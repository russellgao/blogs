[{"categories":null,"content":"Alpine å®¹å™¨å†…å®‰è£…å‘½ä»¤æ—¶é‡åˆ°å‘","date":"2021-02-19","objectID":"/linux-alpine-apk/","tags":["linux","alpine","apk","docker"],"title":"Alpine å®¹å™¨å†…å®‰è£…å‘½ä»¤æ—¶é‡åˆ°å‘","uri":"/linux-alpine-apk/"},{"categories":null,"content":"å¯¼è¯» è®°å½•åœ¨ Alpine å®¹å™¨å†…å®‰è£…å‘½ä»¤æ—¶é‡åˆ°çš„ä¸€äº›é—®é¢˜ï¼Œæœ¬ç¯‡æ–‡ç« ä¼šæŒç»­æ›´æ–°ã€‚ é—®é¢˜èƒŒæ™¯æ˜¯åœ¨docker å®¹å™¨å†…æ‰§è¡Œ docker å‘½ä»¤ï¼Œæ‰§è¡Œæ—¶å‘ç°ç¼ºå°‘æŸäº›ä¾èµ–åŒ…ï¼Œåœ¨å®‰è£…ä¾èµ–åŒ…æ—¶é‡åˆ°ä¸€äº›éš¾ä»¥è§£å†³çš„é—®é¢˜ã€‚ ","date":"2021-02-19","objectID":"/linux-alpine-apk/:1:0","tags":["linux","alpine","apk","docker"],"title":"Alpine å®¹å™¨å†…å®‰è£…å‘½ä»¤æ—¶é‡åˆ°å‘","uri":"/linux-alpine-apk/"},{"categories":null,"content":"åœ¨å®¹å™¨å†…æ‰§è¡Œ docker å‘½ä»¤ åœ¨ docker å®¹å™¨æ‰§è¡Œ docker å‘½ä»¤ï¼Œå¦‚å¯åŠ¨æ–°çš„å®¹å™¨ï¼Œéœ€è¦æŠŠä¸»æœºçš„ docker sock å¥—æ¥å­—æ˜ å°„åˆ°å®¹å™¨å†… ã€‚ å…·ä½“æ–¹æ³•ä¸º: docker run -v /usr/bin/docker:/bin/docker \\ -v /var/run/docker.sock:/var/run/docker.sock \\ xxx ","date":"2021-02-19","objectID":"/linux-alpine-apk/:2:0","tags":["linux","alpine","apk","docker"],"title":"Alpine å®¹å™¨å†…å®‰è£…å‘½ä»¤æ—¶é‡åˆ°å‘","uri":"/linux-alpine-apk/"},{"categories":null,"content":"error while loading shared libraries: libltdl.so.7 å¦‚æœæ‰§è¡Œ docker å‘½ä»¤æŠ¥é”™å¦‚ä¸‹: error while loading shared libraries: libltdl.so.7: cannot open shared object file: No such file or directory è¯´æ˜ç¼ºå°‘å¯¹åº”çš„ä¾èµ–åº“ï¼Œå®‰è£…æ–¹æ³•ä¸º : apk add --no-cache libltdl å¦‚æœæ˜¯ Centos å®¹å™¨: yum install libtool-ltdl -y å¦‚æœæ˜¯ Ubantu å®¹å™¨: sudo apt-get update sudo apt-get install libltdl-dev ","date":"2021-02-19","objectID":"/linux-alpine-apk/:3:0","tags":["linux","alpine","apk","docker"],"title":"Alpine å®¹å™¨å†…å®‰è£…å‘½ä»¤æ—¶é‡åˆ°å‘","uri":"/linux-alpine-apk/"},{"categories":null,"content":"2 errors; 50 MiB in 38 packages å¦‚æœå®‰è£… libltdl æ—¶æŠ¥é”™å¦‚ä¸‹ï¼š apk add --no-cache libltdl fetch http://mirrors.ustc.edu.cn/alpine/v3.4/main/x86_64/APKINDEX.tar.gz fetch http://mirrors.ustc.edu.cn/alpine/v3.4/community/x86_64/APKINDEX.tar.gz 2 errors; 50 MiB in 38 packages è¯´æ˜æ²¡æœ‰å®‰è£…æˆåŠŸï¼Œéœ€è¦ç»§ç»­å®šä½é”™è¯¯æ–¹æ³•ã€‚è¿™æ—¶å€™å¯ä»¥æ‰§è¡Œ apk update æ›´æ–°ä¸€ä¸‹æœ¬åœ°ç´¢å¼• : apk update fetch http://mirrors.ustc.edu.cn/alpine/v3.4/main/x86_64/APKINDEX.tar.gz ERROR: http://mirrors.ustc.edu.cn/alpine/v3.4/main: Bad file descriptor WARNING: Ignoring APKINDEX.0d9a6724.tar.gz: Bad file descriptor fetch http://mirrors.ustc.edu.cn/alpine/v3.4/community/x86_64/APKINDEX.tar.gz ERROR: http://mirrors.ustc.edu.cn/alpine/v3.4/community: Bad file descriptor WARNING: Ignoring APKINDEX.6a82a2a6.tar.gz: Bad file descriptor 2 errors; 38 distinct packages available å¯ä»¥çœ‹åˆ°åˆæŠ¥é”™äº†ï¼Œè¿™ä¸ªé”™è¯¯è¯´æ˜æ–‡ä»¶æè¿°ç¬¦æœ‰é—®é¢˜ ï¼Œè§£å†³æ–¹æ³•åˆ é™¤æœ¬åœ°ç¼“å­˜ç›®å½•å¹¶é‡æ–°åˆ›å»ºå³å¯ : rm -fr /var/cache/apk mkdir -p mkdir /var/cache/apk è¿™æ—¶å€™å†æ‰§è¡Œ apk update å°±å¯ä»¥äº† apk update -v fetch http://mirrors.ustc.edu.cn/alpine/v3.4/main/x86_64/APKINDEX.tar.gz fetch http://mirrors.ustc.edu.cn/alpine/v3.4/community/x86_64/APKINDEX.tar.gz v3.4.6-316-g63ea6d0 [http://mirrors.ustc.edu.cn/alpine/v3.4/main] v3.4.6-160-g14ad2a3 [http://mirrors.ustc.edu.cn/alpine/v3.4/community] OK: 5984 distinct packages available å†æ¬¡æ‰§è¡Œ apk add --no-cache libltdl å¦‚æœè¿˜æ˜¯æŠ¥é”™åˆ™å¯ä»¥æ‰§è¡Œ apk fix è¿›è¡Œä¿®å¤ : apk fix (1/2) Reinstalling busybox (1.24.2-r14) Executing busybox-1.24.2-r14.post-upgrade (2/2) [APK unavailable, skipped] Reinstalling glibc-bin (2.25-r0) Executing busybox-1.24.2-r14.trigger 1 errors; 164 MiB in 56 packages bash-4.3# bash-4.3# apk fix -v (1/1) [APK unavailable, skipped] Reinstalling glibc-bin (2.25-r0) 1 errors; 56 packages, 333 dirs, 7131 files, 164 MiB ä»ä¸Šé¢çš„ä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼Œåœ¨ fix é˜¶æ®µ fix glibc-bin å¤±è´¥äº†ï¼Œé‚£å°±éœ€è¦æ‰‹åŠ¨åˆ é™¤å†é‡æ–°å®‰è£…äº†ã€‚ apk del glibc-bin World updated, but the following packages are not removed due to: glibc-bin: glibc-i18n 1 errors; 164 MiB in 56 packages å¯ä»¥å¦‚æœè¦åˆ é™¤ glibc-bin éœ€è¦å…ˆåˆ é™¤ glibc-i18n apk del glibc-i18n (1/2) Purging glibc-i18n (2.25-r0) (2/2) Purging glibc-bin (2.25-r0) OK: 151 MiB in 54 packages apk del glibc-bin è¿™æ—¶å€™é‡æ–° fix : apk fix -v OK: 54 packages, 256 dirs, 6543 files, 151 MiB å†æ¬¡å®‰è£… libltdl apk add -v --no-cache libltdl fetch http://mirrors.ustc.edu.cn/alpine/v3.4/main/x86_64/APKINDEX.tar.gz fetch http://mirrors.ustc.edu.cn/alpine/v3.4/community/x86_64/APKINDEX.tar.gz OK: 54 packages, 256 dirs, 6543 files, 151 MiB å¯ä»¥çœ‹åˆ°é—®é¢˜å®Œç¾è§£å†³ ã€‚ ","date":"2021-02-19","objectID":"/linux-alpine-apk/:4:0","tags":["linux","alpine","apk","docker"],"title":"Alpine å®¹å™¨å†…å®‰è£…å‘½ä»¤æ—¶é‡åˆ°å‘","uri":"/linux-alpine-apk/"},{"categories":null,"content":"æ€»ç»“ è®°å½•åœ¨ alpine å®¹å™¨å†…å®‰è£…åº“æ—¶é‡åˆ°çš„å‘ï¼Œæ­¤ç¯‡æ–‡ç« æŒç»­æ›´æ–° ã€‚ ","date":"2021-02-19","objectID":"/linux-alpine-apk/:5:0","tags":["linux","alpine","apk","docker"],"title":"Alpine å®¹å™¨å†…å®‰è£…å‘½ä»¤æ—¶é‡åˆ°å‘","uri":"/linux-alpine-apk/"},{"categories":null,"content":"äº¤å‰æ‰“å°","date":"2021-02-18","objectID":"/argorithm/go-goroutine-print/","tags":["å¤šçº¿ç¨‹","goroutine","go"],"title":"äº¤å‰æ‰“å°","uri":"/argorithm/go-goroutine-print/"},{"categories":null,"content":"äº¤å‰æ‰“å° æ•°å­—å’Œå­—æ¯äº¤å‰æ‰“å°ï¼Œæ‰“å°ä¸¤ä¸ªå­—æ¯ï¼Œæ¥ç€æ‰“å°ä¸€ä¸ªæ•°å­—ï¼Œå†æ¥ç€æ‰“å°ä¸¤ä¸ªå­—æ¯ï¼Œä¸€ç›´ä» a æ‰“å°åˆ° zï¼Œä»¥å­—æ¯ç»“æŸã€‚è¾“å‡ºç¤ºä¾‹ï¼š a b 1 c d 2 ... z ç”¨ goè¯­è¨€çš„å¤šçº¿ç¨‹å®ç° ","date":"2021-02-18","objectID":"/argorithm/go-goroutine-print/:0:0","tags":["å¤šçº¿ç¨‹","goroutine","go"],"title":"äº¤å‰æ‰“å°","uri":"/argorithm/go-goroutine-print/"},{"categories":null,"content":"å®ç°åŸç† ç”¨ä¸¤ä¸ª goroutine å®ç°ï¼Œä¸€ä¸ªæ‰“å°å­—æ¯ï¼Œä¸€ä¸ªæ‰“å°æ•°å­—ï¼Œé€šè¿‡ä¸€ä¸ª chan æ§åˆ¶æ‰“å°é¡ºåºã€‚ ","date":"2021-02-18","objectID":"/argorithm/go-goroutine-print/:1:0","tags":["å¤šçº¿ç¨‹","goroutine","go"],"title":"äº¤å‰æ‰“å°","uri":"/argorithm/go-goroutine-print/"},{"categories":null,"content":"å®ç° package main import \"fmt\" func main() { done := make(chan bool) c := make(chan bool) go func() { defer func() { done \u003c- true }() letter := []string{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"} for i, item := range letter { if i%2 == 0 || i == 25 { c \u003c- false } else { c \u003c- true } fmt.Println(item) } close(c) }() go func() { count := 1 for item := range c { if item { fmt.Println(count) count++ } } }() \u003c-done } ","date":"2021-02-18","objectID":"/argorithm/go-goroutine-print/:2:0","tags":["å¤šçº¿ç¨‹","goroutine","go"],"title":"äº¤å‰æ‰“å°","uri":"/argorithm/go-goroutine-print/"},{"categories":null,"content":"äº¤å‰æ‰“å°","date":"2021-02-18","objectID":"/go-goroutine-print/","tags":["å¤šçº¿ç¨‹","goroutine","go"],"title":"äº¤å‰æ‰“å°","uri":"/go-goroutine-print/"},{"categories":null,"content":"äº¤å‰æ‰“å° æ•°å­—å’Œå­—æ¯äº¤å‰æ‰“å°ï¼Œæ‰“å°ä¸¤ä¸ªå­—æ¯ï¼Œæ¥ç€æ‰“å°ä¸€ä¸ªæ•°å­—ï¼Œå†æ¥ç€æ‰“å°ä¸¤ä¸ªå­—æ¯ï¼Œä¸€ç›´ä» a æ‰“å°åˆ° zï¼Œä»¥å­—æ¯ç»“æŸã€‚è¾“å‡ºç¤ºä¾‹ï¼š a b 1 c d 2 ... z ç”¨ goè¯­è¨€çš„å¤šçº¿ç¨‹å®ç° ","date":"2021-02-18","objectID":"/go-goroutine-print/:0:0","tags":["å¤šçº¿ç¨‹","goroutine","go"],"title":"äº¤å‰æ‰“å°","uri":"/go-goroutine-print/"},{"categories":null,"content":"å®ç°åŸç† ç”¨ä¸¤ä¸ª goroutine å®ç°ï¼Œä¸€ä¸ªæ‰“å°å­—æ¯ï¼Œä¸€ä¸ªæ‰“å°æ•°å­—ï¼Œé€šè¿‡ä¸€ä¸ª chan æ§åˆ¶æ‰“å°é¡ºåºã€‚ ","date":"2021-02-18","objectID":"/go-goroutine-print/:1:0","tags":["å¤šçº¿ç¨‹","goroutine","go"],"title":"äº¤å‰æ‰“å°","uri":"/go-goroutine-print/"},{"categories":null,"content":"å®ç° package main import \"fmt\" func main() { done := make(chan bool) c := make(chan bool) go func() { defer func() { done \u003c- true }() letter := []string{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\", \"h\", \"i\", \"j\", \"k\", \"l\", \"m\", \"n\", \"o\", \"p\", \"q\", \"r\", \"s\", \"t\", \"u\", \"v\", \"w\", \"x\", \"y\", \"z\"} for i, item := range letter { if i%2 == 0 || i == 25 { c \u003c- false } else { c \u003c- true } fmt.Println(item) } close(c) }() go func() { count := 1 for item := range c { if item { fmt.Println(count) count++ } } }() \u003c-done } ","date":"2021-02-18","objectID":"/go-goroutine-print/:2:0","tags":["å¤šçº¿ç¨‹","goroutine","go"],"title":"äº¤å‰æ‰“å°","uri":"/go-goroutine-print/"},{"categories":null,"content":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","date":"2021-02-06","objectID":"/kubernetes/k8s-kind/","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/kubernetes/k8s-kind/"},{"categories":null,"content":"å¯¼è¯» kubernetes ç°åœ¨å·²ç»èµ°è¿›äº†å¤§ä¼—çš„è§†é‡ï¼Œå¾ˆå¤šåŒå­¦éƒ½å¯¹æ­¤æ¯”è¾ƒå¥½å¥‡ï¼Œä»å…¶ä»–æ¸ é“æˆ–å¤šæˆ–å°‘éƒ½äº†è§£äº†ä¸€äº›ï¼Œä½†æ˜¯è‹¦äºæ²¡æœ‰kubernetesç¯å¢ƒï¼Œä¸èƒ½èº«ä¸´å…¶å¢ƒçš„æ„Ÿå—ï¼Œ æ¯•ç«Ÿå¦‚æœå®Œæ•´æ­å»ºä¸€å¥—kubernetesç¯å¢ƒæ˜¯éœ€è¦èµ„æºçš„ã€‚ ä»Šå¤©ä»‹ç»ä¸€æ¬¾å·¥å…·ï¼ˆkindï¼‰ï¼Œè®©å¤§å®¶å¯ä»¥æœ¬åœ°ä¹Ÿå¯ä»¥æ„å»ºèµ· kubernetes ç¯å¢ƒï¼Œæ„‰å¿«çš„åœ¨æœ¬åœ°ç©è½¬ kubernetesã€‚ kind å…¨ç§° æ˜¯ kubernetes in docker ï¼ŒæŠŠ kubernetes æ§åˆ¶é¢çš„ç»„ä»¶å…¨éƒ¨è¿è¡Œåœ¨ä¸€ä¸ªdocker å®¹å™¨ä¸­ï¼Œåœ¨æœ¬åœ°é€šè¿‡ 127.0.0.1 è¿›è¡Œé€šä¿¡ã€‚è¿™ç§ç©æ³•åªèƒ½åœ¨æœ¬åœ°ä½“éªŒï¼Œ ä¸å¯ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œç‰¹åˆ«é€‚ç”¨äºæ–°äººåœ¨æœ¬åœ°ä½“éªŒã€å¼€å‘ kubernetes ç›¸å…³ç»„ä»¶æ—¶åœ¨æœ¬åœ°è¿›è¡Œè°ƒè¯•ç­‰ï¼Œå¦‚å¼€å§‹ operator æ—¶å¯ä»¥åœ¨ kind è¿›è¡Œè°ƒè¯• ã€‚ è¯¦ç»†ç”¨æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ ","date":"2021-02-06","objectID":"/kubernetes/k8s-kind/:1:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/kubernetes/k8s-kind/"},{"categories":null,"content":"kind å‚è€ƒèµ„æ–™ å®˜ç½‘: https://kind.sigs.k8s.io/ å®˜æ–¹æ–‡æ¡£: https://kind.sigs.k8s.io/docs/user/quick-start/ github : https://github.com/kubernetes-sigs/kind ","date":"2021-02-06","objectID":"/kubernetes/k8s-kind/:2:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/kubernetes/k8s-kind/"},{"categories":null,"content":"å®‰è£… ","date":"2021-02-06","objectID":"/kubernetes/k8s-kind/:3:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/kubernetes/k8s-kind/"},{"categories":null,"content":"æœ‰ golang ç¯å¢ƒ å¦‚æœæœ‰ golang ç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å®‰è£… : GO111MODULE=\"on\" go get sigs.k8s.io/kind@v0.10.0 å¦‚æœä¸‹è½½çš„æ¯”è¾ƒæ…¢å¯ä»¥è®¾ç½®ä»£ç†ï¼Œå¢åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡å³å¯: GOPROXY=\"https://goproxy.cn\" ","date":"2021-02-06","objectID":"/kubernetes/k8s-kind/:3:1","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/kubernetes/k8s-kind/"},{"categories":null,"content":"æ—  golang ç¯å¢ƒ Linux : curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64 chmod +x ./kind mv ./kind /some-dir-in-your-PATH/kind Mac (homebrew) brew install kind æˆ–è€… : curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-darwin-amd64 Windows: curl.exe -Lo kind-windows-amd64.exe https://kind.sigs.k8s.io/dl/v0.10.0/kind-windows-amd64 Move-Item .\\kind-windows-amd64.exe c:\\some-dir-in-your-PATH\\kind.exe ","date":"2021-02-06","objectID":"/kubernetes/k8s-kind/:3:2","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/kubernetes/k8s-kind/"},{"categories":null,"content":"åŸºæœ¬å‘½ä»¤ é€šè¿‡ kind --help çœ‹çœ‹æ”¯æŒå“ªäº›å‘½ä»¤ kind --help kind creates and manages local Kubernetes clusters using Docker container 'nodes' Usage: kind [command] Available Commands: build Build one of [node-image] completion Output shell completion code for the specified shell (bash, zsh or fish) create Creates one of [cluster] delete Deletes one of [cluster] export Exports one of [kubeconfig, logs] get Gets one of [clusters, nodes, kubeconfig] help Help about any command load Loads images into nodes version Prints the kind CLI version Flags: -h, --help help for kind --loglevel string DEPRECATED: see -v instead -q, --quiet silence all stderr output -v, --verbosity int32 info log verbosity --version version for kind Use \"kind [command] --help\" for more information about a command. å¯ä»¥çœ‹å‡ºæ”¯æŒ3ç§ç±»å‹çš„å‘½ä»¤ï¼Œcluster ç›¸å…³ã€image ç›¸å…³ã€é€šç”¨å‘½ä»¤ ã€‚ cluster ç›¸å…³çš„æœ‰ create, delete ç­‰ï¼Œä¸»è¦ç”¨äºåˆ›å»ºå’Œåˆ é™¤ kubernetes é›†ç¾¤ã€‚ image ç›¸å…³çš„æœ‰ buildï¼Œ load ç­‰ï¼Œä¸»è¦ç”¨äºæœ¬åœ°è°ƒè¯•æ—¶ï¼Œæœ¬åœ°å¯ä»¥ buildé•œåƒç›´æ¥load åˆ°é›†ç¾¤ä¸­ï¼Œè€Œä¸éœ€è¦æ¨é€åˆ°é•œåƒä»“åº“å†é€šè¿‡é›†ç¾¤å» pull ã€‚ é€šç”¨å‘½ä»¤å¦‚ get ï¼Œversion ç­‰ã€‚ kind â€“version kind --version kind version 0.9.0 æœ¬ç¯‡æ–‡ç« ä»¥ kind 0.9.0 è¿›è¡Œä»‹ç» ã€‚ä¸‹é¢æ˜¯æ¯”è¾ƒç²¾å½©çš„éƒ¨åˆ†ï¼Œä»”ç»†çœ‹å“¦ ğŸ‘€ ","date":"2021-02-06","objectID":"/kubernetes/k8s-kind/:4:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/kubernetes/k8s-kind/"},{"categories":null,"content":"åˆ›å»º kubernetes é›†ç¾¤ åˆ›å»ºä¸€ä¸ª kubernetes é›†ç¾¤ ï¼š kind create cluster Creating cluster \"kind\" ... âœ“ Ensuring node image (kindest/node:v1.19.1) ğŸ–¼ âœ“ Preparing nodes ğŸ“¦ âœ“ Writing configuration ğŸ“œ âœ“ Starting control-plane ğŸ•¹ï¸ âœ“ Installing CNI ğŸ”Œ âœ“ Installing StorageClass ğŸ’¾ Set kubectl context to \"kind-kind\" You can now use your cluster with: kubectl cluster-info --context kind-kind Thanks for using kind! ğŸ˜Š ä¸€æ¡å‘½ä»¤å°±å·²ç»å¯åŠ¨å¥½äº†ä¸€ä¸ªé›†ç¾¤ ï¼Œå¯ä»¥é€šè¿‡ kind get clusters æŸ¥çœ‹å·²ç»åˆ›å»ºçš„é›†ç¾¤ã€‚ kind get clusters kind æ—¢ç„¶æ˜¯ kubernetes in docker ï¼Œé‚£å°±çœ‹çœ‹å¯åŠ¨äº†å“ªäº›å®¹å™¨ : docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES fdb88a476bb0 kindest/node:v1.19.1 \"/usr/local/bin/entrâ€¦\" 3 minutes ago Up 2 minutes 127.0.0.1:43111-\u003e6443/tcp kind-control-plane å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªæ§åˆ¶é¢çš„å®¹å™¨å¯åŠ¨äº†ï¼Œè¿›åˆ°å®¹å™¨ä¸­çœ‹çœ‹éƒ½æœ‰ä»€ä¹ˆ [root@iZuf685opgs9oyozju9i2bZ ~]# docker exec -it kind-control-plane bash root@kind-control-plane:/# root@kind-control-plane:/# root@kind-control-plane:/# ps -ef UID PID PPID C STIME TTY TIME CMD root 1 0 0 02:49 ? 00:00:00 /sbin/init root 126 1 0 02:49 ? 00:00:00 /lib/systemd/systemd-journald root 145 1 1 02:49 ? 00:00:06 /usr/local/bin/containerd root 257 1 0 02:49 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id c1a5e2c868b9a744f4f78a85a8d660950bb76103a38e7 root 271 1 0 02:49 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 3549ecade28e2dccbad5ed15a4cd2b6e6a886cd3e10ab root 297 1 0 02:49 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 379ed27442f35696d488dd5a63cc61dc474bfa9bd08a9 root 335 1 0 02:49 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id e4eae33bf489c617c7133ada7dbd92129f3f817cb74b7 root 343 271 0 02:49 ? 00:00:00 /pause root 360 257 0 02:49 ? 00:00:00 /pause root 365 297 0 02:49 ? 00:00:00 /pause root 377 335 0 02:49 ? 00:00:00 /pause root 443 335 0 02:49 ? 00:00:01 kube-scheduler --authentication-kubeconfig=/etc/kubernetes/scheduler.conf --authorization-kubeconfig=/etc/ root 468 297 4 02:49 ? 00:00:17 kube-apiserver --advertise-address=172.18.0.2 --allow-privileged=true --authorization-mode=Node,RBAC --cli root 496 271 1 02:49 ? 00:00:05 kube-controller-manager --allocate-node-cidrs=true --authentication-kubeconfig=/etc/kubernetes/controller- root 540 257 1 02:49 ? 00:00:05 etcd --advertise-client-urls=https://172.18.0.2:2379 --cert-file=/etc/kubernetes/pki/etcd/server.crt --cli root 580 1 1 02:49 ? 00:00:06 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernete root 673 1 0 02:50 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id b0965a6f77f58c46cfe7b30dd84ddf4bc37516ba60e6e root 695 673 0 02:50 ? 00:00:00 /pause root 709 1 0 02:50 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id aedf0f1fd02baf1cf2b253ad11e33e396d97cc7c53114 root 738 709 0 02:50 ? 00:00:00 /pause root 789 673 0 02:50 ? 00:00:00 /usr/local/bin/kube-proxy --config=/var/lib/kube-proxy/config.conf --hostname-override=kind-control-plane root 798 709 0 02:50 ? 00:00:00 /bin/kindnetd root 1011 1 0 02:50 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id aa554aa998c3091a70eacbc3e4a2f275a1e680a585d69 root 1024 1 0 02:50 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 7373488f811fc5d638c2b3f5f79d953573e30a42ff52f root 1048 1 0 02:50 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 5ab6c3ef1715623e2c28fbfdecd5f4e6e2616fc20a387 root 1079 1011 0 02:50 ? 00:00:00 /pause root 1088 1024 0 02:50 ? 00:00:00 /pause root 1095 1048 0 02:50 ? 00:00:00 /pause root 1152 1011 0 02:50 ? 00:00:00 /coredns -conf /etc/coredns/Corefile root 1196 1024 0 02:50 ? 00:00:00 /coredns -conf /etc/coredns/Corefile root 1205 1048 0 02:50 ? 00:00:00 local-path-provisioner --debug start --helper-image k8s.gcr.io/build-image/debian-base:v2.1.0 --config /et root 1961 0 0 02:56 pts/1 00:00:00 bash root 1969 1961 0 02:56 pts/1 00:00:00 ps -ef root@kind-control-plane:/# å¯ä»¥çœ‹åˆ°å®¹å™¨ä¸­æœ‰å¾ˆå¤šè¿›ç¨‹ï¼Œä»”ç»†æ¢³ç†ä¸€ä¸‹çœ‹çœ‹æœ‰ä»€ä¹ˆç»„ä»¶ kube-apiserver â€¦ : api-serve","date":"2021-02-06","objectID":"/kubernetes/k8s-kind/:5:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/kubernetes/k8s-kind/"},{"categories":null,"content":"ä½¿ç”¨é›†ç¾¤ å…³äº kubernetes çš„ä½¿ç”¨å·²ç»æœ‰å¾ˆå¤šæ–‡ç« æ¥ä»‹ç»äº†ï¼Œæ‰€ä»¥è¿™é‡Œä¸ä½œä¸ºé‡ç‚¹ä»‹ç»ï¼Œç®€å•æ¼”ç¤ºä¸€ä¸‹ã€‚å¯ä»¥é€šè¿‡ api æˆ–è€… kubectl ä¸kuberntes è¿›è¡Œäº¤äº’ï¼Œ è¿™é‡Œé€‰æ‹©ç”¨ kubectl è¿›è¡Œæ¼”ç¤ºã€‚ å¦‚æœæœ¬åœ°æ²¡æœ‰ kubectl éœ€è¦è¿›è¡Œå®‰è£…ï¼Œå®‰è£…æ–‡æ¡£å‚è§ï¼š https://kubernetes.io/docs/tasks/tools/install-kubectl/ kubectl çš„åŸºæœ¬ç”¨æ³•å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  ï¼škubectl å¸¸ç”¨å‘½ä»¤ ä»¥ éƒ¨ç½² logstash ä¸ºä¾‹ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºå¦‚ä¸‹èµ„æº ï¼š Namespace Deployment Configmap Hpa Service å…·ä½“çš„ yaml æ–‡ä»¶å¦‚ä¸‹ : cat logstash.yaml ---# setting NamespaceapiVersion:v1kind:Namespacemetadata:name:logging---# setting ConfigMapkind:ConfigMapapiVersion:v1metadata:name:logstash-confnamespace:loggingdata:logstash.conf:| input {http{host=\u003e\"0.0.0.0\"# default: 0.0.0.0port =\u003e 8080 # default:8080response_headers=\u003e{\"Content-Type\"=\u003e\"text/plain\"\"Access-Control-Allow-Origin\"=\u003e\"*\"\"Access-Control-Allow-Methods\"=\u003e\"GET, POST, DELETE, PUT\"\"Access-Control-Allow-Headers\"=\u003e\"authorization, content-type\"\"Access-Control-Allow-Credentials\"=\u003etrue}}}output{stdout{codec=\u003erubydebug}}---# setting DepolymentapiVersion:apps/v1kind:Deploymentmetadata:name:logstashnamespace:loggingspec:replicas:1selector:matchLabels:app:logstashtemplate:metadata:labels:app:logstashspec:volumes:- name:configconfigMap:name:logstash-confhostname:logstashcontainers:- name:logstashimage:russellgao/logstash:7.2.0args:[\"-f\",\"/usr/share/logstash/pipeline/logstash.conf\",]imagePullPolicy:IfNotPresentvolumeMounts:- name:configmountPath:\"/usr/share/logstash/pipeline/logstash.conf\"readOnly:truesubPath:logstash.confresources:requests:cpu:1memory:2048Milimits:cpu:3memory:3072MireadinessProbe:tcpSocket:port:8080initialDelaySeconds:5periodSeconds:10livenessProbe:tcpSocket:port:8080initialDelaySeconds:15periodSeconds:20timeoutSeconds:15imagePullSecrets:- name:harbor---apiVersion:autoscaling/v2beta1kind:HorizontalPodAutoscalermetadata:name:logstash-hpanamespace:loggingspec:scaleTargetRef:apiVersion:apps/v1beta2kind:Deploymentname:logstashminReplicas:1maxReplicas:10metrics:- type:Resourceresource:name:cputargetAverageUtilization:80---apiVersion:v1kind:Servicemetadata:name:logstash-custeripnamespace:loggingspec:selector:app:logstashtype:ClusterIPports:- name:'port'protocol:TCPport:8080targetPort:8080 æ‰§è¡Œ kubectl apply -f logstash.yaml kubectl apply -f logstash.yaml namespace/logging created configmap/logstash-conf created deployment.apps/logstash created horizontalpodautoscaler.autoscaling/logstash-hpa created service/logstash-custerip created å¯ä»¥çœ‹åˆ°å…·ä½“çš„èµ„æºå·²ç»è¢«åˆ›å»ºå‡ºæ¥ï¼Œä¸‹é¢æ¥è§‚å¯Ÿå…·ä½“çš„èµ„æº : æŸ¥çœ‹ ConfigMap : kubectl -n logging get configmap NAME DATA AGE logstash-conf 1 4m æŸ¥çœ‹ Deployment : kubectl -n logging get deployment NAME READY UP-TO-DATE AVAILABLE AGE logstash 1/1 1 1 4m æŸ¥çœ‹ Pod : kubectl -n logging get po -owide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES logstash-64d58c4b98-nqk4v 1/1 Running 0 93s 10.244.0.9 kind-control-plane \u003cnone\u003e \u003cnone\u003e è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ Pod æ‰€åœ¨çš„ node æ˜¯ kind-control-plane ï¼Œè€Œéæœ¬æœºï¼Œè¯´æ˜ kubernetes node å°±æ˜¯è¿™ä¸ªå®¹å™¨ï¼Œåœ¨æœ¬åœ° curl 10.244.0.9:8080 è¿™ä¸ªåœ°å€æ˜¯ä¸é€šï¼Œè¯´æ˜æ˜¯åœ¨é›†ç¾¤å¤–ï¼Œ è¿›åˆ°å®¹å™¨å†…å† curl å°±æ˜¯é€šçš„ ï¼š curl 10.244.0.9:8080 -v * About to connect() to 10.244.0.9 port 8080 (#0) * Trying 10.244.0.9... ^C [root@iZuf685opgs9oyozju9i2bZ k8s]# [root@iZuf685opgs9oyozju9i2bZ k8s]# [root@iZuf685opgs9oyozju9i2bZ k8s]# docker exec -it kind-control-plane bash root@kind-control-plane:/# curl 10.244.0.9:8080 -v * Trying 10.244.0.9:8080... * TCP_NODELAY set * Connected to 10.244.0.9 (10.244.0.9) port 8080 (#0) \u003e GET / HTTP/1.1 \u003e Host: 10.244.0.9:8080 \u003e User-Agent: curl/7.68.0 \u003e Accept: */* \u003e * Mark bundle as not supporting multiuse \u003c HTTP/1.1 200 OK \u003c Access-Control-Allow-Origin: * \u003c Access-Control-Allow-Methods: GET, POST, DELETE, PUT \u003c Access-Control-Allow-Headers: authorization, content-type \u003c Access-Control-Allow-Credentials: true \u003c content-length: 2 \u003c content-type: text/plain \u003c * Connection #0 to host 10.244.0.9 left intact okroot@kind-control-plane:/# æŸ¥çœ‹ service : kubectl -n logging get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE logstash-custerip ClusterIP 10.96.234.144 \u003cnone\u003e 8080/TCP 5m pod å’Œ service çš„åŸç†æ˜¯ä¸€æ ·çš„ï¼Œé€šè¿‡ CLUSTER-IP è®¿é—®åªèƒ½åœ¨å®¹å™¨å†…è¿›è¡Œè®¿é—®ã€‚ åœ¨ pod å†…è¿›è¡Œè®¿é—® [root@iZuf685opgs9oyozju9i2bZ k8s]# kubectl -n logging exec -it logst","date":"2021-02-06","objectID":"/kubernetes/k8s-kind/:6:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/kubernetes/k8s-kind/"},{"categories":null,"content":"ç¯å¢ƒæ¸…ç† åœ¨æœ¬åœ°ä½“éªŒå®Œæˆ–è€…æµ‹è¯•å®Œæˆä¹‹åï¼Œä¸ºäº†èŠ‚çœèµ„æºï¼Œå¯ä»¥æŠŠåˆšåˆšå¯åŠ¨çš„é›†ç¾¤è¿›è¡Œåˆ é™¤ï¼Œä¸‹æ¬¡éœ€è¦æ—¶å†åˆ›å»ºå³å¯ ã€‚ kind delete cluster Deleting cluster \"kind\" ... [root@iZuf685opgs9oyozju9i2bZ k8s]# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 4ec800c3ec10 russellgao/openresty:1.17.8.2-5-alpine \"/usr/local/openrestâ€¦\" 8 weeks ago Up 7 days 0.0.0.0:80-\u003e80/tcp, 0.0.0.0:443-\u003e443/tcp openresty-app-1 [root@iZuf685opgs9oyozju9i2bZ k8s]# kubectl -n logging get po The connection to the server localhost:8080 was refused - did you specify the right host or port? é€šè¿‡ä¸Šé¢çš„å‘½ä»¤å¯ä»¥çœ‹å‡º : å½“æ‰§è¡Œ kind delete cluster å‘½ä»¤ä¹‹åä¼šæŠŠæ§åˆ¶é¢çš„å®¹å™¨(kind-control-plane) åˆ é™¤ å½“å†æ¬¡æ‰§è¡Œ kubectl å‘½ä»¤æ˜¯å·²ç»æ— æ³•æ‰¾åˆ°å¯¹åº”çš„ api-serveråœ°å€ï¼Œå¯ä»¥æŸ¥çœ‹ .kube/config æ–‡ä»¶ï¼Œå‘ç°å·²ç»åˆ é™¤äº†å…³äºé›†ç¾¤çš„é…ç½®ä¿¡æ¯ã€‚ ","date":"2021-02-06","objectID":"/kubernetes/k8s-kind/:7:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/kubernetes/k8s-kind/"},{"categories":null,"content":"æ€»ç»“ æœ¬ç¯‡ä»‹ç»äº† kind(kubernetes in docker) çš„åŸºæœ¬ç”¨æ³•ï¼Œå¯ä»¥åœ¨æœ¬åœ°å¿«é€Ÿæ„å»ºèµ·kubernetes ç¯å¢ƒï¼Œé€‚åˆæ–°äººå¿«é€Ÿå…¥é—¨ã€è°ƒè¯•k8s ç›¸å…³ç»„ä»¶ï¼Œæµ‹è¯•operator ç­‰ã€‚ ","date":"2021-02-06","objectID":"/kubernetes/k8s-kind/:8:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/kubernetes/k8s-kind/"},{"categories":null,"content":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","date":"2021-02-06","objectID":"/k8s-kind/","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/k8s-kind/"},{"categories":null,"content":"å¯¼è¯» kubernetes ç°åœ¨å·²ç»èµ°è¿›äº†å¤§ä¼—çš„è§†é‡ï¼Œå¾ˆå¤šåŒå­¦éƒ½å¯¹æ­¤æ¯”è¾ƒå¥½å¥‡ï¼Œä»å…¶ä»–æ¸ é“æˆ–å¤šæˆ–å°‘éƒ½äº†è§£äº†ä¸€äº›ï¼Œä½†æ˜¯è‹¦äºæ²¡æœ‰kubernetesç¯å¢ƒï¼Œä¸èƒ½èº«ä¸´å…¶å¢ƒçš„æ„Ÿå—ï¼Œ æ¯•ç«Ÿå¦‚æœå®Œæ•´æ­å»ºä¸€å¥—kubernetesç¯å¢ƒæ˜¯éœ€è¦èµ„æºçš„ã€‚ ä»Šå¤©ä»‹ç»ä¸€æ¬¾å·¥å…·ï¼ˆkindï¼‰ï¼Œè®©å¤§å®¶å¯ä»¥æœ¬åœ°ä¹Ÿå¯ä»¥æ„å»ºèµ· kubernetes ç¯å¢ƒï¼Œæ„‰å¿«çš„åœ¨æœ¬åœ°ç©è½¬ kubernetesã€‚ kind å…¨ç§° æ˜¯ kubernetes in docker ï¼ŒæŠŠ kubernetes æ§åˆ¶é¢çš„ç»„ä»¶å…¨éƒ¨è¿è¡Œåœ¨ä¸€ä¸ªdocker å®¹å™¨ä¸­ï¼Œåœ¨æœ¬åœ°é€šè¿‡ 127.0.0.1 è¿›è¡Œé€šä¿¡ã€‚è¿™ç§ç©æ³•åªèƒ½åœ¨æœ¬åœ°ä½“éªŒï¼Œ ä¸å¯ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œç‰¹åˆ«é€‚ç”¨äºæ–°äººåœ¨æœ¬åœ°ä½“éªŒã€å¼€å‘ kubernetes ç›¸å…³ç»„ä»¶æ—¶åœ¨æœ¬åœ°è¿›è¡Œè°ƒè¯•ç­‰ï¼Œå¦‚å¼€å§‹ operator æ—¶å¯ä»¥åœ¨ kind è¿›è¡Œè°ƒè¯• ã€‚ è¯¦ç»†ç”¨æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚ ","date":"2021-02-06","objectID":"/k8s-kind/:1:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/k8s-kind/"},{"categories":null,"content":"kind å‚è€ƒèµ„æ–™ å®˜ç½‘: https://kind.sigs.k8s.io/ å®˜æ–¹æ–‡æ¡£: https://kind.sigs.k8s.io/docs/user/quick-start/ github : https://github.com/kubernetes-sigs/kind ","date":"2021-02-06","objectID":"/k8s-kind/:2:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/k8s-kind/"},{"categories":null,"content":"å®‰è£… ","date":"2021-02-06","objectID":"/k8s-kind/:3:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/k8s-kind/"},{"categories":null,"content":"æœ‰ golang ç¯å¢ƒ å¦‚æœæœ‰ golang ç¯å¢ƒï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤å®‰è£… : GO111MODULE=\"on\" go get sigs.k8s.io/kind@v0.10.0 å¦‚æœä¸‹è½½çš„æ¯”è¾ƒæ…¢å¯ä»¥è®¾ç½®ä»£ç†ï¼Œå¢åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡å³å¯: GOPROXY=\"https://goproxy.cn\" ","date":"2021-02-06","objectID":"/k8s-kind/:3:1","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/k8s-kind/"},{"categories":null,"content":"æ—  golang ç¯å¢ƒ Linux : curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64 chmod +x ./kind mv ./kind /some-dir-in-your-PATH/kind Mac (homebrew) brew install kind æˆ–è€… : curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-darwin-amd64 Windows: curl.exe -Lo kind-windows-amd64.exe https://kind.sigs.k8s.io/dl/v0.10.0/kind-windows-amd64 Move-Item .\\kind-windows-amd64.exe c:\\some-dir-in-your-PATH\\kind.exe ","date":"2021-02-06","objectID":"/k8s-kind/:3:2","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/k8s-kind/"},{"categories":null,"content":"åŸºæœ¬å‘½ä»¤ é€šè¿‡ kind --help çœ‹çœ‹æ”¯æŒå“ªäº›å‘½ä»¤ kind --help kind creates and manages local Kubernetes clusters using Docker container 'nodes' Usage: kind [command] Available Commands: build Build one of [node-image] completion Output shell completion code for the specified shell (bash, zsh or fish) create Creates one of [cluster] delete Deletes one of [cluster] export Exports one of [kubeconfig, logs] get Gets one of [clusters, nodes, kubeconfig] help Help about any command load Loads images into nodes version Prints the kind CLI version Flags: -h, --help help for kind --loglevel string DEPRECATED: see -v instead -q, --quiet silence all stderr output -v, --verbosity int32 info log verbosity --version version for kind Use \"kind [command] --help\" for more information about a command. å¯ä»¥çœ‹å‡ºæ”¯æŒ3ç§ç±»å‹çš„å‘½ä»¤ï¼Œcluster ç›¸å…³ã€image ç›¸å…³ã€é€šç”¨å‘½ä»¤ ã€‚ cluster ç›¸å…³çš„æœ‰ create, delete ç­‰ï¼Œä¸»è¦ç”¨äºåˆ›å»ºå’Œåˆ é™¤ kubernetes é›†ç¾¤ã€‚ image ç›¸å…³çš„æœ‰ buildï¼Œ load ç­‰ï¼Œä¸»è¦ç”¨äºæœ¬åœ°è°ƒè¯•æ—¶ï¼Œæœ¬åœ°å¯ä»¥ buildé•œåƒç›´æ¥load åˆ°é›†ç¾¤ä¸­ï¼Œè€Œä¸éœ€è¦æ¨é€åˆ°é•œåƒä»“åº“å†é€šè¿‡é›†ç¾¤å» pull ã€‚ é€šç”¨å‘½ä»¤å¦‚ get ï¼Œversion ç­‰ã€‚ kind â€“version kind --version kind version 0.9.0 æœ¬ç¯‡æ–‡ç« ä»¥ kind 0.9.0 è¿›è¡Œä»‹ç» ã€‚ä¸‹é¢æ˜¯æ¯”è¾ƒç²¾å½©çš„éƒ¨åˆ†ï¼Œä»”ç»†çœ‹å“¦ ğŸ‘€ ","date":"2021-02-06","objectID":"/k8s-kind/:4:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/k8s-kind/"},{"categories":null,"content":"åˆ›å»º kubernetes é›†ç¾¤ åˆ›å»ºä¸€ä¸ª kubernetes é›†ç¾¤ ï¼š kind create cluster Creating cluster \"kind\" ... âœ“ Ensuring node image (kindest/node:v1.19.1) ğŸ–¼ âœ“ Preparing nodes ğŸ“¦ âœ“ Writing configuration ğŸ“œ âœ“ Starting control-plane ğŸ•¹ï¸ âœ“ Installing CNI ğŸ”Œ âœ“ Installing StorageClass ğŸ’¾ Set kubectl context to \"kind-kind\" You can now use your cluster with: kubectl cluster-info --context kind-kind Thanks for using kind! ğŸ˜Š ä¸€æ¡å‘½ä»¤å°±å·²ç»å¯åŠ¨å¥½äº†ä¸€ä¸ªé›†ç¾¤ ï¼Œå¯ä»¥é€šè¿‡ kind get clusters æŸ¥çœ‹å·²ç»åˆ›å»ºçš„é›†ç¾¤ã€‚ kind get clusters kind æ—¢ç„¶æ˜¯ kubernetes in docker ï¼Œé‚£å°±çœ‹çœ‹å¯åŠ¨äº†å“ªäº›å®¹å™¨ : docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES fdb88a476bb0 kindest/node:v1.19.1 \"/usr/local/bin/entrâ€¦\" 3 minutes ago Up 2 minutes 127.0.0.1:43111-\u003e6443/tcp kind-control-plane å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªæ§åˆ¶é¢çš„å®¹å™¨å¯åŠ¨äº†ï¼Œè¿›åˆ°å®¹å™¨ä¸­çœ‹çœ‹éƒ½æœ‰ä»€ä¹ˆ [root@iZuf685opgs9oyozju9i2bZ ~]# docker exec -it kind-control-plane bash root@kind-control-plane:/# root@kind-control-plane:/# root@kind-control-plane:/# ps -ef UID PID PPID C STIME TTY TIME CMD root 1 0 0 02:49 ? 00:00:00 /sbin/init root 126 1 0 02:49 ? 00:00:00 /lib/systemd/systemd-journald root 145 1 1 02:49 ? 00:00:06 /usr/local/bin/containerd root 257 1 0 02:49 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id c1a5e2c868b9a744f4f78a85a8d660950bb76103a38e7 root 271 1 0 02:49 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 3549ecade28e2dccbad5ed15a4cd2b6e6a886cd3e10ab root 297 1 0 02:49 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 379ed27442f35696d488dd5a63cc61dc474bfa9bd08a9 root 335 1 0 02:49 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id e4eae33bf489c617c7133ada7dbd92129f3f817cb74b7 root 343 271 0 02:49 ? 00:00:00 /pause root 360 257 0 02:49 ? 00:00:00 /pause root 365 297 0 02:49 ? 00:00:00 /pause root 377 335 0 02:49 ? 00:00:00 /pause root 443 335 0 02:49 ? 00:00:01 kube-scheduler --authentication-kubeconfig=/etc/kubernetes/scheduler.conf --authorization-kubeconfig=/etc/ root 468 297 4 02:49 ? 00:00:17 kube-apiserver --advertise-address=172.18.0.2 --allow-privileged=true --authorization-mode=Node,RBAC --cli root 496 271 1 02:49 ? 00:00:05 kube-controller-manager --allocate-node-cidrs=true --authentication-kubeconfig=/etc/kubernetes/controller- root 540 257 1 02:49 ? 00:00:05 etcd --advertise-client-urls=https://172.18.0.2:2379 --cert-file=/etc/kubernetes/pki/etcd/server.crt --cli root 580 1 1 02:49 ? 00:00:06 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernete root 673 1 0 02:50 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id b0965a6f77f58c46cfe7b30dd84ddf4bc37516ba60e6e root 695 673 0 02:50 ? 00:00:00 /pause root 709 1 0 02:50 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id aedf0f1fd02baf1cf2b253ad11e33e396d97cc7c53114 root 738 709 0 02:50 ? 00:00:00 /pause root 789 673 0 02:50 ? 00:00:00 /usr/local/bin/kube-proxy --config=/var/lib/kube-proxy/config.conf --hostname-override=kind-control-plane root 798 709 0 02:50 ? 00:00:00 /bin/kindnetd root 1011 1 0 02:50 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id aa554aa998c3091a70eacbc3e4a2f275a1e680a585d69 root 1024 1 0 02:50 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 7373488f811fc5d638c2b3f5f79d953573e30a42ff52f root 1048 1 0 02:50 ? 00:00:00 /usr/local/bin/containerd-shim-runc-v2 -namespace k8s.io -id 5ab6c3ef1715623e2c28fbfdecd5f4e6e2616fc20a387 root 1079 1011 0 02:50 ? 00:00:00 /pause root 1088 1024 0 02:50 ? 00:00:00 /pause root 1095 1048 0 02:50 ? 00:00:00 /pause root 1152 1011 0 02:50 ? 00:00:00 /coredns -conf /etc/coredns/Corefile root 1196 1024 0 02:50 ? 00:00:00 /coredns -conf /etc/coredns/Corefile root 1205 1048 0 02:50 ? 00:00:00 local-path-provisioner --debug start --helper-image k8s.gcr.io/build-image/debian-base:v2.1.0 --config /et root 1961 0 0 02:56 pts/1 00:00:00 bash root 1969 1961 0 02:56 pts/1 00:00:00 ps -ef root@kind-control-plane:/# å¯ä»¥çœ‹åˆ°å®¹å™¨ä¸­æœ‰å¾ˆå¤šè¿›ç¨‹ï¼Œä»”ç»†æ¢³ç†ä¸€ä¸‹çœ‹çœ‹æœ‰ä»€ä¹ˆç»„ä»¶ kube-apiserver â€¦ : api-serve","date":"2021-02-06","objectID":"/k8s-kind/:5:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/k8s-kind/"},{"categories":null,"content":"ä½¿ç”¨é›†ç¾¤ å…³äº kubernetes çš„ä½¿ç”¨å·²ç»æœ‰å¾ˆå¤šæ–‡ç« æ¥ä»‹ç»äº†ï¼Œæ‰€ä»¥è¿™é‡Œä¸ä½œä¸ºé‡ç‚¹ä»‹ç»ï¼Œç®€å•æ¼”ç¤ºä¸€ä¸‹ã€‚å¯ä»¥é€šè¿‡ api æˆ–è€… kubectl ä¸kuberntes è¿›è¡Œäº¤äº’ï¼Œ è¿™é‡Œé€‰æ‹©ç”¨ kubectl è¿›è¡Œæ¼”ç¤ºã€‚ å¦‚æœæœ¬åœ°æ²¡æœ‰ kubectl éœ€è¦è¿›è¡Œå®‰è£…ï¼Œå®‰è£…æ–‡æ¡£å‚è§ï¼š https://kubernetes.io/docs/tasks/tools/install-kubectl/ kubectl çš„åŸºæœ¬ç”¨æ³•å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç«  ï¼škubectl å¸¸ç”¨å‘½ä»¤ ä»¥ éƒ¨ç½² logstash ä¸ºä¾‹ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºå¦‚ä¸‹èµ„æº ï¼š Namespace Deployment Configmap Hpa Service å…·ä½“çš„ yaml æ–‡ä»¶å¦‚ä¸‹ : cat logstash.yaml ---# setting NamespaceapiVersion:v1kind:Namespacemetadata:name:logging---# setting ConfigMapkind:ConfigMapapiVersion:v1metadata:name:logstash-confnamespace:loggingdata:logstash.conf:| input {http{host=\u003e\"0.0.0.0\"# default: 0.0.0.0port =\u003e 8080 # default:8080response_headers=\u003e{\"Content-Type\"=\u003e\"text/plain\"\"Access-Control-Allow-Origin\"=\u003e\"*\"\"Access-Control-Allow-Methods\"=\u003e\"GET, POST, DELETE, PUT\"\"Access-Control-Allow-Headers\"=\u003e\"authorization, content-type\"\"Access-Control-Allow-Credentials\"=\u003etrue}}}output{stdout{codec=\u003erubydebug}}---# setting DepolymentapiVersion:apps/v1kind:Deploymentmetadata:name:logstashnamespace:loggingspec:replicas:1selector:matchLabels:app:logstashtemplate:metadata:labels:app:logstashspec:volumes:- name:configconfigMap:name:logstash-confhostname:logstashcontainers:- name:logstashimage:russellgao/logstash:7.2.0args:[\"-f\",\"/usr/share/logstash/pipeline/logstash.conf\",]imagePullPolicy:IfNotPresentvolumeMounts:- name:configmountPath:\"/usr/share/logstash/pipeline/logstash.conf\"readOnly:truesubPath:logstash.confresources:requests:cpu:1memory:2048Milimits:cpu:3memory:3072MireadinessProbe:tcpSocket:port:8080initialDelaySeconds:5periodSeconds:10livenessProbe:tcpSocket:port:8080initialDelaySeconds:15periodSeconds:20timeoutSeconds:15imagePullSecrets:- name:harbor---apiVersion:autoscaling/v2beta1kind:HorizontalPodAutoscalermetadata:name:logstash-hpanamespace:loggingspec:scaleTargetRef:apiVersion:apps/v1beta2kind:Deploymentname:logstashminReplicas:1maxReplicas:10metrics:- type:Resourceresource:name:cputargetAverageUtilization:80---apiVersion:v1kind:Servicemetadata:name:logstash-custeripnamespace:loggingspec:selector:app:logstashtype:ClusterIPports:- name:'port'protocol:TCPport:8080targetPort:8080 æ‰§è¡Œ kubectl apply -f logstash.yaml kubectl apply -f logstash.yaml namespace/logging created configmap/logstash-conf created deployment.apps/logstash created horizontalpodautoscaler.autoscaling/logstash-hpa created service/logstash-custerip created å¯ä»¥çœ‹åˆ°å…·ä½“çš„èµ„æºå·²ç»è¢«åˆ›å»ºå‡ºæ¥ï¼Œä¸‹é¢æ¥è§‚å¯Ÿå…·ä½“çš„èµ„æº : æŸ¥çœ‹ ConfigMap : kubectl -n logging get configmap NAME DATA AGE logstash-conf 1 4m æŸ¥çœ‹ Deployment : kubectl -n logging get deployment NAME READY UP-TO-DATE AVAILABLE AGE logstash 1/1 1 1 4m æŸ¥çœ‹ Pod : kubectl -n logging get po -owide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES logstash-64d58c4b98-nqk4v 1/1 Running 0 93s 10.244.0.9 kind-control-plane \u003cnone\u003e \u003cnone\u003e è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ Pod æ‰€åœ¨çš„ node æ˜¯ kind-control-plane ï¼Œè€Œéæœ¬æœºï¼Œè¯´æ˜ kubernetes node å°±æ˜¯è¿™ä¸ªå®¹å™¨ï¼Œåœ¨æœ¬åœ° curl 10.244.0.9:8080 è¿™ä¸ªåœ°å€æ˜¯ä¸é€šï¼Œè¯´æ˜æ˜¯åœ¨é›†ç¾¤å¤–ï¼Œ è¿›åˆ°å®¹å™¨å†…å† curl å°±æ˜¯é€šçš„ ï¼š curl 10.244.0.9:8080 -v * About to connect() to 10.244.0.9 port 8080 (#0) * Trying 10.244.0.9... ^C [root@iZuf685opgs9oyozju9i2bZ k8s]# [root@iZuf685opgs9oyozju9i2bZ k8s]# [root@iZuf685opgs9oyozju9i2bZ k8s]# docker exec -it kind-control-plane bash root@kind-control-plane:/# curl 10.244.0.9:8080 -v * Trying 10.244.0.9:8080... * TCP_NODELAY set * Connected to 10.244.0.9 (10.244.0.9) port 8080 (#0) \u003e GET / HTTP/1.1 \u003e Host: 10.244.0.9:8080 \u003e User-Agent: curl/7.68.0 \u003e Accept: */* \u003e * Mark bundle as not supporting multiuse \u003c HTTP/1.1 200 OK \u003c Access-Control-Allow-Origin: * \u003c Access-Control-Allow-Methods: GET, POST, DELETE, PUT \u003c Access-Control-Allow-Headers: authorization, content-type \u003c Access-Control-Allow-Credentials: true \u003c content-length: 2 \u003c content-type: text/plain \u003c * Connection #0 to host 10.244.0.9 left intact okroot@kind-control-plane:/# æŸ¥çœ‹ service : kubectl -n logging get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE logstash-custerip ClusterIP 10.96.234.144 \u003cnone\u003e 8080/TCP 5m pod å’Œ service çš„åŸç†æ˜¯ä¸€æ ·çš„ï¼Œé€šè¿‡ CLUSTER-IP è®¿é—®åªèƒ½åœ¨å®¹å™¨å†…è¿›è¡Œè®¿é—®ã€‚ åœ¨ pod å†…è¿›è¡Œè®¿é—® [root@iZuf685opgs9oyozju9i2bZ k8s]# kubectl -n logging exec -it logst","date":"2021-02-06","objectID":"/k8s-kind/:6:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/k8s-kind/"},{"categories":null,"content":"ç¯å¢ƒæ¸…ç† åœ¨æœ¬åœ°ä½“éªŒå®Œæˆ–è€…æµ‹è¯•å®Œæˆä¹‹åï¼Œä¸ºäº†èŠ‚çœèµ„æºï¼Œå¯ä»¥æŠŠåˆšåˆšå¯åŠ¨çš„é›†ç¾¤è¿›è¡Œåˆ é™¤ï¼Œä¸‹æ¬¡éœ€è¦æ—¶å†åˆ›å»ºå³å¯ ã€‚ kind delete cluster Deleting cluster \"kind\" ... [root@iZuf685opgs9oyozju9i2bZ k8s]# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 4ec800c3ec10 russellgao/openresty:1.17.8.2-5-alpine \"/usr/local/openrestâ€¦\" 8 weeks ago Up 7 days 0.0.0.0:80-\u003e80/tcp, 0.0.0.0:443-\u003e443/tcp openresty-app-1 [root@iZuf685opgs9oyozju9i2bZ k8s]# kubectl -n logging get po The connection to the server localhost:8080 was refused - did you specify the right host or port? é€šè¿‡ä¸Šé¢çš„å‘½ä»¤å¯ä»¥çœ‹å‡º : å½“æ‰§è¡Œ kind delete cluster å‘½ä»¤ä¹‹åä¼šæŠŠæ§åˆ¶é¢çš„å®¹å™¨(kind-control-plane) åˆ é™¤ å½“å†æ¬¡æ‰§è¡Œ kubectl å‘½ä»¤æ˜¯å·²ç»æ— æ³•æ‰¾åˆ°å¯¹åº”çš„ api-serveråœ°å€ï¼Œå¯ä»¥æŸ¥çœ‹ .kube/config æ–‡ä»¶ï¼Œå‘ç°å·²ç»åˆ é™¤äº†å…³äºé›†ç¾¤çš„é…ç½®ä¿¡æ¯ã€‚ ","date":"2021-02-06","objectID":"/k8s-kind/:7:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/k8s-kind/"},{"categories":null,"content":"æ€»ç»“ æœ¬ç¯‡ä»‹ç»äº† kind(kubernetes in docker) çš„åŸºæœ¬ç”¨æ³•ï¼Œå¯ä»¥åœ¨æœ¬åœ°å¿«é€Ÿæ„å»ºèµ·kubernetes ç¯å¢ƒï¼Œé€‚åˆæ–°äººå¿«é€Ÿå…¥é—¨ã€è°ƒè¯•k8s ç›¸å…³ç»„ä»¶ï¼Œæµ‹è¯•operator ç­‰ã€‚ ","date":"2021-02-06","objectID":"/k8s-kind/:8:0","tags":["kubernetes","kind"],"title":"åœ¨æœ¬åœ°å¦‚ä½•ç©è½¬kubernetes? - kind","uri":"/k8s-kind/"},{"categories":null,"content":"Python ä¸­çš„è£…é¥°å™¨","date":"2021-01-30","objectID":"/python-decorator/","tags":["python","è£…é¥°å™¨"],"title":"Python ä¸­çš„è£…é¥°å™¨","uri":"/python-decorator/"},{"categories":null,"content":"å¯¼è¯» è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº† python å½“ä¸­çš„è£…é¥°å™¨ã€‚ ","date":"2021-01-30","objectID":"/python-decorator/:1:0","tags":["python","è£…é¥°å™¨"],"title":"Python ä¸­çš„è£…é¥°å™¨","uri":"/python-decorator/"},{"categories":null,"content":"ä»€ä¹ˆæ˜¯è£…é¥°å™¨ è£…é¥°å™¨å¯ä»¥ç†è§£ä¸ºå‡½æ•°çš„å‡½æ•°ï¼Œæƒ³æƒ³è¿™ä¹ˆä¸€ç§åœºæ™¯ï¼Œè¦è®¡ç®—æ¯ä¸ªå‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œä¸€ç§è§£å†³æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªå‡½æ•°ä¸­åšä¸ªè®¡æ—¶ï¼Œå°±å¯ä»¥æ‹¿åˆ°æ‰§è¡Œæ—¶é—´ï¼Œ ä½†æ˜¯è¿™æ ·ä¼šæœ‰å¤§é‡çš„å†—ä½™ä»£ç ï¼Œæ˜¾ç„¶æ˜¯ä¸å¯å–çš„ï¼Œè¿™æ—¶å€™è£…é¥°å™¨å°±æ´¾ä¸Šç”¨åœºäº†ã€‚ ä¸‹é¢ç›´æ¥çœ‹ä»£ç ï¼Œä»£ç æ¯”æ–‡å­—æ›´æœ‰è¯´æœåŠ›ã€‚ ","date":"2021-01-30","objectID":"/python-decorator/:2:0","tags":["python","è£…é¥°å™¨"],"title":"Python ä¸­çš„è£…é¥°å™¨","uri":"/python-decorator/"},{"categories":null,"content":"è£…é¥°å™¨æœ‰å“ªäº›ç±»å‹ ","date":"2021-01-30","objectID":"/python-decorator/:3:0","tags":["python","è£…é¥°å™¨"],"title":"Python ä¸­çš„è£…é¥°å™¨","uri":"/python-decorator/"},{"categories":null,"content":"æ— å‚è£…é¥°å™¨ è£…é¥°å™¨æœ¬èº«æ²¡æœ‰ä»»åŠ¡å‚æ•°ï¼Œé€šè¿‡ @ ç›´æ¥ä½¿ç”¨å³å¯ã€‚ import time from datetime import datetime def timet(func) : print(\"otter=====\") def inner(*args, **kwargs) : start_time = datetime.now() print(\"inner====\") func(*args, **kwargs) end_time = datetime.now() print(\"total cost {}\".format(end_time - start_time)) return inner @timet def p_p1(a1,a2,a3 = \"pkfjf\") : print(\"=====\") print(a1) print(a2) print(a3) print(\"======\") time.sleep(4) p_p1(\"a1111111\",\"a22222\") ","date":"2021-01-30","objectID":"/python-decorator/:3:1","tags":["python","è£…é¥°å™¨"],"title":"Python ä¸­çš„è£…é¥°å™¨","uri":"/python-decorator/"},{"categories":null,"content":"æœ‰å‚è£…é¥°å™¨ è£…é¥°å™¨æœ¬èº«è¿˜æœ‰å‚æ•°ï¼Œåœ¨ä½¿ç”¨æ—¶å¯ä»¥ä¼ å‚æ§åˆ¶ã€‚ import time from datetime import datetime def timet(*args, **kwargs) : print(\"è£…é¥°å™¨å‚æ•° =====\") for item_a in args : print(item_a) for item_k ,item_v in kwargs.items() : print(item_k,item_v) print(\"è£…é¥°å™¨å‚æ•°------\") def outter(func) : print(\"otter=====\") def inner(*args, **kwargs) : start_time = datetime.now() print(\"inner====\") func(*args, **kwargs) end_time = datetime.now() print(\"total cost {}\".format(end_time - start_time)) return inner return outter @timet(\"p1\",\"p2\",p3=\"oirei\",p4=\"uryhd\") def p_p1(a1,a2,a3 = \"pkfjf\") : print(\"=====\") print(a1) print(a2) print(a3) print(\"======\") time.sleep(4) p_p1(\"a1111111\",\"a22222\") ","date":"2021-01-30","objectID":"/python-decorator/:3:2","tags":["python","è£…é¥°å™¨"],"title":"Python ä¸­çš„è£…é¥°å™¨","uri":"/python-decorator/"},{"categories":null,"content":"Python ä¸­çš„è£…é¥°å™¨","date":"2021-01-30","objectID":"/python/python-decorator/","tags":["python","è£…é¥°å™¨"],"title":"Python ä¸­çš„è£…é¥°å™¨","uri":"/python/python-decorator/"},{"categories":null,"content":"å¯¼è¯» è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº† python å½“ä¸­çš„è£…é¥°å™¨ã€‚ ","date":"2021-01-30","objectID":"/python/python-decorator/:1:0","tags":["python","è£…é¥°å™¨"],"title":"Python ä¸­çš„è£…é¥°å™¨","uri":"/python/python-decorator/"},{"categories":null,"content":"ä»€ä¹ˆæ˜¯è£…é¥°å™¨ è£…é¥°å™¨å¯ä»¥ç†è§£ä¸ºå‡½æ•°çš„å‡½æ•°ï¼Œæƒ³æƒ³è¿™ä¹ˆä¸€ç§åœºæ™¯ï¼Œè¦è®¡ç®—æ¯ä¸ªå‡½æ•°çš„æ‰§è¡Œæ—¶é—´ï¼Œä¸€ç§è§£å†³æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªå‡½æ•°ä¸­åšä¸ªè®¡æ—¶ï¼Œå°±å¯ä»¥æ‹¿åˆ°æ‰§è¡Œæ—¶é—´ï¼Œ ä½†æ˜¯è¿™æ ·ä¼šæœ‰å¤§é‡çš„å†—ä½™ä»£ç ï¼Œæ˜¾ç„¶æ˜¯ä¸å¯å–çš„ï¼Œè¿™æ—¶å€™è£…é¥°å™¨å°±æ´¾ä¸Šç”¨åœºäº†ã€‚ ä¸‹é¢ç›´æ¥çœ‹ä»£ç ï¼Œä»£ç æ¯”æ–‡å­—æ›´æœ‰è¯´æœåŠ›ã€‚ ","date":"2021-01-30","objectID":"/python/python-decorator/:2:0","tags":["python","è£…é¥°å™¨"],"title":"Python ä¸­çš„è£…é¥°å™¨","uri":"/python/python-decorator/"},{"categories":null,"content":"è£…é¥°å™¨æœ‰å“ªäº›ç±»å‹ ","date":"2021-01-30","objectID":"/python/python-decorator/:3:0","tags":["python","è£…é¥°å™¨"],"title":"Python ä¸­çš„è£…é¥°å™¨","uri":"/python/python-decorator/"},{"categories":null,"content":"æ— å‚è£…é¥°å™¨ è£…é¥°å™¨æœ¬èº«æ²¡æœ‰ä»»åŠ¡å‚æ•°ï¼Œé€šè¿‡ @ ç›´æ¥ä½¿ç”¨å³å¯ã€‚ import time from datetime import datetime def timet(func) : print(\"otter=====\") def inner(*args, **kwargs) : start_time = datetime.now() print(\"inner====\") func(*args, **kwargs) end_time = datetime.now() print(\"total cost {}\".format(end_time - start_time)) return inner @timet def p_p1(a1,a2,a3 = \"pkfjf\") : print(\"=====\") print(a1) print(a2) print(a3) print(\"======\") time.sleep(4) p_p1(\"a1111111\",\"a22222\") ","date":"2021-01-30","objectID":"/python/python-decorator/:3:1","tags":["python","è£…é¥°å™¨"],"title":"Python ä¸­çš„è£…é¥°å™¨","uri":"/python/python-decorator/"},{"categories":null,"content":"æœ‰å‚è£…é¥°å™¨ è£…é¥°å™¨æœ¬èº«è¿˜æœ‰å‚æ•°ï¼Œåœ¨ä½¿ç”¨æ—¶å¯ä»¥ä¼ å‚æ§åˆ¶ã€‚ import time from datetime import datetime def timet(*args, **kwargs) : print(\"è£…é¥°å™¨å‚æ•° =====\") for item_a in args : print(item_a) for item_k ,item_v in kwargs.items() : print(item_k,item_v) print(\"è£…é¥°å™¨å‚æ•°------\") def outter(func) : print(\"otter=====\") def inner(*args, **kwargs) : start_time = datetime.now() print(\"inner====\") func(*args, **kwargs) end_time = datetime.now() print(\"total cost {}\".format(end_time - start_time)) return inner return outter @timet(\"p1\",\"p2\",p3=\"oirei\",p4=\"uryhd\") def p_p1(a1,a2,a3 = \"pkfjf\") : print(\"=====\") print(a1) print(a2) print(a3) print(\"======\") time.sleep(4) p_p1(\"a1111111\",\"a22222\") ","date":"2021-01-30","objectID":"/python/python-decorator/:3:2","tags":["python","è£…é¥°å™¨"],"title":"Python ä¸­çš„è£…é¥°å™¨","uri":"/python/python-decorator/"},{"categories":null,"content":"è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™","date":"2021-01-19","objectID":"/design-principle/","tags":["è®¾è®¡æ¨¡å¼"],"title":"è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™","uri":"/design-principle/"},{"categories":null,"content":"å¯¼è¯» é‡æ¸©è®¾è®¡æ¨¡å¼çš„åŸåˆ™ ","date":"2021-01-19","objectID":"/design-principle/:1:0","tags":["è®¾è®¡æ¨¡å¼"],"title":"è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™","uri":"/design-principle/"},{"categories":null,"content":"å…­å¤§åŸåˆ™ ","date":"2021-01-19","objectID":"/design-principle/:2:0","tags":["è®¾è®¡æ¨¡å¼"],"title":"è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™","uri":"/design-principle/"},{"categories":null,"content":"å•ä¸€èŒè´£åŸåˆ™ï¼ˆSingle Responsibility Principleï¼‰ There should never be more than one reason for a class to change. å°±ä¸€ä¸ªç±»è€Œè¨€ï¼Œ åº”è¯¥ä»…æœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚ ","date":"2021-01-19","objectID":"/design-principle/:2:1","tags":["è®¾è®¡æ¨¡å¼"],"title":"è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™","uri":"/design-principle/"},{"categories":null,"content":"å¼€æ”¾å°é—­åŸåˆ™ï¼ˆOpen-Closed Principleï¼‰ Software entities like classes,modules and functions should be open for extension but closed for modifications. ç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰åº”è¯¥æ˜¯å¯ä»¥æ‹“å±•çš„ï¼Œä½†æ˜¯ä¸å¯ä¿®æ”¹ã€‚ å¼€é—­åŸåˆ™æŒ‡å¯¼æˆ‘ä»¬ï¼Œå½“è½¯ä»¶éœ€è¦å˜åŒ–æ—¶ï¼Œåº”è¯¥å°½é‡é€šè¿‡æ‹“å±•çš„æ–¹å¼æ¥å®ç°å˜åŒ–ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¿®æ”¹å·²æœ‰ä»£ç æ¥å®ç°ã€‚è¿™é‡Œçš„â€œåº”è¯¥å°½é‡â€4ä¸ªå­—è¯´æ˜OCPåŸåˆ™å¹¶ä¸æ˜¯è¯´ç»å¯¹ä¸å¯ä»¥ä¿®æ”¹åŸå§‹ç±»çš„ã€‚å½“æˆ‘ä»¬å—…åˆ°åŸæ¥çš„ä»£ç â€œè…åŒ–æ°”å‘³â€æ—¶ï¼Œåº”è¯¥å°½æ—©åœ°é‡æ„ï¼Œä»¥ä¾¿ä½¿ä»£ç æ¢å¤åˆ°æ­£å¸¸çš„â€œè¿›åŒ–â€è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯é€šè¿‡é›†æˆç­‰æ–¹å¼æ·»åŠ æ–°çš„å®ç°ï¼Œè¿™ä¼šå¯¼è‡´ç±»å‹çš„è†¨èƒ€ä»¥åŠå†å²é—ç•™ä»£ç çš„å†—ä½™ã€‚å› æ­¤ï¼Œåœ¨å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦è‡ªå·±ç»“åˆå…·ä½“æƒ…å†µè¿›è¡Œè€ƒé‡ï¼Œæ˜¯é€šè¿‡ä¿®æ”¹æ—§ä»£ç è¿˜æ˜¯é€šè¿‡ç»§æ‰¿ä½¿å¾—è½¯ä»¶ç³»ç»Ÿæ›´ç¨³å®šã€æ›´çµæ´»ï¼Œåœ¨ä¿è¯å»é™¤â€œä»£ç è…åŒ–â€çš„åŒæ—¶ï¼Œä¹Ÿä¿è¯åŸæœ‰æ¨¡å—çš„æ­£ç¡®æ€§ã€‚ ","date":"2021-01-19","objectID":"/design-principle/:2:2","tags":["è®¾è®¡æ¨¡å¼"],"title":"è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™","uri":"/design-principle/"},{"categories":null,"content":"é‡Œå¼æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰ Functions that use pointers or references to base classes must be able to use objects of derived classes without knowing it. æ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™çš„æ ¸å¿ƒåŸç†æ˜¯æŠ½è±¡ï¼ŒæŠ½è±¡åˆä¾èµ–äºç»§æ‰¿è¿™ä¸ªç‰¹æ€§ï¼Œåœ¨OOPä¸­ï¼Œç»§æ‰¿çš„ä¼˜ç¼ºç‚¹ç›¸å½“æ˜æ˜¾ï¼Œæœ‰ç‚¹å¦‚ä¸‹ï¼š ä»£ç é‡ç”¨ï¼Œå‡å°‘åˆ›å»ºç±»æˆæœ¬ï¼Œæ¯ä¸ªå­ç±»æ‹¥æœ‰çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼› å­ç±»å’Œçˆ¶ç±»åŸºæœ¬ç›¸ä¼¼ï¼Œä½†åˆä¸çˆ¶ç±»æœ‰æ‰€åŒºåˆ«ï¼› æé«˜ä»£ç çš„å¯æ‹“å±•æ€§ã€‚ ç»§æ‰¿çš„ç¼ºç‚¹ï¼š ç»§æ‰¿æ˜¯ä¾µå…¥æ€§çš„ï¼Œåªè¦ç»§æ‰¿å°±å¿…é¡»æ‹¥æœ‰çˆ¶ç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼› å¯èƒ½é€ æˆå­ç±»ä»£ç çš„å†—ä½™ã€çµæ´»æ€§é™ä½ï¼Œå› ä¸ºå­ç±»å¿…é¡»æ‹¥æœ‰å¼—é›·çš„å±æ€§å’Œæ–¹æ³•ã€‚ å¼€é—­åŸåˆ™å’Œé‡Œæ°æ›¿æ¢åŸåˆ™å¾€å¾€æ˜¯ç”Ÿæ­»ç›¸ä¾ã€ä¸ç¦»ä¸å¼ƒçš„ï¼Œé€šè¿‡é‡Œæ°æ›¿æ¢æ¥è¾¾åˆ°å¯¹æ‰©å±•çš„å¼€å‘ï¼Œå¯¹ä¿®æ”¹çš„å…³é—­æ•ˆæœã€‚ ","date":"2021-01-19","objectID":"/design-principle/:2:3","tags":["è®¾è®¡æ¨¡å¼"],"title":"è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™","uri":"/design-principle/"},{"categories":null,"content":"è¿ªç±³ç‰¹åŸåˆ™(æœ€å°‘çŸ¥è¯†åŸåˆ™)ï¼ˆLaw of Demeterï¼‰ Only talk to you immediate friends. ä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å°½å¯èƒ½å°‘åœ°ä¸å…¶ä»–å®ä½“å‘ç”Ÿç›¸äº’ä½œç”¨ã€‚ ","date":"2021-01-19","objectID":"/design-principle/:2:4","tags":["è®¾è®¡æ¨¡å¼"],"title":"è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™","uri":"/design-principle/"},{"categories":null,"content":"æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰ The dependency of one class to another one should depend on the smallest possible interface. ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šã€‚ å»ºç«‹å•ä¸€æ¥å£ï¼Œä¸è¦å»ºç«‹åºå¤§è‡ƒè‚¿æ¥å£ï¼›å°½é‡ç»†åŒ–æ¥å£ï¼Œæ¥å£ä¸­æ–¹æ³•å°½é‡å°‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¦ä¸ºå„ä¸ªç±»å»ºç«‹ä¸“ç”¨çš„æ¥å£ï¼Œè€Œä¸è¦è¯•å›¾å»ºç«‹ä¸€ä¸ªå¾ˆåºå¤§çš„æ¥å£ä¾›æ‰€æœ‰ä¾èµ–å®ƒçš„ç±»è°ƒç”¨ã€‚ æ¥å£å°½é‡å°ï¼Œä½†æ˜¯è¦æœ‰é™åº¦ã€‚å¯¹æ¥å£è¿›è¡Œç»†åŒ–å¯ä»¥æé«˜ç¨‹åºè®¾è®¡çš„çµæ´»æ€§ï¼›ä½†æ˜¯å¦‚æœè¿‡å°ï¼Œåˆ™ä¼šé€ æˆæ¥å£æ•°é‡è¿‡å¤šï¼Œä½¿è®¾è®¡å¤æ‚åŒ–ã€‚æ‰€ä»¥ï¼Œä¸€å®šè¦é€‚åº¦ã€‚ ä¸ºä¾èµ–æ¥å£çš„ç±»å®šåˆ¶æœåŠ¡ï¼Œåªæš´éœ²ç»™è°ƒç”¨çš„ç±»éœ€è¦çš„æ–¹æ³•ï¼Œå®ƒä¸éœ€è¦çš„æ–¹æ³•åˆ™éšè”½èµ·æ¥ã€‚åªæœ‰ä¸“æ³¨å¾—ä¸ºä¸€ä¸ªæ¨¡å—æä¾›å®šåˆ¶æœåŠ¡ï¼Œæ‰èƒ½å»ºç«‹æœ€å°çš„ä¾èµ–å…³ç³»ã€‚ æé«˜å†…èšï¼Œå‡å°‘å¯¹å¤–äº¤äº’ã€‚æ¥å£æ–¹æ³•å°½é‡å°‘ç”¨publicä¿®é¥°ã€‚æ¥å£æ˜¯å¯¹å¤–çš„æ‰¿è¯ºï¼Œæ‰¿è¯ºè¶Šå°‘å¯¹ç³»ç»Ÿå¼€å‘è¶Šæœ‰åˆ©ï¼Œå˜æ›´é£é™©ä¹Ÿä¼šè¶Šå°‘ã€‚ ","date":"2021-01-19","objectID":"/design-principle/:2:5","tags":["è®¾è®¡æ¨¡å¼"],"title":"è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™","uri":"/design-principle/"},{"categories":null,"content":"ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰ High level modules should not depends upon low level modules.Both should depend upon abstractions.Abstractions should not depend upon details.Details should depend upon abstractions. é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–äºä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚ ","date":"2021-01-19","objectID":"/design-principle/:2:6","tags":["è®¾è®¡æ¨¡å¼"],"title":"è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™","uri":"/design-principle/"},{"categories":null,"content":"æ€»ç»“ å•ä¸€èŒè´£åŸåˆ™å‘Šè¯‰æˆ‘ä»¬å®ç°ç±»è¦èŒè´£å•ä¸€ é‡Œæ°æ›¿æ¢åŸåˆ™å‘Šè¯‰æˆ‘ä»¬ä¸è¦ç ´åç»§æ‰¿ä½“ç³» ä¾èµ–å€’ç½®åŸåˆ™å‘Šè¯‰æˆ‘ä»¬è¦é¢å‘æ¥å£ç¼–ç¨‹ æ¥å£éš”ç¦»åŸåˆ™å‘Šè¯‰æˆ‘ä»¬åœ¨è®¾è®¡æ¥å£çš„æ—¶å€™è¦ç²¾ç®€å•ä¸€ è¿ªç±³ç‰¹æ³•åˆ™å‘Šè¯‰æˆ‘ä»¬è¦é™ä½è€¦åˆã€‚ å¼€é—­åŸåˆ™æ˜¯æ€»çº²ï¼Œå‘Šè¯‰æˆ‘ä»¬è¦å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ ","date":"2021-01-19","objectID":"/design-principle/:3:0","tags":["è®¾è®¡æ¨¡å¼"],"title":"è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™","uri":"/design-principle/"},{"categories":null,"content":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","date":"2020-12-17","objectID":"/mq-kafka/","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"å¯¼è¯» æœ¬æ–‡æ¶ˆæ¯é˜Ÿåˆ—ç³»åˆ—ç¬¬äºŒç¯‡ï¼Œä¸Šä¸€ç¯‡è®²è¿°çš„æ˜¯ Rabbitmq ï¼Œè¿™ç¯‡ä¸»è¦ä»‹ç» Kafka çš„åŸç†ä¸ä½¿ç”¨ã€‚ Kafka æ˜¯ä¸€ä¸ªå¿«é€Ÿã€å¯æ‰©å±•çš„ã€é«˜ååçš„ã€å¯å®¹é”™çš„åˆ†å¸ƒå¼â€œå‘å¸ƒ-è®¢é˜…â€æ¶ˆæ¯ç³»ç»Ÿï¼Œ ä½¿ç”¨ Scala ä¸ Java è¯­è¨€ç¼–å†™ï¼Œèƒ½å¤Ÿå°†æ¶ˆæ¯ä»ä¸€ä¸ªç«¯ç‚¹ä¼ é€’åˆ°å¦ä¸€ä¸ªç«¯ç‚¹ã€‚ è¾ƒä¹‹ä¼ ç»Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆä¾‹å¦‚ ActiveMQã€RabbitMQï¼‰ï¼ŒKafka å…·æœ‰é«˜ååé‡ã€å†…ç½®åˆ†åŒºã€æ”¯æŒæ¶ˆæ¯å‰¯æœ¬å’Œé«˜å®¹é”™çš„ç‰¹æ€§ï¼Œéå¸¸é€‚åˆå¤§è§„æ¨¡æ¶ˆæ¯å¤„ç†åº”ç”¨ç¨‹åºã€‚ Kafka å®˜ç½‘ï¼šhttp://kafka.apache.org/ ","date":"2020-12-17","objectID":"/mq-kafka/:1:0","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"Kafka ä¸»è¦è®¾è®¡ç›®æ ‡å¦‚ä¸‹ ä»¥æ—¶é—´å¤æ‚åº¦ä¸º O(1) çš„æ–¹å¼æä¾›æ¶ˆæ¯æŒä¹…åŒ–èƒ½åŠ›ï¼Œå³ä½¿å¯¹ TB çº§ä»¥ä¸Šæ•°æ®ä¹Ÿèƒ½ä¿è¯å¸¸æ•°æ—¶é—´çš„è®¿é—®æ€§èƒ½ã€‚ é«˜ååç‡ã€‚å³ä½¿åœ¨éå¸¸å»‰ä»·çš„å•†ç”¨æœºå™¨ä¸Šä¹Ÿèƒ½åšåˆ°å•æœºæ”¯æŒæ¯ç§’ 100K æ¡æ¶ˆæ¯çš„ä¼ è¾“ã€‚ æ”¯æŒ Kafka Server é—´çš„æ¶ˆæ¯åˆ†åŒºï¼ŒåŠåˆ†å¸ƒå¼æ¶ˆè´¹ï¼ŒåŒæ—¶ä¿è¯æ¯ä¸ª Partition å†…çš„æ¶ˆæ¯é¡ºåºä¼ è¾“ã€‚ åŒæ—¶æ”¯æŒç¦»çº¿æ•°æ®å¤„ç†å’Œå®æ—¶æ•°æ®å¤„ç†ã€‚ æ”¯æŒåœ¨çº¿æ°´å¹³æ‰©å±•ã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:2:0","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"Kafka é€šå¸¸ç”¨äºä¸¤å¤§ç±»åº”ç”¨ç¨‹åº å»ºç«‹å®æ—¶æµæ•°æ®ç®¡é“ï¼Œä»¥å¯é åœ°åœ¨ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºä¹‹é—´è·å–æ•°æ®ã€‚ æ„å»ºå®æ—¶æµåº”ç”¨ç¨‹åºï¼Œä»¥è½¬æ¢æˆ–å“åº”æ•°æ®æµã€‚ è¦äº†è§£ Kafka å¦‚ä½•æ‰§è¡Œè¿™äº›æ“ä½œï¼Œè®©æˆ‘ä»¬ä»å¤´å¼€å§‹æ·±å…¥ç ”ç©¶ Kafka çš„åŠŸèƒ½ã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:3:0","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"é¦–å…ˆå‡ ä¸ªæ¦‚å¿µ Kafka åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªå¯ä»¥è·¨è¶Šå¤šä¸ªæ•°æ®ä¸­å¿ƒçš„æœåŠ¡å™¨ä¸Šä½œä¸ºé›†ç¾¤è¿è¡Œã€‚ Kafka é›†ç¾¤å°†è®°å½•æµå­˜å‚¨åœ¨ç§°ä¸ºä¸»é¢˜çš„ç±»åˆ«ä¸­ã€‚ æ¯ä¸ªè®°å½•ç”±ä¸€ä¸ªé”®ï¼Œä¸€ä¸ªå€¼å’Œä¸€ä¸ªæ—¶é—´æˆ³ç»„æˆã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:4:0","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"Kafka æ¶æ„ä½“ç³»å¦‚ä¸‹å›¾ Kafka çš„åº”ç”¨åœºæ™¯éå¸¸å¤š, ä¸‹é¢æˆ‘ä»¬å°±æ¥ä¸¾å‡ ä¸ªæˆ‘ä»¬æœ€å¸¸è§çš„åœºæ™¯ï¼š ç”¨æˆ·çš„æ´»åŠ¨è·Ÿè¸ªï¼šç”¨æˆ·åœ¨ç½‘ç«™çš„ä¸åŒæ´»åŠ¨æ¶ˆæ¯å‘å¸ƒåˆ°ä¸åŒçš„ä¸»é¢˜ä¸­å¿ƒï¼Œç„¶åå¯ä»¥å¯¹è¿™äº›æ¶ˆæ¯è¿›è¡Œå®æ—¶ç›‘æµ‹ã€å®æ—¶å¤„ç†ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åŠ è½½åˆ° Hadoop æˆ–ç¦»çº¿å¤„ç†æ•°æ®ä»“åº“ï¼Œå¯¹ç”¨æˆ·è¿›è¡Œç”»åƒã€‚åƒæ·˜å®ã€å¤©çŒ«ã€äº¬ä¸œè¿™äº›å¤§å‹ç”µå•†å¹³å°ï¼Œç”¨æˆ·çš„æ‰€æœ‰æ´»åŠ¨éƒ½è¦è¿›è¡Œè¿½è¸ªçš„ã€‚ æ—¥å¿—æ”¶é›†å¦‚ä¸‹å›¾ï¼š é™æµå‰Šå³°å¦‚ä¸‹å›¾ï¼š é«˜ååç‡å®ç°ï¼šKafka ä¸å…¶ä»– MQ ç›¸æ¯”ï¼Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯é«˜ååç‡ã€‚ä¸ºäº†å¢åŠ å­˜å‚¨èƒ½åŠ›ï¼ŒKafka å°†æ‰€æœ‰çš„æ¶ˆæ¯éƒ½å†™å…¥åˆ°äº†ä½é€Ÿå¤§å®¹é‡çš„ç¡¬ç›˜ã€‚æŒ‰ç†è¯´ï¼Œè¿™å°†å¯¼è‡´æ€§èƒ½æŸå¤±ï¼Œä½†å®é™…ä¸Šï¼ŒKafka ä»ç„¶å¯ä»¥ä¿æŒè¶…é«˜çš„ååç‡ï¼Œå¹¶ä¸”å…¶æ€§èƒ½å¹¶æœªå—åˆ°å½±å“ã€‚ å…¶ä¸»è¦é‡‡ç”¨å¦‚ä¸‹æ–¹å¼å®ç°äº†é«˜ååç‡ï¼š é¡ºåºè¯»å†™ï¼šKafka å°†æ¶ˆæ¯å†™å…¥åˆ°äº†åˆ†åŒº Partition ä¸­ï¼Œè€Œåˆ†åŒºä¸­çš„æ¶ˆæ¯åˆæ˜¯é¡ºåºè¯»å†™çš„ã€‚é¡ºåºè¯»å†™è¦å¿«äºéšæœºè¯»å†™ã€‚ é›¶æ‹·è´ï¼šç”Ÿäº§è€…ã€æ¶ˆè´¹è€…å¯¹äº Kafka ä¸­çš„æ¶ˆæ¯æ˜¯é‡‡ç”¨é›¶æ‹·è´å®ç°çš„ã€‚ æ‰¹é‡å‘é€ï¼šKafka å…è®¸æ‰¹é‡å‘é€æ¨¡å¼ã€‚ æ¶ˆæ¯å‹ç¼©ï¼šKafka å…è®¸å¯¹æ¶ˆæ¯é›†åˆè¿›è¡Œå‹ç¼©ã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:5:0","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"Kafka çš„ä¼˜ç‚¹ è§£è€¦ï¼šåœ¨é¡¹ç›®å¯åŠ¨ä¹‹åˆæ¥é¢„æµ‹å°†æ¥é¡¹ç›®ä¼šç¢°åˆ°ä»€ä¹ˆéœ€æ±‚ï¼Œæ˜¯æå…¶å›°éš¾çš„ã€‚æ¶ˆæ¯ç³»ç»Ÿåœ¨å¤„ç†è¿‡ç¨‹ä¸­é—´æ’å…¥äº†ä¸€ä¸ªéšå«çš„ã€åŸºäºæ•°æ®çš„æ¥å£å±‚ï¼Œä¸¤è¾¹çš„å¤„ç†è¿‡ç¨‹éƒ½è¦å®ç°è¿™ä¸€æ¥å£ã€‚è¿™å…è®¸ä½ ç‹¬ç«‹çš„æ‰©å±•æˆ–ä¿®æ”¹ä¸¤è¾¹çš„å¤„ç†è¿‡ç¨‹ï¼Œåªè¦ç¡®ä¿å®ƒä»¬éµå®ˆåŒæ ·çš„æ¥å£çº¦æŸã€‚ å†—ä½™ï¼ˆå‰¯æœ¬ï¼‰ï¼šæœ‰äº›æƒ…å†µä¸‹ï¼Œå¤„ç†æ•°æ®çš„è¿‡ç¨‹ä¼šå¤±è´¥ã€‚é™¤éæ•°æ®è¢«æŒä¹…åŒ–ï¼Œå¦åˆ™å°†é€ æˆä¸¢å¤±ã€‚æ¶ˆæ¯é˜Ÿåˆ—æŠŠæ•°æ®è¿›è¡ŒæŒä¹…åŒ–ç›´åˆ°å®ƒä»¬å·²ç»è¢«å®Œå…¨å¤„ç†ï¼Œé€šè¿‡è¿™ä¸€æ–¹å¼è§„é¿äº†æ•°æ®ä¸¢å¤±é£é™©ã€‚è®¸å¤šæ¶ˆæ¯é˜Ÿåˆ—æ‰€é‡‡ç”¨çš„\"æ’å…¥-è·å–-åˆ é™¤\"èŒƒå¼ä¸­ï¼Œåœ¨æŠŠä¸€ä¸ªæ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­åˆ é™¤ä¹‹å‰ï¼Œéœ€è¦ä½ çš„å¤„ç†ç³»ç»Ÿæ˜ç¡®çš„æŒ‡å‡ºè¯¥æ¶ˆæ¯å·²ç»è¢«å¤„ç†å®Œæ¯•ï¼Œä»è€Œç¡®ä¿ä½ çš„æ•°æ®è¢«å®‰å…¨çš„ä¿å­˜ç›´åˆ°ä½ ä½¿ç”¨å®Œæ¯•ã€‚ æ‰©å±•æ€§ï¼šå› ä¸ºæ¶ˆæ¯é˜Ÿåˆ—è§£è€¦äº†ä½ çš„å¤„ç†è¿‡ç¨‹ï¼Œæ‰€ä»¥å¢å¤§æ¶ˆæ¯å…¥é˜Ÿå’Œå¤„ç†çš„é¢‘ç‡æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œåªè¦å¦å¤–å¢åŠ å¤„ç†è¿‡ç¨‹å³å¯ã€‚ä¸éœ€è¦æ”¹å˜ä»£ç ã€ä¸éœ€è¦è°ƒèŠ‚å‚æ•°ã€‚æ‰©å±•å°±åƒè°ƒå¤§ç”µåŠ›æŒ‰é’®ä¸€æ ·ç®€å•ã€‚ çµæ´»æ€§\u0026å³°å€¼å¤„ç†èƒ½åŠ›ï¼šåœ¨è®¿é—®é‡å‰§å¢çš„æƒ…å†µä¸‹ï¼Œåº”ç”¨ä»ç„¶éœ€è¦ç»§ç»­å‘æŒ¥ä½œç”¨ï¼Œä½†æ˜¯è¿™æ ·çš„çªå‘æµé‡å¹¶ä¸å¸¸è§ï¼›å¦‚æœä¸ºä»¥èƒ½å¤„ç†è¿™ç±»å³°å€¼è®¿é—®ä¸ºæ ‡å‡†æ¥æŠ•å…¥èµ„æºéšæ—¶å¾…å‘½æ— ç–‘æ˜¯å·¨å¤§çš„æµªè´¹ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—èƒ½å¤Ÿä½¿å…³é”®ç»„ä»¶é¡¶ä½çªå‘çš„è®¿é—®å‹åŠ›ï¼Œè€Œä¸ä¼šå› ä¸ºçªå‘çš„è¶…è´Ÿè·çš„è¯·æ±‚è€Œå®Œå…¨å´©æºƒã€‚ å¯æ¢å¤æ€§ï¼šç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ç»„ä»¶å¤±æ•ˆæ—¶ï¼Œä¸ä¼šå½±å“åˆ°æ•´ä¸ªç³»ç»Ÿã€‚æ¶ˆæ¯é˜Ÿåˆ—é™ä½äº†è¿›ç¨‹é—´çš„è€¦åˆåº¦ï¼Œæ‰€ä»¥å³ä½¿ä¸€ä¸ªå¤„ç†æ¶ˆæ¯çš„è¿›ç¨‹æŒ‚æ‰ï¼ŒåŠ å…¥é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä»ç„¶å¯ä»¥åœ¨ç³»ç»Ÿæ¢å¤åè¢«å¤„ç†ã€‚ é¡ºåºä¿è¯ï¼šåœ¨å¤§å¤šä½¿ç”¨åœºæ™¯ä¸‹ï¼Œæ•°æ®å¤„ç†çš„é¡ºåºéƒ½å¾ˆé‡è¦ã€‚å¤§éƒ¨åˆ†æ¶ˆæ¯é˜Ÿåˆ—æœ¬æ¥å°±æ˜¯æ’åºçš„ï¼Œå¹¶ä¸”èƒ½ä¿è¯æ•°æ®ä¼šæŒ‰ç…§ç‰¹å®šçš„é¡ºåºæ¥å¤„ç†ã€‚Kafka ä¿è¯ä¸€ä¸ª Partition å†…çš„æ¶ˆæ¯çš„æœ‰åºæ€§ã€‚ ç¼“å†²ï¼šåœ¨ä»»ä½•é‡è¦çš„ç³»ç»Ÿä¸­ï¼Œéƒ½ä¼šæœ‰éœ€è¦ä¸åŒçš„å¤„ç†æ—¶é—´çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼ŒåŠ è½½ä¸€å¼ å›¾ç‰‡æ¯”åº”ç”¨è¿‡æ»¤å™¨èŠ±è´¹æ›´å°‘çš„æ—¶é—´ã€‚æ¶ˆæ¯é˜Ÿåˆ—é€šè¿‡ä¸€ä¸ªç¼“å†²å±‚æ¥å¸®åŠ©ä»»åŠ¡æœ€é«˜æ•ˆç‡çš„æ‰§è¡Œï¼Œå†™å…¥é˜Ÿåˆ—çš„å¤„ç†ä¼šå°½å¯èƒ½çš„å¿«é€Ÿã€‚è¯¥ç¼“å†²æœ‰åŠ©äºæ§åˆ¶å’Œä¼˜åŒ–æ•°æ®æµç»è¿‡ç³»ç»Ÿçš„é€Ÿåº¦ã€‚ å¼‚æ­¥é€šä¿¡ï¼šå¾ˆå¤šæ—¶å€™ï¼Œç”¨æˆ·ä¸æƒ³ä¹Ÿä¸éœ€è¦ç«‹å³å¤„ç†æ¶ˆæ¯ã€‚æ¶ˆæ¯é˜Ÿåˆ—æä¾›äº†å¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·æŠŠä¸€ä¸ªæ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—ï¼Œä½†å¹¶ä¸ç«‹å³å¤„ç†å®ƒã€‚æƒ³å‘é˜Ÿåˆ—ä¸­æ”¾å…¥å¤šå°‘æ¶ˆæ¯å°±æ”¾å¤šå°‘ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™å†å»å¤„ç†å®ƒä»¬ã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:6:0","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"Kafka ä¸å…¶ä»– MQ å¯¹æ¯” RabbitMQï¼šRabbitMQ æ˜¯ä½¿ç”¨ Erlang ç¼–å†™çš„ä¸€ä¸ªå¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæœ¬èº«æ”¯æŒå¾ˆå¤šçš„åè®®ï¼šAMQPï¼ŒXMPPï¼ŒSMTPï¼ŒSTOMPï¼Œä¹Ÿæ­£å› å¦‚æ­¤ï¼Œå®ƒéå¸¸é‡é‡çº§ï¼Œæ›´é€‚åˆäºä¼ä¸šçº§çš„å¼€å‘ã€‚åŒæ—¶å®ç°äº† Broker æ„æ¶ï¼Œè¿™æ„å‘³ç€æ¶ˆæ¯åœ¨å‘é€ç»™å®¢æˆ·ç«¯æ—¶å…ˆåœ¨ä¸­å¿ƒé˜Ÿåˆ—æ’é˜Ÿã€‚å¯¹è·¯ç”±ï¼Œè´Ÿè½½å‡è¡¡æˆ–è€…æ•°æ®æŒä¹…åŒ–éƒ½æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚ Redisï¼šRedis æ˜¯ä¸€ä¸ªåŸºäº Key-Value å¯¹çš„ NoSQL æ•°æ®åº“ï¼Œå¼€å‘ç»´æŠ¤å¾ˆæ´»è·ƒã€‚è™½ç„¶å®ƒæ˜¯ä¸€ä¸ª Key-Value æ•°æ®åº“å­˜å‚¨ç³»ç»Ÿï¼Œä½†å®ƒæœ¬èº«æ”¯æŒ MQ åŠŸèƒ½ï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥å½“åšä¸€ä¸ªè½»é‡çº§çš„é˜Ÿåˆ—æœåŠ¡æ¥ä½¿ç”¨ã€‚å¯¹äº RabbitMQ å’Œ Redis çš„å…¥é˜Ÿå’Œå‡ºé˜Ÿæ“ä½œï¼Œå„æ‰§è¡Œ 100 ä¸‡æ¬¡ï¼Œæ¯ 10 ä¸‡æ¬¡è®°å½•ä¸€æ¬¡æ‰§è¡Œæ—¶é—´ã€‚æµ‹è¯•æ•°æ®åˆ†ä¸º 128Bytesã€512Bytesã€1K å’Œ 10K å››ä¸ªä¸åŒå¤§å°çš„æ•°æ®ã€‚å®éªŒè¡¨æ˜ï¼šå…¥é˜Ÿæ—¶ï¼Œå½“æ•°æ®æ¯”è¾ƒå°æ—¶ Redis çš„æ€§èƒ½è¦é«˜äº RabbitMQï¼Œè€Œå¦‚æœæ•°æ®å¤§å°è¶…è¿‡äº† 10Kï¼ŒRedis åˆ™æ…¢çš„æ— æ³•å¿å—ï¼›å‡ºé˜Ÿæ—¶ï¼Œæ— è®ºæ•°æ®å¤§å°ï¼ŒRedis éƒ½è¡¨ç°å‡ºéå¸¸å¥½çš„æ€§èƒ½ï¼Œè€Œ RabbitMQ çš„å‡ºé˜Ÿæ€§èƒ½åˆ™è¿œä½äº Redisã€‚ ZeroMQï¼šZeroMQ å·ç§°æœ€å¿«çš„æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œå°¤å…¶é’ˆå¯¹å¤§ååé‡çš„éœ€æ±‚åœºæ™¯ã€‚ZeroMQ èƒ½å¤Ÿå®ç° RabbitMQ ä¸æ“…é•¿çš„é«˜çº§/å¤æ‚çš„é˜Ÿåˆ—ï¼Œä½†æ˜¯å¼€å‘äººå‘˜éœ€è¦è‡ªå·±ç»„åˆå¤šç§æŠ€æœ¯æ¡†æ¶ï¼ŒæŠ€æœ¯ä¸Šçš„å¤æ‚åº¦æ˜¯å¯¹è¿™ MQ èƒ½å¤Ÿåº”ç”¨æˆåŠŸçš„æŒ‘æˆ˜ã€‚ZeroMQ å…·æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„éä¸­é—´ä»¶çš„æ¨¡å¼ï¼Œä½ ä¸éœ€è¦å®‰è£…å’Œè¿è¡Œä¸€ä¸ªæ¶ˆæ¯æœåŠ¡å™¨æˆ–ä¸­é—´ä»¶ï¼Œå› ä¸ºä½ çš„åº”ç”¨ç¨‹åºå°†æ‰®æ¼”è¿™ä¸ªæœåŠ¡å™¨è§’è‰²ã€‚ä½ åªéœ€è¦ç®€å•çš„å¼•ç”¨ ZeroMQ ç¨‹åºåº“ï¼Œå¯ä»¥ä½¿ç”¨ NuGet å®‰è£…ï¼Œç„¶åä½ å°±å¯ä»¥æ„‰å¿«çš„åœ¨åº”ç”¨ç¨‹åºä¹‹é—´å‘é€æ¶ˆæ¯äº†ã€‚ä½†æ˜¯ ZeroMQ ä»…æä¾›éæŒä¹…æ€§çš„é˜Ÿåˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå®•æœºï¼Œæ•°æ®å°†ä¼šä¸¢å¤±ã€‚å…¶ä¸­ï¼ŒTwitter çš„ Storm 0.9.0 ä»¥å‰çš„ç‰ˆæœ¬ä¸­é»˜è®¤ä½¿ç”¨ ZeroMQ ä½œä¸ºæ•°æ®æµçš„ä¼ è¾“ï¼ˆStorm ä» 0.9 ç‰ˆæœ¬å¼€å§‹åŒæ—¶æ”¯æŒ ZeroMQ å’Œ Netty ä½œä¸ºä¼ è¾“æ¨¡å—ï¼‰ã€‚ ActiveMQï¼šActiveMQ æ˜¯ Apache ä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ã€‚ç±»ä¼¼äº ZeroMQï¼Œå®ƒèƒ½å¤Ÿä»¥ä»£ç†äººå’Œç‚¹å¯¹ç‚¹çš„æŠ€æœ¯å®ç°é˜Ÿåˆ—ã€‚åŒæ—¶ç±»ä¼¼äº RabbitMQï¼Œå®ƒå°‘é‡ä»£ç å°±å¯ä»¥é«˜æ•ˆåœ°å®ç°é«˜çº§åº”ç”¨åœºæ™¯ã€‚ Kafka/Jafkaï¼šKafka æ˜¯ Apache ä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½è·¨è¯­è¨€åˆ†å¸ƒå¼å‘å¸ƒ/è®¢é˜…æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œè€Œ Jafka æ˜¯åœ¨ Kafka ä¹‹ä¸Šå­µåŒ–è€Œæ¥çš„ï¼Œå³ Kafka çš„ä¸€ä¸ªå‡çº§ç‰ˆã€‚ Kafka å…·æœ‰ä»¥ä¸‹ç‰¹æ€§: å¿«é€ŸæŒä¹…åŒ–ï¼Œå¯ä»¥åœ¨ O(1) çš„ç³»ç»Ÿå¼€é”€ä¸‹è¿›è¡Œæ¶ˆæ¯æŒä¹…åŒ–ã€‚ é«˜ååï¼Œåœ¨ä¸€å°æ™®é€šçš„æœåŠ¡å™¨ä¸Šæ—¢å¯ä»¥è¾¾åˆ° 10W/s çš„ååé€Ÿç‡ã€‚ å®Œå…¨çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒBrokerã€Producerã€Consumer éƒ½åŸç”Ÿè‡ªåŠ¨æ”¯æŒåˆ†å¸ƒå¼ï¼Œè‡ªåŠ¨å®ç°è´Ÿè½½å‡è¡¡ã€‚ æ”¯æŒ Hadoop æ•°æ®å¹¶è¡ŒåŠ è½½ï¼Œå¯¹äºåƒ Hadoop çš„ä¸€æ ·çš„æ—¥å¿—æ•°æ®å’Œç¦»çº¿åˆ†æç³»ç»Ÿï¼Œä½†åˆè¦æ±‚å®æ—¶å¤„ç†çš„é™åˆ¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚ Kafka é€šè¿‡ Hadoop çš„å¹¶è¡ŒåŠ è½½æœºåˆ¶ç»Ÿä¸€äº†åœ¨çº¿å’Œç¦»çº¿çš„æ¶ˆæ¯å¤„ç†ã€‚Apache Kafka ç›¸å¯¹äº ActiveMQ æ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œé™¤äº†æ€§èƒ½éå¸¸å¥½ä¹‹å¤–ï¼Œè¿˜æ˜¯ä¸€ä¸ªå·¥ä½œè‰¯å¥½çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚ Kafka çš„å‡ ç§é‡è¦è§’è‰²å¦‚ä¸‹ï¼š Kafka ä½œä¸ºå­˜å‚¨ç³»ç»Ÿï¼šä»»ä½•å…è®¸å‘å¸ƒä¸ä½¿ç”¨æ— å…³çš„æ¶ˆæ¯å‘å¸ƒçš„æ¶ˆæ¯é˜Ÿåˆ—éƒ½æœ‰æ•ˆåœ°å……å½“äº†è¿è¡Œä¸­æ¶ˆæ¯çš„å­˜å‚¨ç³»ç»Ÿã€‚Kafka çš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒæ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å­˜å‚¨ç³»ç»Ÿã€‚å†™å…¥ Kafka çš„æ•°æ®å°†å†™å…¥ç£ç›˜å¹¶è¿›è¡Œå¤åˆ¶ä»¥å®ç°å®¹é”™åŠŸèƒ½ã€‚Kafka å…è®¸ç”Ÿäº§è€…ç­‰å¾…ç¡®è®¤ï¼Œä»¥ä¾¿ç›´åˆ°å®Œå…¨å¤åˆ¶å¹¶ç¡®ä¿å³ä½¿å†™å…¥æœåŠ¡å™¨å¤±è´¥çš„æƒ…å†µä¸‹å†™å…¥ä¹Ÿä¸ä¼šå®Œæˆã€‚ Kafka çš„ç£ç›˜ç»“æ„å¯ä»¥å¾ˆå¥½åœ°æ‰©å±•ä½¿ç”¨-æ— è®ºæœåŠ¡å™¨ä¸Šæœ‰ 50KB è¿˜æ˜¯ 50TB çš„æŒä¹…æ•°æ®ï¼ŒKafka éƒ½å°†æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚ç”±äºè®¤çœŸå¯¹å¾…å­˜å‚¨å¹¶å…è®¸å®¢æˆ·ç«¯æ§åˆ¶å…¶è¯»å–ä½ç½®ï¼Œå› æ­¤æ‚¨å¯ä»¥å°† Kafka è§†ä¸ºä¸€ç§ä¸“ç”¨äºé«˜æ€§èƒ½ï¼Œä½å»¶è¿Ÿæäº¤æ—¥å¿—å­˜å‚¨ï¼Œå¤åˆ¶å’Œä¼ æ’­çš„ä¸“ç”¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚ Kafka ä½œä¸ºæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿï¼šKafka çš„æµæ¦‚å¿µä¸ä¼ ç»Ÿçš„ä¼ä¸šæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿç›¸æ¯”å¦‚ä½•ï¼Ÿä¼ ç»Ÿä¸Šï¼Œæ¶ˆæ¯ä¼ é€’å…·æœ‰ä¸¤ç§æ¨¡å‹ï¼šæ’é˜Ÿå’Œå‘å¸ƒè®¢é˜…ã€‚åœ¨é˜Ÿåˆ—ä¸­ï¼Œä¸€ç»„ä½¿ç”¨è€…å¯ä»¥ä»æœåŠ¡å™¨ä¸­è¯»å–å†…å®¹ï¼Œå¹¶ä¸”æ¯æ¡è®°å½•éƒ½å°†è½¬åˆ°å…¶ä¸­ä¸€ä¸ªã€‚åœ¨å‘å¸ƒ-è®¢é˜…è®°å½•ä¸­å¹¿æ’­ç»™æ‰€æœ‰æ¶ˆè´¹è€…ã€‚è¿™ä¸¤ä¸ªæ¨¡å‹ä¸­çš„æ¯ä¸€ä¸ªéƒ½æœ‰ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚æ’é˜Ÿçš„ä¼˜åŠ¿åœ¨äºï¼Œå®ƒå…è®¸æ‚¨å°†æ•°æ®å¤„ç†åˆ’åˆ†åˆ°å¤šä¸ªä½¿ç”¨è€…å®ä¾‹ä¸Šï¼Œä»è€Œæ‰©å±•å¤„ç†é‡ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œé˜Ÿåˆ—ä¸æ˜¯å¤šç”¨æˆ·çš„â€”ä¸€æ¬¡è¿›ç¨‹è¯»å–äº†ä¸¢å¤±çš„æ•°æ®ã€‚å‘å¸ƒ-è®¢é˜…å…è®¸æ‚¨å°†æ•°æ®å¹¿æ’­åˆ°å¤šä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯ç”±äºæ¯æ¡æ¶ˆæ¯éƒ½ä¼ é€’ç»™æ¯ä¸ªè®¢é˜…è€…ï¼Œå› æ­¤æ— æ³•æ‰©å±•å¤„ç†ã€‚Kafka çš„æ¶ˆè´¹è€…ç¾¤ä½“æ¦‚å¿µæ¦‚æ‹¬äº†è¿™ä¸¤ä¸ªæ¦‚å¿µã€‚ä¸é˜Ÿåˆ—ä¸€æ ·ï¼Œä½¿ç”¨è€…ç»„å…è®¸æ‚¨å°†å¤„ç†åˆ’åˆ†ä¸ºä¸€ç»„è¿›ç¨‹ï¼ˆä½¿ç”¨è€…ç»„çš„æˆå‘˜ï¼‰ã€‚ä¸å‘å¸ƒè®¢é˜…ä¸€æ ·ï¼ŒKafka å…è®¸æ‚¨å°†æ¶ˆæ¯å¹¿æ’­åˆ°å¤šä¸ªæ¶ˆè´¹è€…ç»„ã€‚ Kafka æ¨¡å‹çš„ä¼˜ç‚¹åœ¨äºï¼Œæ¯ä¸ªä¸»é¢˜éƒ½å…·æœ‰è¿™äº›å±æ€§-å¯ä»¥æ‰©å±•å¤„ç†èŒƒå›´ï¼Œå¹¶ä¸”æ˜¯å¤šè®¢é˜…è€…ï¼Œæ— éœ€é€‰æ‹©å…¶ä¸­ä¸€ä¸ªã€‚ä¸ä¼ ç»Ÿçš„æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿç›¸æ¯”ï¼ŒKafka è¿˜å…·æœ‰æ›´å¼ºçš„è®¢è´­ä¿è¯ã€‚ä¼ ç»Ÿé˜Ÿåˆ—å°†è®°å½•æŒ‰é¡ºåºä¿ç•™åœ¨æœåŠ¡å™¨ä¸Šï¼Œå¦‚æœå¤šä¸ªä½¿ç”¨è€…ä»é˜Ÿåˆ—ä¸­æ¶ˆè´¹ï¼Œåˆ™æœåŠ¡å™¨å°†æŒ‰è®°å½•çš„å­˜å‚¨é¡ºåºåˆ†å‘è®°å½•ã€‚ä½†æ˜¯ï¼Œå°½ç®¡æœåŠ¡å™¨æŒ‰é¡ºåºåˆ†å‘è®°å½•ï¼Œä½†æ˜¯è¿™äº›è®°å½•æ˜¯å¼‚æ­¥ä¼ é€’ç»™ä½¿ç”¨è€…çš„ï¼Œå› æ­¤å®ƒä»¬å¯èƒ½åœ¨ä¸åŒçš„ä½¿ç”¨è€…ä¸Šä¹±åºåˆ°è¾¾ã€‚ è¿™å®é™…ä¸Šæ„å‘³ç€åœ¨å¹¶è¡Œä½¿ç”¨çš„æƒ…å†µä¸‹ä¼šä¸¢å¤±è®°å½•çš„é¡ºåºã€‚æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿé€šå¸¸é€šè¿‡â€œä¸“æœ‰ä½¿ç”¨è€…â€çš„æ¦‚å¿µæ¥è§£å†³æ­¤é—®é¢˜ï¼Œè¯¥æ¦‚å¿µä»…å…è®¸ä¸€ä¸ªè¿›ç¨‹ä»é˜Ÿåˆ—ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯ï¼Œè¿™å½“ç„¶æ„å‘³ç€åœ¨å¤„ç†ä¸­æ²¡æœ‰å¹¶è¡Œæ€§ã€‚Kafka åšå¾—æ›´å¥½ï¼Œé€šè¿‡åœ¨ä¸»é¢˜å†…å…·æœ‰å¹¶è¡Œæ€§ï¼ˆå³åˆ†åŒºï¼‰çš„æ¦‚å¿µï¼ŒKafka èƒ½å¤Ÿåœ¨ç”¨æˆ·è¿›ç¨‹æ± ä¸­æä¾›æ’åºä¿è¯å’Œè´Ÿè½½å‡è¡¡ã€‚ è¿™æ˜¯é€šè¿‡å°†ä¸»é¢˜ä¸­çš„åˆ†åŒºåˆ†é…ç»™æ¶ˆè´¹è€…ç»„ä¸­çš„æ¶ˆè´¹è€…æ¥å®ç°çš„ï¼Œä»¥ä¾¿æ¯ä¸ªåˆ†åŒºéƒ½ç”±ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…å®Œå…¨æ¶ˆè´¹ã€‚é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬ç¡®ä¿ä½¿ç”¨è€…æ˜¯è¯¥åˆ†åŒºçš„å”¯ä¸€è¯»å–å™¨ï¼Œå¹¶æŒ‰é¡ºåºä½¿ç”¨æ•°æ®ã€‚ç”±äºå­˜åœ¨è®¸å¤šåˆ†åŒºï¼Œå› æ­¤ä»ç„¶å¯ä»¥å¹³è¡¡è®¸å¤šä½¿ç”¨è€…å®ä¾‹ä¸Šçš„è´Ÿè½½ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œä½¿ç”¨è€…ç»„ä¸­çš„ä½¿ç”¨è€…å®ä¾‹ä¸èƒ½è¶…è¿‡åˆ†åŒºã€‚ Kafka ç”¨ä½œæµå¤„ç†ï¼šä»…è¯»å–ï¼Œå†™å…¥å’Œå­˜å‚¨æ•°æ®æµæ˜¯ä¸å¤Ÿçš„ï¼Œç›®çš„æ˜¯å®ç°å¯¹æµçš„å®æ—¶å¤„ç†ã€‚åœ¨ Kafka ä¸­ï¼Œæµå¤„ç†å™¨æ˜¯æŒ‡ä»è¾“å…¥ä¸»é¢˜ä¸­è·å–è¿ç»­æ•°æ®æµï¼Œå¯¹è¯¥è¾“å…¥è¿›è¡Œä¸€äº›å¤„ç†å¹¶ç”Ÿæˆè¿ç»­æ•°æ®æµä»¥è¾“å‡ºä¸»é¢˜çš„ä»»ä½•ä¸œè¥¿ã€‚ä¾‹å¦‚ï¼Œé›¶å”®åº”ç”¨ç¨‹åºå¯ä»¥æ¥å—é”€å”®å’Œè£…è¿çš„è¾“å…¥æµï¼Œå¹¶è¾“å‡ºæ ¹æ®æ­¤æ•°æ®è®¡ç®—å‡ºçš„é‡æ–°è®¢è´­å’Œä»·æ ¼è°ƒæ•´æµã€‚ å¯ä»¥ç›´æ¥ä½¿ç”¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€… API è¿›è¡Œç®€å•å¤„ç†ã€‚ä½†æ˜¯ï¼Œå¯¹äºæ›´å¤æ‚çš„è½¬æ¢ï¼ŒKafka æä¾›äº†å®Œå…¨é›†æˆçš„ Streams APIã€‚è¿™å…è®¸æ„å»ºæ‰§è¡Œéé‡è¦å¤„ç†çš„åº”ç”¨ç¨‹åºï¼Œè¿™äº›åº”ç”¨ç¨‹åºè®¡ç®—æµçš„èšåˆæˆ–å°†æµè¿æ¥åœ¨ä¸€èµ·ã€‚è¯¥åŠŸèƒ½æœ‰åŠ©äºè§£å†³æ­¤ç±»åº”ç”¨ç¨‹åºæ‰€é¢ä¸´çš„éš¾é¢˜ï¼šå¤„ç†æ— åºæ•°æ®ï¼Œåœ¨ä»£ç æ›´æ”¹æ—¶é‡æ–°å¤„ç†è¾“å…¥ï¼Œæ‰§è¡ŒçŠ¶æ€è®¡ç®—ç­‰ã€‚ æµ API å»ºç«‹åœ¨ Kafka æä¾›çš„æ ¸å¿ƒåŸè¯­ä¹‹ä¸Šï¼šå®ƒä½¿ç”¨ç”Ÿäº§è€…å’Œä½¿ç”¨è€… API è¿›è¡Œè¾“å…¥ï¼Œä½¿ç”¨ Kafka è¿›è¡ŒçŠ¶æ€å­˜å‚¨ï¼Œå¹¶ä½¿ç”¨ç›¸åŒçš„ç»„æœºåˆ¶æ¥å®ç°æµå¤„ç†å™¨å®ä¾‹ä¹‹é—´çš„å®¹é”™ã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:7:0","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"Kafka ä¸­çš„å…³é”®æœ¯è¯­è§£é‡Š Topicï¼š ä¸»é¢˜ã€‚åœ¨ Kafka ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªç±»åˆ«å±æ€§æ¥åˆ’åˆ†æ¶ˆæ¯çš„æ‰€å±ç±»ï¼Œåˆ’åˆ†æ¶ˆæ¯çš„è¿™ä¸ªç±»ç§°ä¸º Topicã€‚Topic ç›¸å½“äºæ¶ˆæ¯çš„åˆ†ç±»æ ‡ç­¾ï¼Œæ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µã€‚ç‰©ç†ä¸Šä¸åŒ Topic çš„æ¶ˆæ¯åˆ†å¼€å­˜å‚¨ï¼Œé€»è¾‘ä¸Šä¸€ä¸ª Topic çš„æ¶ˆæ¯è™½ç„¶ä¿å­˜äºä¸€ä¸ªæˆ–å¤šä¸ª Broker ä¸Šä½†ç”¨æˆ·åªéœ€æŒ‡å®šæ¶ˆæ¯çš„ Topic å³å¯ç”Ÿäº§æˆ–æ¶ˆè´¹æ•°æ®è€Œä¸å¿…å…³å¿ƒæ•°æ®å­˜äºä½•å¤„ã€‚ Partitionï¼š åˆ†åŒºã€‚Topic ä¸­çš„æ¶ˆæ¯è¢«åˆ†å‰²ä¸ºä¸€ä¸ªæˆ–å¤šä¸ª Partitionï¼Œå…¶æ˜¯ä¸€ä¸ªç‰©ç†æ¦‚å¿µï¼Œå¯¹åº”åˆ°ç³»ç»Ÿä¸Š å°±æ˜¯ä¸€ä¸ªæˆ–è‹¥å¹²ä¸ªç›®å½•ã€‚Partition å†…éƒ¨çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Œä½† Partition é—´çš„æ¶ˆæ¯æ˜¯æ— åºçš„ã€‚ Segment æ®µ: å°† Partition è¿›ä¸€æ­¥ç»†åˆ†ä¸ºäº†è‹¥å¹²çš„ Segmentï¼Œæ¯ä¸ª Segment æ–‡ä»¶çš„å¤§å°ç›¸ç­‰ã€‚ Brokerï¼š Kafka é›†ç¾¤åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡å™¨ï¼Œæ¯ä¸ªæœåŠ¡å™¨èŠ‚ç‚¹ç§°ä¸ºä¸€ä¸ª Brokerã€‚Broker å­˜å‚¨ Topic çš„æ•°æ®ã€‚å¦‚æœæŸ Topic æœ‰ N ä¸ª Partitionï¼Œé›†ç¾¤æœ‰ N ä¸ª Brokerï¼Œé‚£ä¹ˆæ¯ä¸ª Broker å­˜å‚¨è¯¥ Topic çš„ä¸€ä¸ª Partitionã€‚ å¦‚æœæŸ Topic æœ‰ N ä¸ª Partitionï¼Œé›†ç¾¤æœ‰ï¼ˆN+Mï¼‰ä¸ª Brokerï¼Œé‚£ä¹ˆå…¶ä¸­æœ‰ N ä¸ª Broker å­˜å‚¨è¯¥ Topic çš„ä¸€ä¸ª Partitionï¼Œå‰©ä¸‹çš„ M ä¸ª Broker ä¸å­˜å‚¨è¯¥ Topic çš„ Partition æ•°æ®ã€‚å¦‚æœæŸ Topic æœ‰ N ä¸ª Partitionï¼Œé›†ç¾¤ä¸­ Broker æ•°ç›®å°‘äº N ä¸ªï¼Œé‚£ä¹ˆä¸€ä¸ª Broker å­˜å‚¨è¯¥ Topic çš„ä¸€ä¸ªæˆ–å¤šä¸ª Partitionã€‚åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå°½é‡é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œè¿™ç§æƒ…å†µå®¹æ˜“å¯¼è‡´ Kafka é›†ç¾¤æ•°æ®ä¸å‡è¡¡ã€‚ Producerï¼š ç”Ÿäº§è€…ã€‚å³æ¶ˆæ¯çš„å‘å¸ƒè€…ï¼Œç”Ÿäº§è€…å°†æ•°æ®å‘å¸ƒåˆ°ä»–ä»¬é€‰æ‹©çš„ä¸»é¢˜ã€‚ç”Ÿäº§è€…è´Ÿè´£é€‰æ‹©å°†å“ªä¸ªè®°å½•åˆ†é…ç»™ä¸»é¢˜ä¸­çš„å“ªä¸ªåˆ†åŒºã€‚å³ï¼šç”Ÿäº§è€…ç”Ÿäº§çš„ä¸€æ¡æ¶ˆæ¯ï¼Œä¼šè¢«å†™å…¥åˆ°æŸä¸€ä¸ª Partitionã€‚ Consumerï¼š æ¶ˆè´¹è€…ã€‚å¯ä»¥ä» Broker ä¸­è¯»å–æ¶ˆæ¯ã€‚ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹å¤šä¸ª Topic çš„æ¶ˆæ¯ï¼›ä¸€ä¸ªæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åŒä¸€ä¸ª Topic ä¸­çš„å¤šä¸ª Partition ä¸­çš„æ¶ˆæ¯ï¼›ä¸€ä¸ª Partiton å…è®¸å¤šä¸ª Consumer åŒæ—¶æ¶ˆè´¹ã€‚ Consumer Groupï¼š Consumer Group æ˜¯ Kafka æä¾›çš„å¯æ‰©å±•ä¸”å…·æœ‰å®¹é”™æ€§çš„æ¶ˆè´¹è€…æœºåˆ¶ã€‚ç»„å†…å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œå®ƒä»¬å…±äº«ä¸€ä¸ªå…¬å…±çš„ IDï¼Œå³ Group IDã€‚ç»„å†…çš„æ‰€æœ‰æ¶ˆè´¹è€…åè°ƒåœ¨ä¸€èµ·æ¥æ¶ˆè´¹è®¢é˜…ä¸»é¢˜ çš„æ‰€æœ‰åˆ†åŒºã€‚Kafka ä¿è¯åŒä¸€ä¸ª Consumer Group ä¸­åªæœ‰ä¸€ä¸ª Consumer ä¼šæ¶ˆè´¹æŸæ¡æ¶ˆæ¯ã€‚ å®é™…ä¸Šï¼ŒKafka ä¿è¯çš„æ˜¯ç¨³å®šçŠ¶æ€ä¸‹æ¯ä¸€ä¸ª Consumer å®ä¾‹åªä¼šæ¶ˆè´¹æŸä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å®šçš„ Partitionï¼Œè€ŒæŸä¸ª Partition çš„æ•°æ®åªä¼šè¢«æŸä¸€ä¸ªç‰¹å®šçš„ Consumer å®ä¾‹æ‰€æ¶ˆè´¹ã€‚ ä¸‹é¢æˆ‘ä»¬ç”¨å®˜ç½‘çš„ä¸€å¼ å›¾, æ¥æ ‡è¯† Consumer æ•°é‡å’Œ Partition æ•°é‡çš„å¯¹åº”å…³ç³»ã€‚ ç”±ä¸¤å°æœåŠ¡å™¨ç»„æˆçš„ Kafka ç¾¤é›†ï¼Œå…¶ä¸­åŒ…å«å››ä¸ªå¸¦æœ‰ä¸¤ä¸ªä½¿ç”¨è€…ç»„çš„åˆ†åŒºï¼ˆP0-P3ï¼‰ã€‚æ¶ˆè´¹è€…ç»„ A æœ‰ä¸¤ä¸ªæ¶ˆè´¹è€…å®ä¾‹ï¼Œç»„ B æœ‰å››ä¸ªã€‚ å¯¹äºè¿™ä¸ªæ¶ˆè´¹ç»„, ä»¥å‰ä¸€ç›´æä¸æ˜ç™½, æˆ‘è‡ªå·±çš„æ€»ç»“æ˜¯ï¼šTopic ä¸­çš„ Partitoin åˆ° Group æ˜¯å‘å¸ƒè®¢é˜…çš„é€šä¿¡æ–¹å¼ã€‚ å³ä¸€æ¡ Topic çš„ Partition çš„æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰çš„ Group æ¶ˆè´¹ï¼Œå±äºä¸€å¯¹å¤šæ¨¡å¼ï¼›Group åˆ° Consumer æ˜¯ç‚¹å¯¹ç‚¹é€šä¿¡æ–¹å¼ï¼Œå±äºä¸€å¯¹ä¸€æ¨¡å¼ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šä¸ä½¿ç”¨ Group çš„è¯ï¼Œå¯åŠ¨ 10 ä¸ª Consumer æ¶ˆè´¹ä¸€ä¸ª Topicï¼Œè¿™ 10 ä¸ª Consumer éƒ½èƒ½å¾—åˆ° Topic çš„æ‰€æœ‰æ•°æ®ï¼Œç›¸å½“äºè¿™ä¸ª Topic ä¸­çš„ä»»ä¸€æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹ 10 æ¬¡ã€‚ ä½¿ç”¨ Group çš„è¯ï¼Œè¿æ¥æ—¶å¸¦ä¸Š groupidï¼ŒTopic çš„æ¶ˆæ¯ä¼šåˆ†å‘åˆ° 10 ä¸ª Consumer ä¸Šï¼Œæ¯æ¡æ¶ˆæ¯åªè¢«æ¶ˆè´¹ 1 æ¬¡ã€‚ Replizcas of partitionï¼š åˆ†åŒºå‰¯æœ¬ã€‚å‰¯æœ¬æ˜¯ä¸€ä¸ªåˆ†åŒºçš„å¤‡ä»½ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±è€Œåˆ›å»ºçš„åˆ†åŒºçš„å¤‡ä»½ã€‚ Partition Leaderï¼š æ¯ä¸ª Partition æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œå…¶ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªä½œä¸º Leaderï¼ŒLeader æ˜¯å½“å‰è´Ÿè´£æ¶ˆæ¯è¯»å†™ çš„ Partitionã€‚å³æ‰€æœ‰è¯»å†™æ“ä½œåªèƒ½å‘ç”Ÿäº Leader åˆ†åŒºä¸Šã€‚ Partition Followerï¼š æ‰€æœ‰ Follower éƒ½éœ€è¦ä» Leader åŒæ­¥æ¶ˆæ¯ï¼ŒFollower ä¸ Leader å§‹ç»ˆä¿æŒæ¶ˆæ¯åŒæ­¥ã€‚Leader ä¸ Follower çš„å…³ç³»æ˜¯ä¸»å¤‡å…³ç³»ï¼Œè€Œéä¸»ä»å…³ç³»ã€‚ ISRï¼š ISRï¼ŒIn-Sync Replicasï¼Œæ˜¯æŒ‡å‰¯æœ¬åŒæ­¥åˆ—è¡¨ã€‚ISR åˆ—è¡¨æ˜¯ç”± Leader è´Ÿè´£ç»´æŠ¤ã€‚ ARï¼ŒAssigned Replicasï¼ŒæŒ‡æŸä¸ª Partition çš„æ‰€æœ‰å‰¯æœ¬, å³å·²åˆ†é…çš„å‰¯æœ¬åˆ—è¡¨ã€‚ OSRï¼ŒOutof-Sync Replicasï¼Œå³éåŒæ­¥çš„å‰¯æœ¬åˆ—è¡¨ã€‚ AR=ISR+OSR Offsetï¼š åç§»é‡ã€‚æ¯æ¡æ¶ˆæ¯éƒ½æœ‰ä¸€ä¸ªå½“å‰ Partition ä¸‹å”¯ä¸€çš„ 64 å­—èŠ‚çš„ Offsetï¼Œå®ƒæ˜¯ç›¸å½“äºå½“å‰åˆ†åŒºç¬¬ä¸€æ¡æ¶ˆæ¯çš„åç§»é‡ã€‚ Broker Controllerï¼š Kafkaé›†ç¾¤çš„å¤šä¸ª Broker ä¸­ï¼Œæœ‰ä¸€ä¸ªä¼šè¢«é€‰ä¸¾ Controllerï¼Œè´Ÿè´£ç®¡ç†æ•´ä¸ªé›†ç¾¤ä¸­ Partition å’Œ Replicas çš„çŠ¶æ€ã€‚ åªæœ‰ Broker Controller ä¼šå‘ Zookeeper ä¸­æ³¨å†Œ Watcherï¼Œå…¶ä»– Broker åŠåˆ†åŒºæ— éœ€æ³¨å†Œã€‚å³ Zookeeper ä»…éœ€ç›‘å¬ Broker Controller çš„çŠ¶æ€å˜åŒ–å³å¯ã€‚ HW ä¸ LEOï¼š HWï¼ŒHighWatermarkï¼Œé«˜æ°´ä½ï¼Œè¡¨ç¤º Consumer å¯ä»¥æ¶ˆè´¹åˆ°çš„æœ€é«˜ Partition åç§»é‡ã€‚HW ä¿è¯äº† Kafka é›†ç¾¤ä¸­æ¶ˆæ¯çš„ä¸€è‡´æ€§ã€‚ç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯ä¿è¯äº† Partition çš„ Follower ä¸ Leader é—´æ•° æ®çš„ä¸€è‡´æ€§ã€‚ LEOï¼ŒLog End Offsetï¼Œæ—¥å¿—æœ€åæ¶ˆæ¯çš„åç§»é‡ã€‚æ¶ˆæ¯æ˜¯è¢«å†™å…¥åˆ° Kafka çš„æ—¥å¿—æ–‡ä»¶ä¸­çš„ï¼Œ è¿™æ˜¯å½“å‰æœ€åä¸€ä¸ªå†™å…¥çš„æ¶ˆæ¯åœ¨ Partition ä¸­çš„åç§»é‡ã€‚ å¯¹äº Leader æ–°å†™å…¥çš„æ¶ˆæ¯ï¼ŒConsumer æ˜¯ä¸èƒ½ç«‹åˆ»æ¶ˆè´¹çš„ã€‚Leader ä¼šç­‰å¾…è¯¥æ¶ˆæ¯è¢«æ‰€æœ‰ ISR ä¸­çš„ Partition Follower åŒæ­¥åæ‰ä¼šæ›´æ–° HWï¼Œæ­¤æ—¶æ¶ˆæ¯æ‰èƒ½è¢« Consumer æ¶ˆè´¹ã€‚ æˆ‘ç›¸ä¿¡ä½ çœ‹å®Œä¸Šé¢çš„æ¦‚å¿µè¿˜æ˜¯æ‡µé€¼çš„ï¼Œå¥½å§ï¼ä¸‹é¢æˆ‘ä»¬å°±ç”¨å›¾æ¥å½¢è±¡è¯çš„è¡¨ç¤ºä¸¤è€…çš„å…³ç³»å§ï¼š Zookeeperï¼š Zookeeper è´Ÿè´£ç»´æŠ¤å’Œåè°ƒ Brokerï¼Œè´Ÿè´£ Broker Controller çš„é€‰ä¸¾ã€‚åœ¨ Kafka 0.9 ä¹‹å‰ç‰ˆæœ¬ï¼ŒOffset æ˜¯ç”± ZK è´Ÿè´£ç®¡ç†çš„ã€‚ æ€»ç»“ï¼šZK è´Ÿè´£ Controller çš„é€‰ä¸¾ï¼ŒController è´Ÿè´£ Leader çš„é€‰ä¸¾ã€‚ Coordinatorï¼š ä¸€èˆ¬æŒ‡çš„æ˜¯è¿è¡Œåœ¨æ¯ä¸ª Broker ä¸Šçš„ Group Coordinator è¿›ç¨‹ï¼Œç”¨äºç®¡ç† Consumer Group ä¸­çš„å„ä¸ªæˆå‘˜ï¼Œä¸»è¦ç”¨äº Offset ä½ç§»ç®¡ç†å’Œ Rebalanceã€‚ä¸€ä¸ª Coordinator å¯ä»¥åŒæ—¶ç®¡ç†å¤šä¸ªæ¶ˆè´¹è€…ç»„ã€‚ Rebalanceï¼š å½“æ¶ˆè´¹è€…ç»„ä¸­çš„æ•°é‡å‘ç”Ÿå˜åŒ–ï¼Œæˆ–è€… Topic ä¸­çš„ Partition æ•°é‡å‘ç”Ÿäº†å˜åŒ–æ—¶ï¼ŒPartition çš„æ‰€æœ‰æƒä¼šåœ¨æ¶ˆè´¹è€…é—´è½¬ç§»ï¼Œå³ Partition ä¼šé‡æ–°åˆ†é…ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå†å‡è¡¡ Rebalanceã€‚ å†å‡è¡¡èƒ½å¤Ÿç»™æ¶ˆè´¹è€…ç»„åŠ Broker å¸¦æ¥é«˜æ€§èƒ½ã€é«˜å¯ç”¨æ€§å’Œä¼¸ç¼©ï¼Œä½†åœ¨å†å‡è¡¡æœŸé—´æ¶ˆè´¹è€…æ˜¯æ— æ³•è¯»å–æ¶ˆæ¯çš„ï¼Œå³æ•´ä¸ª Broker é›†ç¾¤æœ‰å°ä¸€æ®µæ—¶é—´æ˜¯ä¸å¯ç”¨çš„ã€‚å› æ­¤è¦é¿å…ä¸å¿…è¦çš„å†å‡è¡¡ã€‚ Offset Commitï¼š Consumer ä» Broker ä¸­å–ä¸€æ‰¹æ¶ˆæ¯å†™å…¥ Buffer è¿›è¡Œæ¶ˆè´¹ï¼Œåœ¨è§„å®šçš„æ—¶é—´å†…æ¶ˆè´¹å®Œæ¶ˆæ¯åï¼Œä¼šè‡ªåŠ¨å°†å…¶æ¶ˆè´¹æ¶ˆæ¯çš„ Offset æäº¤ç»™ Brokerï¼Œä»¥è®°å½•ä¸‹å“ªäº›æ¶ˆæ¯æ˜¯æ¶ˆè´¹è¿‡çš„ã€‚å½“ç„¶ï¼Œè‹¥åœ¨æ—¶é™å†…æ²¡æœ‰æ¶ˆè´¹å®Œæ¯•ï¼Œå…¶æ˜¯ä¸ä¼šæäº¤ Offset çš„ã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:8:0","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"Kafkaçš„å·¥ä½œåŸç†å’Œè¿‡ç¨‹ ","date":"2020-12-17","objectID":"/mq-kafka/:9:0","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"æ¶ˆæ¯å†™å…¥ç®—æ³• æ¶ˆæ¯å‘é€è€…å°†æ¶ˆæ¯å‘é€ç»™ Broker, å¹¶å½¢æˆæœ€ç»ˆçš„å¯ä¾›æ¶ˆè´¹è€…æ¶ˆè´¹çš„ logï¼Œæ˜¯æ¯”è¾ƒå¤æ‚çš„è¿‡ç¨‹ï¼š Producer å…ˆä» Zookeeper ä¸­æ‰¾åˆ°è¯¥ Partition çš„ Leaderã€‚ Producerå°†æ¶ˆæ¯å‘é€ç»™è¯¥ Leaderã€‚ Leader å°†æ¶ˆæ¯æ¥å…¥æœ¬åœ°çš„ logï¼Œå¹¶é€šçŸ¥ ISR çš„ Followersã€‚ ISR ä¸­çš„ Followers ä» Leader ä¸­ Pull æ¶ˆæ¯, å†™å…¥æœ¬åœ° log åå‘ Leader å‘é€ Ackã€‚ Leader æ”¶åˆ°æ‰€æœ‰ ISR ä¸­çš„ Followers çš„ Ack åï¼Œå¢åŠ  HW å¹¶å‘ Producer å‘é€ Ackï¼Œè¡¨ç¤ºæ¶ˆæ¯å†™å…¥æˆåŠŸã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:9:1","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"æ¶ˆæ¯è·¯ç”±ç­–ç•¥ åœ¨é€šè¿‡ API æ–¹å¼å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œç”Ÿäº§è€…æ˜¯ä»¥ Record ä¸ºæ¶ˆæ¯è¿›è¡Œå‘å¸ƒçš„ã€‚ Record ä¸­åŒ…å« Key ä¸ Valueï¼ŒValue æ‰æ˜¯æˆ‘ä»¬çœŸæ­£çš„æ¶ˆæ¯æœ¬èº«ï¼Œè€Œ Key ç”¨äºè·¯ç”±æ¶ˆæ¯æ‰€è¦å­˜æ”¾çš„ Partitionã€‚ æ¶ˆæ¯è¦å†™å…¥åˆ°å“ªä¸ª Partition å¹¶ä¸æ˜¯éšæœºçš„ï¼Œè€Œæ˜¯æœ‰è·¯ç”±ç­–ç•¥çš„ï¼š è‹¥æŒ‡å®šäº† Partitionï¼Œåˆ™ç›´æ¥å†™å…¥åˆ°æŒ‡å®šçš„ Partitionã€‚ è‹¥æœªæŒ‡å®š Partition ä½†æŒ‡å®šäº† Keyï¼Œåˆ™é€šè¿‡å¯¹ Key çš„ Hash å€¼ä¸ Partition æ•°é‡å–æ¨¡ï¼Œè¯¥å–æ¨¡ã€‚ ç»“æœå°±æ˜¯è¦é€‰å‡ºçš„ Partition ç´¢å¼•ã€‚ è‹¥ Partition å’Œ Key éƒ½æœªæŒ‡å®šï¼Œåˆ™ä½¿ç”¨è½®è¯¢ç®—æ³•é€‰å‡ºä¸€ä¸ª Partitionã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:9:2","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"HW æˆªæ–­æœºåˆ¶ å¦‚æœ Partition Leader æ¥æ”¶åˆ°äº†æ–°çš„æ¶ˆæ¯ï¼Œ ISR ä¸­å…¶å®ƒ Follower æ­£åœ¨åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œè¿˜æœªåŒæ­¥å®Œæ¯•æ—¶ leader å®•æœºã€‚ æ­¤æ—¶å°±éœ€è¦é€‰ä¸¾å‡ºæ–°çš„ Leaderã€‚è‹¥æ²¡æœ‰ HW æˆªæ–­æœºåˆ¶ï¼Œå°†ä¼šå¯¼è‡´ Partition ä¸­ Leader ä¸ Follower æ•°æ®çš„ä¸ä¸€è‡´ã€‚ å½“åŸ Leader å®•æœºååˆæ¢å¤æ—¶ï¼Œå°†å…¶ LEO å›é€€åˆ°å…¶å®•æœºæ—¶çš„ HWï¼Œç„¶åå†ä¸æ–°çš„ Leader è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯è€ Leader ä¸æ–° Leader ä¸­æ•°æ®ä¸€è‡´äº†ï¼Œè¿™ç§æœºåˆ¶ç§°ä¸º HW æˆªæ–­æœºåˆ¶ã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:9:3","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"æ¶ˆæ¯å‘é€çš„å¯é æ€§ ç”Ÿäº§è€…å‘ Kafka å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥é€‰æ‹©éœ€è¦çš„å¯é æ€§çº§åˆ«ã€‚é€šè¿‡ request.required.acks å‚æ•°çš„å€¼è¿›è¡Œè®¾ç½®ã€‚ 0 å€¼ï¼š å¼‚æ­¥å‘é€ã€‚ç”Ÿäº§è€…å‘ Kafka å‘é€æ¶ˆæ¯è€Œä¸éœ€è¦ Kafka åé¦ˆæˆåŠŸ Ackã€‚è¯¥æ–¹å¼æ•ˆç‡æœ€é«˜ï¼Œä½†å¯é æ€§æœ€ä½ã€‚ å…¶å¯èƒ½ä¼šå­˜åœ¨æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µï¼š åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¼šå‡ºç°æ¶ˆæ¯ä¸¢å¤±ã€‚ åœ¨ Broker å†…éƒ¨ä¼šå‡ºç°æ¶ˆæ¯ä¸¢å¤±ã€‚ ä¼šå‡ºç°å†™å…¥åˆ° Kafka ä¸­çš„æ¶ˆæ¯çš„é¡ºåºä¸ç”Ÿäº§é¡ºåºä¸ä¸€è‡´çš„æƒ…å†µã€‚ 1 å€¼ï¼š åŒæ­¥å‘é€ã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç»™ Kafkaï¼ŒBroker çš„ Partition Leader åœ¨æ”¶åˆ°æ¶ˆæ¯åé©¬ä¸Šå‘é€æˆåŠŸ Ackï¼ˆæ— éœ€ç­‰ç­‰ ISR ä¸­çš„ Follower åŒæ­¥ï¼‰ã€‚ ç”Ÿäº§è€…æ”¶åˆ°åçŸ¥é“æ¶ˆæ¯å‘é€æˆåŠŸï¼Œç„¶åä¼šå†å‘é€æ¶ˆæ¯ã€‚å¦‚æœä¸€ç›´æœªæ”¶åˆ° Kafka çš„ Ackï¼Œåˆ™ç”Ÿäº§è€…ä¼šè®¤ä¸ºæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œä¼šé‡å‘æ¶ˆæ¯ã€‚ è¯¥æ–¹å¼å¯¹äº Producer æ¥è¯´ï¼Œè‹¥æ²¡æœ‰æ”¶åˆ° Ackï¼Œä¸€å®šå¯ä»¥ç¡®è®¤æ¶ˆæ¯å‘é€å¤±è´¥äº†ï¼Œç„¶åå¯ä»¥é‡å‘ã€‚ ä½†æ˜¯ï¼Œå³ä½¿æ”¶åˆ°äº† ACKï¼Œä¹Ÿä¸èƒ½ä¿è¯æ¶ˆæ¯ä¸€å®šå°±å‘é€æˆåŠŸäº†ã€‚æ•…ï¼Œè¿™ç§æƒ…å†µï¼Œä¹Ÿå¯èƒ½ä¼šå‘ç”Ÿæ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µã€‚ -1 å€¼ï¼š åŒæ­¥å‘é€ã€‚ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ç»™ Kafkaï¼ŒKafka æ”¶åˆ°æ¶ˆæ¯åè¦ç­‰åˆ° ISR åˆ—è¡¨ä¸­çš„æ‰€æœ‰å‰¯æœ¬éƒ½ åŒæ­¥æ¶ˆæ¯å®Œæˆåï¼Œæ‰å‘ç”Ÿäº§è€…å‘é€æˆåŠŸ Ackã€‚ å¦‚æœä¸€ç›´æœªæ”¶åˆ° Kafka çš„ Ackï¼Œåˆ™è®¤ä¸ºæ¶ˆæ¯å‘é€ å¤±è´¥ï¼Œä¼šè‡ªåŠ¨é‡å‘æ¶ˆæ¯ã€‚è¯¥æ–¹å¼ä¼šå‡ºç°æ¶ˆæ¯é‡å¤æ¥æ”¶çš„æƒ…å†µã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:9:4","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"æ¶ˆè´¹è€…æ¶ˆè´¹è¿‡ç¨‹è§£æ ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ° Topitc ä¸­ï¼Œæ¶ˆè´¹è€…å³å¯å¯¹å…¶è¿›è¡Œæ¶ˆè´¹ï¼Œå…¶æ¶ˆè´¹è¿‡ç¨‹å¦‚ä¸‹ï¼š Consumer å‘ Broker æäº¤è¿æ¥è¯·æ±‚ï¼Œå…¶æ‰€è¿æ¥ä¸Šçš„ Broker éƒ½ä¼šå‘å…¶å‘é€Broker Controller çš„é€šä¿¡ URLï¼Œå³é…ç½®æ–‡ä»¶ä¸­çš„ Listeners åœ°å€ã€‚ å½“ Consumer æŒ‡å®šäº†è¦æ¶ˆè´¹çš„ Topic åï¼Œä¼šå‘ Broker Controller å‘é€æ¶ˆè´¹è¯·æ±‚ã€‚ Broker Controller ä¼šä¸º Consumer åˆ†é…ä¸€ä¸ªæˆ–å‡ ä¸ª Partition Leaderï¼Œå¹¶å°†è¯¥ Partition çš„å½“å‰ Offset å‘é€ç»™ Consumerã€‚ Consumer ä¼šæŒ‰ç…§ Broker Controller åˆ†é…çš„ Partition å¯¹å…¶ä¸­çš„æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ã€‚ å½“ Consumer æ¶ˆè´¹å®Œè¯¥æ¡æ¶ˆæ¯åï¼ŒConsumer ä¼šå‘ Broker å‘é€ä¸€ä¸ªæ¶ˆæ¯å·²ç»è¢«æ¶ˆè´¹åé¦ˆï¼Œå³è¯¥æ¶ˆæ¯çš„ Offsetã€‚ åœ¨ Broker æ¥æ”¶åˆ° Consumer çš„ Offset åï¼Œä¼šæ›´æ–°ç›¸åº”çš„ __consumer_offset ä¸­ã€‚ ä»¥ä¸Šè¿‡ç¨‹ä¼šä¸€ç›´é‡å¤ï¼ŒçŸ¥é“æ¶ˆè´¹è€…åœæ­¢è¯·æ±‚æ¶ˆè´¹ã€‚ Consumer å¯ä»¥é‡ç½® Offsetï¼Œä»è€Œå¯ä»¥çµæ´»æ¶ˆè´¹å­˜å‚¨åœ¨ Broker ä¸Šçš„æ¶ˆæ¯ã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:9:5","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"Partition Leader é€‰ä¸¾èŒƒå›´ å½“ Leader å®•æœºåï¼ŒBroker Controller ä¼šä» ISR ä¸­æŒ‘é€‰ä¸€ä¸ª Follower æˆä¸ºæ–°çš„ Leaderã€‚ å¦‚æœ ISR ä¸­æ²¡æœ‰å…¶ä»–å‰¯æœ¬æ€ä¹ˆåŠï¼Ÿå¯ä»¥é€šè¿‡ unclean.leader.election.enable çš„å€¼æ¥è®¾ç½® Leader é€‰ä¸¾èŒƒå›´ã€‚ Falseï¼šå¿…é¡»ç­‰åˆ° ISR åˆ—è¡¨ä¸­æ‰€æœ‰çš„å‰¯æœ¬éƒ½æ´»è¿‡æ¥æ‰è¿›è¡Œæ–°çš„é€‰ä¸¾ã€‚è¯¥ç­–ç•¥å¯é æ€§æœ‰ä¿è¯ï¼Œä½†å¯ç”¨æ€§ä½ã€‚ Trueï¼šåœ¨ ISR åˆ—è¡¨ä¸­æ²¡æœ‰å‰¯æœ¬çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€‰æ‹©ä»»æ„ä¸€ä¸ªæ²¡æœ‰å®•æœºçš„ä¸»æœºä½œä¸ºæ–°çš„ Leaderï¼Œè¯¥ç­–ç•¥å¯ç”¨æ€§é«˜ï¼Œä½†å¯é æ€§æ²¡æœ‰ä¿è¯ã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:9:6","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"é‡å¤æ¶ˆè´¹é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ åŒä¸€ä¸ª Consumer é‡å¤æ¶ˆè´¹ï¼šå½“ Consumer ç”±äºæ¶ˆè´¹èƒ½åŠ›ä½è€Œå¼•å‘äº†æ¶ˆè´¹è¶…æ—¶ï¼Œåˆ™å¯èƒ½ä¼šå½¢æˆé‡å¤æ¶ˆè´¹ã€‚ åœ¨æŸæ•°æ®åˆšå¥½æ¶ˆè´¹å®Œæ¯•ï¼Œä½†æ˜¯æ­£å‡†å¤‡æäº¤ Offset æ—¶å€™ï¼Œæ¶ˆè´¹æ—¶é—´è¶…æ—¶ï¼Œåˆ™ Broker è®¤ä¸ºè¿™æ¡æ¶ˆæ¯æœªæ¶ˆè´¹æˆåŠŸã€‚è¿™æ—¶å°±ä¼šäº§ç”Ÿé‡å¤æ¶ˆè´¹é—®é¢˜ã€‚å…¶è§£å†³æ–¹æ¡ˆï¼šå»¶é•¿ Offset æäº¤æ—¶é—´ã€‚ ä¸åŒçš„ Consumer é‡å¤æ¶ˆè´¹ï¼šå½“ Consumer æ¶ˆè´¹äº†æ¶ˆæ¯ï¼Œä½†è¿˜æ²¡æœ‰æäº¤ Offset æ—¶å®•æœºï¼Œåˆ™è¿™äº›å·²ç»è¢«æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯ä¼šè¢«é‡å¤æ¶ˆè´¹ã€‚å…¶è§£å†³æ–¹æ¡ˆï¼šå°†è‡ªåŠ¨æäº¤æ”¹ä¸ºæ‰‹åŠ¨æäº¤ã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:9:7","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"ä»æ¶æ„è®¾è®¡ä¸Šè§£å†³ Kafka é‡å¤æ¶ˆè´¹çš„é—®é¢˜ æˆ‘ä»¬åœ¨è®¾è®¡ç¨‹åºçš„æ—¶å€™ï¼Œæ¯”å¦‚è€ƒè™‘åˆ°ç½‘ç»œæ•…éšœç­‰ä¸€äº›å¼‚å¸¸çš„æƒ…å†µï¼Œæˆ‘ä»¬éƒ½ä¼šè®¾ç½®æ¶ˆæ¯çš„é‡è¯•æ¬¡æ•°ï¼Œå¯èƒ½è¿˜æœ‰å…¶ä»–å¯èƒ½å‡ºç°æ¶ˆæ¯é‡å¤ï¼Œé‚£æˆ‘ä»¬åº”è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿä¸‹é¢æä¾›ä¸‰ä¸ªæ–¹æ¡ˆï¼š ä¿å­˜å¹¶æŸ¥è¯¢ ç»™æ¯ä¸ªæ¶ˆæ¯éƒ½è®¾ç½®ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ uuidï¼Œæ‰€æœ‰çš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬éƒ½è¦å­˜ä¸€ä¸ª uuidã€‚ æˆ‘ä»¬åœ¨æ¶ˆè´¹æ¶ˆæ¯çš„æ—¶å€™ï¼Œé¦–å…ˆå»æŒä¹…åŒ–ç³»ç»Ÿä¸­æŸ¥è¯¢ä¸€ä¸‹çœ‹è¿™ä¸ªçœ‹æ˜¯å¦ä»¥å‰æ¶ˆè´¹è¿‡ï¼Œå¦‚æ²¡æœ‰æ¶ˆè´¹è¿‡ï¼Œåœ¨è¿›è¡Œæ¶ˆè´¹ï¼Œå¦‚æœå·²ç»æ¶ˆè´¹è¿‡ï¼Œä¸¢å¼ƒå°±å¥½äº†ã€‚ ä¸‹å›¾è¡¨æ˜äº†è¿™ç§æ–¹æ¡ˆï¼š åˆ©ç”¨å¹‚ç­‰ å¹‚ç­‰ï¼ˆIdempotenceï¼‰åœ¨æ•°å­¦ä¸Šæ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œå¦‚æœä¸€ä¸ªå‡½æ•° f(x) æ»¡è¶³ï¼šf(f(x)) = f(x)ï¼Œåˆ™å‡½æ•° f(x) æ»¡è¶³å¹‚ç­‰æ€§ã€‚ è¿™ä¸ªæ¦‚å¿µè¢«æ‹“å±•åˆ°è®¡ç®—æœºé¢†åŸŸï¼Œè¢«ç”¨æ¥æè¿°ä¸€ä¸ªæ“ä½œã€æ–¹æ³•æˆ–è€…æœåŠ¡ã€‚ä¸€ä¸ªå¹‚ç­‰æ“ä½œçš„ç‰¹ç‚¹æ˜¯ï¼Œå…¶ä»»æ„å¤šæ¬¡æ‰§è¡Œæ‰€äº§ç”Ÿçš„å½±å“å‡ä¸ä¸€æ¬¡æ‰§è¡Œçš„å½±å“ç›¸åŒã€‚ ä¸€ä¸ªå¹‚ç­‰çš„æ–¹æ³•ï¼Œä½¿ç”¨åŒæ ·çš„å‚æ•°ï¼Œå¯¹å®ƒè¿›è¡Œå¤šæ¬¡è°ƒç”¨å’Œä¸€æ¬¡è°ƒç”¨ï¼Œå¯¹ç³»ç»Ÿäº§ç”Ÿçš„å½±å“æ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥ï¼Œå¯¹äºå¹‚ç­‰çš„æ–¹æ³•ï¼Œä¸ç”¨æ‹…å¿ƒé‡å¤æ‰§è¡Œä¼šå¯¹ç³»ç»Ÿé€ æˆä»»ä½•æ”¹å˜ã€‚ æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹ã€‚åœ¨ä¸è€ƒè™‘å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œâ€œå°† X è€å¸ˆçš„è´¦æˆ·ä½™é¢è®¾ç½®ä¸º 100 ä¸‡å…ƒâ€ï¼Œæ‰§è¡Œä¸€æ¬¡åå¯¹ç³»ç»Ÿçš„å½±å“æ˜¯ï¼ŒX è€å¸ˆçš„è´¦æˆ·ä½™é¢å˜æˆäº† 100 ä¸‡å…ƒã€‚åªè¦æä¾›çš„å‚æ•° 100 ä¸‡å…ƒä¸å˜ï¼Œé‚£å³ä½¿å†æ‰§è¡Œå¤šå°‘æ¬¡ï¼ŒX è€å¸ˆçš„è´¦æˆ·ä½™é¢å§‹ç»ˆéƒ½æ˜¯ 100 ä¸‡å…ƒï¼Œä¸ä¼šå˜åŒ–ï¼Œè¿™ä¸ªæ“ä½œå°±æ˜¯ä¸€ä¸ªå¹‚ç­‰çš„æ“ä½œã€‚ å†ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œâ€œå°† X è€å¸ˆçš„ä½™é¢åŠ  100 ä¸‡å…ƒâ€ï¼Œè¿™ä¸ªæ“ä½œå®ƒå°±ä¸æ˜¯å¹‚ç­‰çš„ï¼Œæ¯æ‰§è¡Œä¸€æ¬¡ï¼Œè´¦æˆ·ä½™é¢å°±ä¼šå¢åŠ  100 ä¸‡å…ƒï¼Œæ‰§è¡Œå¤šæ¬¡å’Œæ‰§è¡Œä¸€æ¬¡å¯¹ç³»ç»Ÿçš„å½±å“ï¼ˆä¹Ÿå°±æ˜¯è´¦æˆ·çš„ä½™é¢ï¼‰æ˜¯ä¸ä¸€æ ·çš„ã€‚ æ‰€ä»¥ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°å¦‚æœç³»ç»Ÿæ¶ˆè´¹æ¶ˆæ¯çš„ä¸šåŠ¡é€»è¾‘å…·å¤‡å¹‚ç­‰æ€§ï¼Œé‚£å°±ä¸ç”¨æ‹…å¿ƒæ¶ˆæ¯é‡å¤çš„é—®é¢˜äº†ï¼Œå› ä¸ºåŒä¸€æ¡æ¶ˆæ¯ï¼Œæ¶ˆè´¹ä¸€æ¬¡å’Œæ¶ˆè´¹å¤šæ¬¡å¯¹ç³»ç»Ÿçš„å½±å“æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ä¹Ÿå°±å¯ä»¥è®¤ä¸ºï¼Œæ¶ˆè´¹å¤šæ¬¡ç­‰äºæ¶ˆè´¹ä¸€æ¬¡ã€‚ é‚£ä¹ˆï¼Œå¦‚ä½•å®ç°å¹‚ç­‰æ“ä½œå‘¢ï¼Ÿæœ€å¥½çš„æ–¹å¼å°±æ˜¯ï¼Œä»ä¸šåŠ¡é€»è¾‘è®¾è®¡ä¸Šå…¥æ‰‹ï¼Œå°†æ¶ˆè´¹çš„ä¸šåŠ¡é€»è¾‘è®¾è®¡æˆå…·å¤‡å¹‚ç­‰æ€§çš„æ“ä½œã€‚ ä½†æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„ä¸šåŠ¡éƒ½èƒ½è®¾è®¡æˆå¤©ç„¶å¹‚ç­‰çš„ï¼Œè¿™é‡Œå°±éœ€è¦ä¸€äº›æ–¹æ³•å’ŒæŠ€å·§æ¥å®ç°å¹‚ç­‰ã€‚ ä¸‹é¢æˆ‘ä»¬ä»‹ç»ä¸€ç§å¸¸ç”¨çš„æ–¹æ³•ï¼šåˆ©ç”¨æ•°æ®åº“çš„å”¯ä¸€çº¦æŸå®ç°å¹‚ç­‰ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬åˆšåˆšæåˆ°çš„é‚£ä¸ªä¸å…·å¤‡å¹‚ç­‰ç‰¹æ€§çš„è½¬è´¦çš„ä¾‹å­ï¼šå°† X è€å¸ˆçš„è´¦æˆ·ä½™é¢åŠ  100 ä¸‡å…ƒã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹é€ ä¸šåŠ¡é€»è¾‘ï¼Œè®©å®ƒå…·å¤‡å¹‚ç­‰æ€§ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥é™å®šï¼Œå¯¹äºæ¯ä¸ªè½¬è´¦å•æ¯ä¸ªè´¦æˆ·åªå¯ä»¥æ‰§è¡Œä¸€æ¬¡å˜æ›´æ“ä½œï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªé™åˆ¶å®ç°çš„æ–¹æ³•éå¸¸å¤šï¼Œæœ€ç®€å•çš„æ˜¯æˆ‘ä»¬åœ¨æ•°æ®åº“ä¸­å»ºä¸€å¼ è½¬è´¦æµæ°´è¡¨ã€‚ è¿™ä¸ªè¡¨æœ‰ä¸‰ä¸ªå­—æ®µï¼šè½¬è´¦å• IDã€è´¦æˆ· ID å’Œå˜æ›´é‡‘é¢ï¼Œç„¶åç»™è½¬è´¦å• ID å’Œè´¦æˆ· ID è¿™ä¸¤ä¸ªå­—æ®µè”åˆèµ·æ¥åˆ›å»ºä¸€ä¸ªå”¯ä¸€çº¦æŸï¼Œè¿™æ ·å¯¹äºç›¸åŒçš„è½¬è´¦å• ID å’Œè´¦æˆ· IDï¼Œè¡¨é‡Œè‡³å¤šåªèƒ½å­˜åœ¨ä¸€æ¡è®°å½•ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬æ¶ˆè´¹æ¶ˆæ¯çš„é€»è¾‘å¯ä»¥å˜ä¸ºï¼šâ€œåœ¨è½¬è´¦æµæ°´è¡¨ä¸­å¢åŠ ä¸€æ¡è½¬è´¦è®°å½•ï¼Œç„¶åå†æ ¹æ®è½¬è´¦è®°å½•ï¼Œå¼‚æ­¥æ“ä½œæ›´æ–°ç”¨æˆ·ä½™é¢å³å¯ã€‚â€ åœ¨è½¬è´¦æµæ°´è¡¨å¢åŠ ä¸€æ¡è½¬è´¦è®°å½•è¿™ä¸ªæ“ä½œä¸­ï¼Œç”±äºæˆ‘ä»¬åœ¨è¿™ä¸ªè¡¨ä¸­é¢„å…ˆå®šä¹‰äº†â€œè´¦æˆ· ID è½¬è´¦å• IDâ€çš„å”¯ä¸€çº¦æŸï¼Œå¯¹äºåŒä¸€ä¸ªè½¬è´¦å•åŒä¸€ä¸ªè´¦æˆ·åªèƒ½æ’å…¥ä¸€æ¡è®°å½•ï¼Œåç»­é‡å¤çš„æ’å…¥æ“ä½œéƒ½ä¼šå¤±è´¥ï¼Œè¿™æ ·å°±å®ç°äº†ä¸€ä¸ªå¹‚ç­‰çš„æ“ä½œã€‚ è®¾ç½®å‰ææ¡ä»¶ ä¸ºæ›´æ–°çš„æ•°æ®è®¾ç½®å‰ç½®æ¡ä»¶å¦å¤–ä¸€ç§å®ç°å¹‚ç­‰çš„æ€è·¯æ˜¯ï¼Œç»™æ•°æ®å˜æ›´è®¾ç½®ä¸€ä¸ªå‰ç½®æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶å°±æ›´æ–°æ•°æ®ï¼Œå¦åˆ™æ‹’ç»æ›´æ–°æ•°æ®ï¼Œåœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼ŒåŒæ—¶å˜æ›´å‰ç½®æ¡ä»¶ä¸­éœ€è¦åˆ¤æ–­çš„æ•°æ®ã€‚ è¿™æ ·ï¼Œé‡å¤æ‰§è¡Œè¿™ä¸ªæ“ä½œæ—¶ï¼Œç”±äºç¬¬ä¸€æ¬¡æ›´æ–°æ•°æ®çš„æ—¶å€™å·²ç»å˜æ›´äº†å‰ç½®æ¡ä»¶ä¸­éœ€è¦åˆ¤æ–­çš„æ•°æ®ï¼Œä¸æ»¡è¶³å‰ç½®æ¡ä»¶ï¼Œåˆ™ä¸ä¼šé‡å¤æ‰§è¡Œæ›´æ–°æ•°æ®æ“ä½œã€‚ æ¯”å¦‚ï¼Œåˆšåˆšæˆ‘ä»¬è¯´è¿‡ï¼Œâ€œå°† X è€å¸ˆçš„è´¦æˆ·çš„ä½™é¢å¢åŠ  100 ä¸‡å…ƒâ€è¿™ä¸ªæ“ä½œå¹¶ä¸æ»¡è¶³å¹‚ç­‰æ€§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªæ“ä½œåŠ ä¸Šä¸€ä¸ªå‰ç½®æ¡ä»¶ï¼Œå˜ä¸ºï¼šâ€œå¦‚æœ X è€å¸ˆçš„è´¦æˆ·å½“å‰çš„ä½™é¢ä¸º 500 ä¸‡å…ƒï¼Œå°†ä½™é¢åŠ  100 ä¸‡å…ƒâ€ï¼Œè¿™ä¸ªæ“ä½œå°±å…·å¤‡äº†å¹‚ç­‰æ€§ã€‚ å¯¹åº”åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„ä½¿ç”¨æ—¶ï¼Œå¯ä»¥åœ¨å‘æ¶ˆæ¯æ—¶åœ¨æ¶ˆæ¯ä½“ä¸­å¸¦ä¸Šå½“å‰çš„ä½™é¢ï¼Œåœ¨æ¶ˆè´¹çš„æ—¶å€™è¿›è¡Œåˆ¤æ–­æ•°æ®åº“ä¸­ï¼Œå½“å‰ä½™é¢æ˜¯å¦ä¸æ¶ˆæ¯ä¸­çš„ä½™é¢ç›¸ç­‰ï¼Œåªæœ‰ç›¸ç­‰æ‰æ‰§è¡Œå˜æ›´æ“ä½œã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦æ›´æ–°çš„æ•°æ®ä¸æ˜¯æ•°å€¼ï¼Œæˆ–è€…æˆ‘ä»¬è¦åšä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„æ›´æ–°æ“ä½œæ€ä¹ˆåŠï¼Ÿç”¨ä»€ä¹ˆä½œä¸ºå‰ç½®åˆ¤æ–­æ¡ä»¶å‘¢ï¼Ÿ æ›´åŠ é€šç”¨çš„æ–¹æ³•æ˜¯ï¼Œç»™ä½ çš„æ•°æ®å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·å±æ€§ï¼Œæ¯æ¬¡æ›´æ•°æ®å‰ï¼Œæ¯”è¾ƒå½“å‰æ•°æ®çš„ç‰ˆæœ¬å·æ˜¯å¦å’Œæ¶ˆæ¯ä¸­çš„ç‰ˆæœ¬å·ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´å°±æ‹’ç»æ›´æ–°æ•°æ®ï¼Œæ›´æ–°æ•°æ®çš„åŒæ—¶å°†ç‰ˆæœ¬å· +1ï¼Œä¸€æ ·å¯ä»¥å®ç°å¹‚ç­‰ã€‚ æˆ‘ä»¬åœ¨å·¥ä½œä¸­ï¼Œä¸ºäº†ä¿è¯ç¯å¢ƒçš„é«˜å¯ç”¨ï¼Œé˜²æ­¢å•ç‚¹ï¼ŒKafka éƒ½æ˜¯ä»¥é›†ç¾¤çš„æ–¹å¼å‡ºç°çš„ï¼Œä¸‹é¢å°±å¸¦é¢†å¤§å®¶ä¸€èµ·æ­å»ºä¸€å¥— Kafka é›†ç¾¤ç¯å¢ƒã€‚ æˆ‘ä»¬åœ¨å®˜ç½‘ä¸‹è½½ Kafkaï¼Œä¸‹è½½åœ°å€ä¸ºï¼šhttp://kafka.apache.org/downloadsï¼Œä¸‹è½½æˆ‘ä»¬éœ€è¦çš„ç‰ˆæœ¬ï¼Œæ¨èä½¿ç”¨ç¨³å®šçš„ç‰ˆæœ¬ã€‚ ","date":"2020-12-17","objectID":"/mq-kafka/:9:8","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"æ­å»ºé›†ç¾¤ ä¸‹è½½å¹¶è§£å‹ï¼š cd /usr/local/src wget http://mirrors.tuna.tsinghua.edu.cn/apache/kafka/2.4.0/kafka_2.11-2.4.0.tgz mkdir /data/servers tar xzvf kafka_2.11-2.4.0.tgz -C /data/servers/ cd /data/servers/kafka_2.11-2.4.0 ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š ç¡®ä¿æ¯ä¸ªæœºå™¨ä¸Šçš„ id ä¸ä¸€æ · broker.id=0 é…ç½®æœåŠ¡ç«¯çš„ç›‘æ§åœ°å€ listeners=PLAINTEXT://192.168.51.128:9092 Kafka æ—¥å¿—ç›®å½• log.dirs=/data/servers/kafka_2.11-2.4.0/logs #Kafka è®¾ç½®çš„ partitons çš„ä¸ªæ•° num.partitions=1 ZooKeeper çš„è¿æ¥åœ°å€ï¼Œå¦‚æœæœ‰è‡ªå·±çš„ ZooKeeper é›†ç¾¤ï¼Œè¯·ç›´æ¥ä½¿ç”¨è‡ªå·±æ­å»ºçš„ ZooKeeper é›†ç¾¤ zookeeper.connect=192.168.51.128:2181 å› ä¸ºæˆ‘è‡ªå·±æ˜¯æœ¬æœºåšå®éªŒï¼Œæ‰€æœ‰ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªä¸»æœºçš„ä¸åŒç«¯å£ï¼Œåœ¨çº¿ä¸Šï¼Œå°±æ˜¯ä¸åŒçš„æœºå™¨ï¼Œå¤§å®¶å‚è€ƒå³å¯ã€‚ æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ Kafka çš„ ZooKeeperï¼Œåªå¯åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½†æ˜¯æ­£çœŸçš„ç”Ÿäº§è¿‡ç¨‹ä¸­ï¼Œæ˜¯éœ€è¦ ZooKeeper é›†ç¾¤ï¼Œè‡ªå·±æ­å»ºå°±å¥½ï¼ŒåæœŸæˆ‘ä»¬ä¹Ÿä¼šå‡º ZooKeeper çš„æ•™ç¨‹ï¼Œå¤§å®¶è¯·å…³æ³¨å°±å¥½äº†ã€‚ æ‹·è´ 3 ä»½é…ç½®æ–‡ä»¶ï¼š #åˆ›å»ºå¯¹åº”çš„æ—¥å¿—ç›®å½• mkdir -p /data/servers/kafka_2.11-2.4.0/logs/9092 mkdir -p /data/servers/kafka_2.11-2.4.0/logs/9093 mkdir -p /data/servers/kafka_2.11-2.4.0/logs/9094 #æ‹·è´ä¸‰ä»½é…ç½®æ–‡ä»¶ cp server.properties server_9092.properties cp server.properties server_9093.properties cp server.properties server_9094.properties ä¿®æ”¹ä¸åŒç«¯å£å¯¹åº”çš„æ–‡ä»¶ï¼š #9092 çš„ id ä¸º 0ï¼Œ9093 çš„ id ä¸º 1ï¼Œ9094 çš„ id ä¸º 2 broker.id=0 # é…ç½®æœåŠ¡ç«¯çš„ç›‘æ§åœ°å€ï¼Œåœ¨ä¸é€šçš„é…ç½®æ–‡ä»¶ä¸­å†™å…¥ä¸åŒçš„ç«¯å£ listeners=PLAINTEXT://192.168.51.128:9092 # Kafka æ—¥å¿—ç›®å½•ï¼Œç›®å½•ä¹Ÿæ˜¯å¯¹åº”ä¸åŒçš„ç«¯å£ log.dirs=/data/servers/kafka_2.11-2.4.0/logs/9092 # Kafka è®¾ç½®çš„ partitons çš„ä¸ªæ•° num.partitions=1 # ZooKeeper çš„è¿æ¥åœ°å€ï¼Œå¦‚æœæœ‰è‡ªå·±çš„ ZooKeeper é›†ç¾¤ï¼Œè¯·ç›´æ¥ä½¿ç”¨è‡ªå·±æ­å»ºçš„ ZooKeeper é›†ç¾¤ zookeeper.connect=192.168.51.128:2181 ä¿®æ”¹ ZooKeeper çš„é…ç½®æ–‡ä»¶ï¼š dataDir=/data/servers/zookeeper server.1=192.168.51.128:2888:3888 ç„¶ååˆ›å»º ZooKeeper çš„ myid æ–‡ä»¶ï¼š echo \"1\"\u003e /data/servers/zookeeper/myid å¯åŠ¨ ZooKeeperï¼š ä½¿ç”¨ Kafka å†…ç½®çš„ ZooKeeperï¼š cd /data/servers/kafka_2.11-2.4.0/bin zookeeper-server-start.sh -daemon ../config/zookeeper.properties netstat -anp |grep 2181 å¯åŠ¨ Kafkaï¼š ./kafka-server-start.sh -daemon ../config/server_9092.properties ./kafka-server-start.sh -daemon ../config/server_9093.properties ./kafka-server-start.sh -daemon ../config/server_9094.properties ","date":"2020-12-17","objectID":"/mq-kafka/:10:0","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"Kafka çš„æ“ä½œ ","date":"2020-12-17","objectID":"/mq-kafka/:11:0","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"topic æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹åˆ›å»º Topic å¸¸ç”¨çš„å‚æ•°å§ï¼š â€“createï¼šåˆ›å»º topic â€“deleteï¼šåˆ é™¤ topic â€“alterï¼šä¿®æ”¹ topic çš„åå­—æˆ–è€… partition ä¸ªæ•° â€“listï¼šæŸ¥çœ‹ topic â€“describeï¼šæŸ¥çœ‹ topic çš„è¯¦ç»†ä¿¡æ¯ â€“topic \u003cString: topic\u003eï¼šæŒ‡å®š topic çš„åå­— â€“zookeeper \u003cString: hosts\u003eï¼šæŒ‡å®š Zookeeper çš„è¿æ¥åœ°å€å‚æ•°æç¤ºå¹¶ä¸èµæˆè¿™æ ·ä½¿ç”¨ï¼ˆDEPRECATED, The connection string for the zookeeper connection in the form host:port. Multiple hosts can be given to allow fail-over.ï¼‰ â€“bootstrap-server \u003cString: server to connect to\u003eï¼šæŒ‡å®š Kafka çš„è¿æ¥åœ°å€ï¼Œæ¨èä½¿ç”¨è¿™ä¸ªï¼Œå‚æ•°çš„æç¤ºä¿¡æ¯æ˜¾ç¤ºï¼ˆREQUIRED: The Kafka server to connect to. In case of providing this, a direct Zookeeper connection wonâ€™t be required.ï¼‰ã€‚ â€“replication-factor \u003cInteger: replication factor\u003eï¼šå¯¹äºæ¯ä¸ª Partiton çš„å¤‡ä»½ä¸ªæ•°ã€‚ï¼ˆThe replication factor for each partition in the topic being created. If not supplied, defaults to the cluster default.ï¼‰ â€“partitions \u003cInteger: # of partitions\u003eï¼šæŒ‡å®šè¯¥ topic çš„åˆ†åŒºçš„ä¸ªæ•°ã€‚ ç¤ºä¾‹ï¼š cd /data/servers/kafka_2.11-2.4.0/bin # åˆ›å»º topic test1 kafka-topics.sh --create --bootstrap-server=192.168.51.128:9092,10.231.128.96:9093,192.168.51.128:9094 --replication-factor 1 --partitions 1 --topic test1 # åˆ›å»º topic test2 kafka-topics.sh --create --bootstrap-server=192.168.51.128:9092,10.231.128.96:9093,192.168.51.128:9094 --replication-factor 1 --partitions 1 --topic test2 # æŸ¥çœ‹ topic kafka-topics.sh --list --bootstrap-server=192.168.51.128:9092,10.231.128.96:9093,192.168.51.128:9094 è‡ªåŠ¨åˆ›å»º Topic æˆ‘ä»¬åœ¨å·¥ä½œä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä¸æƒ³å»ç®¡ç† Topicï¼Œå¯ä»¥é€šè¿‡ Kafka çš„é…ç½®æ–‡ä»¶æ¥ç®¡ç†ã€‚ æˆ‘ä»¬å¯ä»¥è®© Kafka è‡ªåŠ¨åˆ›å»º Topicï¼Œéœ€è¦åœ¨æˆ‘ä»¬çš„ Kafka é…ç½®æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®æ–‡ä»¶ï¼š auto.create.topics.enable=true å¦‚æœåˆ é™¤ Topic æƒ³è¾¾åˆ°ç‰©ç†åˆ é™¤çš„ç›®çš„ï¼Œä¹Ÿæ˜¯éœ€è¦é…ç½®çš„ï¼š delete.topic.enable=true ","date":"2020-12-17","objectID":"/mq-kafka/:11:1","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"å‘é€æ¶ˆæ¯ ä»–ä»¬å¯ä»¥é€šè¿‡å®¢æˆ·ç«¯çš„å‘½ä»¤ç”Ÿäº§æ¶ˆæ¯ï¼Œå…ˆæ¥çœ‹çœ‹ kafka-console-producer.sh å¸¸ç”¨çš„å‡ ä¸ªå‚æ•°å§ï¼š â€“topic \u003cString: topic\u003eï¼šæŒ‡å®š topic â€“timeout \u003cInteger: timeout_ms\u003eï¼šè¶…æ—¶æ—¶é—´ â€“syncï¼šå¼‚æ­¥å‘é€æ¶ˆæ¯ â€“broker-list \u003cString: broker-list\u003eï¼šå®˜ç½‘æç¤ºï¼šREQUIRED: The broker list string in the form HOST1:PORT1,HOST2:PORT2. è¿™ä¸ªå‚æ•°æ˜¯å¿…é¡»çš„ï¼š kafka-console-producer.sh --broker-list 192.168.51.128:9092,192.168.51.128:9093,192.168.51.128:9094 --topic test1 ","date":"2020-12-17","objectID":"/mq-kafka/:11:2","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"æ¶ˆè´¹æ¶ˆæ¯ æˆ‘ä»¬ä¹Ÿè¿˜æ˜¯å…ˆæ¥çœ‹çœ‹ kafka-console-consumer.sh çš„å‚æ•°å§ï¼š â€“topic \u003cString: topic\u003eï¼šæŒ‡å®š topic â€“group \u003cString: consumer group id\u003eï¼šæŒ‡å®šæ¶ˆè´¹è€…ç»„ â€“from-beginningï¼šæŒ‡å®šä»å¼€å§‹è¿›è¡Œæ¶ˆè´¹, å¦‚æœä¸æŒ‡å®š, å°±ä»å½“å‰è¿›è¡Œæ¶ˆè´¹ â€“bootstrap-serverï¼šKafka çš„è¿æ¥åœ°å€â€â€ ","date":"2020-12-17","objectID":"/mq-kafka/:11:3","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"Kafka çš„æ—¥å¿— Kafka çš„æ—¥å¿—åˆ†ä¸¤ç§ï¼š ç¬¬ä¸€ç§æ—¥å¿—æ˜¯æˆ‘ä»¬çš„ Kafka çš„å¯åŠ¨æ—¥å¿—ï¼Œå°±æ˜¯æˆ‘ä»¬æ’æŸ¥é—®é¢˜ï¼ŒæŸ¥çœ‹æŠ¥é”™ä¿¡æ¯çš„æ—¥å¿—ã€‚ ç¬¬äºŒç§æ—¥å¿—å°±æ˜¯æˆ‘ä»¬çš„æ•°æ®æ—¥å¿—ï¼ŒKafka æ˜¯æˆ‘ä»¬çš„æ•°æ®æ˜¯ä»¥æ—¥å¿—çš„å½¢å¼å­˜åœ¨å­˜ç›˜ä¸­çš„ï¼Œæˆ‘ä»¬ç¬¬äºŒç§æ‰€è¯´çš„æ—¥å¿—å°±æ˜¯æˆ‘ä»¬çš„ Partiton ä¸ Segmentã€‚ é‚£æˆ‘ä»¬å°±æ¥è¯´è¯´å¤‡ä»½å’Œåˆ†åŒºå§ï¼šæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåˆ†åŒºï¼Œä¸€ä¸ªå¤‡ä»½ï¼Œé‚£ä¹ˆ test å°±åº”è¯¥åœ¨ä¸‰å°æœºå™¨ä¸Šæˆ–è€…ä¸‰ä¸ªæ•°æ®ç›®å½•åªæœ‰ä¸€ä¸ª test-0ã€‚ï¼ˆåˆ†åŒºçš„ä¸‹æ ‡æ˜¯ä» 0 å¼€å§‹çš„ï¼‰ å¦‚æœæˆ‘ä»¬åˆ›å»º N ä¸ªåˆ†åŒºï¼Œæˆ‘ä»¬å°±ä¼šåœ¨ä¸‰ä¸ªæœåŠ¡å™¨ä¸Šå‘ç°ï¼Œtest_0-nï¼Œå¦‚æœæˆ‘ä»¬åˆ›å»º M ä¸ªå¤‡ä»½ï¼Œæˆ‘ä»¬å°±ä¼šåœ¨å‘ç°ï¼Œtest_0 åˆ° test_n æ¯ä¸€ä¸ªéƒ½æ˜¯ M ä¸ªã€‚ kafka-console-consumer.sh --bootstrap-server 192.168.51.128:9092,192.168.51.128:9093,192.168.51.128:9094 --topic test1 ---beginning ","date":"2020-12-17","objectID":"/mq-kafka/:11:4","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"Kafka API ä½¿ç”¨ Kafka åŸç”Ÿçš„ API ","date":"2020-12-17","objectID":"/mq-kafka/:12:0","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"æ¶ˆè´¹è€…è‡ªåŠ¨æäº¤ å®šä¹‰è‡ªå·±çš„ç”Ÿäº§è€…ï¼š import org.apache.kafka.clients.producer.Callback; import org.apache.kafka.clients.producer.KafkaProducer; import org.apache.kafka.clients.producer.ProducerRecord; import org.apache.kafka.clients.producer.RecordMetadata; import java.util.Properties; /** * @ClassName MyKafkaProducer * @Description TODO * @Author lingxiangxiang * @Date 3:37 PM * @Version 1.0 **/ public class MyKafkaProducer { private org.apache.kafka.clients.producer.KafkaProducer\u003cInteger, String\u003e producer; public MyKafkaProducer() { Properties properties = new Properties(); properties.put(\"bootstrap.servers\", \"192.168.51.128:9092,192.168.51.128:9093,192.168.51.128:9094\"); properties.put(\"key.serializer\", \"org.apache.kafka.common.serialization.IntegerSerializer\"); properties.put(\"value.serializer\", \"org.apache.kafka.common.serialization.StringSerializer\"); // è®¾ç½®æ‰¹é‡å‘é€ properties.put(\"batch.size\", 16384); // æ‰¹é‡å‘é€çš„ç­‰å¾…æ—¶é—´ 50ms, è¶…è¿‡ 50ms, ä¸è¶³æ‰¹é‡å¤§å°ä¹Ÿå‘é€ properties.put(\"linger.ms\", 50); this.producer = new org.apache.kafka.clients.producer.KafkaProducer\u003cInteger, String\u003e(properties); } public boolean sendMsg() { boolean result = true; try { // æ­£å¸¸å‘é€, test2 æ˜¯ topic, 0 ä»£è¡¨çš„æ˜¯åˆ†åŒº, 1 ä»£è¡¨çš„æ˜¯ key, hello world æ˜¯å‘é€çš„æ¶ˆæ¯å†…å®¹ final ProducerRecord\u003cInteger, String\u003e record = new ProducerRecord\u003cInteger, String\u003e(\"test2\", 0, 1, \"hello world\"); producer.send(record); // æœ‰å›è°ƒå‡½æ•°çš„è°ƒç”¨ producer.send(record, new Callback() { @Override public void onCompletion(RecordMetadata recordMetadata, Exception e) { System.out.println(recordMetadata.topic()); System.out.println(recordMetadata.partition()); System.out.println(recordMetadata.offset()); } }); // è‡ªå·±å®šä¹‰ä¸€ä¸ªç±» producer.send(record, new MyCallback(record)); } catch (Exception e) { result = false; } return result; } } å®šä¹‰ç”Ÿäº§è€…å‘é€æˆåŠŸçš„å›è°ƒå‡½æ•°ï¼š import org.apache.kafka.clients.producer.Callback; import org.apache.kafka.clients.producer.RecordMetadata; /** * @ClassName MyCallback * @Description TODO * @Author lingxiangxiang * @Date 3:51 PM * @Version 1.0 **/ public class MyCallback implements Callback { private Object msg; public MyCallback(Object msg) { this.msg = msg; } @Override public void onCompletion(RecordMetadata metadata, Exception e) { System.out.println(\"topic = \" + metadata.topic()); System.out.println(\"partiton = \" + metadata.partition()); System.out.println(\"offset = \" + metadata.offset()); System.out.println(msg); } } ç”Ÿäº§è€…æµ‹è¯•ç±»ï¼šåœ¨ç”Ÿäº§è€…æµ‹è¯•ç±»ä¸­ï¼Œè‡ªå·±é‡åˆ°ä¸€ä¸ªå‘ï¼Œå°±æ˜¯æœ€åè‡ªå·±æ²¡æœ‰åŠ  sleepï¼Œå°±æ˜¯æ€ä¹ˆæ£€æŸ¥è‡ªå·±çš„ä»£ç éƒ½æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯æœ€åå°±æ˜¯æ²¡æ³•å‘é€æˆåŠŸæ¶ˆæ¯ï¼Œæœ€ååŠ äº†ä¸€ä¸ª sleep å°±å¯ä»¥äº†ã€‚ å› ä¸ºä¸»å‡½æ•° main å·²ç»æ‰§è¡Œå®Œé€€å‡ºï¼Œä½†æ˜¯æ¶ˆæ¯å¹¶æ²¡æœ‰å‘é€å®Œæˆï¼Œéœ€è¦è¿›è¡Œç­‰å¾…ä¸€ä¸‹ã€‚å½“ç„¶ï¼Œä½ åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯èƒ½ä¸ä¼šé‡åˆ°è¿™æ ·é—®é¢˜ï¼Œå‘µå‘µï¼ ä»£ç å¦‚ä¸‹ï¼š import static java.lang.Thread.sleep; /** * @ClassName MyKafkaProducerTest * @Description TODO * @Author lingxiangxiang * @Date 3:46 PM * @Version 1.0 **/ public class MyKafkaProducerTest { public static void main(String[] args) throws InterruptedException { MyKafkaProducer producer = new MyKafkaProducer(); boolean result = producer.sendMsg(); System.out.println(\"send msg \" + result); sleep(1000); } } æ¶ˆè´¹è€…ç±»ï¼š import kafka.utils.ShutdownableThread; import org.apache.kafka.clients.consumer.ConsumerRecord; import org.apache.kafka.clients.consumer.ConsumerRecords; import org.apache.kafka.clients.consumer.KafkaConsumer; import java.util.Arrays; import java.util.Collections; import java.util.Properties; /** * @ClassName MyKafkaConsumer * @Description TODO * @Author lingxiangxiang * @Date 4:12 PM * @Version 1.0 **/ public class MyKafkaConsumer extends ShutdownableThread { private KafkaConsumer\u003cInteger, String\u003e consumer; public MyKafkaConsumer() { super(\"KafkaConsumerTest\", false); Properties properties = new Properties(); properties.put(\"bootstrap.servers\", \"192.168.51.128:9092,192.168.51.128:9093,192.168.51.128:9094\"); properties.put(\"group.id\", \"mygroup\"); properties.put(\"enable.auto.commit\", \"true\"); properties.put(\"auto.commit.interval.ms\", \"1000\"); properties.put(\"session.timeout.ms\", \"30000\"); properties.put(\"heartbeat.interval.ms\", \"10000\"); properties.put(\"auto.offset.reset\", \"earliest\"); properties.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.IntegerDeseriali","date":"2020-12-17","objectID":"/mq-kafka/:12:1","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"æ¶ˆè´¹è€…åŒæ­¥æ‰‹åŠ¨æäº¤ å‰é¢çš„æ¶ˆè´¹è€…éƒ½æ˜¯ä»¥è‡ªåŠ¨æäº¤ Offset çš„æ–¹å¼å¯¹ Broker ä¸­çš„æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹çš„ï¼Œä½†è‡ªåŠ¨æäº¤ å¯èƒ½ä¼šå‡ºç°æ¶ˆæ¯é‡å¤æ¶ˆè´¹çš„æƒ…å†µã€‚ æ‰€ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œå¾ˆå¤šæ—¶å€™éœ€è¦å¯¹ Offset è¿›è¡Œæ‰‹åŠ¨æäº¤ï¼Œ ä»¥è§£å†³é‡å¤æ¶ˆè´¹çš„é—®é¢˜ã€‚ æ‰‹åŠ¨æäº¤åˆå¯ä»¥åˆ’åˆ†ä¸ºåŒæ­¥æäº¤ã€å¼‚æ­¥æäº¤ï¼ŒåŒå¼‚æ­¥è”åˆæäº¤ã€‚è¿™äº›æäº¤æ–¹å¼ä»…ä»…æ˜¯ doWork() æ–¹æ³•ä¸ç›¸åŒï¼Œå…¶æ„é€ å™¨æ˜¯ç›¸åŒçš„ã€‚ æ‰€ä»¥ä¸‹é¢é¦–å…ˆåœ¨å‰é¢æ¶ˆè´¹è€…ç±»çš„åŸºç¡€ä¸Šè¿›è¡Œæ„é€ å™¨çš„ä¿®æ”¹ï¼Œç„¶åå†åˆ†åˆ«å®ç°ä¸‰ç§ä¸åŒçš„æäº¤æ–¹å¼ã€‚ åŒæ­¥æäº¤æ–¹å¼æ˜¯ï¼Œæ¶ˆè´¹è€…å‘ Broker æäº¤ Offset åç­‰å¾… Broker æˆåŠŸå“åº”ã€‚è‹¥æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œåˆ™ä¼šé‡æ–°æäº¤ï¼Œç›´åˆ°è·å–åˆ°å“åº”ã€‚ è€Œåœ¨è¿™ä¸ªç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œæ¶ˆè´¹è€…æ˜¯é˜»å¡çš„ã€‚å…¶ä¸¥é‡å½±å“äº†æ¶ˆè´¹è€…çš„ååé‡ã€‚ ä¿®æ”¹å‰é¢çš„ MyKafkaConsumer.java, ä¸»è¦ä¿®æ”¹ä¸‹é¢çš„é…ç½®ï¼š import kafka.utils.ShutdownableThread; import org.apache.kafka.clients.consumer.ConsumerRecord; import org.apache.kafka.clients.consumer.ConsumerRecords; import org.apache.kafka.clients.consumer.KafkaConsumer; import java.util.Arrays; import java.util.Collections; import java.util.Properties; /** * @ClassName MyKafkaConsumer * @Description TODO * @Author lingxiangxiang * @Date 4:12 PM * @Version 1.0 **/ public class MyKafkaConsumer extends ShutdownableThread { private KafkaConsumer\u003cInteger, String\u003e consumer; public MyKafkaConsumer() { super(\"KafkaConsumerTest\", false); Properties properties = new Properties(); properties.put(\"bootstrap.servers\", \"192.168.51.128:9092,192.168.51.128:9093,192.168.51.128:9094\"); properties.put(\"group.id\", \"mygroup\"); // è¿™é‡Œè¦ä¿®æ”¹æˆæ‰‹åŠ¨æäº¤ properties.put(\"enable.auto.commit\", \"false\"); // properties.put(\"auto.commit.interval.ms\", \"1000\"); properties.put(\"session.timeout.ms\", \"30000\"); properties.put(\"heartbeat.interval.ms\", \"10000\"); properties.put(\"auto.offset.reset\", \"earliest\"); properties.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.IntegerDeserializer\"); properties.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); this.consumer = new KafkaConsumer\u003cInteger, String\u003e(properties); } @Override public void doWork() { consumer.subscribe(Arrays.asList(\"test2\")); ConsumerRecords\u003cInteger, String\u003erecords = consumer.poll(1000); for (ConsumerRecord record : records) { System.out.println(\"topic = \" + record.topic()); System.out.println(\"partition = \" + record.partition()); System.out.println(\"key = \" + record.key()); System.out.println(\"value = \" + record.value()); //æ‰‹åŠ¨åŒæ­¥æäº¤ consumer.commitSync(); } } } ","date":"2020-12-17","objectID":"/mq-kafka/:12:2","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"æ¶ˆè´¹è€…å¼‚æ­¥æ‰‹å·¥æäº¤ æ‰‹åŠ¨åŒæ­¥æäº¤æ–¹å¼éœ€è¦ç­‰å¾… Broker çš„æˆåŠŸå“åº”ï¼Œæ•ˆç‡å¤ªä½ï¼Œå½±å“æ¶ˆè´¹è€…çš„ååé‡ã€‚ å¼‚æ­¥æäº¤æ–¹å¼æ˜¯ï¼Œæ¶ˆè´¹è€…å‘ Broker æäº¤ Offset åä¸ç”¨ç­‰å¾…æˆåŠŸå“åº”ï¼Œæ‰€ä»¥å…¶å¢åŠ äº†æ¶ˆè´¹è€…çš„ååé‡ã€‚ import kafka.utils.ShutdownableThread; import org.apache.kafka.clients.consumer.ConsumerRecord; import org.apache.kafka.clients.consumer.ConsumerRecords; import org.apache.kafka.clients.consumer.KafkaConsumer; import java.util.Arrays; import java.util.Collections; import java.util.Properties; /** * @ClassName MyKafkaConsumer * @Description TODO * @Author lingxiangxiang * @Date 4:12 PM * @Version 1.0 **/ public class MyKafkaConsumer extends ShutdownableThread { private KafkaConsumer\u003cInteger, String\u003e consumer; public MyKafkaConsumer() { super(\"KafkaConsumerTest\", false); Properties properties = new Properties(); properties.put(\"bootstrap.servers\", \"192.168.51.128:9092,192.168.51.128:9093,192.168.51.128:9094\"); properties.put(\"group.id\", \"mygroup\"); // è¿™é‡Œè¦ä¿®æ”¹æˆæ‰‹åŠ¨æäº¤ properties.put(\"enable.auto.commit\", \"false\"); // properties.put(\"auto.commit.interval.ms\", \"1000\"); properties.put(\"session.timeout.ms\", \"30000\"); properties.put(\"heartbeat.interval.ms\", \"10000\"); properties.put(\"auto.offset.reset\", \"earliest\"); properties.put(\"key.deserializer\", \"org.apache.kafka.common.serialization.IntegerDeserializer\"); properties.put(\"value.deserializer\", \"org.apache.kafka.common.serialization.StringDeserializer\"); this.consumer = new KafkaConsumer\u003cInteger, String\u003e(properties); } @Override public void doWork() { consumer.subscribe(Arrays.asList(\"test2\")); ConsumerRecords\u003cInteger, String\u003erecords = consumer.poll(1000); for (ConsumerRecord record : records) { System.out.println(\"topic = \" + record.topic()); System.out.println(\"partition = \" + record.partition()); System.out.println(\"key = \" + record.key()); System.out.println(\"value = \" + record.value()); //æ‰‹åŠ¨åŒæ­¥æäº¤ // consumer.commitSync(); //æ‰‹åŠ¨å¼‚æ­¥æäº¤ // consumer.commitAsync(); // å¸¦å›è°ƒå…¬å…±çš„æ‰‹åŠ¨å¼‚æ­¥æäº¤ consumer.commitAsync((offsets, e) -\u003e { if(e != null) { System.out.println(\"æäº¤æ¬¡æ•°, offsets = \" + offsets); System.out.println(\"exception = \" + e); } }); } } } ","date":"2020-12-17","objectID":"/mq-kafka/:12:3","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"Spring Boot ä½¿ç”¨ Kafka ç°åœ¨å¤§å®¶çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¾ˆå¤šéƒ½ç”¨çš„æ˜¯ Spring Boot çš„é¡¹ç›®ï¼Œç›´æ¥å¯åŠ¨äº†ï¼Œå¦‚æœè¿˜æ˜¯ç”¨åŸç”Ÿçš„ APIï¼Œå°±æ˜¯æœ‰ç‚¹ Low äº†å•Šï¼Œé‚£ Kafka æ˜¯å¦‚ä½•å’Œ Spring Boot è¿›è¡Œè”åˆçš„å‘¢ï¼Ÿ Maven é…ç½®ï¼š \u003c!-- https://mvnrepository.com/artifact/org.apache.kafka/kafka-clients --\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.kafka\u003c/groupId\u003e \u003cartifactId\u003ekafka-clients\u003c/artifactId\u003e \u003cversion\u003e2.1.1\u003c/version\u003e \u003c/dependency\u003e æ·»åŠ é…ç½®æ–‡ä»¶ï¼Œåœ¨ application.properties ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ä¿¡æ¯ï¼š Kafka è¿æ¥åœ°å€ï¼š spring.kafka.bootstrap-servers = 192.168.51.128:9092,10.231.128.96:9093,192.168.51.128:9094 ç”Ÿäº§è€…ï¼š spring.kafka.producer.acks = 0 spring.kafka.producer.key-serializer = org.apache.kafka.common.serialization.StringSerializer spring.kafka.producer.value-serializer = org.apache.kafka.common.serialization.StringSerializer spring.kafka.producer.retries = 3 spring.kafka.producer.batch-size = 4096 spring.kafka.producer.buffer-memory = 33554432 spring.kafka.producer.compression-type = gzip æ¶ˆè´¹è€…ï¼š spring.kafka.consumer.group-id = mygroup spring.kafka.consumer.auto-commit-interval = 5000 spring.kafka.consumer.heartbeat-interval = 3000 spring.kafka.consumer.key-deserializer = org.apache.kafka.common.serialization.StringDeserializer spring.kafka.consumer.value-deserializer = org.apache.kafka.common.serialization.StringDeserializer spring.kafka.consumer.auto-offset-reset = earliest spring.kafka.consumer.enable-auto-commit = true # listenner, æ ‡è¯†æ¶ˆè´¹è€…ç›‘å¬çš„ä¸ªæ•° spring.kafka.listener.concurrency = 8 # topicçš„åå­— kafka.topic1 = topic1 ç”Ÿäº§è€…ï¼š import lombok.extern.slf4j.Slf4j; import org.springframework.beans.factory.annotation.Value; import org.springframework.kafka.core.KafkaTemplate; @Service @Slf4j public class MyKafkaProducerServiceImpl implements MyKafkaProducerService { @Resource private KafkaTemplate\u003cString, String\u003e kafkaTemplate; // è¯»å–é…ç½®æ–‡ä»¶ @Value(\"${kafka.topic1}\") private String topic; @Override public void sendKafka() { kafkaTemplate.send(topic, \"hell world\"); } } æ¶ˆè´¹è€…ï¼š @Component @Slf4j public class MyKafkaConsumer { @KafkaListener(topics = \"${kafka.topic1}\") public void listen(ConsumerRecord\u003c?, ?\u003e record) { Optional\u003c?\u003e kafkaMessage = Optional.ofNullable(record.value()); if (kafkaMessage.isPresent()) { log.info(\"----------------- record =\" + record); log.info(\"------------------ message =\" + kafkaMessage.get()); } ","date":"2020-12-17","objectID":"/mq-kafka/:12:4","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"å‚è€ƒ æœ¬æ–‡ç³»è½¬è½½ https://mp.weixin.qq.com/s/R1en4V0Tlwlpt102BjotoA ","date":"2020-12-17","objectID":"/mq-kafka/:13:0","tags":["kafka","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹kafka","uri":"/mq-kafka/"},{"categories":null,"content":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹rabbitmq","date":"2020-12-16","objectID":"/mq-rabbitmq/","tags":["rabbitmq","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹rabbitmq","uri":"/mq-rabbitmq/"},{"categories":null,"content":"å¯¼è¯» è°ˆèµ·æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ‘ä»¬çš„è„‘æµ·å¯èƒ½ä¼šä¸ç”±è‡ªä¸»çš„å†’å‡ºè¿™ä¹ˆå‡ ä¸ªå…³é”®è¯ï¼Œè§£è€¦ã€å¼‚æ­¥åŒ–ã€æ¶ˆå³°ã€å¹¿æ’­ç­‰ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„ç§ç±»ä¹Ÿå¾ˆå¤šï¼Œå¦‚ rabbitmqã€rocketmqã€activemqã€kafkaç­‰è¿˜æœ‰å„ä¸ªäº‘å‚å•†æä¾›çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ å®ƒä»¬éƒ½æœ‰å„ç§çš„ç‰¹ç‚¹å’Œä½¿ç”¨åœºæ™¯ï¼Œæ‰€ä»¥è¿™ä¸ªç³»åˆ—çš„æ–‡ç« ä¸»è¦è°ˆå„ä¸ªæ¶ˆæ¯çš„åŸç†ï¼Œç›®å‰è§„åˆ’äº†ä¸¤ç¯‡æ–‡ç« ï¼Œrabbitmq å’Œ kafka ï¼Œå…¶ä»–çš„æš‚æ—¶è¿˜æ²¡æœ‰ç”¨åˆ°ï¼Œè¿˜æ²¡æœ‰æ·±ç©¶ã€‚ è¿™ç¯‡ä¸»è¦ä»‹ç» rabbitmq çš„åŸç†å’ŒåŸºäº golang å¦‚ä½•ä½¿ç”¨ã€‚ ","date":"2020-12-16","objectID":"/mq-rabbitmq/:1:0","tags":["rabbitmq","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹rabbitmq","uri":"/mq-rabbitmq/"},{"categories":null,"content":"ä»‹ç» RabbitMQ æ˜¯ä¸€ä¸ªç”± Erlang å¼€å‘çš„ AMQP(Advanced Message Queuing Protocolï¼Œé«˜çº§æ¶ˆæ¯é˜Ÿåˆ—åè®®)çš„å¼€æºå®ç°ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å­˜å‚¨è½¬å‘æ¶ˆæ¯ï¼Œåœ¨æ˜“ç”¨æ€§ã€æ‰©å±•æ€§ã€é«˜å¯ç”¨æ€§ç­‰æ–¹é¢è¡¨ç°ä¸ä¿—ã€‚æ”¯æŒå¤šç§å®¢æˆ·ç«¯è¯­è¨€ã€‚ ","date":"2020-12-16","objectID":"/mq-rabbitmq/:2:0","tags":["rabbitmq","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹rabbitmq","uri":"/mq-rabbitmq/"},{"categories":null,"content":"æ¶æ„ æ•´ä½“æ¶æ„å¯¹ç…§ä¸‹é¢çš„å›¾è¯´æ˜ å…ˆçœ‹çœ‹å›¾ç‰‡ä¸Šå„ä¸ªåæ¬¡çš„è§£é‡Š: Broker:å®ƒæä¾›ä¸€ç§ä¼ è¾“æœåŠ¡ï¼Œå®ƒçš„è§’è‰²å°±æ˜¯ç»´æŠ¤ä¸€æ¡ä»ç”Ÿäº§è€…åˆ°æ¶ˆè´¹è€…çš„è·¯çº¿ï¼Œä¿è¯æ•°æ®èƒ½æŒ‰ç…§æŒ‡å®šçš„æ–¹å¼è¿›è¡Œä¼ è¾“ï¼Œç®€å•æ¥è¯´å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨å®ä½“ã€‚ Connection: å®¢æˆ·ç«¯ä¸ Rabbitmq Broker ç›´æ¥çš„ TCP è¿æ¥ï¼Œé€šå¸¸ä¸€ä¸ªå®¢æˆ·ç«¯ä¸ Broker ä¹‹é—´åªéœ€è¦ä¸€ä¸ªè¿æ¥å³å¯ã€‚ Channel: æ¶ˆæ¯é€šé“ï¼Œåœ¨å®¢æˆ·ç«¯çš„æ¯ä¸ªè¿æ¥é‡Œï¼Œå¯å»ºç«‹å¤šä¸ªchannelï¼Œæœ€å¥½æ¯ä¸ªçº¿ç¨‹éƒ½ç”¨ç‹¬ç«‹çš„Channelï¼Œåç»­çš„å¯¹ Queue å’Œ Exchange çš„æ“ä½œéƒ½æ˜¯åœ¨ Channel ä¸­å®Œæˆçš„ã€‚ Producer: æ¶ˆæ¯ç”Ÿäº§è€…ï¼Œé€šè¿‡å’Œ Broker å»ºç«‹ Connection å’Œ Channel ï¼Œå‘ Exchange å‘é€æ¶ˆæ¯ã€‚ Consumer: æ¶ˆæ¯æ¶ˆè´¹è€…ï¼Œé€šè¿‡å’Œ Broker å»ºç«‹ Connection å’Œ Channelï¼Œä» Queue ä¸­æ¶ˆè´¹æ¶ˆæ¯ã€‚ Exchange: æ¶ˆæ¯äº¤æ¢æœºï¼ŒæŒ‰ç…§ä¸€å®šçš„ç­–ç•¥æŠŠ Producer ç”Ÿäº§çš„æ¶ˆæ¯æŠ•é€’åˆ° Queue ä¸­ï¼Œç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚ Queue: æ¶ˆæ¯é˜Ÿåˆ—è½½ä½“ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½ä¼šè¢«æŠ•å…¥åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªé˜Ÿåˆ—ã€‚ Vhost: è™šæ‹Ÿä¸»æœºï¼Œä¸€ä¸ªbrokeré‡Œå¯ä»¥å¼€è®¾å¤šä¸ªvhostï¼Œç”¨ä½œæƒé™åˆ†ç¦»ï¼ŒæŠŠä¸åŒçš„ç³»ç»Ÿä½¿ç”¨çš„rabbitmqåŒºåˆ†å¼€ï¼Œå…±ç”¨ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨ï¼Œä½†çœ‹ä¸Šå»å°±åƒå„è‡ªåœ¨ç”¨ä¸ç”¨çš„rabbitmqæœåŠ¡å™¨ä¸€æ ·ã€‚ Bindingï¼šç»‘å®šï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯æŠŠexchangeå’ŒqueueæŒ‰ç…§è·¯ç”±è§„åˆ™ç»‘å®šèµ·æ¥ï¼Œè¿™æ ·RabbitMQå°±çŸ¥é“å¦‚ä½•æ­£ç¡®åœ°å°†æ¶ˆæ¯è·¯ç”±åˆ°æŒ‡å®šçš„Queueäº†ã€‚ RoutingKeyï¼šè·¯ç”±å…³é”®å­—ï¼Œç”Ÿäº§è€…åœ¨å°†æ¶ˆæ¯å‘é€ç»™Exchangeçš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šæŒ‡å®šä¸€ä¸ªrouting keyï¼Œæ¥æŒ‡å®šè¿™ä¸ªæ¶ˆæ¯çš„è·¯ç”±è§„åˆ™ï¼Œè€Œè¿™ä¸ªrouting keyéœ€è¦ä¸Exchange TypeåŠbinding keyè”åˆä½¿ç”¨æ‰èƒ½æœ€ç»ˆç”Ÿæ•ˆã€‚ è¿™é‡Œé¢æ¯”è¾ƒéš¾ç†è§£çš„æ¦‚å¿µæ˜¯ RoutingKey,Exchange,Binding ï¼Œæ¶ˆè´¹å‘é€æ—¶ä¸ä¼šç›´æ¥å‘é€ç»™ Queue ,è€Œæ˜¯å…ˆå‘é€ç»™ Exchangeï¼Œç”± Exchange æŒ‰ç…§ä¸€å®šçš„è§„åˆ™æŠ•é€’åˆ°ä¸å®ƒç»‘å®šçš„ Queue ä¸­ï¼Œé‚£è¿™ä¸ªè§„åˆ™æ˜¯ä»€ä¹ˆå‘¢? è§„åˆ™å°±ä¸ Exchange çš„ Typeã€Bindingã€RoutingKey ç›¸å…³ï¼ŒExchange æ”¯æŒçš„ç±»å‹æœ‰ 4 ç§ï¼Œdirect,fanout,topic,headers,å«ä¹‰å¦‚ä¸‹: direct: Queue å’Œ Exchange åœ¨ç»‘å®šæ—¶éœ€è¦æŒ‡å®šä¸€ä¸ª key, æˆ‘ä»¬ç§°ä¸º Bindkeyã€‚Producer å¾€ Exchange å‘é€æ¶ˆæ¯æ—¶ï¼Œä¹Ÿéœ€è¦æŒ‡å®šä¸€ä¸ª key ï¼Œè¿™ä¸ª key å°±æ˜¯ Routekeyã€‚è¿™ç§æ¨¡å¼ä¸‹ Exchange ä¼šæŠŠæ¶ˆæ¯æŠ•é€’ç»™ Routekey å’Œ Bindkey ç›¸åŒçš„é˜Ÿåˆ— fanout: ç±»ä¼¼äºå¹¿æ’­çš„æ–¹å¼ï¼Œä¼šæŠŠæ¶ˆæ¯æŠ•é€’ç»™å’Œ Exchange ç»‘å®šçš„æ‰€æœ‰é˜Ÿåˆ—ï¼Œä¸éœ€è¦æ£€æŸ¥ Routekey å’Œ Bindkey ã€‚ topic: ç±»ä¼¼äºç»„æ’­çš„æ–¹å¼ï¼Œè¿™ç§æ¨¡å¼ä¸‹ Bingkey æ”¯æŒæ¨¡ç³ŠåŒ¹é…ï¼Œ* ä»£è¡¨åŒ¹é…ä¸€ä¸ªä»»æ„è¯ç»„ï¼Œ#ä»£è¡¨åŒ¹é…0ä¸ªæˆ–å¤šä¸ªè¯ç»„ã€‚å¦‚ Producer äº§ç”Ÿä¸€æ¡ RouteKey ä¸º benz.car çš„æ¶ˆæ¯ï¼Œ åŒæ—¶è¿™ä¸ª Exchange ç»‘å®šäº†3ç»„é˜Ÿåˆ—ï¼ˆè¯·æ³¨æ„æ˜¯3ç»„ä¸æ˜¯3ä¸ªï¼Œæ„æ€æ˜¯Exchangeå¯ä»¥å’ŒåŒä¸€ä¸ªQueueè¿›è¡Œå¤šæ¬¡ç»‘å®šï¼Œé€šè¿‡Bindkey çš„ä¸åŒï¼Œå®ƒä»¬ä¹‹é—´æ˜¯å¤šå¯¹å¤šçš„å…³ç³»ï¼‰ï¼ŒBindkey åˆ†åˆ«ä¸º: car ,*.car ,benz.car ,é‚£ä¹ˆä¼šæŠŠè¿™ä¸ªæ¶ˆæ¯æŠ•é€’åˆ° *.carã€benz.car å¯¹åº”çš„ Queue ä¸­ã€‚ headers: è¿™ä¸ªç±»å‹ Routekey å’Œ Bindkey çš„åŒ¹é…è§„åˆ™æ¥è·¯ç”±æ¶ˆæ¯ï¼Œè€Œæ˜¯æ ¹æ®å‘é€çš„æ¶ˆæ¯å†…å®¹ä¸­çš„ headers å±æ€§è¿›è¡ŒåŒ¹é…ã€‚ å¯¹ç…§ä¸Šé¢å›¾å’Œåæ¬¡è§£é‡Šåº”è¯¥æ¯”è¾ƒæ¸…æ™°æ˜äº†äº†ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­è¯´æ˜å¦‚ä½•ä½¿ç”¨ã€‚ ","date":"2020-12-16","objectID":"/mq-rabbitmq/:3:0","tags":["rabbitmq","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹rabbitmq","uri":"/mq-rabbitmq/"},{"categories":null,"content":"ç”¨æ³•ï¼ˆgolangï¼‰ ","date":"2020-12-16","objectID":"/mq-rabbitmq/:4:0","tags":["rabbitmq","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹rabbitmq","uri":"/mq-rabbitmq/"},{"categories":null,"content":"direct å…ˆçœ‹çœ‹ Rabbitmq é»˜è®¤çš„ exchange ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ª(AMQP default) æ˜¯é»˜è®¤çš„ï¼Œé»˜è®¤ç»‘å®šäº†æ‰€æœ‰çš„ Queue ï¼Œä¼šæŠŠæ¶ˆæ¯æŠ•é€’åˆ° Routekey å¯¹åº”çš„é˜Ÿåˆ—ä¸­ï¼Œå³ï¼š Routekey==QueueName ã€‚ package main import ( \"fmt\" \"github.com/streadway/amqp\" \"log\" ) func handlerError(err error, msg string) { if err != nil { log.Fatalf(\"%s: %s\", msg, err) } } var url = \"amqp://username:password@ip:port\" func main() { conn, err := amqp.Dial(url) handlerError(err, \"Failed to connect to RabbitMQ\") defer conn.Close() channel, err := conn.Channel() handlerError(err, \"Failed to open a Channel\") defer channel.Close() queueNameCar := \"car\" if _, err := channel.QueueDeclare(queueNameCar, false, false, false, false, nil); err != nil { handlerError(err, \"Failed to decare Queue\") } if err := channel.Publish(\"\", queueNameCar, false, false, amqp.Publishing{ContentType: \"text/plain\", Body: []byte(\"test car\")}); err != nil { handlerError(err, \"Failed to publish message\") } } è¿™é‡Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„ Demoï¼Œ åé¢åªä¼šæä¾›main() å‡½æ•°çš„ç¤ºä¾‹ä»£ç ï¼Œå…¶ä»–çš„å’Œè¿™é‡Œè¿™é‡Œç±»ä¼¼ã€‚ ç”³æ˜äº†ä¸€ä¸ªåç§°ä¸º car çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶æ²¡æœ‰åšä»»ä½•çš„ç»‘å®šï¼Œå¾€ defalut exchange å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œroutekey ä¸º car ,å¯ä»¥çœ‹åˆ°å’Œé˜Ÿåˆ—åç›¸åŒã€‚ ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œç»“æœä»¥å›¾ç‰‡çš„æ–¹å¼å±•ç°ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ car çš„é˜Ÿåˆ—ï¼Œå¹¶ä¸”æœ‰ä¸€æ¡æ¶ˆæ¯ã€‚ åœ¨åˆ›å»ºé˜Ÿåˆ—æœ‰å‡ ä¸ªå‚æ•°å¯ä»¥å…³æ³¨ä¸€ä¸‹ Durabilityï¼š æŒä¹…åŒ–ï¼Œæ˜¯å¦å°†é˜Ÿåˆ—æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå½“é€‰æ‹©æŒä¹…åŒ–æ—¶å½“ rabbitmq é‡å¯äº†ï¼Œè¿™ä¸ªé˜Ÿåˆ—è¿˜åœ¨ï¼Œå¦åˆ™å½“é‡å¯äº†ä¹‹åè¿™ä¸ªé˜Ÿåˆ—å°±æ²¡æœ‰äº†ï¼Œéœ€è¦é‡æ–°åˆ›å»ºï¼Œè¿™ä¸ªéœ€è¦è®¾è®¡ç¨‹åºæ—¶è€ƒè™‘åˆ°ã€‚ Auto delete: å½“å…¶ä¸­ä¸€ä¸ªæ¶ˆè´¹è€…å·²ç»å®Œæˆä¹‹åï¼Œä¼šåˆ é™¤è¿™ä¸ªé˜Ÿåˆ—å¹¶æ–­å¼€ä¸å…¶ä»–çš„æ¶ˆè´¹è€…çš„è¿æ¥ã€‚ Argumentsï¼š x-message-ttl: æ¶ˆæ¯çš„è¿‡æœŸæ—¶é—´ï¼Œå‘å¸ƒåˆ°é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯åœ¨è¢«ä¸¢å¼ƒä¹‹å‰å¯ä»¥å­˜æ´»å¤šä¹…ã€‚ x-expires: é˜Ÿåˆ—çš„è¿‡æœŸæ—¶é—´ï¼Œä¸€ä¸ªé˜Ÿåˆ—åœ¨å¤šé•¿æ—¶é—´å†…æœªä½¿ç”¨ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚ x-max-length: é˜Ÿåˆ—çš„é•¿åº¦ï¼Œæœ€å¤šå‰‹å®¹çº³å¤šå°‘æ¡æ¶ˆæ¯ã€‚ x-max-length-bytes: é˜Ÿåˆ—æœ€å¤§å¯ä»¥åŒ…å«å¤šå¤§çš„æ¶ˆæ¯ã€‚ x-dead-letter-exchange: å½“æ¶ˆæ¯è¿‡æœŸæˆ–è€…è¢«å®¢æˆ·ç«¯reject ä¹‹ååº”è¯¥é‡æ–°æŠ•é€’åˆ°é‚£ä¸ªexchange ï¼Œç±»ä¼¼ä¸ä¸€ä¸ªproducerå‘é€æ¶ˆæ¯æ—¶é€‰æ‹©exchange x-dead-letter-routing-key: å½“æ¶ˆæ¯è¿‡æœŸæˆ–è€…è¢«å®¢æˆ·ç«¯reject ä¹‹åé‡æ–°æŠ•é€’æ—¶çš„ Routekeyï¼Œç±»ä¼¼ä¸ä¸€ä¸ªproducerå‘é€æ¶ˆæ¯æ—¶è®¾ç½®routekeyï¼Œé»˜è®¤æ˜¯åŸæ¶ˆæ¯çš„ routekey x-max-priority: æ¶ˆæ¯çš„ä¼˜å…ˆçº§è®¾ç½®ï¼Œè®¾ç½®å¯ä»¥æ”¯æŒçš„æœ€å¤§ä¼˜å…ˆçº§ï¼Œå¦‚è®¾ç½®ä¸º10,åˆ™å¯ä»¥åœ¨å‘é€æ¶ˆæ¯è®¾ç½®ä¼˜å…ˆçº§ï¼Œå¯ä»¥æ ¹æ®ä¼˜å…ˆçº§å¤„ç†æ¶ˆæ¯ï¼Œé»˜è®¤ä¸ºç©ºï¼Œå½“ä¸ºç©ºæ—¶åˆ™ä¸æ”¯æŒä¼˜å…ˆçº§ x-queue-mode: å°†é˜Ÿåˆ—è®¾ç½®ä¸ºæ‡’æƒ°æ¨¡å¼ï¼Œå°½å¯èƒ½å¤šåœ°å°†æ¶ˆæ¯ä¿ç•™åœ¨ç£ç›˜ä¸Šï¼Œä»¥å‡å°‘RAMçš„ä½¿ç”¨é‡ï¼›å¦‚æœä¸è®¾ç½®ï¼Œé˜Ÿåˆ—å°†ä¿ç•™å†…å­˜ä¸­çš„ç¼“å­˜ï¼Œä»¥å°½å¯èƒ½å¿«åœ°ä¼ é€’æ¶ˆæ¯ã€‚ æˆ‘ä»¬è‡ªå·±åˆ›å»ºä¸€ä¸ª direct ç±»å‹çš„ exchange å¹¶ç»‘å®šä¸€äº›é˜Ÿåˆ—çœ‹çœ‹æ˜¯ä»€ä¹ˆæ•ˆæœã€‚ func main() { conn, err := amqp.Dial(url) handlerError(err, \"Failed to connect to RabbitMQ\") defer conn.Close() channel, err := conn.Channel() handlerError(err, \"Failed to open a Channel\") defer channel.Close() directExchangeNameCar := \"direct.car\" if err := channel.ExchangeDeclare(directExchangeNameCar, \"direct\", true, false, false, false, nil); err != nil { handlerError(err, \"Failed to decalare exchange\") } queueNameCar := \"car\" queueNameBigCar := \"big-car\" queueNameMiddleCar := \"middle-car\" queueNameSmallCar := \"small-car\" channel.QueueDeclare(queueNameCar, false, false, false, false, nil) channel.QueueDeclare(queueNameBigCar, false, false, false, false, nil) channel.QueueDeclare(queueNameMiddleCar, false, false, false, false, nil) channel.QueueDeclare(queueNameSmallCar, false, false, false, false, nil) if err := channel.QueueBind(queueNameCar, \"car\", directExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameBigCar, \"car\", directExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameBigCar, \"big.car\", directExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameMiddleCar, \"car\", directExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameMiddleCar, \"middler.car\", directExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameSmallCar, \"car\", directExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameSmallCar, \"small.car\", directExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.Publish(directExchangeNameCar, \"car\", false, false, amqp.Publishing{ContentType: \"text/plain\", Body: []byte(\"test car\")}); err != nil { handlerError(err, \"Failed to publish message\") } } ä»£ç ä¸­ç”³æ˜äº† 1 ä¸€ä¸ª Exchange ï¼Œ4ä¸ª Queueï¼Œ7ä¸ª Binding ,å…¶","date":"2020-12-16","objectID":"/mq-rabbitmq/:4:1","tags":["rabbitmq","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹rabbitmq","uri":"/mq-rabbitmq/"},{"categories":null,"content":"fanout fanout å·¥ä½œæ–¹å¼ç±»ä¼¼äºå¹¿æ’­ï¼Œçœ‹çœ‹ä¸‹é¢çš„ä»£ç  func main() { conn, err := amqp.Dial(url) handlerError(err, \"Failed to connect to RabbitMQ\") defer conn.Close() channel, err := conn.Channel() handlerError(err, \"Failed to open a Channel\") defer channel.Close() fanoutExchangeNameCar := \"fanout.car\" if err := channel.ExchangeDeclare(fanoutExchangeNameCar, \"fanout\", true, false, false, false, nil); err != nil { handlerError(err, \"Failed to decalare exchange\") } queueNameCar := \"car\" queueNameBigCar := \"big-car\" queueNameMiddleCar := \"middle-car\" queueNameSmallCar := \"small-car\" channel.QueueDeclare(queueNameCar, false, false, false, false, nil) channel.QueueDeclare(queueNameBigCar, false, false, false, false, nil) channel.QueueDeclare(queueNameMiddleCar, false, false, false, false, nil) channel.QueueDeclare(queueNameSmallCar, false, false, false, false, nil) if err := channel.QueueBind(queueNameCar, \"car\", fanoutExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameBigCar, \"car\", fanoutExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameBigCar, \"big.car\", fanoutExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameMiddleCar, \"car\", fanoutExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameMiddleCar, \"middler.car\", fanoutExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameSmallCar, \"car\", fanoutExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameSmallCar, \"small.car\", fanoutExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.Publish(fanoutExchangeNameCar, \"middle.car\", false, false, amqp.Publishing{ContentType: \"text/plain\", Body: []byte(\"test car\")}); err != nil { handlerError(err, \"Failed to publish message\") } } è¿™ä¸ªç”³æ˜äº†ä¸€ä¸ª fanout ç±»å‹çš„ exchange ï¼Œå’Œä¸Šé¢çš„ä»£ç ç±»ä¼¼ï¼Œåªæœ‰ exchange ä¸åŒã€‚ å¯ä»¥å…ˆåœ¨è„‘æµ·ä¸­æƒ³æƒ³æ¯ä¸ª queue ä¸­æœ‰å‡ æ¡æ¶ˆæ¯ã€‚ å‘ fanout.car è¿™ä¸ª exchange å‘æ¶ˆæ¯æŒ‡å®š Routekey ä¸º middle.car ï¼Œä½†æ˜¯ç”±äºæ˜¯å¹¿æ’­æ¨¡å¼ï¼Œæ‰€ä»¥å’Œ routekey æ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œæ¯ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­å„æœ‰ä¸€æ¡æ¶ˆæ¯ã€‚ è¯·æ³¨æ„æœ‰äº› binding æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ª queue ï¼Œé‚£ä¹ˆä¼šäº§ç”Ÿå¤šæ¡æ¶ˆæ¯åˆ°ç›¸åŒçš„ queue ä¸­ï¼Œç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚producer äº§ç”Ÿä¸€æ¡æ¶ˆæ¯ï¼Œæ ¹æ®ä¸€å®šçš„è§„åˆ™ï¼Œæ¯ä¸ªé˜Ÿåˆ—åªä¼šæ”¶åˆ°ä¸€æ¡(å¦‚ä½•ç¬¦åˆæŠ•é€’è§„åˆ™çš„è¯)ã€‚ ","date":"2020-12-16","objectID":"/mq-rabbitmq/:4:2","tags":["rabbitmq","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹rabbitmq","uri":"/mq-rabbitmq/"},{"categories":null,"content":"topic topic æ¯”è¾ƒæœ‰æ„æ€äº†ï¼Œå’Œä¹‹å‰çš„ç®€å•ç²—æš´çš„ç”¨æ³•ä¸ä¸€æ ·äº†ï¼Œå…ˆçœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼Œå£°æ˜äº†ä¸€ä¸ª topic ç±»å‹çš„ exchangeï¼Œ 4ä¸ª queue func main() { conn, err := amqp.Dial(url) handlerError(err, \"Failed to connect to RabbitMQ\") defer conn.Close() channel, err := conn.Channel() handlerError(err, \"Failed to open a Channel\") defer channel.Close() topicExchangeNameCar := \"topic.car\" if err := channel.ExchangeDeclare(topicExchangeNameCar, \"topic\", true, false, false, false, nil); err != nil { handlerError(err, \"Failed to decalare exchange\") } queueNameCar := \"car\" queueNameBigCar := \"big-car\" queueNameMiddleCar := \"middle-car\" queueNameSmallCar := \"small-car\" channel.QueueDeclare(queueNameCar, false, false, false, false, nil) channel.QueueDeclare(queueNameBigCar, false, false, false, false, nil) channel.QueueDeclare(queueNameMiddleCar, false, false, false, false, nil) channel.QueueDeclare(queueNameSmallCar, false, false, false, false, nil) if err := channel.QueueBind(queueNameCar, \"car\", topicExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameBigCar, \"car\", topicExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameBigCar, \"big.car\", topicExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameMiddleCar, \"car\", topicExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameMiddleCar, \"middler.car\", topicExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameSmallCar, \"car\", topicExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameSmallCar, \"small.car\", topicExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameSmallCar, \"*.small.car\", topicExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } if err := channel.QueueBind(queueNameSmallCar, \"#.small.car\", topicExchangeNameCar, false, nil); err != nil { handlerError(err, \"Failed to bind queue to exchange\") } } ç°åœ¨æ€è€ƒæ¯ä¸ª producer äº§ç”Ÿæ¶ˆæ¯ä¹‹åï¼Œä¼šæœ‰å“ªäº› queue ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚ if err := channel.Publish(topicExchangeNameCar, \"car\", false, false, amqp.Publishing{ContentType: \"text/plain\", Body: []byte(\"test car\")}); err != nil { handlerError(err, \"Failed to publish message\") } æ¯ä¸ª queue éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯ if err := channel.Publish(topicExchangeNameCar, \"small.car\", false, false, amqp.Publishing{ContentType: \"text/plain\", Body: []byte(\"test car\")}); err != nil { handlerError(err, \"Failed to publish message\") } small-car è¿™ä¸€ä¸ªé˜Ÿåˆ—ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚ ç¬¦åˆ Routekey ä¸º small.car ã€*.small.carã€#.small.car çš„binding if err := channel.Publish(topicExchangeNameCar, \"benz.small.car\", false, false, amqp.Publishing{ContentType: \"text/plain\", Body: []byte(\"test car\")}); err != nil { handlerError(err, \"Failed to publish message\") } small-car è¿™ä¸€ä¸ªé˜Ÿåˆ—ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚ ç¬¦åˆ Routekey ä¸º *.small.carã€#.small.car çš„binding if err := channel.Publish(topicExchangeNameCar, \"auto.blue.benz.small.car\", false, false, amqp.Publishing{ContentType: \"text/plain\", Body: []byte(\"test car\")}); err != nil { handlerError(err, \"Failed to publish message\") } small-car è¿™ä¸€ä¸ªé˜Ÿåˆ—ä¼šæ”¶åˆ°æ¶ˆæ¯ã€‚ ç¬¦åˆ Routekey ä¸º #.small.car çš„binding if err := channel.Publish(topicExchangeNameCar, \"bike\", false, false, amqp.Publishing{ContentType: \"text/plain\", Body: []byte(\"test car\")}); err != nil { handlerError(err, \"Failed to publish message\") } éƒ½ä¸ä¼šæ”¶åˆ°æ¶ˆæ¯ï¼Œæ²¡æœ‰ç¬¦åˆçš„ routekey ã€‚ ","date":"2020-12-16","objectID":"/mq-rabbitmq/:4:3","tags":["rabbitmq","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹rabbitmq","uri":"/mq-rabbitmq/"},{"categories":null,"content":"headers è¿™ç§ç±»å‹å¾ˆå°‘æœ‰å®é™…çš„åº”ç”¨åœºæ™¯ã€‚ ","date":"2020-12-16","objectID":"/mq-rabbitmq/:4:4","tags":["rabbitmq","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹rabbitmq","uri":"/mq-rabbitmq/"},{"categories":null,"content":"å‚è€ƒ https://www.rabbitmq.com/documentation.html ","date":"2020-12-16","objectID":"/mq-rabbitmq/:5:0","tags":["rabbitmq","æ¶ˆæ¯é˜Ÿåˆ—"],"title":"æ¶ˆæ¯é˜Ÿåˆ—åŸç†ä¹‹rabbitmq","uri":"/mq-rabbitmq/"},{"categories":null,"content":"æ·±å…¥æµ…å‡ºçš„èŠèŠ cpu è´Ÿè½½ä¸ä½¿ç”¨ç‡","date":"2020-12-15","objectID":"/cpu/","tags":["linux","cpu"],"title":"æ·±å…¥æµ…å‡ºçš„èŠèŠ cpu è´Ÿè½½ä¸ä½¿ç”¨ç‡","uri":"/cpu/"},{"categories":null,"content":"å¯¼è¯» åœ¨å®šä½æ€§èƒ½é—®é¢˜æ—¶ï¼Œä¸€ä¸ªç»•ä¸å¼€çš„è¯é¢˜å°±æ˜¯ CPU ï¼Œä¼šè§‰å¾— CPU ä¸å¤Ÿç”¨äº†ï¼Œæˆ–è€…æ˜¯ç“¶é¢ˆäº†ï¼Œé‚£ä¹ˆæ€ä¹ˆæ¥ç¡®å®šæ˜¯ CPU çš„é—®é¢˜å‘¢ï¼Ÿè¡¡é‡ CPU çš„æŒ‡æ ‡æœ‰ä¸¤ä¸ªï¼ŒCPU è´Ÿè½½(load average) å’Œ ä½¿ç”¨ç‡ï¼Œè¿™ä¸¤è€…æœ‰ä»€ä¹ˆå…³ç³»å’ŒåŒºåˆ«å‘¢ï¼Ÿ è¿™ç¯‡æ–‡ç« å¸¦å¤§å®¶æ·±å±‚æ¬¡çš„äº†è§£ä¸€ä¸‹ CPU ã€‚ ","date":"2020-12-15","objectID":"/cpu/:1:0","tags":["linux","cpu"],"title":"æ·±å…¥æµ…å‡ºçš„èŠèŠ cpu è´Ÿè½½ä¸ä½¿ç”¨ç‡","uri":"/cpu/"},{"categories":null,"content":"ä»€ä¹ˆæ˜¯CPU CPU å°±æ˜¯è®¡ç®—æœºçš„ä¸­å¤®å¤„ç†å™¨(Central Processing Unit)ï¼Œå…¶åŠŸèƒ½ä¸»è¦æ˜¯è§£é‡Šè®¡ç®—æœºæŒ‡ä»¤ä»¥åŠå¤„ç†è®¡ç®—æœºè½¯ä»¶ä¸­çš„æ•°æ®ã€‚CPUæ˜¯è®¡ç®—æœºä¸­è´Ÿè´£è¯»å–æŒ‡ä»¤ï¼Œå¯¹æŒ‡ä»¤è¯‘ç å¹¶æ‰§è¡ŒæŒ‡ä»¤çš„æ ¸å¿ƒéƒ¨ä»¶ã€‚ä¸­å¤®å¤„ç†å™¨ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå³æ§åˆ¶å™¨ã€è¿ç®—å™¨ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬é«˜é€Ÿç¼“å†²å­˜å‚¨å™¨åŠå®ç°å®ƒä»¬ä¹‹é—´è”ç³»çš„æ•°æ®ã€æ§åˆ¶çš„æ€»çº¿ã€‚ç”µå­è®¡ç®—æœºä¸‰å¤§æ ¸å¿ƒéƒ¨ä»¶å°±æ˜¯CPUã€å†…éƒ¨å­˜å‚¨å™¨ã€è¾“å…¥/è¾“å‡ºè®¾å¤‡ã€‚ä¸­å¤®å¤„ç†å™¨çš„åŠŸæ•ˆä¸»è¦ä¸ºå¤„ç†æŒ‡ä»¤ã€æ‰§è¡Œæ“ä½œã€æ§åˆ¶æ—¶é—´ã€å¤„ç†æ•°æ®ã€‚ æ¥è‡ªç™¾åº¦ç™¾ç§‘ä¸Šçš„å®šä¹‰ã€‚ ","date":"2020-12-15","objectID":"/cpu/:2:0","tags":["linux","cpu"],"title":"æ·±å…¥æµ…å‡ºçš„èŠèŠ cpu è´Ÿè½½ä¸ä½¿ç”¨ç‡","uri":"/cpu/"},{"categories":null,"content":"CPU ç»“æ„ ä¸Šé¢è¿™å¼ å›¾ç‰‡æè¿°äº†ç°åœ¨çš„CPUçš„åŸºæœ¬æƒ…å†µï¼Œä¸€ä¸ªç‰©ç†æ ¸å¿ƒä¸­åŒ…å«å¤šä¸ªæ ¸å¿ƒ(å¤šæ ¸ç»“æ„)ã€‚è¿™å¼ å›¾è¡¨ç¤ºä¸€ä¸ªç‰©ç†æ ¸å¿ƒä¸­åŒ…å«4ä¸ªæ ¸å¿ƒï¼Œè€Œç°åœ¨çš„ CPU éƒ½ä¼šç”¨åˆ°è¶…çº¿ç¨‹æŠ€æœ¯ï¼ŒInter ä¸€èˆ¬æ˜¯æŠŠä¸€ä¸ªæ ¸åˆ†æˆ2ä¸ªï¼Œæ‰€ä»¥ä¸Šè¿™ä¸ªå°±ä»£è¡¨ 8 æ ¸(8=1 * 4 * 2) ã€‚ è¶…çº¿ç¨‹æŠ€æœ¯æŠŠå¤šçº¿ç¨‹å¤„ç†å™¨å†…éƒ¨çš„ä¸¤ä¸ªé€»è¾‘å†…æ ¸æ¨¡æ‹Ÿæˆä¸¤ä¸ªç‰©ç†èŠ¯ç‰‡ï¼Œè®©å•ä¸ªå¤„ç†å™¨å°±èƒ½ä½¿ç”¨çº¿ç¨‹çº§çš„å¹¶è¡Œè®¡ç®—ï¼Œè¿›è€Œå…¼å®¹å¤šçº¿ç¨‹æ“ä½œç³»ç»Ÿå’Œè½¯ä»¶ã€‚è¶…çº¿ç¨‹æŠ€æœ¯å……åˆ†åˆ©ç”¨ç©ºé—²CPUèµ„æºï¼Œåœ¨ç›¸åŒæ—¶é—´å†…å®Œæˆæ›´å¤šå·¥ä½œã€‚ è¶…çº¿ç¨‹æŠ€æœ¯ä¸»è¦çš„å‡ºå‘ç‚¹æ˜¯ï¼Œå½“å¤„ç†å™¨åœ¨è¿è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡ŒæŒ‡ä»¤ä»£ç æ—¶ï¼Œå¾ˆå¤šæ—¶å€™å¤„ç†å™¨å¹¶ä¸ä¼šä½¿ç”¨åˆ°å…¨éƒ¨çš„è®¡ç®—èƒ½åŠ›ï¼Œéƒ¨åˆ†è®¡ç®—èƒ½åŠ›å°±ä¼šå¤„äºç©ºé—²çŠ¶æ€ã€‚è€Œè¶…çº¿ç¨‹æŠ€æœ¯å°±æ˜¯é€šè¿‡å¤šçº¿ç¨‹æ¥è¿›ä¸€æ­¥â€œå‹æ¦¨â€å¤„ç†å™¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¿…é¡»è¦ç­‰åˆ°ä¸€äº›æ•°æ®åŠ è½½åˆ°ç¼“å­˜ä¸­ä»¥åæ‰èƒ½ç»§ç»­æ‰§è¡Œï¼Œæ­¤æ—¶CPUå°±å¯ä»¥åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œå»æ‰§è¡Œå…¶ä»–æŒ‡ä»¤ï¼Œè€Œä¸ç”¨å»å¤„äºç©ºé—²çŠ¶æ€ï¼Œç­‰å¾…å½“å‰çº¿ç¨‹çš„æ•°æ®åŠ è½½å®Œæ¯•ã€‚ é€šå¸¸ï¼Œä¸€ä¸ªä¼ ç»Ÿçš„å¤„ç†å™¨åœ¨çº¿ç¨‹ä¹‹é—´åˆ‡æ¢ï¼Œå¯èƒ½éœ€è¦å‡ ä¸‡ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚è€Œä¸€ä¸ªå…·æœ‰HTè¶…çº¿ç¨‹æŠ€æœ¯çš„å¤„ç†å™¨åªéœ€è¦1ä¸ªæ—¶é’Ÿå‘¨æœŸã€‚å› æ­¤å°±å¤§å¤§å‡å°äº†çº¿ç¨‹ä¹‹é—´åˆ‡æ¢çš„æˆæœ¬ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°è®©å¤„ç†å™¨æ»¡è´Ÿè·è¿è½¬ã€‚ æ‰€ä»¥å¾—å‡ºä¸€ä¸ªç»“è®º: æ€»æ ¸æ•° = ç‰©ç†æ ¸æ•° * æ¯ä¸ªç‰©ç†æ ¸å¿ƒçš„æ ¸æ•° * è¶…çº¿ç¨‹æ•° ","date":"2020-12-15","objectID":"/cpu/:3:0","tags":["linux","cpu"],"title":"æ·±å…¥æµ…å‡ºçš„èŠèŠ cpu è´Ÿè½½ä¸ä½¿ç”¨ç‡","uri":"/cpu/"},{"categories":null,"content":"cpu ä¿¡æ¯æŸ¥çœ‹ åœ¨ unix ç³»ç»Ÿä¸‹æŸ¥çœ‹ CPU è¯¦ç»†ä¿¡æ¯çš„æ–¹æ³•ä¸º cat /proc/cpuinfo : [root@iZuf685opgs9oyozju9i2bZ ~]# cat /proc/cpuinfo processor : 0 vendor_id : GenuineIntel cpu family : 6 model : 85 model name : Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz stepping : 7 microcode : 0x1 cpu MHz : 2499.998 cache size : 36608 KB physical id : 0 siblings : 2 core id : 0 cpu cores : 1 apicid : 0 initial apicid : 0 fpu : yes fpu_exception : yes cpuid level : 22 wp : yes flags : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl nonstop_tsc eagerfpu pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm mpx avx512f avx512dq rdseed adx smap avx512cd avx512bw avx512vl xsaveopt xsavec xgetbv1 arat avx512_vnni bogomips : 4999.99 clflush size : 64 cache_alignment : 64 address sizes : 46 bits physical, 48 bits virtual power management: processor : 1 vendor_id : GenuineIntel cpu family : 6 model : 85 model name : Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz stepping : 7 microcode : 0x1 cpu MHz : 2499.998 cache size : 36608 KB physical id : 0 siblings : 2 core id : 0 cpu cores : 1 apicid : 1 initial apicid : 1 fpu : yes fpu_exception : yes cpuid level : 22 wp : yes flags : fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush mmx fxsr sse sse2 ss ht syscall nx pdpe1gb rdtscp lm constant_tsc rep_good nopl nonstop_tsc eagerfpu pni pclmulqdq ssse3 fma cx16 pcid sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand hypervisor lahf_lm abm 3dnowprefetch invpcid_single fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm mpx avx512f avx512dq rdseed adx smap avx512cd avx512bw avx512vl xsaveopt xsavec xgetbv1 arat avx512_vnni bogomips : 4999.99 clflush size : 64 cache_alignment : 64 address sizes : 46 bits physical, 48 bits virtual power management: ä¸Šé¢è¿™æ˜¯ä¸€ä¸ª 1ä¸€ä¸ªç‰©ç†æ ¸å¿ƒï¼Œä¸€ä¸ªç‰©ç†æ ¸å¿ƒåªæœ‰ä¸€ä¸ªæ ¸ï¼Œä¸€ä¸ªæ ¸ä¸Šæœ‰ä¸¤ä¸ªè¶…çº¿ç¨‹ çš„ CPU è¯¦ç»†ä¿¡æ¯ã€‚ å…³é”®æŒ‡æ ‡è¯´æ˜: processor: é€»è¾‘æ ¸å¿ƒçš„åºå·ï¼Œé»˜è®¤ä» 0 å¼€å§‹ï¼Œå¯¹äºå•æ ¸å¤„ç†å™¨ï¼Œåˆ™å¯ä»¥è®¤ä¸ºæ˜¯å…¶CPUç¼–å·ï¼Œå¯¹äºå¤šæ ¸å¤„ç†å™¨åˆ™å¯ä»¥æ˜¯ç‰©ç†æ ¸ã€æˆ–è€…ä½¿ç”¨è¶…çº¿ç¨‹æŠ€æœ¯è™šæ‹Ÿçš„é€»è¾‘æ ¸ã€‚ vendor_id: CPU åˆ¶é€ å•† cpu family: CPU äº§å“ç³»åˆ—ä»£å· model: CPUå±äºå…¶ç³»åˆ—ä¸­çš„å“ªä¸€ä»£çš„ä»£å· model name: CPUå±äºçš„åå­—åŠå…¶ç¼–å·ã€æ ‡ç§°ä¸»é¢‘ stepping: CPUå±äºåˆ¶ä½œæ›´æ–°ç‰ˆæœ¬ cpu MHz: CPUçš„å®é™…ä½¿ç”¨ä¸»é¢‘ cache size: CPUäºŒçº§ç¼“å­˜å¤§å° physical id: å•ä¸ªCPUçš„æ ‡å· siblings: å•ä¸ªCPUé€»è¾‘ç‰©ç†æ ¸æ•° core id: å½“å‰ç‰©ç†æ ¸åœ¨å…¶æ‰€å¤„CPUä¸­çš„ç¼–å·ï¼Œè¿™ä¸ªç¼–å·ä¸ä¸€å®šè¿ç»­ cpu cores: è¯¥é€»è¾‘æ ¸æ‰€å¤„CPUçš„ç‰©ç†æ ¸æ•° apicid: ç”¨æ¥åŒºåˆ†ä¸åŒé€»è¾‘æ ¸çš„ç¼–å·ï¼Œç³»ç»Ÿä¸­æ¯ä¸ªé€»è¾‘æ ¸çš„æ­¤ç¼–å·å¿…ç„¶ä¸åŒï¼Œæ­¤ç¼–å·ä¸ä¸€å®šè¿ç»­ fpu: æ˜¯å¦å…·æœ‰æµ®ç‚¹è¿ç®—å•å…ƒï¼ˆFloating Point Unitï¼‰ fpu_exception: æ˜¯å¦æ”¯æŒæµ®ç‚¹è®¡ç®—å¼‚å¸¸ cpuid level : æ‰§è¡ŒcpuidæŒ‡ä»¤å‰ï¼Œeaxå¯„å­˜å™¨ä¸­çš„å€¼ï¼Œæ ¹æ®ä¸åŒçš„å€¼cpuidæŒ‡ä»¤ä¼šè¿”å›ä¸åŒçš„å†…å®¹ wp: è¡¨æ˜å½“å‰CPUæ˜¯å¦åœ¨å†…æ ¸æ€æ”¯æŒå¯¹ç”¨æˆ·ç©ºé—´çš„å†™ä¿æŠ¤ï¼ˆWrite Protectionï¼‰ flags: å½“å‰CPUæ”¯æŒçš„åŠŸèƒ½ bogomips: åœ¨ç³»ç»Ÿå†…æ ¸å¯åŠ¨æ—¶ç²—ç•¥æµ‹ç®—çš„CPUé€Ÿåº¦ï¼ˆMillion Instructions Per Secondï¼‰ clflush size: æ¯æ¬¡åˆ·æ–°ç¼“å­˜çš„å¤§å°å•ä½ cache_alignment: ç¼“å­˜åœ°å€å¯¹é½å•ä½ address sizes: å¯è®¿é—®åœ°å€ç©ºé—´ä½æ•° power management: å¯¹èƒ½æºç®¡ç†çš„æ”¯æŒ å¯¹äº cpu çš„å¸¸ç”¨æ“ä½œå¦‚ä¸‹: æŸ¥çœ‹ CPU å‹å·: [root@iZuf685opgs9oyozju9i2bZ ~]# cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c 2 Intel(R) Xeon(R) Platinum 8269CY CPU @ 2.50GHz æŸ¥çœ‹ç‰©ç† CPU ä¸ªæ•° [root@iZuf685opgs9oyozju9i2bZ ~]# cat /proc/cpuinfo| grep \"physical id\"| sort| uniq| wc -l 1 æŸ¥çœ‹æ¯ä¸ªç‰©ç† CPU ä¸­ core çš„ä¸ªæ•°(å³æ ¸æ•°) [root@iZuf685opgs9oyozju9i2bZ ~]# cat /proc/cpuinfo| grep \"cpu cores\"| uniq cpu cores : 1 æŸ¥çœ‹é€»è¾‘ CPU çš„ä¸ªæ•° [root@iZuf685opgs9oyozju9i2bZ ~]# cat /proc/cpuinfo| grep \"processor\"| wc -l 2 æŸ¥çœ‹ CPU æ˜¯è¿è¡Œåœ¨ 32 ä½è¿˜æ˜¯ 64 ä½æ¨¡å¼ä¸‹ [root@iZuf685opgs9oyozju9i2bZ ~]# getconf LONG_BIT 64 ","date":"2020-12-15","objectID":"/cpu/:3:1","tags":["linux","cpu"],"title":"æ·±å…¥æµ…å‡ºçš„èŠèŠ cpu è´Ÿè½½ä¸ä½¿ç”¨ç‡","uri":"/cpu/"},{"categories":null,"content":"CPU è´Ÿè½½ åœ¨ unix ç³»ç»Ÿä¸‹å¯ä»¥é€šè¿‡ top å‘½ä»¤çœ‹åˆ°3ä¸ªå€¼ : [root@iZuf685opgs9oyozju9i2bZ ~]# top top - 21:18:36 up 35 days, 12:39, 1 user, load average: 0.00, 0.01, 0.05 Tasks: 99 total, 1 running, 98 sleeping, 0 stopped, 0 zombie ... load average: 0.00, 0.01, 0.05 è¡¨ç¤ºç³»ç»Ÿåœ¨æœ€è¿‘ 1ã€5ã€15åˆ†é’Ÿå†…çš„å¹³å‡è´Ÿè½½ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯è´Ÿè½½å‘¢ ? CPU è´Ÿè½½æŒ‡çš„æ˜¯: ç³»ç»Ÿåœ¨ä¸€æ®µæ—¶é—´å†…æ­£åœ¨ä½¿ç”¨å’Œç­‰å¾…ä½¿ç”¨CPUçš„å¹³å‡ä»»åŠ¡æ•°ã€‚æè¿°çš„æ˜¯ä»»åŠ¡çš„æ’é˜Ÿæƒ…å†µã€‚ å€Ÿç”¨ç½‘ä¸Šçš„ä¸€ä¸ªä¾‹å­ï¼šå…¬ç”¨ç”µè¯ æŠŠCPUæ¯”ä½œç”µè¯äº­ï¼ŒæŠŠä»»åŠ¡æ¯”ä½œæ’é˜Ÿæ‰“ç”µè¯çš„äººã€‚æœ‰ä¸€å †äººæ’é˜Ÿæ‰“ç”µè¯ï¼Œæ¯ä¸ªäººåªå…è®¸æ‰“1åˆ†é’Ÿçš„ç”µè¯ï¼Œå¦‚æœæ—¶é—´åˆ°äº†è¿˜æ²¡æœ‰æ‰“å®Œè¿˜æ˜¯éœ€è¦é‡æ–°å»æ’é˜Ÿã€‚åœ¨æ‰“ç”µè¯çš„æ—¶å€™ï¼Œè‚¯å®šä¼šé‡åˆ°æ’é˜Ÿç­‰å¾…ç”µè¯çš„äººï¼Œä¹Ÿæœ‰æ‰“å®Œç”µè¯èµ°æ‰çš„äººï¼Œä¹Ÿæœ‰æ–°æ¥æ’é˜Ÿçš„äººï¼Œä¹Ÿæœ‰æ‰“å®Œ1åˆ†é’Ÿåæ²¡æ‰“å®Œåˆé‡æ–°æ’é˜Ÿçš„äººã€‚é‚£è¿™ä¸ªäººæ•°çš„å˜åŒ–å°±ç›¸å½“äºä»»åŠ¡çš„å¢å‡ã€‚ä¸ºäº†ç»Ÿè®¡å¹³å‡è´Ÿè½½çŠ¶æ€ï¼Œæ¯åˆ†é’Ÿç»Ÿè®¡ä¸€æ¬¡ï¼Œè®¡ç®—æœ€è¿‘1ã€5ã€15åˆ†é’Ÿçš„å¹³å‡å€¼ã€‚ loadä½å¹¶ä¸æ„å‘³ç€CPUçš„åˆ©ç”¨ç‡ä½ï¼Œæœ‰çš„äºº(ä»»åŠ¡)æ‹¿èµ·ç”µè¯(CPU)ä¸€ç›´æ‰“å®Œ1åˆ†é’Ÿï¼Œè¿™æ—¶å€™ cpu ä½¿ç”¨ç‡ä¸º100%ï¼Œæœ‰çš„äºº(ä»»åŠ¡)æ‹¿èµ·ç”µè¯(CPU)ä¸€ç›´çŠ¹è±«æ˜¯å¦è¦æ‰“æˆ–è€…åœ¨æ‰¾æ‰‹æœºå·ï¼Œ30ç§’åæ‰æ‹¨é€šäº†ç”µè¯ï¼Œåªæœ‰å30ç§’æ˜¯çœŸæ­£åœ¨æ‰“ç”µè¯ï¼Œè¿™æ—¶å€™cpuä½¿ç”¨ç‡ä¸º50% ï¼Œå½“ç„¶å®é™…æƒ…å†µå¯èƒ½ä¼šæœ‰åå·®ã€‚ ","date":"2020-12-15","objectID":"/cpu/:4:0","tags":["linux","cpu"],"title":"æ·±å…¥æµ…å‡ºçš„èŠèŠ cpu è´Ÿè½½ä¸ä½¿ç”¨ç‡","uri":"/cpu/"},{"categories":null,"content":"CPU ä½¿ç”¨ç‡ CPU ä½¿ç”¨ç‡æ˜¯ç¨‹åºåœ¨è¿è¡ŒæœŸé—´å®æ—¶å ç”¨çš„CPUç™¾åˆ†æ¯”ã€‚æè¿°çš„æ˜¯ cpu çš„ç¹å¿™æƒ…å†µã€‚ cpu ä½¿ç”¨ç‡é«˜ä¸ä¸€å®šè´Ÿè½½é«˜ï¼Œçœ‹çœ‹ä¸‹é¢çš„ä»£ç : func main() { for { num1 := 1 num2 := 1 num3 := num1 + num2 fmt.Println(num3) } } è¿™ä¸ªç¨‹åºä¼šä¸€ç›´å ç€ cpu ï¼Œå¦‚æœæ˜¯å•æ ¸çš„ï¼Œcpu ä½¿ç”¨ç‡ä¸º 100%ï¼Œè´Ÿè½½ä¸º1ã€‚ ","date":"2020-12-15","objectID":"/cpu/:5:0","tags":["linux","cpu"],"title":"æ·±å…¥æµ…å‡ºçš„èŠèŠ cpu è´Ÿè½½ä¸ä½¿ç”¨ç‡","uri":"/cpu/"},{"categories":null,"content":"è´Ÿè½½ä¸ä½¿ç”¨ç‡åˆ†æ ","date":"2020-12-15","objectID":"/cpu/:6:0","tags":["linux","cpu"],"title":"æ·±å…¥æµ…å‡ºçš„èŠèŠ cpu è´Ÿè½½ä¸ä½¿ç”¨ç‡","uri":"/cpu/"},{"categories":null,"content":"è´Ÿè½½é«˜ã€ä½¿ç”¨ç‡ä½ è¯´æ˜ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡å¾ˆå¤šã€‚å¾ˆå¯èƒ½æ˜¯è¿›ç¨‹åƒµæ­»äº†ã€‚é€šè¿‡å‘½ä»¤ ps -aux æŸ¥çœ‹æ˜¯å¦å­˜åœ¨DçŠ¶æ€çš„è¿›ç¨‹ï¼Œè¯¥çŠ¶æ€ä¸ºä¸å¯ä¸­æ–­çš„ç¡çœ çŠ¶ï¼Œæ€ã€‚å¤„äºDçŠ¶æ€çš„è¿›ç¨‹é€šå¸¸æ˜¯åœ¨ç­‰å¾…IOï¼Œé€šå¸¸æ˜¯IOå¯†é›†å‹ä»»åŠ¡ï¼Œå¦‚æœå¤§é‡è¯·æ±‚éƒ½é›†ä¸­äºç›¸åŒçš„IOè®¾å¤‡ï¼Œè¶…å‡ºè®¾å¤‡çš„å“åº”èƒ½åŠ›ï¼Œä¼šé€ æˆä»»åŠ¡åœ¨è¿è¡Œé˜Ÿåˆ—é‡Œå †ç§¯ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯DçŠ¶æ€çš„è¿›ç¨‹å †ç§¯ï¼Œé‚£ä¹ˆæ­¤æ—¶Load Averageå°±ä¼šé£™é«˜ã€‚ ","date":"2020-12-15","objectID":"/cpu/:6:1","tags":["linux","cpu"],"title":"æ·±å…¥æµ…å‡ºçš„èŠèŠ cpu è´Ÿè½½ä¸ä½¿ç”¨ç‡","uri":"/cpu/"},{"categories":null,"content":"åˆ©ç”¨ç‡é«˜ã€è´Ÿè½½ä½ è¯´æ˜ä»»åŠ¡å°‘ï¼Œä½†æ˜¯ä»»åŠ¡æ‰§è¡Œæ—¶é—´é•¿ï¼Œæœ‰å¯èƒ½æ˜¯ç¨‹åºæœ¬èº«æœ‰é—®é¢˜ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜é‚£ä¹ˆè®¡ç®—å®Œæˆååˆ™åˆ©ç”¨ç‡ä¼šä¸‹é™ã€‚è¿™ç§åœºæ™¯ï¼Œé€šå¸¸æ˜¯è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼Œå³å¤§é‡ç”Ÿæˆè€—æ—¶çŸ­çš„è®¡ç®—ä»»åŠ¡ã€‚ ","date":"2020-12-15","objectID":"/cpu/:6:2","tags":["linux","cpu"],"title":"æ·±å…¥æµ…å‡ºçš„èŠèŠ cpu è´Ÿè½½ä¸ä½¿ç”¨ç‡","uri":"/cpu/"},{"categories":null,"content":"ä½¿ç”¨ç‡ä½ã€è´Ÿè½½ä½ã€IOPS é«˜ é€šå¸¸æ˜¯ä½é¢‘å¤§æ–‡ä»¶è¯»å†™ï¼Œç”±äºè¯·æ±‚æ•°é‡ä¸å¤§ï¼Œæ‰€ä»¥ä»»åŠ¡éƒ½å¤„äºRçŠ¶æ€(è¡¨ç¤ºæ­£åœ¨è¿è¡Œï¼Œæˆ–è€…å¤„äºè¿è¡Œé˜Ÿåˆ—ï¼Œå¯ä»¥è¢«è°ƒåº¦è¿è¡Œ)ï¼Œè´Ÿè½½æ•°å€¼åæ˜ äº†å½“å‰è¿è¡Œçš„ä»»åŠ¡æ•°ï¼Œä¸ä¼šé£™å‡ï¼ŒIOè®¾å¤‡å¤„äºæ»¡è´Ÿè·å·¥ä½œçŠ¶æ€ï¼Œå¯¼è‡´ç³»ç»Ÿå“åº”èƒ½åŠ›é™ä½ã€‚ ","date":"2020-12-15","objectID":"/cpu/:6:3","tags":["linux","cpu"],"title":"æ·±å…¥æµ…å‡ºçš„èŠèŠ cpu è´Ÿè½½ä¸ä½¿ç”¨ç‡","uri":"/cpu/"},{"categories":null,"content":"æ€»ç»“ CPU å°±æ˜¯è®¡ç®—æœºçš„ä¸­å¤®å¤„ç†å™¨(Central Processing Unit)ï¼Œå…¶åŠŸèƒ½ä¸»è¦æ˜¯è§£é‡Šè®¡ç®—æœºæŒ‡ä»¤ä»¥åŠå¤„ç†è®¡ç®—æœºè½¯ä»¶ä¸­çš„æ•°æ® æ€»æ ¸æ•° = ç‰©ç†æ ¸æ•° * æ¯ä¸ªç‰©ç†æ ¸å¿ƒçš„æ ¸æ•° * è¶…çº¿ç¨‹æ•° CPU è´Ÿè½½æ˜¯ç³»ç»Ÿåœ¨ä¸€æ®µæ—¶é—´å†…æ­£åœ¨ä½¿ç”¨å’Œç­‰å¾…ä½¿ç”¨CPUçš„å¹³å‡ä»»åŠ¡æ•°ã€‚æè¿°çš„æ˜¯ä»»åŠ¡çš„æ’é˜Ÿæƒ…å†µã€‚ CPU ä½¿ç”¨ç‡æ˜¯ç¨‹åºåœ¨è¿è¡ŒæœŸé—´å®æ—¶å ç”¨çš„CPUç™¾åˆ†æ¯”ã€‚æè¿°çš„æ˜¯ cpu çš„ç¹å¿™æƒ…å†µã€‚ CPU è´Ÿè½½é«˜å¹¶ä¸èƒ½è¯´æ˜ CPU ä½¿ç”¨ç‡é«˜ï¼Œåä¹‹äº¦ç„¶ã€‚ ","date":"2020-12-15","objectID":"/cpu/:7:0","tags":["linux","cpu"],"title":"æ·±å…¥æµ…å‡ºçš„èŠèŠ cpu è´Ÿè½½ä¸ä½¿ç”¨ç‡","uri":"/cpu/"},{"categories":null,"content":"git å¸¸ç”¨å‘½ä»¤","date":"2020-12-14","objectID":"/git-command/","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"å¯¼è¯» è¿™ç¯‡æ–‡ç« ä¸»è¦è®°å½•äº† git çš„ä¸€äº›å¸¸ç”¨å‘½ä»¤ï¼Œåç»­ä¼šæŒç»­è¡¥å……æ›´æ–°ã€‚ ","date":"2020-12-14","objectID":"/git-command/:1:0","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"å¸¸ç”¨å‘½ä»¤ ","date":"2020-12-14","objectID":"/git-command/:2:0","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"æ£€å‡ºä»£ç  git clone url -b git_branch ","date":"2020-12-14","objectID":"/git-command/:2:1","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"æŸ¥çœ‹åˆ†æ”¯ git branch -a ","date":"2020-12-14","objectID":"/git-command/:2:2","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"åˆ›å»ºåˆ†æ”¯ git branch xxx ","date":"2020-12-14","objectID":"/git-command/:2:3","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"åˆ é™¤æœ¬åœ°åˆ†æ”¯ git branch -d xxxxx ","date":"2020-12-14","objectID":"/git-command/:2:4","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"æ£€å‡ºåˆ†æ”¯ git checkout git_branch ","date":"2020-12-14","objectID":"/git-command/:2:5","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"æ‹‰å–ä»£ç  git pull ","date":"2020-12-14","objectID":"/git-command/:2:6","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"æŠŠä¿®æ”¹æ–‡ä»¶æäº¤åˆ°ç¼“å†²åŒº git add \u003cfilename\u003e ","date":"2020-12-14","objectID":"/git-command/:2:7","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"æœ¬åœ°æäº¤ git commit -m \"ä»£ç æäº¤ä¿¡æ¯\" ","date":"2020-12-14","objectID":"/git-command/:2:8","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"æ¨é€ä»£ç  git push origin local_branch:remote_branch ä¾‹ : git push origin release/release:release/release ","date":"2020-12-14","objectID":"/git-command/:2:9","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"åˆå¹¶ä»£ç  git merge origin/remote ","date":"2020-12-14","objectID":"/git-command/:2:10","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"cherry pick git cherry-pick commit_id ","date":"2020-12-14","objectID":"/git-command/:2:11","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"è·Ÿè¸ª git branch --set-upstream-to=remote_branch local_branch ä¾‹ git branch --set-upstream-to=origin/release/release release/release ","date":"2020-12-14","objectID":"/git-command/:2:12","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"ä¸¢å¼ƒæœ¬åœ°ä¿®æ”¹ git checkout -- file ä¾‹ git checkout -- test.py ","date":"2020-12-14","objectID":"/git-command/:2:13","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"å–æ¶ˆæœ¬åœ°æäº¤ - git log æŸ¥æ‰¾éœ€è¦æ¢å¤çš„ commit_id - git reset --hard commit_id ","date":"2020-12-14","objectID":"/git-command/:2:14","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"æœ¬åœ°æ¸…é™¤gitä¸Šå·²ç»åˆ é™¤çš„åˆ†æ”¯ git remote prune origin ","date":"2020-12-14","objectID":"/git-command/:2:15","tags":["git","cli"],"title":"git å¸¸ç”¨å‘½ä»¤","uri":"/git-command/"},{"categories":null,"content":"docker åŸç†ä¹‹æœ¬åœ°å­˜å‚¨","date":"2020-12-09","objectID":"/docker-local-storage/","tags":["docker","å­˜å‚¨"],"title":"docker åŸç†ä¹‹æœ¬åœ°å­˜å‚¨","uri":"/docker-local-storage/"},{"categories":null,"content":"å¯¼è¯» åœ¨å‰é¢çš„æ–‡ç« docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨ä¸­ç®€å•çš„ä»‹ç»äº† Docker çš„å­˜å‚¨é©±åŠ¨ï¼Œè¿™ç¯‡æ–‡ç« æ¥ç€è®²å­˜å‚¨ï¼Œç›®å‰çš„ docker ç‰ˆæœ¬ä¸­é»˜è®¤çš„æ˜¯ overlay2 ï¼Œæ‰€ä»¥è¿™ç¯‡æ–‡ç« å°±ä»¥ overlay2 ä¸ºä¾‹å¸¦å¤§å®¶çœ‹çœ‹ï¼Œåœ¨æˆ‘ä»¬æ‰§è¡Œ docker build ï¼Œdocker pullï¼Œdocker run ç­‰å‘½ä»¤æ—¶æœ¬åœ°å­˜å‚¨æœ‰ä½•å˜åŒ–ã€‚ è¿™ç¯‡æ–‡ç« æ¯”è¾ƒé•¿ï¼Œå¦‚æœçœ‹ä¸å®Œå¯ä»¥æ”¶è—èµ·æ¥åç»­éœ€è¦ç”¨åˆ°çš„æ—¶å€™å†æŸ¥é˜…ï¼Œç§°çš„ä¸Šæ˜¯å¹²è´§æ»¡æ»¡ï¼Œä½œè€…è‡ªå·±æ•´ç†ä¹ŸèŠ±äº†è¾ƒé•¿çš„æ—¶é—´ã€‚ ","date":"2020-12-09","objectID":"/docker-local-storage/:1:0","tags":["docker","å­˜å‚¨"],"title":"docker åŸç†ä¹‹æœ¬åœ°å­˜å‚¨","uri":"/docker-local-storage/"},{"categories":null,"content":"èƒŒæ™¯ æŸ¥çœ‹ docker Storage Driver å¯ä»¥é€šè¿‡ docker info | grep \"Storage Driver\"å‘½ä»¤ã€‚ docker çš„é»˜è®¤å®‰è£…ç›®å½•ä¸ºï¼š /var/lib/dockerï¼Œå¦‚æœè¦ä¿®æ”¹å¯ä»¥é€šè¿‡ä¿®æ”¹å¯åŠ¨æ—¶çš„é…ç½®æ–‡ä»¶(é»˜è®¤ä¸º/usr/lib/systemd/system/docker.service) ä¸­çš„ ExecStartï¼Œ æŸ¥çœ‹ docker å¯åŠ¨æ—¶çš„é…ç½®æ–‡ä»¶: ä¿®æ”¹ docker çš„å­˜å‚¨ç›®å½•: ä¿®æ”¹(å¢åŠ ) --graph å³å¯ã€‚ ","date":"2020-12-09","objectID":"/docker-local-storage/:2:0","tags":["docker","å­˜å‚¨"],"title":"docker åŸç†ä¹‹æœ¬åœ°å­˜å‚¨","uri":"/docker-local-storage/"},{"categories":null,"content":"æœ¬åœ°ç›®å½• [root@iZuf685opgs9oyozju9i2bZ docker]# ll æ€»ç”¨é‡ 48 drwx------ 2 root root 4096 11æœˆ 11 08:49 builder drwx--x--x 4 root root 4096 11æœˆ 11 08:49 buildkit drwx------ 3 root root 4096 12æœˆ 2 09:25 containers drwx------ 3 root root 4096 11æœˆ 11 08:49 image drwxr-x--- 3 root root 4096 11æœˆ 11 08:49 network drwx------ 9 root root 4096 12æœˆ 2 09:25 overlay2 drwx------ 4 root root 4096 11æœˆ 11 08:49 plugins drwx------ 2 root root 4096 11æœˆ 11 08:49 runtimes drwx------ 2 root root 4096 11æœˆ 11 08:49 swarm drwx------ 2 root root 4096 11æœˆ 11 13:32 tmp drwx------ 2 root root 4096 11æœˆ 11 08:49 trust drwx------ 2 root root 4096 11æœˆ 11 08:49 volumes å¯ä»¥ç”¨ tree è¿›è¡Œå±•å¼€ [root@iZuf685opgs9oyozju9i2bZ docker]# tree -L 2 . â”œâ”€â”€ builder â”‚Â â””â”€â”€ fscache.db â”œâ”€â”€ buildkit â”‚Â â”œâ”€â”€ cache.db â”‚Â â”œâ”€â”€ content â”‚Â â”œâ”€â”€ executor â”‚Â â”œâ”€â”€ metadata.db â”‚Â â””â”€â”€ snapshots.db â”œâ”€â”€ containers â”‚Â â””â”€â”€ 9bd6ac07a8c962e2403203e1c45f4fb54733f9953cf318b34fc3f155bf2c0c59 â”œâ”€â”€ image â”‚Â â””â”€â”€ overlay2 â”œâ”€â”€ network â”‚Â â””â”€â”€ files â”œâ”€â”€ overlay2 â”‚Â â”œâ”€â”€ 00b65b9c288df8c0ae7cdacba531a7dc5cb006e6c768e19ee36055717b782acc â”‚Â â”œâ”€â”€ 1e53dddb1a0bb04ee4ebd24a8edb94b96e2fd471a72bf1b8608096b38cb16646 â”‚Â â”œâ”€â”€ 1e53dddb1a0bb04ee4ebd24a8edb94b96e2fd471a72bf1b8608096b38cb16646-init â”‚Â â”œâ”€â”€ 5da215c4f218cbb1d9825fa111c21bf381dc35a9e6c7c6cd5c3ea952316031e4 â”‚Â â”œâ”€â”€ 8cbfb8b74c887e780747c8e6f4b3b9223a513ff6d69770bac16abb76da4e314f â”‚Â â”œâ”€â”€ f1cf8b173467c98e08f3d276d7ccd8f9892c7c71dec2c4b335c39c6f175ae744 â”‚Â â””â”€â”€ l â”œâ”€â”€ plugins â”‚Â â”œâ”€â”€ storage â”‚Â â””â”€â”€ tmp â”œâ”€â”€ runtimes â”œâ”€â”€ swarm â”œâ”€â”€ tmp â”œâ”€â”€ trust â””â”€â”€ volumes â””â”€â”€ metadata.db 26 directories, 5 files è¿™ç¯‡æ–‡ç« ä»¥åˆ†æå­˜å‚¨ä¸ºä¸»ï¼Œæ¶‰åŠåˆ°çš„ç›®å½•æœ‰ image,containers,overlay2ï¼Œå…¶ä»–çš„ç›®å½•æ”¾åœ¨åç»­çš„æ–‡ç« è®¨è®ºã€‚ åœ¨çœŸæ­£å¼€å§‹ä¹‹å‰ï¼Œå…ˆæƒ³æƒ³å‡ ä¸ªé—®é¢˜(è¿™ä¹Ÿæ˜¯æˆ‘è‡ªå·±é—®æˆ‘è‡ªå·±çš„é—®é¢˜) : docker build çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„? docker pull å’Œ docker build äº§ç”Ÿçš„é•œåƒå­˜æ”¾åœ¨å“ªäº†ï¼Ÿ docker run è¿è¡Œä¸€ä¸ªå®¹å™¨çš„æ—¶å€™è¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„? å¸¦ç€è¿™äº›é—®é¢˜æˆ‘ä»¬ä»¥ä¸€ä¸ªä¾‹å­è¿›è¡Œè¯´æ˜ russellgao/openresty:1.17.8.2-5-alpine ","date":"2020-12-09","objectID":"/docker-local-storage/:3:0","tags":["docker","å­˜å‚¨"],"title":"docker åŸç†ä¹‹æœ¬åœ°å­˜å‚¨","uri":"/docker-local-storage/"},{"categories":null,"content":"image image ç›®å½•ä¸»è¦å­˜æ”¾çš„é•œåƒç›¸å…³çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬æ‰§è¡Œ docker pull russellgao/openresty:1.17.8.2-5-alpine çœ‹çœ‹ï¼š [root@iZuf685opgs9oyozju9i2bZ docker]# docker pull russellgao/openresty:1.17.8.2-5-alpine 1.17.8.2-5-alpine: Pulling from russellgao/openresty df20fa9351a1: Already exists 5682af42731d: Pull complete 7c6cb2b54a9d: Pull complete aa74dc345098: Pull complete Digest: sha256:224ced85b5f8b679a8664a39b69c1b8feb09f8ba4343d834bd5b69433081389e Status: Downloaded newer image for openresty/openresty:1.17.8.2-5-alpine å¯ä»¥çœ‹åˆ° pull äº† 4 å±‚ä¸‹æ¥äº†ï¼Œæˆ‘ä»¬çœ‹çœ‹ image ç›®å½•: [root@iZuf685opgs9oyozju9i2bZ docker]# tree image image â””â”€â”€ overlay2 â”œâ”€â”€ distribution â”‚Â â”œâ”€â”€ diffid-by-digest â”‚Â â”‚Â â””â”€â”€ sha256 â”‚Â â”‚Â â”œâ”€â”€ 5682af42731d652bd98d2456ed3da4f0595ed5d9e5b13ac8bb9590bb74f72eb8 â”‚Â â”‚Â â”œâ”€â”€ 7c6cb2b54a9d9d40c4a03dd6615b1c8e791feb5d81464a7702a9bb921f7a73e9 â”‚Â â”‚Â â”œâ”€â”€ aa74dc3450985aee599c181d650da8f8880ca1d6e2bc01a43831ca59b6e2a7b6 â”‚Â â”‚Â â””â”€â”€ df20fa9351a15782c64e6dddb2d4a6f50bf6d3688060a34c4014b0d9a752eb4c â”‚Â â””â”€â”€ v2metadata-by-diffid â”‚Â â””â”€â”€ sha256 â”‚Â â”œâ”€â”€ 1680a9f16b18732726d0656b6d6ff9611a3c4460ca870827b537a87bbe10cc22 â”‚Â â”œâ”€â”€ 50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a â”‚Â â”œâ”€â”€ 8521b614863046bf4bb604e3586feeca8b7ce1372f1d6664a5545e85ad9ca472 â”‚Â â””â”€â”€ 9c572ba82b91e3ac35c7351bdacc6876c67f5d9bc69c5e51e8b2deeafae95e4f â”œâ”€â”€ imagedb â”‚Â â”œâ”€â”€ content â”‚Â â”‚Â â””â”€â”€ sha256 â”‚Â â”‚Â â””â”€â”€ 1ddc7a18ba0bcc20c61447f391bfff98ac559eea590e7ac59b5b5f588f1f47ed â”‚Â â””â”€â”€ metadata â”‚Â â””â”€â”€ sha256 â”‚Â â””â”€â”€ 1ddc7a18ba0bcc20c61447f391bfff98ac559eea590e7ac59b5b5f588f1f47ed â”‚Â â””â”€â”€ lastUpdated â”œâ”€â”€ layerdb â”‚Â â”œâ”€â”€ mounts â”‚Â â”‚Â â””â”€â”€ 9bd6ac07a8c962e2403203e1c45f4fb54733f9953cf318b34fc3f155bf2c0c59 â”‚Â â”‚Â â”œâ”€â”€ init-id â”‚Â â”‚Â â”œâ”€â”€ mount-id â”‚Â â”‚Â â””â”€â”€ parent â”‚Â â”œâ”€â”€ sha256 â”‚Â â”‚Â â”œâ”€â”€ 228fb92e31891f472e9857ee11d13c404ff7c88e808b05ce4ebdc80d785d71f3 â”‚Â â”‚Â â”‚Â â”œâ”€â”€ cache-id â”‚Â â”‚Â â”‚Â â”œâ”€â”€ diff â”‚Â â”‚Â â”‚Â â”œâ”€â”€ parent â”‚Â â”‚Â â”‚Â â”œâ”€â”€ size â”‚Â â”‚Â â”‚Â â””â”€â”€ tar-split.json.gz â”‚Â â”‚Â â”œâ”€â”€ 50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a â”‚Â â”‚Â â”‚Â â”œâ”€â”€ cache-id â”‚Â â”‚Â â”‚Â â”œâ”€â”€ diff â”‚Â â”‚Â â”‚Â â”œâ”€â”€ size â”‚Â â”‚Â â”‚Â â””â”€â”€ tar-split.json.gz â”‚Â â”‚Â â”œâ”€â”€ 5f72760956a669e4c9b33aa3f2f04baa84b0f4cf1e11676049981bafcbba74da â”‚Â â”‚Â â”‚Â â”œâ”€â”€ cache-id â”‚Â â”‚Â â”‚Â â”œâ”€â”€ diff â”‚Â â”‚Â â”‚Â â”œâ”€â”€ parent â”‚Â â”‚Â â”‚Â â”œâ”€â”€ size â”‚Â â”‚Â â”‚Â â””â”€â”€ tar-split.json.gz â”‚Â â”‚Â â””â”€â”€ fe267088885017d5e9a4621e68617a7f35e58dc2d0d747927882da21059854e3 â”‚Â â”‚Â â”œâ”€â”€ cache-id â”‚Â â”‚Â â”œâ”€â”€ diff â”‚Â â”‚Â â”œâ”€â”€ parent â”‚Â â”‚Â â”œâ”€â”€ size â”‚Â â”‚Â â””â”€â”€ tar-split.json.gz â”‚Â â””â”€â”€ tmp â””â”€â”€ repositories.json 21 directories, 33 files çœ‹çœ‹ repositories.json ä¸­æ˜¯å†…å®¹ : [root@iZuf685opgs9oyozju9i2bZ docker]# cat image/overlay2/repositories.json | jq . { \"Repositories\": { \"openresty/openresty\": { \"openresty/openresty:1.17.8.2-5-alpine\": \"sha256:1ddc7a18ba0bcc20c61447f391bfff98ac559eea590e7ac59b5b5f588f1f47ed\", \"openresty/openresty@sha256:224ced85b5f8b679a8664a39b69c1b8feb09f8ba4343d834bd5b69433081389e\": \"sha256:1ddc7a18ba0bcc20c61447f391bfff98ac559eea590e7ac59b5b5f588f1f47ed\" }, \"russellgao/openresty\": { \"russellgao/openresty:1.17.8.2-5-alpine\": \"sha256:1ddc7a18ba0bcc20c61447f391bfff98ac559eea590e7ac59b5b5f588f1f47ed\", \"russellgao/openresty@sha256:84f53dc7517e9b6695fc8fd74916a1eb5970a92fc24a984f99bfb81508f3d261\": \"sha256:1ddc7a18ba0bcc20c61447f391bfff98ac559eea590e7ac59b5b5f588f1f47ed\" } } } repositories.json ä¸­è®°å½•äº†è¿™ä¸ªæœºå™¨ä¸Šæ‰€æœ‰çš„é•œåƒï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸¤ä¸ªé•œåƒ openresty/openresty:1.17.8.2-5-alpine å’Œ russellgao/openresty:1.17.8.2-5-alpine ï¼Œä½†å…¶å®åªæœ‰ä¸€ä¸ªé•œåƒï¼Œå› ä¸ºåé¢çš„ imageid æ˜¯ç›¸åŒçš„ï¼Œè¿™ä¸ªå¯ä»¥ docker images éªŒè¯ä¸€ä¸‹ [root@iZuf685opgs9oyozju9i2bZ docker]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE openresty/openresty 1.17.8.2-5-alpine 1ddc7a18ba0b 2 months ago 104MB russellgao/openresty 1.17.8.2-5-alpine 1ddc7a18ba0b 2 months ago 104MB openresty/openresty:1.17.8.2-5-alpine å’Œ russellgao/openresty:1.17.8.2-5-alpine åªæ˜¯é•œåƒ 1ddc7a18ba0b çš„ tag ã€‚ é‚£ä¹ˆ 1ddc7a18ba0b é•œåƒæ˜¯æ€ä¹ˆç»„æˆçš„å‘¢? image/overlay2/ ä¸‹é¢é™¤äº† repositories.json è¿˜æœ‰3ä¸ªç›®å½• distribution,imagedb,layerdbï¼Œä½œç”¨åˆ†åˆ«å¦‚ä¸‹: distribution: ä¸»è¦å’Œé•œåƒä»“åº“çš„äº¤äº’ç›¸å…³ imagedb: ä¿å­˜äº†é•œåƒçš„å…ƒæ•°æ® layerdb: ä¿å­˜äº†é•œåƒlayer(å±‚) çš„æ•°æ® image/overlay2/ ä¿å­˜çš„æ˜¯æ•°æ®çš„é“¾æ¥ï¼ŒçœŸæ­£çš„é•œåƒæ•°æ®æ˜¯å­˜æ”¾åœ¨ overlay2 ç›®å½•ä¸‹ï¼Œå…ˆçœ‹çœ‹ distribution : ","date":"2020-12-09","objectID":"/docker-local-storage/:3:1","tags":["docker","å­˜å‚¨"],"title":"docker åŸç†ä¹‹æœ¬åœ°å­˜å‚¨","uri":"/docker-local-storage/"},{"categories":null,"content":"distribution [root@iZuf685opgs9oyozju9i2bZ docker]# tree image/overlay2/distribution/ image/overlay2/distribution/ â”œâ”€â”€ diffid-by-digest â”‚Â â””â”€â”€ sha256 â”‚Â â”œâ”€â”€ 5682af42731d652bd98d2456ed3da4f0595ed5d9e5b13ac8bb9590bb74f72eb8 â”‚Â â”œâ”€â”€ 7c6cb2b54a9d9d40c4a03dd6615b1c8e791feb5d81464a7702a9bb921f7a73e9 â”‚Â â”œâ”€â”€ aa74dc3450985aee599c181d650da8f8880ca1d6e2bc01a43831ca59b6e2a7b6 â”‚Â â””â”€â”€ df20fa9351a15782c64e6dddb2d4a6f50bf6d3688060a34c4014b0d9a752eb4c â””â”€â”€ v2metadata-by-diffid â””â”€â”€ sha256 â”œâ”€â”€ 1680a9f16b18732726d0656b6d6ff9611a3c4460ca870827b537a87bbe10cc22 â”œâ”€â”€ 50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a â”œâ”€â”€ 8521b614863046bf4bb604e3586feeca8b7ce1372f1d6664a5545e85ad9ca472 â””â”€â”€ 9c572ba82b91e3ac35c7351bdacc6876c67f5d9bc69c5e51e8b2deeafae95e4f 4 directories, 8 files è¯·æ³¨æ„çœ‹ image/overlay2/distribution/diffid-by-digest/sha256 ä¸‹é¢ï¼Œå›è¿‡å¤´å†çœ‹çœ‹ docker pull çš„è¿‡ç¨‹ï¼Œè¿™é‡Œçš„å°±æ˜¯ digestid ï¼Œdocker pull çš„æ—¶å€™ä¹Ÿæ˜¯é€šè¿‡ digestid å®ç°çš„ï¼Œè¿™ä¸ªidå¯¹åº”çš„æ˜¯ docker repository ä¸­çš„ blob idï¼Œåœ¨ docker repository çš„ blobs ç›®å½•ä¸‹å¯ä»¥æ‰¾åˆ°ã€‚ å¯ä»¥æŸ¥çœ‹å…·ä½“çš„æ–‡ä»¶ï¼Œå¦‚ cat image/overlay2/distribution/diffid-by-digest/sha256/5682af42731d652bd98d2456ed3da4f0595ed5d9e5b13ac8bb9590bb74f72eb8 [root@iZuf685opgs9oyozju9i2bZ docker]# cat image/overlay2/distribution/diffid-by-digest/sha256/5682af42731d652bd98d2456ed3da4f0595ed5d9e5b13ac8bb9590bb74f72eb8 sha256:9c572ba82b91e3ac35c7351bdacc6876c67f5d9bc69c5e51e8b2deeafae95e4f ä¸éš¾å‘ç°å®ƒä»¬ä¹‹é—´æ˜¯ç›¸äº’å¼•ç”¨çš„ï¼Œå¯ä»¥å®ç° diffid å’Œ digest çš„ç›¸äº’è½¬æ¢ã€‚ ","date":"2020-12-09","objectID":"/docker-local-storage/:3:2","tags":["docker","å­˜å‚¨"],"title":"docker åŸç†ä¹‹æœ¬åœ°å­˜å‚¨","uri":"/docker-local-storage/"},{"categories":null,"content":"imagedb [root@iZuf685opgs9oyozju9i2bZ docker]# tree image/overlay2/imagedb/ image/overlay2/imagedb/ â”œâ”€â”€ content â”‚Â â””â”€â”€ sha256 â”‚Â â””â”€â”€ 1ddc7a18ba0bcc20c61447f391bfff98ac559eea590e7ac59b5b5f588f1f47ed â””â”€â”€ metadata â””â”€â”€ sha256 â””â”€â”€ 1ddc7a18ba0bcc20c61447f391bfff98ac559eea590e7ac59b5b5f588f1f47ed â””â”€â”€ lastUpdated 5 directories, 2 files å¯ä»¥çœ‹åˆ° imagedb æ˜¯ä»¥é•œåƒä¸ºå•ä½è¿›è¡Œå­˜å‚¨çš„ï¼Œçœ‹ä¸€ä¸‹ content ä¸‹é¢çš„å…·ä½“å†…å®¹ : [root@iZuf685opgs9oyozju9i2bZ docker]# cat image/overlay2/imagedb/content/sha256/1ddc7a18ba0bcc20c61447f391bfff98ac559eea590e7ac59b5b5f588f1f47ed | jq . { \"architecture\": \"amd64\", \"config\": { \"Hostname\": \"\", \"Domainname\": \"\", \"User\": \"\", \"AttachStdin\": false, \"AttachStdout\": false, \"AttachStderr\": false, \"Tty\": false, \"OpenStdin\": false, \"StdinOnce\": false, \"Env\": [ \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/openresty/luajit/bin:/usr/local/openresty/nginx/sbin:/usr/local/openresty/bin\" ], \"Cmd\": [ \"/usr/local/openresty/bin/openresty\", \"-g\", \"daemon off;\" ], \"ArgsEscaped\": true, \"Image\": \"sha256:0b827067ad09ab8a0b9a73a45f5b1c408b84db1ca6883a4c544078ed43b8b5e3\", \"Volumes\": null, \"WorkingDir\": \"\", \"Entrypoint\": null, \"OnBuild\": null, \"Labels\": { \"maintainer\": \"Evan Wies \u003cevan@neomantra.net\u003e\", \"resty_add_package_builddeps\": \"\", \"resty_add_package_rundeps\": \"\", \"resty_config_deps\": \"--with-pcre --with-cc-opt='-DNGX_LUA_ABORT_AT_PANIC -I/usr/local/openresty/pcre/include -I/usr/local/openresty/openssl/include' --with-ld-opt='-L/usr/local/openresty/pcre/lib -L/usr/local/openresty/openssl/lib -Wl,-rpath,/usr/local/openresty/pcre/lib:/usr/local/openresty/openssl/lib' \", \"resty_config_options\": \" --with-compat --with-file-aio --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_geoip_module=dynamic --with-http_gunzip_module --with-http_gzip_static_module --with-http_image_filter_module=dynamic --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_xslt_module=dynamic --with-ipv6 --with-mail --with-mail_ssl_module --with-md5-asm --with-pcre-jit --with-sha1-asm --with-stream --with-stream_ssl_module --with-threads \", \"resty_config_options_more\": \"\", \"resty_eval_post_make\": \"\", \"resty_eval_pre_configure\": \"\", \"resty_image_base\": \"alpine\", \"resty_image_tag\": \"3.12\", \"resty_openssl_patch_version\": \"1.1.1f\", \"resty_openssl_url_base\": \"https://www.openssl.org/source\", \"resty_openssl_version\": \"1.1.1g\", \"resty_pcre_version\": \"8.44\", \"resty_version\": \"1.17.8.2\" }, \"StopSignal\": \"SIGQUIT\" }, \"container\": \"0ae35046dd1afef0f1f525360939abc524dbd469a92470c5836dfbb7dc666923\", \"container_config\": { \"Hostname\": \"0ae35046dd1a\", \"Domainname\": \"\", \"User\": \"\", \"AttachStdin\": false, \"AttachStdout\": false, \"AttachStderr\": false, \"Tty\": false, \"OpenStdin\": false, \"StdinOnce\": false, \"Env\": [ \"PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/openresty/luajit/bin:/usr/local/openresty/nginx/sbin:/usr/local/openresty/bin\" ], \"Cmd\": [ \"/bin/sh\", \"-c\", \"#(nop) \", \"STOPSIGNAL SIGQUIT\" ], \"ArgsEscaped\": true, \"Image\": \"sha256:0b827067ad09ab8a0b9a73a45f5b1c408b84db1ca6883a4c544078ed43b8b5e3\", \"Volumes\": null, \"WorkingDir\": \"\", \"Entrypoint\": null, \"OnBuild\": null, \"Labels\": { \"maintainer\": \"Evan Wies \u003cevan@neomantra.net\u003e\", \"resty_add_package_builddeps\": \"\", \"resty_add_package_rundeps\": \"\", \"resty_config_deps\": \"--with-pcre --with-cc-opt='-DNGX_LUA_ABORT_AT_PANIC -I/usr/local/openresty/pcre/include -I/usr/local/openresty/openssl/include' --with-ld-opt='-L/usr/local/openresty/pcre/lib -L/usr/local/openresty/openssl/lib -Wl,-rpath,/usr/local/openresty/pcre/lib:/usr/local/openresty/openssl/lib' \", \"resty_config_options\": \" --with-compat --with-file-aio --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_flv_module --with-http_geoip_module=dynamic --","date":"2020-12-09","objectID":"/docker-local-storage/:3:3","tags":["docker","å­˜å‚¨"],"title":"docker åŸç†ä¹‹æœ¬åœ°å­˜å‚¨","uri":"/docker-local-storage/"},{"categories":null,"content":"layerdb å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œimagedb å­˜çš„æ˜¯å…ƒæ•°æ®ï¼Œé‚£ä¹ˆ layerdb åº”è¯¥å­˜çš„æ˜¯ layer ç›¸å…³ä¿¡æ¯?å…ˆçœ‹çœ‹è¿™ä¸ªç›®å½•ä¸‹é¢æœ‰ä»€ä¹ˆ: [root@iZuf685opgs9oyozju9i2bZ docker]# ll image/overlay2/layerdb/ æ€»ç”¨é‡ 12 drwxr-xr-x 3 root root 4096 12æœˆ 2 09:25 mounts drwxr-xr-x 6 root root 4096 11æœˆ 11 13:32 sha256 drwxr-xr-x 2 root root 4096 11æœˆ 11 13:32 tmp tmp tmp æ˜¯ä¸€ä¸ªä¸´æ—¶ç›®å½• sha256 sha256: å…ˆçœ‹çœ‹è¿™ä¸ªä¸‹é¢æœ‰ä»€ä¹ˆ ll image/overlay2/layerdb/sha256/ [root@iZuf685opgs9oyozju9i2bZ docker]# ll image/overlay2/layerdb/sha256/ æ€»ç”¨é‡ 16 drwx------ 2 root root 4096 11æœˆ 11 13:32 228fb92e31891f472e9857ee11d13c404ff7c88e808b05ce4ebdc80d785d71f3 drwx------ 2 root root 4096 11æœˆ 11 13:31 50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a drwx------ 2 root root 4096 11æœˆ 11 13:32 5f72760956a669e4c9b33aa3f2f04baa84b0f4cf1e11676049981bafcbba74da drwx------ 2 root root 4096 11æœˆ 11 13:32 fe267088885017d5e9a4621e68617a7f35e58dc2d0d747927882da21059854e3 å’‹ä¸€çœ‹è¿™é‡Œå’Œ rootfs ä¸­çš„ diff_id å¹¶ä¸ç›¸åŒï¼Œåªæœ‰ä¸€å±‚æ˜¯ä¸€æ ·çš„(åªæœ‰base layeræ˜¯ç›¸åŒ)ã€‚è¿™é‡Œçš„æ˜¯ chain_id ï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ chain_idå‘¢ï¼Ÿ diff_id: æè¿°çš„æ˜¯æŸä¸€å±‚çš„å˜åŒ– chain_id: æè¿°çš„æ˜¯ä¸€ç³»åˆ—å˜åŒ– diff_id å’Œ chain_id çš„è®¡ç®—å…¬å¼ä¸º: ChainID(A) = DiffID(A) ChainID(A | B) = Digest(ChainID(A) + \" \" + DiffID(B)) ChainID(A | B | C) = Digest(ChainID(A | B) + \" \" + DiffID(C)) æ˜¯ä¸æ˜¯æœ‰ç‚¹ç»•ï¼Œå›åˆ°æˆ‘ä»¬çš„ä¾‹å­çœ‹çœ‹ï¼š rootfs ä¸­çš„ diff_id ä¸º: \"diff_ids\": [ \"sha256:50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a\", \"sha256:9c572ba82b91e3ac35c7351bdacc6876c67f5d9bc69c5e51e8b2deeafae95e4f\", \"sha256:1680a9f16b18732726d0656b6d6ff9611a3c4460ca870827b537a87bbe10cc22\", \"sha256:8521b614863046bf4bb604e3586feeca8b7ce1372f1d6664a5545e85ad9ca472\" ] chain_id ä¸º: drwx------ 2 root root 4096 11æœˆ 11 13:32 228fb92e31891f472e9857ee11d13c404ff7c88e808b05ce4ebdc80d785d71f3 drwx------ 2 root root 4096 11æœˆ 11 13:31 50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a drwx------ 2 root root 4096 11æœˆ 11 13:32 5f72760956a669e4c9b33aa3f2f04baa84b0f4cf1e11676049981bafcbba74da drwx------ 2 root root 4096 11æœˆ 11 13:32 fe267088885017d5e9a4621e68617a7f35e58dc2d0d747927882da21059854e3 æ ¹æ®ä¸Šé¢çš„å…¬å¼ base layer çš„ diff_id å’Œ chain_id æ˜¯ç›¸åŒçš„: 50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a -\u003e 50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a åœ¨ç»§ç»­çœ‹çœ‹ä¸‹é¢çš„ç®—æ³• [root@iZuf685opgs9oyozju9i2bZ docker]# echo -n \"sha256:50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a sha256:9c572ba82b91e3ac35c7351bdacc6876c67f5d9bc69c5e51e8b2deeafae95e4f\" | sha256sum fe267088885017d5e9a4621e68617a7f35e58dc2d0d747927882da21059854e3 - [root@iZuf685opgs9oyozju9i2bZ docker]# [root@iZuf685opgs9oyozju9i2bZ docker]# echo -n \"sha256:fe267088885017d5e9a4621e68617a7f35e58dc2d0d747927882da21059854e3 sha256:1680a9f16b18732726d0656b6d6ff9611a3c4460ca870827b537a87bbe10cc22\" | sha256sum 5f72760956a669e4c9b33aa3f2f04baa84b0f4cf1e11676049981bafcbba74da - [root@iZuf685opgs9oyozju9i2bZ docker]# echo -n \"sha256:5f72760956a669e4c9b33aa3f2f04baa84b0f4cf1e11676049981bafcbba74da sha256:8521b614863046bf4bb604e3586feeca8b7ce1372f1d6664a5545e85ad9ca472\" | sha256sum 228fb92e31891f472e9857ee11d13c404ff7c88e808b05ce4ebdc80d785d71f3 - è¿™ä¹ˆä¸€æ¼”ç®—å°±äº‹æƒ…å°±å˜çš„æ¸…æ™°èµ·æ¥äº†: 50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a -\u003e 50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a 9c572ba82b91e3ac35c7351bdacc6876c67f5d9bc69c5e51e8b2deeafae95e4f -\u003e fe267088885017d5e9a4621e68617a7f35e58dc2d0d747927882da21059854e3 1680a9f16b18732726d0656b6d6ff9611a3c4460ca870827b537a87bbe10cc22 -\u003e 5f72760956a669e4c9b33aa3f2f04baa84b0f4cf1e11676049981bafcbba74da 8521b614863046bf4bb604e3586feeca8b7ce1372f1d6664a5545e85ad9ca472 -\u003e 228fb92e31891f472e9857ee11d13c404ff7c88e808b05ce4ebdc80d785d71f3 ç†æ¸…å®ƒä»¬ä¹‹é—´çš„å…³ç³»å°±æ¯”è¾ƒå¥½åŠäº†ï¼Œåœ¨çœ‹çœ‹ chain_id ç›®å½•ä¸‹éƒ½æœ‰ä»€ä¹ˆ: [root@iZuf685opgs9oyozju9i2bZ docker]# tree image/overlay2/layerdb/sha256/ image/overlay2/layerdb/sha256/ â”œâ”€â”€ 228fb92e31891f472e9857ee11d13c404ff7c88e808b05ce4ebdc80d785d71f3 â”‚Â â”œâ”€â”€ cache-id â”‚Â â”œâ”€â”€ diff â”‚Â â”œâ”€â”€ parent â”‚Â â”œâ”€â”€ size â”‚Â â””â”€â”€ tar-split.json.gz â”œâ”€â”€ 50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a â”‚Â â”œâ”€â”€ cache-id â”‚Â â”œâ”€â”€ diff â”‚Â â”œâ”€â”€ size â”‚Â â””â”€â”€ tar-split.json.gz â”œâ”€â”€ 5f72760956a669e4c9b33aa3f2f04baa84b","date":"2020-12-09","objectID":"/docker-local-storage/:3:4","tags":["docker","å­˜å‚¨"],"title":"docker åŸç†ä¹‹æœ¬åœ°å­˜å‚¨","uri":"/docker-local-storage/"},{"categories":null,"content":"overlay2 overlay2 ç›®å½•å­˜æ”¾çš„æ¯ä¸€å±‚çš„å…·ä½“æ•°æ®ï¼Œå…ˆçœ‹çœ‹ç›®å½•ç»“æ„: [root@iZuf685opgs9oyozju9i2bZ docker]# tree overlay2/ -L 2 [root@iZuf685opgs9oyozju9i2bZ docker]# tree -L 2 overlay2/ overlay2/ â”œâ”€â”€ 00b65b9c288df8c0ae7cdacba531a7dc5cb006e6c768e19ee36055717b782acc â”‚Â â”œâ”€â”€ committed â”‚Â â”œâ”€â”€ diff â”‚Â â”œâ”€â”€ link â”‚Â â”œâ”€â”€ lower â”‚Â â””â”€â”€ work â”œâ”€â”€ 5da215c4f218cbb1d9825fa111c21bf381dc35a9e6c7c6cd5c3ea952316031e4 â”‚Â â”œâ”€â”€ committed â”‚Â â”œâ”€â”€ diff â”‚Â â”œâ”€â”€ link â”‚Â â”œâ”€â”€ lower â”‚Â â””â”€â”€ work â”œâ”€â”€ 8cbfb8b74c887e780747c8e6f4b3b9223a513ff6d69770bac16abb76da4e314f â”‚Â â”œâ”€â”€ committed â”‚Â â”œâ”€â”€ diff â”‚Â â””â”€â”€ link â”œâ”€â”€ b04b728c94b5a269e9d102329c930e3781212717e830e1941e1008088d823cdc â”‚Â â”œâ”€â”€ diff â”‚Â â”œâ”€â”€ link â”‚Â â”œâ”€â”€ lower â”‚Â â”œâ”€â”€ merged â”‚Â â””â”€â”€ work â”œâ”€â”€ b04b728c94b5a269e9d102329c930e3781212717e830e1941e1008088d823cdc-init â”‚Â â”œâ”€â”€ committed â”‚Â â”œâ”€â”€ diff â”‚Â â”œâ”€â”€ link â”‚Â â”œâ”€â”€ lower â”‚Â â””â”€â”€ work â”œâ”€â”€ f1cf8b173467c98e08f3d276d7ccd8f9892c7c71dec2c4b335c39c6f175ae744 â”‚Â â”œâ”€â”€ committed â”‚Â â”œâ”€â”€ diff â”‚Â â”œâ”€â”€ link â”‚Â â”œâ”€â”€ lower â”‚Â â””â”€â”€ work â””â”€â”€ l â”œâ”€â”€ 2NFRHNZBFYCUAPMTFCKUR5R4DS -\u003e ../b04b728c94b5a269e9d102329c930e3781212717e830e1941e1008088d823cdc/diff â”œâ”€â”€ 33RV26M4VMX3ZUISOG26USXBKR -\u003e ../f1cf8b173467c98e08f3d276d7ccd8f9892c7c71dec2c4b335c39c6f175ae744/diff â”œâ”€â”€ BGEYC7V6ULKFOOIITWCEKITQEU -\u003e ../b04b728c94b5a269e9d102329c930e3781212717e830e1941e1008088d823cdc-init/diff â”œâ”€â”€ HG76ICE67NTXFL7AYXCMI3EK4Y -\u003e ../00b65b9c288df8c0ae7cdacba531a7dc5cb006e6c768e19ee36055717b782acc/diff â”œâ”€â”€ L5XCYQVZ6DOSLJNP6HXCZQZ7A5 -\u003e ../5da215c4f218cbb1d9825fa111c21bf381dc35a9e6c7c6cd5c3ea952316031e4/diff â””â”€â”€ MUHXHRXFSGNCBKQ2AUXDFOUDLF -\u003e ../8cbfb8b74c887e780747c8e6f4b3b9223a513ff6d69770bac16abb76da4e314f/diff 25 directories, 16 files å¯ä»¥çœ‹åˆ° overlay2 ä¸€çº§ç›®å½•ä¸‹æœ‰ä¸ªç‰¹æ®Šç›®å½• l , l ä¸‹æ˜¯å„ä¸ªlayer è½¯é“¾æ¥ï¼Œé˜²æ­¢mount å‘½ä»¤å¤ªé•¿è€Œå‘ç”Ÿé”™è¯¯ï¼Œæ‰€ä»¥å°±ç”¨çŸ­é“¾æ¥äº†ã€‚ ç»†å¿ƒçš„ä½ ä¸€å®šå‘ç°äº†è¿™ä¹ˆå‡ ä¸ªé—®é¢˜: è¿™ä¸ªé•œåƒåªæœ‰ 4 ä¸ªå±‚ï¼Œè¿™é‡Œä¸ºå•¥ä¼šæœ‰ 6 ä¸ªå±‚(ç›®å½•) ä¸ºå•¥å…·ä½“layer ä¸‹çš„ç›®å½•/æ–‡ä»¶ç»“æ„ä¸ä¸€æ · æœ‰çš„ layer ä¸ºå•¥å¸¦äº† -init åç¼€ï¼Œæœ‰çš„æ²¡æœ‰ æœ‰ 6 ä¸ªlayer å±‚æ˜¯å› ä¸ºæˆ‘è¿™é‡Œå¯åŠ¨äº†ä¸€ä¸ªå®¹å™¨ï¼Œä¼šç”Ÿæˆä¸¤ä¸ªå±‚(è¯»å†™å±‚å’Œè¿™ä¸ªé•œåƒmergedä¹‹åçš„åªè¯»å±‚)ï¼Œåˆ é™¤å®¹å™¨ä¹‹åçœ‹çœ‹: [root@iZuf685opgs9oyozju9i2bZ docker]# docker rm -f openresty-app-1 openresty-app-1 [root@iZuf685opgs9oyozju9i2bZ docker]# ll overlay2/ æ€»ç”¨é‡ 20 drwx------ 4 root root 4096 11æœˆ 11 13:32 00b65b9c288df8c0ae7cdacba531a7dc5cb006e6c768e19ee36055717b782acc drwx------ 4 root root 4096 11æœˆ 11 13:48 5da215c4f218cbb1d9825fa111c21bf381dc35a9e6c7c6cd5c3ea952316031e4 drwx------ 3 root root 4096 11æœˆ 11 13:32 8cbfb8b74c887e780747c8e6f4b3b9223a513ff6d69770bac16abb76da4e314f drwx------ 4 root root 4096 11æœˆ 11 13:32 f1cf8b173467c98e08f3d276d7ccd8f9892c7c71dec2c4b335c39c6f175ae744 drwx------ 2 root root 4096 12æœˆ 12 13:29 l è¿™ä¸‹å’Œä¹‹å‰è®¨è®ºå¯¹ä¸Šäº†ï¼Œ å’Œ cache-id ä¸­çš„å†…å®¹ä¸€ä¸€å¯¹åº” [root@iZuf685opgs9oyozju9i2bZ docker]# ll image/overlay2/layerdb/sha256/*/cache-id -rw-r--r-- 1 root root 64 11æœˆ 11 13:32 image/overlay2/layerdb/sha256/228fb92e31891f472e9857ee11d13c404ff7c88e808b05ce4ebdc80d785d71f3/cache-id -rw-r--r-- 1 root root 64 11æœˆ 11 13:31 image/overlay2/layerdb/sha256/50644c29ef5a27c9a40c393a73ece2479de78325cae7d762ef3cdc19bf42dd0a/cache-id -rw-r--r-- 1 root root 64 11æœˆ 11 13:32 image/overlay2/layerdb/sha256/5f72760956a669e4c9b33aa3f2f04baa84b0f4cf1e11676049981bafcbba74da/cache-id -rw-r--r-- 1 root root 64 11æœˆ 11 13:32 image/overlay2/layerdb/sha256/fe267088885017d5e9a4621e68617a7f35e58dc2d0d747927882da21059854e3/cache-id åœ¨çœ‹çœ‹å…·ä½“é•œåƒ layer å±‚çš„å†…å®¹: diff: è¿™ä¸ªå±‚æ‰€åšçš„æ”¹åŠ¨ï¼Œå¦‚é€šè¿‡ ADDã€RUN ç­‰æŒ‡ä»¤å¯¹åšæ–‡ä»¶ç³»ç»Ÿåšå‡ºçš„æ”¹å˜éƒ½åœ¨è¿™é‡Œäº†ã€‚ link: è‡ªå·±çš„linkå€¼ï¼Œåœ¨åˆšåˆšçš„ overlay2/l ç›®å½•ä¸‹å¯ä»¥çœ‹çš„åˆ°ã€‚ [root@iZuf685opgs9oyozju9i2bZ docker]# cat overlay2/00b65b9c288df8c0ae7cdacba531a7dc5cb006e6c768e19ee36055717b782acc/link HG76ICE67NTXFL7AYXCMI3EK4Y lower: è¯¥å±‚æ‰€ä¾èµ–çš„å±‚çš„æ‰€æœ‰linkï¼Œbase layer ä¸ä¾èµ–ä»»ä½•å±‚ï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸ä¼šæœ‰ lower è¿™ä¸ªæ–‡ä»¶ï¼Œæœ€åä¸€å±‚ä¾èµ–ä¹‹å‰çš„æ‰€æœ‰å±‚ï¼Œå¦‚: [root@iZuf685opgs9oyozju9i2bZ docker]# cat overlay2/5da215c4f218cbb1d9825fa111c21bf381dc35a9e6c7c6cd5c3ea952316031e4/lower l/HG76ICE67NTXFL7AYXCMI3EK4Y:l/33RV26M4VMX3ZUISOG26USXBKR:l/MUHXHRXFSGNCBKQ2AUXDFOUDLF è¿™ä¸ªé•œåƒçš„æœ€åä¸€å±‚ä¾èµ–å‰é¢çš„å±‚ merged:å®¹å™¨çš„æœ€ç»ˆè§†å›¾ï¼Œmerge äº† é•œåƒå±‚åŠ è¯»å†™å±‚ å¯åŠ¨å®¹å™¨æ–°å»ºçš„ä¸¤å±‚åœ¨ containers ä¸­è¯¦ç»†è¯´ã€‚ ","date":"2020-12-09","objectID":"/docker-local-storage/:3:5","tags":["docker","å­˜å‚¨"],"title":"docker åŸç†ä¹‹æœ¬åœ°å­˜å‚¨","uri":"/docker-local-storage/"},{"categories":null,"content":"containers æˆ‘ä»¬ä¸€ç›´è¯´ docker é•œåƒæ˜¯åˆ†å±‚çš„ï¼Œ å®¹å™¨ = é•œåƒ + è¯»å†™å±‚ ï¼Œå¦‚æœè¿˜æ²¡æœ‰ä»€ä¹ˆæ„Ÿè§‰çš„è¯ä¸å¦¨å†æ¥çœ‹ä¸€ä¸ªå›¾: å¯ä»¥çœ‹åˆ°å®¹å™¨æ˜¯ä¾èµ–äºé•œåƒï¼Œå¯åŠ¨å®¹å™¨æ—¶ä¼šå…ˆæŠŠé•œåƒçš„å„ä¸ª layer è”åˆæŒ‚è½½æˆä¸€ä¸ªç»Ÿä¸€çš„è§†å›¾(åªè¯»å±‚)ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ overlay2 ç›®å½•ä¸­çœ‹åˆ°çš„ b04b728c94b5a269e9d102329c930e3781212717e830e1941e1008088d823cdc-init ç›®å½•ï¼Œ å»æ‰ -init å°±æ˜¯å¯¹åº”çš„è¯»å†™å±‚ã€‚ çœ‹çœ‹ containers ç›®å½•ä¸‹éƒ½æœ‰ä»€ä¹ˆ: [root@iZuf685opgs9oyozju9i2bZ docker]# tree -L 2 containers/ containers/ â””â”€â”€ 4ec800c3ec10654a6ea2b2317ac198514748464a217ef63bb58ef67874a79ae0 â”œâ”€â”€ 4ec800c3ec10654a6ea2b2317ac198514748464a217ef63bb58ef67874a79ae0-json.log â”œâ”€â”€ checkpoints â”œâ”€â”€ config.v2.json â”œâ”€â”€ hostconfig.json â”œâ”€â”€ hostname â”œâ”€â”€ hosts â”œâ”€â”€ mounts â”œâ”€â”€ resolv.conf â””â”€â”€ resolv.conf.hash 3 directories, 7 files [root@iZuf685opgs9oyozju9i2bZ docker]# docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 4ec800c3ec10 russellgao/openresty:1.17.8.2-5-alpine \"/usr/local/openrestâ€¦\" About an hour ago Up About an hour 0.0.0.0:80-\u003e80/tcp, 0.0.0.0:443-\u003e443/tcp openresty-app-1 å¯ä»¥çœ‹åˆ°è¿™ä¸ªä¸‹é¢æ˜¯ä»¥å®¹å™¨ä¸ºå•ä½è¿›è¡Œå­˜æ”¾çš„ï¼Œä¿å­˜äº†æ¯ä¸ªå®¹å™¨çš„è¯¦ç»†é…ç½®ï¼Œåœ¨å®¹å™¨é‡Œçœ‹åˆ°çš„hostname,/etc/hosts,dns ç­‰å„ç§é…ç½®åœ¨è¿™é‡Œéƒ½å¯ä»¥æ‰¾å¾—åˆ°ï¼Œè¿™é‡Œå°±ä¸å±•å¼€çœ‹æ¯ä¸ªå…·ä½“æ–‡ä»¶äº†ï¼Œæœ‰å…´è¶£è€…å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ã€‚ å€¼å¾—ä¸€æçš„æ˜¯ï¼Œé€šè¿‡ docker inspect containername å¾—åˆ°çš„å†…å®¹åœ¨ containers/xxx/config.v2.json éƒ½å¯ä»¥æ‰¾çš„åˆ°å“¦ï¼Œå¯ä»¥æŸ¥çœ‹å®ƒä»¬çš„è¾“å‡ºï¼Œä¼šå‘ç°å‡ºå¥‡çš„ç›¸ä¼¼å“¦ã€‚ è¯·æ³¨æ„å¥½ç©çš„äº‹æƒ…æ¥äº† æˆ‘ä»¬è¯´åˆ° å®¹å™¨=é•œåƒ+è¯»å†™å±‚ ï¼Œé‚£æ˜¯ä¸æ˜¯ä»¥ä¸ºç€æˆ‘ä»¬åœ¨è¯»å†™å±‚åšä¿®æ”¹ï¼Œå®¹å™¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåä¹‹åœ¨å®¹å™¨ä¸­åšçš„ä¿®æ”¹ï¼Œåœ¨è¯»å†™å±‚ä¹Ÿåº”è¯¥èƒ½çœ‹åˆ°æ‰å¯¹ã€‚ è¯»å†™å±‚æ—¶å„ä¸´æ—¶çš„ layer å±‚(ä¸´æ—¶ç›®å½•) ï¼Œå½“å®¹å™¨è¢«åˆ é™¤æ—¶ï¼Œè¿™ä¸ª layer ä¹Ÿä¼šéšä¹‹è¢«åˆ é™¤ã€‚ åšäº†å®éªŒçœ‹çœ‹: æœ€åˆè¯»å†™å±‚çš„å†…å®¹å’Œå®¹å™¨çš„æ ¹ç›®å½•å¦‚ä¸‹: [root@iZuf685opgs9oyozju9i2bZ docker]# ll overlay2/b04b728c94b5a269e9d102329c930e3781212717e830e1941e1008088d823cdc/diff/ æ€»ç”¨é‡ 16 drwxr-xr-x 3 root root 4096 9æœˆ 19 00:25 run drwxr-xr-x 3 root root 4096 9æœˆ 19 00:25 usr [root@iZuf685opgs9oyozju9i2bZ docker]# [root@iZuf685opgs9oyozju9i2bZ docker]# docker exec openresty-app-1 ls -l / total 64 drwxr-xr-x 1 root root 4096 Sep 18 16:25 bin drwxr-xr-x 5 root root 340 Dec 12 05:29 dev drwxr-xr-x 1 root root 4096 Dec 12 05:29 etc drwxr-xr-x 2 root root 4096 May 29 2020 home drwxr-xr-x 1 root root 4096 Sep 18 16:25 lib drwxr-xr-x 5 root root 4096 May 29 2020 media drwxr-xr-x 2 root root 4096 May 29 2020 mnt drwxr-xr-x 2 root root 4096 May 29 2020 opt dr-xr-xr-x 114 root root 0 Dec 12 05:29 proc drwx------ 2 root root 4096 May 29 2020 root drwxr-xr-x 1 root root 4096 Sep 18 16:25 run drwxr-xr-x 2 root root 4096 May 29 2020 sbin drwxr-xr-x 2 root root 4096 May 29 2020 srv dr-xr-xr-x 13 root root 0 Nov 11 00:49 sys drwxrwxrwt 1 root root 4096 Sep 18 16:25 tmp drwxr-xr-x 1 root root 4096 Sep 18 16:25 usr drwxr-xr-x 1 root root 4096 May 29 2020 var è¿›å…¥åˆ°å®¹å™¨å¹¶åœ¨æ ¹ç›®å½•ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶: [root@iZuf685opgs9oyozju9i2bZ docker]# docker exec -it openresty-app-1 sh / # echo \"æµ‹è¯•å®¹å™¨çš„è¯»å†™å±‚-20201209\" \u003e /test-layer.20201209.txt è¯»å†™å±‚çœ‹çœ‹ä»€ä¹ˆæƒ…å†µ: [root@iZuf685opgs9oyozju9i2bZ docker]# ll overlay2/b04b728c94b5a269e9d102329c930e3781212717e830e1941e1008088d823cdc/diff/ æ€»ç”¨é‡ 24 drwx------ 2 root root 4096 12æœˆ 12 15:22 root drwxr-xr-x 3 root root 4096 9æœˆ 19 00:25 run -rw-r--r-- 1 root root 34 12æœˆ 12 15:22 test-layer.20201209.txt drwxr-xr-x 3 root root 4096 9æœˆ 19 00:25 usr [root@iZuf685opgs9oyozju9i2bZ docker]# cat overlay2/b04b728c94b5a269e9d102329c930e3781212717e830e1941e1008088d823cdc/diff/test-layer.20201209.txt æµ‹è¯•å®¹å™¨çš„è¯»å†™å±‚-20201209 å¯ä»¥çœ‹åˆ°åœ¨å®¹å™¨ä¸­æ–°å»ºçš„æ–‡ä»¶ç¡®å®åœ¨è¯»å†™å±‚ä¸­å¯ä»¥çœ‹åˆ°ï¼Œé‚£ä¹ˆåè¿‡æ¥å†è¯•è¯• åœ¨è¯»å†™å±‚æ–°å»ºä¸€ä¸ªæ–‡ä»¶: [root@iZuf685opgs9oyozju9i2bZ docker]# echo \"æµ‹è¯•å®¹å™¨çš„è¯»å†™å±‚-20201209-abcdefg\" \u003e overlay2/b04b728c94b5a269e9d102329c930e3781212717e830e1941e1008088d823cdc/diff/test-layer.20201209-abcdefg.txt [root@iZuf685opgs9oyozju9i2bZ docker]# ll overlay2/b04b728c94b5a269e9d102329c930e3781212717e830e1941e1008088d823cdc/diff/ æ€»ç”¨é‡ 28 drwx------ 2 root root 4096 12æœˆ 12 15:22 root drwxr-xr-x 3 root root 4096 9æœˆ 19 00:25 run -rw-r--r-- 1 root root 42 12æœˆ 12 15:26 test-layer.20201209-abcdefg.txt -rw-r--r-- 1 root root 34 12æœˆ 12 15:22 test-layer.20201209.txt drwxr-xr-x 3 root root 4096 9æœˆ 19 00:25 usr è¿›åˆ°å®¹å™¨ä¸­çœ‹çœ‹: [root@iZuf685opgs9oyozju9i2bZ docker]# docker exec -it openresty-app-1 sh / # ls -l total 72 drwxr-xr-x 1 root root 4096 Sep 18 16:25 bin drwxr-xr-x 5 root root 340 Dec 12 05:29 dev drwxr-xr-x 1 root root 4096 Dec 12 05:29 etc drwxr-xr-x 2 root root 4096 May 29 2020 home drwxr-xr-x 1 root root 4096 Sep 18 16:25 lib drwxr-xr-x 5 root root 4096 May 2","date":"2020-12-09","objectID":"/docker-local-storage/:3:6","tags":["docker","å­˜å‚¨"],"title":"docker åŸç†ä¹‹æœ¬åœ°å­˜å‚¨","uri":"/docker-local-storage/"},{"categories":null,"content":"æ€»ç»“ è¿™ç¯‡æ–‡ç« å¾ˆé•¿ï¼Œéš¾å…è¡¨è¾¾é€»è¾‘ä¸Šå‡ºç°æ··ä¹±ï¼Œæ„Ÿè°¢èƒ½è€å¿ƒçœ‹å®Œçš„å°ä¼™ä¼´ï¼Œå¦‚æœæœ‰ä¸å¯¹ä¹‹å¤„æ¬¢è¿æ‰¹è¯„æŒ‡æ­£ã€‚ image/overlay2 distribution: å’Œé•œåƒåˆ†å‘ç›¸å…³ï¼Œè®°å½•äº†diffid ä¸ digest ä¹‹é—´çš„å…³ç³»ã€‚ imagedb: è®°å½•äº†é•œåƒçš„å…ƒä¿¡æ¯ï¼Œå…¶ä¸­contentä¸­çš„å†…å®¹å’Œdocker inspect image ç»“æœåŸºæœ¬ä¸€ç›´ã€‚ layerdb: è®°å½•äº† layer çš„å…ƒä¿¡æ¯ï¼Œå¦‚çœŸæ­£çš„ layeridï¼Œ size ç­‰ä¿¡æ¯ã€‚ repositories.json: è®°å½•è¿™ä¸ªä¸»æœºä¸Šæ‰€æœ‰çš„é•œåƒã€‚ overlay2: é•œåƒçš„å…·ä½“layer å±‚çš„å†…å®¹ï¼ŒåŒ…æ‹¬é•œåƒçš„åªè¯»å±‚å’Œå®¹å™¨çš„è¯»å†™å±‚ã€‚å…¶ä¸­è¯»å†™å±‚æ˜¯ä¸´æ—¶å±‚ï¼Œå½“å®¹å™¨åˆ é™¤æ—¶ä¹Ÿä¼šéšä¹‹åˆ é™¤ï¼Œåœ¨è¿™ä¸€å±‚çš„ diff ç›®å½•ä¸‹åšä¿®æ”¹ï¼Œå®¹å™¨å†…ä¹Ÿä¼šéšä¹‹çœ‹åˆ°ã€‚ containers: å®¹å™¨çš„é…ç½®ä¿¡æ¯ï¼Œé€šè¿‡ docker inspect containerid å¾—åˆ°çš„ç»“æœå’Œ containers/xxx ä¸‹çš„å†…å®¹åŸºæœ¬ä¸€ç›´ã€‚ ","date":"2020-12-09","objectID":"/docker-local-storage/:4:0","tags":["docker","å­˜å‚¨"],"title":"docker åŸç†ä¹‹æœ¬åœ°å­˜å‚¨","uri":"/docker-local-storage/"},{"categories":null,"content":"å‚è€ƒ https://segmentfault.com/a/1190000017579626 ","date":"2020-12-09","objectID":"/docker-local-storage/:5:0","tags":["docker","å­˜å‚¨"],"title":"docker åŸç†ä¹‹æœ¬åœ°å­˜å‚¨","uri":"/docker-local-storage/"},{"categories":null,"content":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","date":"2020-12-07","objectID":"/python-iter/","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python-iter/"},{"categories":null,"content":"å¯¼è¯» è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº† python å½“ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨ï¼Œåœ¨æ¶‰åŠåˆ°å¤§æ•°æ®é‡çš„åœºæ™¯åº”è¯¥è€ƒè™‘ä½¿ç”¨è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨ã€‚ ","date":"2020-12-07","objectID":"/python-iter/:1:0","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python-iter/"},{"categories":null,"content":"å¯è¿­ä»£å¯¹è±¡ å¦‚æœä¸€ä¸ªå¯¹è±¡å®ç°äº† __iter__ æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç§°å®ƒæ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰å®ç° __iter__ è€Œå®ç°äº† __getitem__ æ–¹æ³•ï¼Œå¹¶ä¸”å…¶å‚æ•°æ˜¯ä»0å¼€å§‹ç´¢å¼•çš„ï¼Œè¿™ç§å¯¹è±¡ä¹Ÿæ˜¯å¯è¿­ä»£çš„ï¼Œæ¯”å¦‚è¯´åºåˆ—ã€‚ ä½¿ç”¨ iter å†…ç½®å‡½æ•°å¯ä»¥è·å–è¿­ä»£å™¨çš„å¯¹è±¡ï¼Œå½“è§£é‡Šå™¨éœ€è¦è¿­ä»£å¯¹è±¡æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ item(x) ï¼š å¦‚æœå¯¹è±¡å®ç°äº† __iter__ æ–¹æ³•ï¼Œè·å–ä¸€ä¸ªè¿­ä»£å™¨ å¦‚æœæ²¡æœ‰å®ç° __iter__ ï¼Œä½†æ˜¯å®ç°äº† __getitem__ ï¼Œpython ä¼šåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œå°è¯•ä»ç´¢å¼•0å¼€å§‹è·å–å…ƒç´  å¦‚æœè·å–å¤±è´¥ï¼Œåˆ™æŠ›å‡º TypeError æ ‡å‡†åºåˆ—éƒ½å®ç°äº† __iter__ æ–¹æ³•ï¼Œæ‰€ä»¥æ ‡å‡†åºåˆ—éƒ½æ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚å¦‚ list,dict,set,tupleã€‚ åªæœ‰å®ç°äº† __iter__ æ–¹æ³•çš„å¯¹è±¡èƒ½é€šè¿‡å­ç±»æµ‹è¯•issubclass(Object,abc.Itertor) æ£€æŸ¥å¯¹è±¡èƒ½å¦è¿­ä»£æœ€æ ‡å‡†çš„æ–¹æ³•æ˜¯è°ƒç”¨ iter() å‡½æ•°ï¼Œå› ä¸º iter() ä¼šè€ƒè™‘åˆ°å®ç° __getitem__ æ–¹æ³•çš„éƒ¨åˆ†å¯è¿­ä»£å¯¹è±¡ã€‚ ","date":"2020-12-07","objectID":"/python-iter/:2:0","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python-iter/"},{"categories":null,"content":"è¿­ä»£å™¨ è¿­ä»£å™¨ä¸»è¦ç”¨äºä»é›†åˆä¸­å–å‡ºå…ƒç´ ï¼Œé‚£ä¹ˆæ˜¯ä»€ä¹ˆè¿­ä»£å™¨å‘¢? å®ç°äº† next æ–¹æ³•çš„å¯è¿­ä»£å¯¹è±¡å°±æ˜¯è¿­ä»£å™¨ã€‚ next è¿”å›ä¸‹ä¸€ä¸ªå¯ç”¨çš„å…ƒç´ ï¼Œå½“æ²¡æœ‰å…ƒç´ æ—¶æŠ›å‡º StopIteration å¼‚å¸¸ã€‚ __iter__ ï¼Œè¿­ä»£å™¨æœ¬èº«ã€‚ åˆ°è¿™é‡Œåº”è¯¥å¯ä»¥çœ‹å‡ºã€Œå¯è¿­ä»£å¯¹è±¡ã€ä¸ ã€Œè¿­ä»£å™¨ã€çš„åŒºåˆ«äº†ï¼Œå°±æ˜¯åœ¨äºæœ‰æ²¡æœ‰å®ç°next æ–¹æ³• ã€‚ æ£€æŸ¥å¯¹è±¡æ˜¯ä¸æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ ï¼šisinstance(object,abc.Iterator) ã€‚ ","date":"2020-12-07","objectID":"/python-iter/:3:0","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python-iter/"},{"categories":null,"content":"è¿­ä»£å™¨æ¨¡å¼ æŒ‰éœ€ä¸€æ¬¡è·å–ä¸€ä¸ªæ•°æ®é¡¹ã€‚ è¿­ä»£å™¨æ¨¡å¼çš„ç”¨é€”æœ‰ï¼š è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡è€Œæ— éœ€æš´éœ²å®ƒçš„å†…éƒ¨ç»“æ„ æ”¯æŒå¯¹èšåˆå¯¹è±¡çš„å¤šç§éå† ä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ è¯´äº†è¿™ä¹ˆå¤šï¼Œé‚£ä¹ˆé™¤äº†æ ‡å‡†åºåˆ—ä¹‹å¤–ï¼Œå¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªè¿­ä»£å™¨å‘¢ï¼Œçœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼š class Books: def __init__(self, books): self.books = books.split(\",\") def __iter__(self): return BookIterator(self.books) class BookIterator: def __init__(self, books): self.books = books self.index = 0 def next(self): try : book = self.books[self.index] except IndexError: raise StopIteration() self.index += 1 return book def __iter__(self): return self books = Books(\"python,golang,vue,kubernetes,istio\") print(books) for book in books : print(book) ","date":"2020-12-07","objectID":"/python-iter/:3:1","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python-iter/"},{"categories":null,"content":"ç”Ÿæˆå™¨ ç”Ÿæˆå™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œè¿™ç§è¿­ä»£å™¨æ›´åŠ ä¼˜é›…ï¼Œä¸éœ€è¦åƒä¸Šé¢ä¸€æ ·å†™ __iter__ å’Œ next æ–¹æ³•äº†ï¼Œåªéœ€è¦ä¸€ä¸ª yield å…³é”®å­—å³å¯ã€‚ ç”Ÿæˆå™¨æœ‰ä¸¤ç§æ–¹æ³•ç”¨: yield () ç”Ÿæˆ ","date":"2020-12-07","objectID":"/python-iter/:4:0","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python-iter/"},{"categories":null,"content":"yield def gen(x) : for i in range(x) : yield i * 2 g1 = gen(10) ","date":"2020-12-07","objectID":"/python-iter/:4:1","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python-iter/"},{"categories":null,"content":"() ç”Ÿæˆå™¨ l1 = [ i * 2 for i in range(10) ] g1 = (i * 2 for i in range(10)) for i in g1 : print(i) print(l1) l1 æ˜¯ä¸€ä¸ªåˆ—è¡¨æ¨å¯¼å¼ g1 æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ ä¸¤è€…çš„åŒºåˆ«æ˜¯ g1 ç”Ÿæˆå™¨é‡‡ç”¨æ‡’åŠ è½½çš„æ–¹å¼ï¼Œä¸ä¼šä¸€æ¬¡æŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ ç”Ÿæˆå™¨çš„å¥½å¤„ä¸ç”¨æŠŠæ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè®¿é—®åˆ°çš„æ—¶å€™åœ¨è®¡ç®—å‡ºæ¥ã€‚ä¾‹å¦‚æœ‰ 100w çš„æ•°æ®é›†ï¼Œä½†æ˜¯åªéœ€è¦è®¿é—®å‰ 100 ä¸ªï¼Œæ˜¯ä¸æ˜¯ç”Ÿæˆå™¨å°±å¾ˆæœ‰ç”¨äº†ã€‚ ","date":"2020-12-07","objectID":"/python-iter/:4:2","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python-iter/"},{"categories":null,"content":"ç‰¹åˆ«è¯´æ˜ ä¸Šè¿°å†™æ³•ä¸º python2 çš„å†™æ³•ï¼Œpython3 ç•¥æœ‰ä¸åŒï¼Œpython3 ä¸­ next æ–¹æ³•å¯¹åº”çš„ä¸º __next__ ï¼Œå¦‚ä¸Šé¢çš„ Books ä¾‹å­å¯¹åº”çš„å†™æ³•ä¸º: class Books: def __init__(self, books): self.books = books.split(\",\") def __iter__(self): return BookIterator(self.books) class BookIterator: def __init__(self, books): self.books = books self.index = 0 def __next__(self): try : book = self.books[self.index] except IndexError: raise StopIteration() self.index += 1 return book def __iter__(self): return self books = Books(\"python,golang,vue,kubernetes,istio\") print(books) for book in books : print(book) ","date":"2020-12-07","objectID":"/python-iter/:5:0","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python-iter/"},{"categories":null,"content":"æ€»ç»“ ä»»ä½•å¯¹è±¡åªè¦å®ç°äº† __iter__ æ–¹æ³•å°±æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ ä»»ä½•å¯¹è±¡åªè¦å®ç°äº† __iter__ å’Œ next æ–¹æ³•å°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå¯ä»¥é€šè¿‡ yield å’Œ () çš„æ–¹å¼ç”Ÿæˆ åœ¨æ•°æ®é‡å¤§çš„æ—¶å€™ä½¿ç”¨ä¼šæœ‰å¥‡æ•ˆ ","date":"2020-12-07","objectID":"/python-iter/:6:0","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python-iter/"},{"categories":null,"content":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","date":"2020-12-07","objectID":"/python/python-iter/","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python/python-iter/"},{"categories":null,"content":"å¯¼è¯» è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº† python å½“ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨ï¼Œåœ¨æ¶‰åŠåˆ°å¤§æ•°é‡çš„åœºæ™¯åº”è¯¥è€ƒè™‘ä½¿ç”¨è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨ã€‚ ","date":"2020-12-07","objectID":"/python/python-iter/:1:0","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python/python-iter/"},{"categories":null,"content":"å¯è¿­ä»£å¯¹è±¡ å¦‚æœä¸€ä¸ªå¯¹è±¡å®ç°äº† __iter__ æ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç§°å®ƒæ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰å®ç° __iter__ è€Œå®ç°äº† __getitem__ æ–¹æ³•ï¼Œå¹¶ä¸”å…¶å‚æ•°æ˜¯ä»0å¼€å§‹ç´¢å¼•çš„ï¼Œè¿™ç§å¯¹è±¡ä¹Ÿæ˜¯å¯è¿­ä»£çš„ï¼Œæ¯”å¦‚è¯´åºåˆ—ã€‚ ä½¿ç”¨ iter å†…ç½®å‡½æ•°å¯ä»¥è·å–è¿­ä»£å™¨çš„å¯¹è±¡ï¼Œå½“è§£é‡Šå™¨éœ€è¦è¿­ä»£å¯¹è±¡æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ item(x) ï¼š å¦‚æœå¯¹è±¡å®ç°äº† __iter__ æ–¹æ³•ï¼Œè·å–ä¸€ä¸ªè¿­ä»£å™¨ å¦‚æœæ²¡æœ‰å®ç° __iter__ ï¼Œä½†æ˜¯å®ç°äº† __getitem__ ï¼Œpython ä¼šåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œå°è¯•ä»ç´¢å¼•0å¼€å§‹è·å–å…ƒç´  å¦‚æœè·å–å¤±è´¥ï¼Œåˆ™æŠ›å‡º TypeError æ ‡å‡†åºåˆ—éƒ½å®ç°äº† __iter__ æ–¹æ³•ï¼Œæ‰€ä»¥æ ‡å‡†åºåˆ—éƒ½æ˜¯å¯è¿­ä»£å¯¹è±¡ã€‚å¦‚ list,dict,set,tupleã€‚ åªæœ‰å®ç°äº† __iter__ æ–¹æ³•çš„å¯¹è±¡èƒ½é€šè¿‡å­ç±»æµ‹è¯•issubclass(Object,abc.Itertor) æ£€æŸ¥å¯¹è±¡èƒ½å¦è¿­ä»£æœ€æ ‡å‡†çš„æ–¹æ³•æ˜¯è°ƒç”¨ iter() å‡½æ•°ï¼Œå› ä¸º iter() ä¼šè€ƒè™‘åˆ°å®ç° __getitem__ æ–¹æ³•çš„éƒ¨åˆ†å¯è¿­ä»£å¯¹è±¡ã€‚ ","date":"2020-12-07","objectID":"/python/python-iter/:2:0","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python/python-iter/"},{"categories":null,"content":"è¿­ä»£å™¨ è¿­ä»£å™¨ä¸»è¦ç”¨äºä»é›†åˆä¸­å–å‡ºå…ƒç´ ï¼Œé‚£ä¹ˆæ˜¯ä»€ä¹ˆè¿­ä»£å™¨å‘¢? å®ç°äº† next æ–¹æ³•çš„å¯è¿­ä»£å¯¹è±¡å°±æ˜¯è¿­ä»£å™¨ã€‚ next è¿”å›ä¸‹ä¸€ä¸ªå¯ç”¨çš„å…ƒç´ ï¼Œå½“æ²¡æœ‰å…ƒç´ æ—¶æŠ›å‡º StopIteration å¼‚å¸¸ã€‚ __iter__ ï¼Œè¿­ä»£å™¨æœ¬èº«ã€‚ åˆ°è¿™é‡Œåº”è¯¥å¯ä»¥çœ‹å‡ºã€Œå¯è¿­ä»£å¯¹è±¡ã€ä¸ ã€Œè¿­ä»£å™¨ã€çš„åŒºåˆ«äº†ï¼Œå°±æ˜¯åœ¨äºæœ‰æ²¡æœ‰å®ç°next æ–¹æ³• ã€‚ æ£€æŸ¥å¯¹è±¡æ˜¯ä¸æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ ï¼šisinstance(object,abc.Iterator) ã€‚ ","date":"2020-12-07","objectID":"/python/python-iter/:3:0","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python/python-iter/"},{"categories":null,"content":"è¿­ä»£å™¨æ¨¡å¼ æŒ‰éœ€ä¸€æ¬¡è·å–ä¸€ä¸ªæ•°æ®é¡¹ã€‚ è¿­ä»£å™¨æ¨¡å¼çš„ç”¨é€”æœ‰ï¼š è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡è€Œæ— éœ€æš´éœ²å®ƒçš„å†…éƒ¨ç»“æ„ æ”¯æŒå¯¹èšåˆå¯¹è±¡çš„å¤šç§éå† ä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ è¯´äº†è¿™ä¹ˆå¤šï¼Œé‚£ä¹ˆé™¤äº†æ ‡å‡†åºåˆ—ä¹‹å¤–ï¼Œå¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªè¿­ä»£å™¨å‘¢ï¼Œçœ‹çœ‹ä¸‹é¢çš„ä»£ç ï¼š class Books: def __init__(self, books): self.books = books.split(\",\") def __iter__(self): return BookIterator(self.books) class BookIterator: def __init__(self, books): self.books = books self.index = 0 def next(self): try : book = self.books[self.index] except IndexError: raise StopIteration() self.index += 1 return book def __iter__(self): return self books = Books(\"python,golang,vue,kubernetes,istio\") print(books) for book in books : print(book) ","date":"2020-12-07","objectID":"/python/python-iter/:3:1","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python/python-iter/"},{"categories":null,"content":"ç”Ÿæˆå™¨ ç”Ÿæˆå™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œè¿™ç§è¿­ä»£å™¨æ›´åŠ ä¼˜é›…ï¼Œä¸éœ€è¦åƒä¸Šé¢ä¸€æ ·å†™ __iter__ å’Œ next æ–¹æ³•äº†ï¼Œåªéœ€è¦ä¸€ä¸ª yield å…³é”®å­—å³å¯ã€‚ ç”Ÿæˆå™¨æœ‰ä¸¤ç§æ–¹æ³•ç”¨: yield () ç”Ÿæˆ ","date":"2020-12-07","objectID":"/python/python-iter/:4:0","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python/python-iter/"},{"categories":null,"content":"yield def gen(x) : for i in range(x) : yield i * 2 g1 = gen(10) ","date":"2020-12-07","objectID":"/python/python-iter/:4:1","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python/python-iter/"},{"categories":null,"content":"() ç”Ÿæˆå™¨ l1 = [ i * 2 for i in range(10) ] g1 = (i * 2 for i in range(10)) for i in g1 : print(i) print(l1) l1 æ˜¯ä¸€ä¸ªåˆ—è¡¨æ¨å¯¼å¼ g1 æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ ä¸¤è€…çš„åŒºåˆ«æ˜¯ g1 ç”Ÿæˆå™¨é‡‡ç”¨æ‡’åŠ è½½çš„æ–¹å¼ï¼Œä¸ä¼šä¸€æ¬¡æŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ ç”Ÿæˆå™¨çš„å¥½å¤„ä¸ç”¨æŠŠæ•°æ®å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè®¿é—®åˆ°çš„æ—¶å€™åœ¨è®¡ç®—å‡ºæ¥ã€‚ä¾‹å¦‚æœ‰ 100w çš„æ•°æ®é›†ï¼Œä½†æ˜¯åªéœ€è¦è®¿é—®å‰ 100 ä¸ªï¼Œæ˜¯ä¸æ˜¯ç”Ÿæˆå™¨å°±å¾ˆæœ‰ç”¨äº†ã€‚ ","date":"2020-12-07","objectID":"/python/python-iter/:4:2","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python/python-iter/"},{"categories":null,"content":"ç‰¹åˆ«è¯´æ˜ ä¸Šè¿°å†™æ³•ä¸º python2 çš„å†™æ³•ï¼Œpython3 ç•¥æœ‰ä¸åŒï¼Œpython3 ä¸­ next æ–¹æ³•å¯¹åº”çš„ä¸º __next__ ï¼Œå¦‚ä¸Šé¢çš„ Books ä¾‹å­å¯¹åº”çš„å†™æ³•ä¸º: class Books: def __init__(self, books): self.books = books.split(\",\") def __iter__(self): return BookIterator(self.books) class BookIterator: def __init__(self, books): self.books = books self.index = 0 def __next__(self): try : book = self.books[self.index] except IndexError: raise StopIteration() self.index += 1 return book def __iter__(self): return self books = Books(\"python,golang,vue,kubernetes,istio\") print(books) for book in books : print(book) ","date":"2020-12-07","objectID":"/python/python-iter/:5:0","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python/python-iter/"},{"categories":null,"content":"æ€»ç»“ ä»»ä½•å¯¹è±¡åªè¦å®ç°äº† __iter__ æ–¹æ³•å°±æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ ä»»ä½•å¯¹è±¡åªè¦å®ç°äº† __iter__ å’Œ next æ–¹æ³•å°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ ç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå¯ä»¥é€šè¿‡ yield å’Œ () çš„æ–¹å¼ç”Ÿæˆ åœ¨æ•°æ®é‡å¤§çš„æ—¶å€™ä½¿ç”¨ä¼šæœ‰å¥‡æ•ˆ ","date":"2020-12-07","objectID":"/python/python-iter/:6:0","tags":["python","è¿­ä»£å™¨","ç”Ÿæˆå™¨"],"title":"Python ä¸­çš„è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨","uri":"/python/python-iter/"},{"categories":null,"content":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","date":"2020-12-05","objectID":"/docker-storage/","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"å¯¼è¯» æèµ· docker å¤§å®¶åº”è¯¥è€³ç†Ÿèƒ½è¯¦ï¼Œå¦‚ä½¿ç”¨ docker æ‰€å¸¦æ¥çš„æŒç»­é›†æˆã€ç‰ˆæœ¬æ§åˆ¶ã€å¯ç§»æ¤æ€§ã€éš”ç¦»æ€§ã€å®‰å…¨æ€§ç­‰è¯¸å¤šå¥½å¤„ã€‚docker çš„ä½¿ç”¨ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯å…¶å†…éƒ¨åŸç†æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿéƒ½æœ‰å“ªäº›ç»„ä»¶ï¼Ÿä¹‹é—´æ˜¯å¦‚ä½•ç›¸äº’åä½œçš„å‘¢ï¼Ÿè¿™æ˜¯ docker ç³»åˆ—æ–‡ç« ï¼Œæ¯ç¯‡è®²è§£ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå¯ä»¥æ›´å¥½çš„æ¶ˆåŒ–ã€‚ è¿™ç¯‡è°ˆè°ˆ docker çš„å­˜å‚¨é©±åŠ¨ã€‚å—é™ä½œè€…æ°´å¹³ï¼Œå¦‚æœ‰ä¸å¯¹ä¹‹å¤„ï¼Œæ¬¢è¿æ‰¹è¯„ä¹‹å¤„ã€‚ ","date":"2020-12-05","objectID":"/docker-storage/:1:0","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"ä»€ä¹ˆæ˜¯ docker å­˜å‚¨é©±åŠ¨ å¦‚æœæ‰§è¡Œè¿‡ docker info å‘½ä»¤ï¼Œé‚£ä¹ˆè‚¯å®šçœ‹åˆ°è¿‡è¿™äº›ä¿¡æ¯: ... Server: Server Version: 19.03.13 Storage Driver: overlay2 Backing Filesystem: extfs Supports d_type: true Native Overlay Diff: true ... è¯·æ³¨æ„ Storage Driver: overlay2 ï¼Œçœ‹åˆ°è¿™äº›å¯èƒ½ä¼šæœ‰å‡ ä¸ªç–‘é—®: ä»€ä¹ˆæ˜¯ Storage Driver ï¼Ÿé™¤äº† overlay2 è¿˜æœ‰å…¶ä»–çš„å—ï¼ŸåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ æˆ‘ä»¬çŸ¥é“ docker çš„ç‰¹åˆ«æ˜¯åˆ†å±‚çš„ï¼Œå±‚å é•œåƒæ˜¯ docker æœ€å…·ç‰¹è‰²çš„ç‰¹æ€§ä¹‹ä¸€ã€‚æƒ³è±¡è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œdocker å¯åŠ¨å®¹å™¨æ˜¯ä¾èµ–äºé•œåƒçš„ï¼Œå‡è®¾è¦ä¸€ä¸ª JDK çš„é•œåƒ è¦å¯åŠ¨ 10 ä¸ªï¼Œè¿™ä¸ªé•œåƒæœ¬èº«500Mï¼Œé‚£ä¹ˆ 10 ä¸ªè¿™äº›å®¹å™¨æ˜¯å…±äº«è¿™ä¸€ä¸ªé•œåƒå‘¢è¿˜æ˜¯æŠŠæ¯ä¸ªé•œåƒéƒ½å¤åˆ¶ä¸€ä»½å‘¢ï¼Œå¦‚æœæ˜¯å…±äº«æ¨¡å¼ï¼Œé‚£ä¹ˆå¦‚æœä¸€ä¸ªå®¹å™¨ä¿®æ”¹äº†é•œåƒä¸­çš„å†…å®¹ å²‚ä¸æ˜¯ä¼šå½±å“å…¶ä»–å®¹å™¨ï¼Ÿå¦‚æœæ˜¯å„è‡ªå¤åˆ¶ä¸€ä»½ï¼Œé‚£å²‚ä¸æ˜¯ä¼šé€ æˆå­˜å‚¨ç©ºé—´çš„æµªè´¹? å­˜å‚¨é©±åŠ¨(Storage Driver) å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåˆ°ç°åœ¨ä¹Ÿæœ‰å¥½å‡ ç§è§£å†³æ–¹æ¡ˆã€‚æ€»çš„è§£å†³æ€è·¯å°±æ˜¯é•œåƒæ˜¯åªè¯»çš„ï¼Œå¯åŠ¨å®¹å™¨æ—¶å°±æ˜¯é•œåƒä¸Šé¢å åŠ ä¸€ä¸ªè¯»å†™å±‚ã€‚ åœ¨äº†è§£å…·ä½“çš„å­˜å‚¨é©±åŠ¨ä¹‹å‰å…ˆé“ºå«å‡ ä¸ªçŸ¥è¯†ç‚¹ï¼š ","date":"2020-12-05","objectID":"/docker-storage/:2:0","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"å†™æ—¶å¤åˆ¶ï¼ˆCoWï¼‰ æ‰€æœ‰é©±åŠ¨éƒ½ç”¨åˆ°çš„æŠ€æœ¯â€”â€”å†™æ—¶å¤åˆ¶ï¼ˆCoWï¼‰ã€‚CoWå°±æ˜¯copy-on-writeï¼Œè¡¨ç¤ºåªåœ¨éœ€è¦å†™æ—¶æ‰å»å¤åˆ¶ï¼Œè¿™ä¸ªæ˜¯é’ˆå¯¹å·²æœ‰æ–‡ä»¶çš„ä¿®æ”¹åœºæ™¯ã€‚æ¯”å¦‚åŸºäºä¸€ä¸ªimageå¯åŠ¨å¤šä¸ªContainerï¼Œå¦‚æœä¸ºæ¯ä¸ªContaineréƒ½å»åˆ†é…ä¸€ä¸ªimageä¸€æ ·çš„æ–‡ä»¶ç³»ç»Ÿï¼Œé‚£ä¹ˆå°†ä¼šå ç”¨å¤§é‡çš„ç£ç›˜ç©ºé—´ã€‚è€ŒCoWæŠ€æœ¯å¯ä»¥è®©æ‰€æœ‰çš„å®¹å™¨å…±äº«imageçš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€æœ‰æ•°æ®éƒ½ä»imageä¸­è¯»å–ï¼Œåªæœ‰å½“è¦å¯¹æ–‡ä»¶è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œæ‰ä»imageé‡ŒæŠŠè¦å†™çš„æ–‡ä»¶å¤åˆ¶åˆ°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œä¿®æ”¹ã€‚æ‰€ä»¥æ— è®ºæœ‰å¤šå°‘ä¸ªå®¹å™¨å…±äº«åŒä¸€ä¸ªimageï¼Œæ‰€åšçš„å†™æ“ä½œéƒ½æ˜¯å¯¹ä»imageä¸­å¤åˆ¶åˆ°è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿä¸­çš„å¤æœ¬ä¸Šè¿›è¡Œï¼Œå¹¶ä¸ä¼šä¿®æ”¹imageçš„æºæ–‡ä»¶ï¼Œä¸”å¤šä¸ªå®¹å™¨æ“ä½œåŒä¸€ä¸ªæ–‡ä»¶ï¼Œä¼šåœ¨æ¯ä¸ªå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿé‡Œç”Ÿæˆä¸€ä¸ªå¤æœ¬ï¼Œæ¯ä¸ªå®¹å™¨ä¿®æ”¹çš„éƒ½æ˜¯è‡ªå·±çš„å¤æœ¬ï¼Œç›¸äº’éš”ç¦»ï¼Œç›¸äº’ä¸å½±å“ã€‚ä½¿ç”¨CoWå¯ä»¥æœ‰æ•ˆçš„æé«˜ç£ç›˜çš„åˆ©ç”¨ç‡ã€‚ ","date":"2020-12-05","objectID":"/docker-storage/:2:1","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"ç”¨æ—¶åˆ†é…ï¼ˆallocate-on-demandï¼‰ è€Œå†™æ—¶åˆ†é…æ˜¯ç”¨åœ¨åŸæœ¬æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶çš„åœºæ™¯ï¼Œåªæœ‰åœ¨è¦æ–°å†™å…¥ä¸€ä¸ªæ–‡ä»¶æ—¶æ‰åˆ†é…ç©ºé—´ï¼Œè¿™æ ·å¯ä»¥æé«˜å­˜å‚¨èµ„æºçš„åˆ©ç”¨ç‡ã€‚æ¯”å¦‚å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå¹¶ä¸ä¼šä¸ºè¿™ä¸ªå®¹å™¨é¢„åˆ†é…ä¸€äº›ç£ç›˜ç©ºé—´ï¼Œè€Œæ˜¯å½“æœ‰æ–°æ–‡ä»¶å†™å…¥æ—¶ï¼Œæ‰æŒ‰éœ€åˆ†é…æ–°ç©ºé—´ã€‚ ","date":"2020-12-05","objectID":"/docker-storage/:2:2","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"è”åˆæ–‡ä»¶ç³»ç»Ÿ è”åˆæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹ã€‚ ","date":"2020-12-05","objectID":"/docker-storage/:2:3","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"ç°æœ‰çš„å­˜å‚¨é©±åŠ¨åŠå…¶ç‰¹ç‚¹ ","date":"2020-12-05","objectID":"/docker-storage/:3:0","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"AUFS AUFSï¼ˆAnotherUnionFSï¼‰æ˜¯ä¸€ç§Union FSï¼Œæ˜¯æ–‡ä»¶çº§çš„å­˜å‚¨é©±åŠ¨ã€‚AUFSèƒ½é€æ˜è¦†ç›–ä¸€æˆ–å¤šä¸ªç°æœ‰æ–‡ä»¶ç³»ç»Ÿçš„å±‚çŠ¶æ–‡ä»¶ç³»ç»Ÿï¼ŒæŠŠå¤šå±‚åˆå¹¶æˆæ–‡ä»¶ç³»ç»Ÿçš„å•å±‚è¡¨ç¤ºã€‚ç®€å•æ¥è¯´å°±æ˜¯æ”¯æŒå°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹çš„æ–‡ä»¶ç³»ç»Ÿã€‚è¿™ç§æ–‡ä»¶ç³»ç»Ÿå¯ä»¥ä¸€å±‚ä¸€å±‚åœ°å åŠ ä¿®æ”¹æ–‡ä»¶ã€‚æ— è®ºåº•ä¸‹æœ‰å¤šå°‘å±‚éƒ½æ˜¯åªè¯»çš„ï¼Œåªæœ‰æœ€ä¸Šå±‚çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯å¯å†™çš„ã€‚å½“éœ€è¦ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼ŒAUFSåˆ›å»ºè¯¥æ–‡ä»¶çš„ä¸€ä¸ªå‰¯æœ¬ï¼Œä½¿ç”¨CoWå°†æ–‡ä»¶ä»åªè¯»å±‚å¤åˆ¶åˆ°å¯å†™å±‚è¿›è¡Œä¿®æ”¹ï¼Œç»“æœä¹Ÿä¿å­˜åœ¨å¯å†™å±‚ã€‚åœ¨Dockerä¸­ï¼Œåº•ä¸‹çš„åªè¯»å±‚å°±æ˜¯imageï¼Œå¯å†™å±‚å°±æ˜¯Containerã€‚ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ","date":"2020-12-05","objectID":"/docker-storage/:3:1","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"Overlay Overlayæ˜¯Linuxå†…æ ¸3.18åæ”¯æŒçš„ï¼Œä¹Ÿæ˜¯ä¸€ç§Union FSï¼Œå’ŒAUFSçš„å¤šå±‚ä¸åŒçš„æ˜¯Overlayåªæœ‰ä¸¤å±‚ï¼šä¸€ä¸ªupperæ–‡ä»¶ç³»ç»Ÿå’Œä¸€ä¸ªloweræ–‡ä»¶ç³»ç»Ÿï¼Œåˆ†åˆ«ä»£è¡¨Dockerçš„é•œåƒå±‚å’Œå®¹å™¨å±‚ã€‚å½“éœ€è¦ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œä½¿ç”¨CoWå°†æ–‡ä»¶ä»åªè¯»çš„lowerå¤åˆ¶åˆ°å¯å†™çš„upperè¿›è¡Œä¿®æ”¹ï¼Œç»“æœä¹Ÿä¿å­˜åœ¨upperå±‚ã€‚åœ¨Dockerä¸­ï¼Œåº•ä¸‹çš„åªè¯»å±‚å°±æ˜¯imageï¼Œå¯å†™å±‚å°±æ˜¯Containerã€‚ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š OverlayFSæœ‰ä¸¤ç§å­˜å‚¨é©±åŠ¨ï¼Œå®ƒä»¬ä½¿ç”¨äº†ç›¸åŒçš„OverlayFSæŠ€æœ¯ï¼Œä½†å´æœ‰ç€ä¸åŒçš„å®ç°ï¼Œåœ¨ç£ç›˜ä½¿ç”¨ä¸Šä¹Ÿå¹¶ä¸äº’ç›¸å…¼å®¹ã€‚å› ä¸ºä¸å…¼å®¹ï¼Œä¸¤è€…ä¹‹é—´çš„åˆ‡æ¢å¿…é¡»é‡æ–°åˆ›å»ºæ‰€æœ‰çš„é•œåƒã€‚overlayé©±åŠ¨æ˜¯æœ€åŸå§‹çš„OverlayFSå®ç°ï¼Œå¹¶ä¸”ï¼Œåœ¨Docker1.11ä¹‹å‰æ˜¯ä»…æœ‰çš„OverlayFSé©±åŠ¨é€‰æ‹©ã€‚overlayé©±åŠ¨åœ¨inodeæ¶ˆè€—æ–¹é¢æœ‰ç€è¾ƒæ˜æ˜¾çš„é™åˆ¶ï¼Œå¹¶ä¸”ä¼šæŸè€—ä¸€å®šçš„æ€§èƒ½ã€‚overlay2é©±åŠ¨è§£å†³äº†è¿™ç§é™åˆ¶ï¼Œä¸è¿‡åªèƒ½åœ¨Linux kernel 4.0ä»¥ä¸Šä½¿ç”¨å®ƒã€‚ ç›®å‰ Overlay2 æ˜¯é»˜è®¤çš„å­˜å‚¨é©±åŠ¨ ","date":"2020-12-05","objectID":"/docker-storage/:3:2","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"Device mapper Device mapperæ˜¯Linuxå†…æ ¸2.6.9åæ”¯æŒçš„ï¼Œæä¾›çš„ä¸€ç§ä»é€»è¾‘è®¾å¤‡åˆ°ç‰©ç†è®¾å¤‡çš„æ˜ å°„æ¡†æ¶æœºåˆ¶ï¼Œåœ¨è¯¥æœºåˆ¶ä¸‹ï¼Œç”¨æˆ·å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ ¹æ®è‡ªå·±çš„éœ€è¦åˆ¶å®šå®ç°å­˜å‚¨èµ„æºçš„ç®¡ç†ç­–ç•¥ã€‚å‰é¢è®²çš„AUFSå’ŒOverlayFSéƒ½æ˜¯æ–‡ä»¶çº§å­˜å‚¨ï¼Œè€ŒDevice mapperæ˜¯å—çº§å­˜å‚¨ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯ç›´æ¥å¯¹å—è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯æ–‡ä»¶ã€‚Device mapperé©±åŠ¨ä¼šå…ˆåœ¨å—è®¾å¤‡ä¸Šåˆ›å»ºä¸€ä¸ªèµ„æºæ± ï¼Œç„¶ååœ¨èµ„æºæ± ä¸Šåˆ›å»ºä¸€ä¸ªå¸¦æœ‰æ–‡ä»¶ç³»ç»Ÿçš„åŸºæœ¬è®¾å¤‡ï¼Œæ‰€æœ‰é•œåƒéƒ½æ˜¯è¿™ä¸ªåŸºæœ¬è®¾å¤‡çš„å¿«ç…§ï¼Œè€Œå®¹å™¨åˆ™æ˜¯é•œåƒçš„å¿«ç…§ã€‚æ‰€ä»¥åœ¨å®¹å™¨é‡Œçœ‹åˆ°æ–‡ä»¶ç³»ç»Ÿæ˜¯èµ„æºæ± ä¸ŠåŸºæœ¬è®¾å¤‡çš„æ–‡ä»¶ç³»ç»Ÿçš„å¿«ç…§ï¼Œå¹¶ä¸æœ‰ä¸ºå®¹å™¨åˆ†é…ç©ºé—´ã€‚å½“è¦å†™å…¥ä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œåœ¨å®¹å™¨çš„é•œåƒå†…ä¸ºå…¶åˆ†é…æ–°çš„å—å¹¶å†™å…¥æ•°æ®ï¼Œè¿™ä¸ªå«ç”¨æ—¶åˆ†é…ã€‚å½“è¦ä¿®æ”¹å·²æœ‰æ–‡ä»¶æ—¶ï¼Œå†ä½¿ç”¨CoWä¸ºå®¹å™¨å¿«ç…§åˆ†é…å—ç©ºé—´ï¼Œå°†è¦ä¿®æ”¹çš„æ•°æ®å¤åˆ¶åˆ°åœ¨å®¹å™¨å¿«ç…§ä¸­æ–°çš„å—é‡Œå†è¿›è¡Œä¿®æ”¹ã€‚Device mapper é©±åŠ¨é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ª100Gçš„æ–‡ä»¶åŒ…å«é•œåƒå’Œå®¹å™¨ã€‚æ¯ä¸€ä¸ªå®¹å™¨è¢«é™åˆ¶åœ¨10Gå¤§å°çš„å·å†…ï¼Œå¯ä»¥è‡ªå·±é…ç½®è°ƒæ•´ã€‚ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ","date":"2020-12-05","objectID":"/docker-storage/:3:3","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"Btrfs Btrfsè¢«ç§°ä¸ºä¸‹ä¸€ä»£å†™æ—¶å¤åˆ¶æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶å…¥Linuxå†…æ ¸ï¼Œä¹Ÿæ˜¯æ–‡ä»¶çº§çº§å­˜å‚¨ï¼Œä½†å¯ä»¥åƒDevice mapperä¸€ç›´æ¥æ“ä½œåº•å±‚è®¾å¤‡ã€‚BtrfsæŠŠæ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†é…ç½®ä¸ºä¸€ä¸ªå®Œæ•´çš„å­æ–‡ä»¶ç³»ç»Ÿï¼Œç§°ä¹‹ä¸ºsubvolume ã€‚é‚£ä¹ˆé‡‡ç”¨ subvolumeï¼Œä¸€ä¸ªå¤§çš„æ–‡ä»¶ç³»ç»Ÿå¯ä»¥è¢«åˆ’åˆ†ä¸ºå¤šä¸ªå­æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™äº›å­æ–‡ä»¶ç³»ç»Ÿå…±äº«åº•å±‚çš„è®¾å¤‡ç©ºé—´ï¼Œåœ¨éœ€è¦ç£ç›˜ç©ºé—´æ—¶ä¾¿ä»åº•å±‚è®¾å¤‡ä¸­åˆ†é…ï¼Œç±»ä¼¼åº”ç”¨ç¨‹åºè°ƒç”¨ malloc()åˆ†é…å†…å­˜ä¸€æ ·ã€‚ä¸ºäº†çµæ´»åˆ©ç”¨è®¾å¤‡ç©ºé—´ï¼ŒBtrfs å°†ç£ç›˜ç©ºé—´åˆ’åˆ†ä¸ºå¤šä¸ªchunk ã€‚æ¯ä¸ªchunkå¯ä»¥ä½¿ç”¨ä¸åŒçš„ç£ç›˜ç©ºé—´åˆ†é…ç­–ç•¥ã€‚æ¯”å¦‚æŸäº›chunkåªå­˜æ”¾metadataï¼ŒæŸäº›chunkåªå­˜æ”¾æ•°æ®ã€‚è¿™ç§æ¨¡å‹æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œæ¯”å¦‚Btrfsæ”¯æŒåŠ¨æ€æ·»åŠ è®¾å¤‡ã€‚ç”¨æˆ·åœ¨ç³»ç»Ÿä¸­å¢åŠ æ–°çš„ç£ç›˜ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨Btrfsçš„å‘½ä»¤å°†è¯¥è®¾å¤‡æ·»åŠ åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚BtrfsæŠŠä¸€ä¸ªå¤§çš„æ–‡ä»¶ç³»ç»Ÿå½“æˆä¸€ä¸ªèµ„æºæ± ï¼Œé…ç½®æˆå¤šä¸ªå®Œæ•´çš„å­æ–‡ä»¶ç³»ç»Ÿï¼Œè¿˜å¯ä»¥å¾€èµ„æºæ± é‡ŒåŠ æ–°çš„å­æ–‡ä»¶ç³»ç»Ÿï¼Œè€ŒåŸºç¡€é•œåƒåˆ™æ˜¯å­æ–‡ä»¶ç³»ç»Ÿçš„å¿«ç…§ï¼Œæ¯ä¸ªå­é•œåƒå’Œå®¹å™¨éƒ½æœ‰è‡ªå·±çš„å¿«ç…§ï¼Œè¿™äº›å¿«ç…§åˆ™éƒ½æ˜¯subvolumeçš„å¿«ç…§ã€‚ å½“å†™å…¥ä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œä¸ºåœ¨å®¹å™¨çš„å¿«ç…§é‡Œä¸ºå…¶åˆ†é…ä¸€ä¸ªæ–°çš„æ•°æ®å—ï¼Œæ–‡ä»¶å†™åœ¨è¿™ä¸ªç©ºé—´é‡Œï¼Œè¿™ä¸ªå«ç”¨æ—¶åˆ†é…ã€‚è€Œå½“è¦ä¿®æ”¹å·²æœ‰æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨CoWå¤åˆ¶åˆ†é…ä¸€ä¸ªæ–°çš„åŸå§‹æ•°æ®å’Œå¿«ç…§ï¼Œåœ¨è¿™ä¸ªæ–°åˆ†é…çš„ç©ºé—´å˜æ›´æ•°æ®ï¼Œå˜ç»“æŸå†æ›´æ–°ç›¸å…³çš„æ•°æ®ç»“æ„æŒ‡å‘æ–°å­æ–‡ä»¶ç³»ç»Ÿå’Œå¿«ç…§ï¼ŒåŸæ¥çš„åŸå§‹æ•°æ®å’Œå¿«ç…§æ²¡æœ‰æŒ‡é’ˆæŒ‡å‘ï¼Œè¢«è¦†ç›–ã€‚ ","date":"2020-12-05","objectID":"/docker-storage/:3:4","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"ZFS ZFS æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªé©å‘½æ€§çš„å…¨æ–°çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒä»æ ¹æœ¬ä¸Šæ”¹å˜äº†æ–‡ä»¶ç³»ç»Ÿçš„ç®¡ç†æ–¹å¼ï¼ŒZFS å®Œå…¨æŠ›å¼ƒäº†â€œå·ç®¡ç†â€ï¼Œä¸å†åˆ›å»ºè™šæ‹Ÿçš„å·ï¼Œè€Œæ˜¯æŠŠæ‰€æœ‰è®¾å¤‡é›†ä¸­åˆ°ä¸€ä¸ªå­˜å‚¨æ± ä¸­æ¥è¿›è¡Œç®¡ç†ï¼Œç”¨â€œå­˜å‚¨æ± â€çš„æ¦‚å¿µæ¥ç®¡ç†ç‰©ç†å­˜å‚¨ç©ºé—´ã€‚è¿‡å»ï¼Œæ–‡ä»¶ç³»ç»Ÿéƒ½æ˜¯æ„å»ºåœ¨ç‰©ç†è®¾å¤‡ä¹‹ä¸Šçš„ã€‚ä¸ºäº†ç®¡ç†è¿™äº›ç‰©ç†è®¾å¤‡ï¼Œå¹¶ä¸ºæ•°æ®æä¾›å†—ä½™ï¼Œâ€œå·ç®¡ç†â€çš„æ¦‚å¿µæä¾›äº†ä¸€ä¸ªå•è®¾å¤‡çš„æ˜ åƒã€‚è€ŒZFSåˆ›å»ºåœ¨è™šæ‹Ÿçš„ï¼Œè¢«ç§°ä¸ºâ€œzpoolsâ€çš„å­˜å‚¨æ± ä¹‹ä¸Šã€‚æ¯ä¸ªå­˜å‚¨æ± ç”±è‹¥å¹²è™šæ‹Ÿè®¾å¤‡ï¼ˆvirtual devicesï¼Œvdevsï¼‰ç»„æˆã€‚è¿™äº›è™šæ‹Ÿè®¾å¤‡å¯ä»¥æ˜¯åŸå§‹ç£ç›˜ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªRAID1é•œåƒè®¾å¤‡ï¼Œæˆ–æ˜¯éæ ‡å‡†RAIDç­‰çº§çš„å¤šç£ç›˜ç»„ã€‚äºæ˜¯zpoolä¸Šçš„æ–‡ä»¶ç³»ç»Ÿå¯ä»¥ä½¿ç”¨è¿™äº›è™šæ‹Ÿè®¾å¤‡çš„æ€»å­˜å‚¨å®¹é‡ã€‚ ä¸‹é¢çœ‹ä¸€ä¸‹åœ¨Dockeré‡ŒZFSçš„ä½¿ç”¨ã€‚é¦–å…ˆä»zpoolé‡Œåˆ†é…ä¸€ä¸ªZFSæ–‡ä»¶ç³»ç»Ÿç»™é•œåƒçš„åŸºç¡€å±‚ï¼Œè€Œå…¶ä»–é•œåƒå±‚åˆ™æ˜¯è¿™ä¸ªZFSæ–‡ä»¶ç³»ç»Ÿå¿«ç…§çš„å…‹éš†ï¼Œå¿«ç…§æ˜¯åªè¯»çš„ï¼Œè€Œå…‹éš†æ˜¯å¯å†™çš„ï¼Œå½“å®¹å™¨å¯åŠ¨æ—¶åˆ™åœ¨é•œåƒçš„æœ€é¡¶å±‚ç”Ÿæˆä¸€ä¸ªå¯å†™å±‚ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å½“è¦å†™ä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨æŒ‰éœ€åˆ†é…ï¼Œä¸€ä¸ªæ–°çš„æ•°æ®å¿«ä»zpoolé‡Œç”Ÿæˆï¼Œæ–°çš„æ•°æ®å†™å…¥è¿™ä¸ªå—ï¼Œè€Œè¿™ä¸ªæ–°ç©ºé—´å­˜äºå®¹å™¨ï¼ˆZFSçš„å…‹éš†ï¼‰é‡Œã€‚ å½“è¦ä¿®æ”¹ä¸€ä¸ªå·²å­˜åœ¨çš„æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨å†™æ—¶å¤åˆ¶ï¼Œåˆ†é…ä¸€ä¸ªæ–°ç©ºé—´å¹¶æŠŠåŸå§‹æ•°æ®å¤åˆ¶åˆ°æ–°ç©ºé—´å®Œæˆä¿®æ”¹ã€‚ ","date":"2020-12-05","objectID":"/docker-storage/:3:5","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"å­˜å‚¨é©±åŠ¨å¯¹æ¯” å­˜å‚¨é©±åŠ¨ ç‰¹ç‚¹ ä¼˜ç‚¹ ç¼ºç‚¹ é€‚ç”¨åœºæ™¯ AUFS è”åˆæ–‡ä»¶ç³»ç»Ÿã€æœªå¹¶å…¥å†…æ ¸ä¸»çº¿ã€æ–‡ä»¶çº§å­˜å‚¨ ä½œä¸ºdockerçš„ç¬¬ä¸€ä¸ªå­˜å‚¨é©±åŠ¨ï¼Œå·²ç»æœ‰å¾ˆé•¿çš„å†å²ï¼Œæ¯”è¾ƒç¨³å®šï¼Œä¸”åœ¨å¤§é‡çš„ç”Ÿäº§ä¸­å®è·µè¿‡ï¼Œæœ‰è¾ƒå¼ºçš„ç¤¾åŒºæ”¯æŒ æœ‰å¤šå±‚ï¼Œåœ¨åšå†™æ—¶å¤åˆ¶æ“ä½œæ—¶ï¼Œå¦‚æœæ–‡ä»¶æ¯”è¾ƒå¤§ä¸”å­˜åœ¨æ¯”è¾ƒä½çš„å±‚ï¼Œå¯èƒ½ä¼šæ…¢ä¸€äº› å¤§å¹¶å‘ä½†å°‘IOçš„åœºæ™¯ overlayFS è”åˆæ–‡ä»¶ç³»ç»Ÿã€å¹¶å…¥å†…æ ¸ä¸»çº¿ã€æ–‡ä»¶çº§å­˜å‚¨ åªæœ‰ä¸¤å±‚ ä¸ç®¡ä¿®æ”¹çš„å†…å®¹å¤§å°éƒ½ä¼šå¤åˆ¶æ•´ä¸ªæ–‡ä»¶ï¼Œå¯¹å¤§æ–‡ä»¶è¿›è¡Œä¿®æ”¹æ˜¾ç¤ºè¦æ¯”å°æ–‡ä»¶æ¶ˆè€—æ›´å¤šçš„æ—¶é—´ å¤§å¹¶å‘ä½†å°‘IOçš„åœºæ™¯ Devicemapper å¹¶å…¥å†…æ ¸ä¸»çº¿ã€å—çº§å­˜å‚¨ å—çº§æ— è®ºæ˜¯å¤§æ–‡ä»¶è¿˜æ˜¯å°æ–‡ä»¶éƒ½åªå¤åˆ¶éœ€è¦ä¿®æ”¹çš„å—ï¼Œå¹¶ä¸æ˜¯æ•´ä¸ªæ–‡ä»¶ ä¸æ”¯æŒå…±äº«å­˜å‚¨ï¼Œå½“æœ‰å¤šä¸ªå®¹å™¨è¯»åŒä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œéœ€è¦ç”Ÿæˆå¤šä¸ªå¤æœ¬ï¼Œåœ¨å¾ˆå¤šå®¹å™¨å¯åœçš„æƒ…å†µä¸‹å¯èƒ½ä¼šå¯¼è‡´ç£ç›˜æº¢å‡º é€‚åˆioå¯†é›†çš„åœºæ™¯ Btrfs å¹¶å…¥linuxå†…æ ¸ã€æ–‡ä»¶çº§å­˜å‚¨ å¯ä»¥åƒdevicemapperä¸€æ ·ç›´æ¥æ“ä½œåº•å±‚è®¾å¤‡ï¼Œæ”¯æŒåŠ¨æ€æ·»åŠ è®¾å¤‡ ä¸æ”¯æŒå…±äº«å­˜å‚¨ï¼Œå½“æœ‰å¤šä¸ªå®¹å™¨è¯»åŒä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œéœ€è¦ç”Ÿæˆå¤šä¸ªå¤æœ¬ ä¸é€‚åˆåœ¨é«˜å¯†åº¦å®¹å™¨çš„paaså¹³å°ä¸Šä½¿ç”¨ ZFS æŠŠæ‰€æœ‰è®¾å¤‡é›†ä¸­åˆ°ä¸€ä¸ªå­˜å‚¨æ± ä¸­æ¥è¿›è¡Œç®¡ç† æ”¯æŒå¤šä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªç¼“å­˜å—ï¼Œé€‚åˆå†…å­˜å¤§çš„ç¯å¢ƒ COWä½¿ç”¨ç¢ç‰‡åŒ–é—®é¢˜æ›´åŠ ä¸¥é‡ï¼Œæ–‡ä»¶åœ¨ç¡¬ç›˜ä¸Šçš„ç‰©ç†åœ°å€ä¼šå˜çš„ä¸å†è¿ç»­ï¼Œé¡ºåºè¯»ä¼šå˜çš„æ€§èƒ½æ¯”è¾ƒå·® é€‚åˆpaaså’Œé«˜å¯†åº¦çš„åœºæ™¯ ","date":"2020-12-05","objectID":"/docker-storage/:4:0","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"è®¾ç½®å­˜å‚¨é©±åŠ¨ docker å®‰è£…æ—¶ä¼šæœ‰è‡ªå·±çš„é»˜è®¤å­˜å‚¨é©±åŠ¨ï¼Œåœ¨æ–°ç‰ˆæœ¬çš„ docker ä¸­ï¼Œé»˜è®¤æ˜¯ overlay2ï¼Œcentosï¼Œmac æ˜¯è¿™æ ·çš„ï¼Œå…¶ä»–çš„æ²¡æœ‰éªŒè¯è¿‡ã€‚ å¦‚æœè¦æ›´æ”¹å­˜å‚¨é©±åŠ¨ï¼Œæ–¹æ³•ä¸º: dockerd --storage-driver=aufs è®¾ç½®å®Œæˆåå¯é€šè¿‡ docker info è¿›è¡ŒéªŒè¯ã€‚ ","date":"2020-12-05","objectID":"/docker-storage/:5:0","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"å‚è€ƒ http://dockone.io/article/1513 https://gitbook.cn/gitchat/column/5d68b823de93ed72d6eca1bc/topic/5db26784bae3b42c1fa84d5f ","date":"2020-12-05","objectID":"/docker-storage/:6:0","tags":["docker"],"title":"docker åŸç†ä¹‹å­˜å‚¨é©±åŠ¨","uri":"/docker-storage/"},{"categories":null,"content":"OSCHINA æ¬è¿ç”³æ˜","date":"2020-11-30","objectID":"/oschina-blog/","tags":[],"title":"OSCHINA æ¬è¿ç”³æ˜","uri":"/oschina-blog/"},{"categories":null,"content":"å¯¼è¯» æˆ‘çš„åšå®¢å³å°†åŒæ­¥è‡³ OSCHINA ç¤¾åŒºï¼Œè¿™æ˜¯æˆ‘çš„ OSCHINA IDï¼šrussellgaoï¼Œé‚€è¯·å¤§å®¶ä¸€åŒå…¥é©»ï¼šhttps://www.oschina.net/sharing-plan/apply ","date":"2020-11-30","objectID":"/oschina-blog/:1:0","tags":[],"title":"OSCHINA æ¬è¿ç”³æ˜","uri":"/oschina-blog/"},{"categories":null,"content":"harbor gc æ—¶é‡åˆ°çš„å‘","date":"2020-11-29","objectID":"/harbor-gc/","tags":["äº‘åŸç”Ÿ","harbor"],"title":"harbor gc æ—¶é‡åˆ°çš„å‘","uri":"/harbor-gc/"},{"categories":null,"content":"å¯¼è¯» Harbor æ˜¯ä¸ºä¼ä¸šç”¨æˆ·è®¾è®¡çš„å®¹å™¨é•œåƒä»“åº“å¼€æºé¡¹ç›®ï¼ŒåŒ…æ‹¬äº†æƒé™ç®¡ç†(RBAC)ã€LDAPã€å®¡è®¡ã€å®‰å…¨æ¼æ´æ‰«æã€é•œåƒéªŒçœŸã€ç®¡ç†ç•Œé¢ã€è‡ªæˆ‘æ³¨å†Œã€HA ç­‰ä¼ä¸šå¿…éœ€çš„åŠŸèƒ½ï¼ŒåŒæ—¶é’ˆå¯¹ä¸­å›½ç”¨æˆ·çš„ç‰¹ç‚¹ï¼Œè®¾è®¡é•œåƒå¤åˆ¶å’Œä¸­æ–‡æ”¯æŒç­‰åŠŸèƒ½ã€‚ åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¼šæœ‰ GC çš„éœ€æ±‚ï¼Œå¯ä»¥æƒ³è±¡ä¸‹è¿™å‡ ç§åœºæ™¯: åœ¨ CI çš„è¿‡ç¨‹ï¼ŒåŒä¸€ä¸ªç‰ˆæœ¬ï¼ˆSNAPSHOT/latestï¼‰ç¼–è¯‘å¾ˆå¤šæ¬¡ï¼Œåªæœ‰æœ€åä¸€æ¬¡äº§ç”Ÿçš„æ‰æœ‰ tag ï¼Œé‚£ä¹ˆä¹‹å‰çš„äº§ç”Ÿ blob å»å“ªäº†ï¼Œæˆ–è€…è¿˜æœ‰ç”¨å— ï¼Ÿ é•œåƒçš„ç”Ÿå‘½å‘¨æœŸå·²ç»ç»“æŸï¼Œéœ€è¦ä»ä»“åº“ä¸­åˆ é™¤ï¼Œåº”è¯¥æ€ä¹ˆæ“ä½œï¼Ÿè¦çŸ¥é“åœ¨ Harbor ç•Œé¢ä¸Šåˆ é™¤åªæ˜¯æ ‡è®°åˆ é™¤ï¼Œå¹¶ä¸ä¼šé‡Šæ”¾å­˜å‚¨ç©ºé—´ã€‚ Harbor / Docker å®˜æ–¹å·²ç»æä¾›æ¯”è¾ƒå®Œå–„çš„ GC æ–¹æ¡ˆï¼Œå¯ä»¥è§£å†³ 80% çš„é—®é¢˜ï¼Œä½†æ˜¯ GC çš„è¿‡ç¨‹ä¸­è¿˜å¯èƒ½å‡ºç°ä¸€äº›å¥‡æ€ªçš„ç°è±¡ï¼Œæœ¬æ–‡ä¸»è¦è®°å½•åœ¨ Harbor GC è¿‡ç¨‹ä¸­è¸©è¿‡çš„å‘ã€‚ ","date":"2020-11-29","objectID":"/harbor-gc/:1:0","tags":["äº‘åŸç”Ÿ","harbor"],"title":"harbor gc æ—¶é‡åˆ°çš„å‘","uri":"/harbor-gc/"},{"categories":null,"content":"GCåŸç† ç”¨ä¸€ä¸ªå®˜æ–¹ä¾‹å­è¯´æ˜: A -----\u003e a \u003c----- B \\--\u003e b | c \u003c--/ å‡è®¾é•œåƒ A å¼•ç”¨äº†å±‚a,b ï¼Œé•œåƒ B å¼•ç”¨äº†å±‚ a,c ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ˜¯ä¸éœ€è¦åš GC çš„ï¼Œæ¥ä¸‹æ¥æŠŠ B ç»™åˆ æ‰ï¼Œå¦‚ä¸‹: A -----\u003e a B \\--\u003e b c åœ¨è¿™ä¸ªé˜¶æ®µå±‚ c æ˜¯ä¸å±äºä»»ä½•é•œåƒäº†ï¼Œé€‚åˆå» GC ï¼ŒGC å®Œä¹‹åæ•ˆæœå¦‚ä¸‹ï¼š A -----\u003e a \\--\u003e b çœ‹ç€è¿˜æ˜¯æŒºç®€å•ï¼Œå¾ˆå®¹æ˜“ç†è§£çš„å¯¹å§ï¼Œä½†æ˜¯å½“é•œåƒæ•°ä¸º 10,000+ ä»¥ä¸Šï¼Œå­˜å‚¨åœ¨ TB çº§åˆ«ä»¥ä¸Šæ—¶ï¼Œäº‹æƒ…å¯èƒ½åˆä¸é‚£ä¹ˆç®€å•äº†ã€‚ ","date":"2020-11-29","objectID":"/harbor-gc/:2:0","tags":["äº‘åŸç”Ÿ","harbor"],"title":"harbor gc æ—¶é‡åˆ°çš„å‘","uri":"/harbor-gc/"},{"categories":null,"content":"Harbor å­˜å‚¨çš„ç›®å½•ç»“æ„ Harbor åº•å±‚è¿˜æ˜¯ Docker Registryï¼Œæ‰€ä»¥å®ƒä»¬çš„å­˜å‚¨ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥å…ˆçœ‹çœ‹å®ƒä»¬åœ¨ç£ç›˜ä¸Šå­˜å‚¨ç»“æ„: # tree docker/registry/v2/ docker/registry/v2 â”‚Â â”‚Â â”œâ”€â”€ blogs â”‚Â â”‚Â â”‚Â â””â”€â”€ sha256 â”‚Â â”‚Â â”‚Â â””â”€â”€ 00 â”‚Â â”‚Â â”‚Â â””â”€â”€ 000098c48e5c8502460fd4427fe19d9def6c3d245b46e4d3dd86a00c79ca3111 â”‚Â â”‚Â â”‚Â â””â”€â”€ data â”‚Â â”‚Â â”‚Â â””â”€â”€ 000098c48e5c8502460fd4427fe19d9def6c3d245b46e4d3dd86a00c79ca3112 â”‚Â â”‚Â â”‚Â â””â”€â”€ data â”‚Â â”‚Â â”‚Â â””â”€â”€ 01 â”‚Â â”‚Â â”‚Â â””â”€â”€ 010098c48e5c8502460fd4427fe19d9def6c3d245b46e4d3dd86a00c79ca3111 â”‚Â â”‚Â â”‚Â â””â”€â”€ data â”‚Â â”‚Â â”‚Â â””â”€â”€ 010098c48e5c8502460fd4427fe19d9def6c3d245b46e4d3dd86a00c79ca3112 â”‚Â â”‚Â â”‚Â â””â”€â”€ data â”‚Â â”‚Â â”œâ”€â”€ repositories â”‚Â â”‚Â â”‚Â â””â”€â”€ golang â”‚Â â”‚Â â”‚Â â””â”€â”€ golang-centos â”‚Â â”‚Â â”‚Â â””â”€â”€ _layers â”‚Â â”‚Â â”‚Â â””â”€â”€ sha256 â”‚Â â”‚Â â”‚Â â””â”€â”€ _manifests â”‚Â â”‚Â â”‚Â â””â”€â”€ revisions â”‚Â â”‚Â â”‚Â â””â”€â”€ sha256 â”‚Â â”‚Â â”‚Â â””â”€â”€ tags â”‚Â â”‚Â â”‚Â â””â”€â”€ 1.14 â”‚Â â”‚Â â”‚Â â””â”€â”€ 1.15 å¯ä»¥çœ‹åˆ°å­˜å‚¨ç»“æ„ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† blogs å’Œ repositories ï¼Œä½œç”¨å¦‚ä¸‹ : blogs æ˜¯é•œåƒæ•°æ®çš„çœŸæ­£å­˜å‚¨ã€‚ repositories æ˜¯é•œåƒæ•°æ®çš„å¼•ç”¨ï¼Œæ¢è¨€ä¹‹å­˜å‚¨çš„æ˜¯blogsçš„ç´¢å¼•ã€‚æ¯ä¸ªé•œåƒéƒ½ä¼šå£°æ˜å®ƒå¼•ç”¨ blogs ä¸­çš„å“ªäº›å±‚ã€‚ ","date":"2020-11-29","objectID":"/harbor-gc/:3:0","tags":["äº‘åŸç”Ÿ","harbor"],"title":"harbor gc æ—¶é‡åˆ°çš„å‘","uri":"/harbor-gc/"},{"categories":null,"content":"GCè¿‡ç¨‹ æœ‰äº†ä¸Šé¢çš„é“ºå«ï¼ŒGC çš„è¿‡ç¨‹åº”è¯¥å¾ˆå®¹æ˜“ç†è§£äº†ã€‚Harbor GC é‡‡ç”¨çš„ä¸¤é˜¶æ®µæ ‡è®°æ¸…é™¤ï¼Œå…ˆéå† repositories ä¸‹çš„é•œåƒï¼Œå¹¶ä¸”å¯¹å¼•ç”¨åˆ°blogs è¿›è¡Œæ ‡è®°ï¼Œéå†å®Œæˆä¹‹åæŠŠæ²¡æœ‰æ ‡è®°çš„ blogs è¿›è¡Œåˆ é™¤ã€‚ çœ‹ä¼¼å®Œç¾çš„æ–¹æ¡ˆï¼Œåœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­å´è¿˜æœ‰äº›å‘ï¼Œä¸‹é¢è¯´è¯´é‡åˆ°çš„å‘ä»¥åŠå¦‚ä½•è§£å†³æ–¹æ¡ˆã€‚ ","date":"2020-11-29","objectID":"/harbor-gc/:4:0","tags":["äº‘åŸç”Ÿ","harbor"],"title":"harbor gc æ—¶é‡åˆ°çš„å‘","uri":"/harbor-gc/"},{"categories":null,"content":"é‡åˆ°çš„å‘ ","date":"2020-11-29","objectID":"/harbor-gc/:5:0","tags":["äº‘åŸç”Ÿ","harbor"],"title":"harbor gc æ—¶é‡åˆ°çš„å‘","uri":"/harbor-gc/"},{"categories":null,"content":"docker pull å¤±è´¥ docker pull çš„æ—¶å€™æŠ¥é”™å¦‚ä¸‹ï¼ˆunknown blobï¼‰ï¼š docker pull russellgao/toolkit ... daa258f4f8c0: Already exists 0c9e9bbad61e: Already exists fa786f5d7be0: Already exists ebc05f08dcb7: Downloading f919a7128c9a: Downloading 34dfbfa16f77: Download complete 65588873bd66: Download complete fc1b74edeacc: Download complete 099607f21531: Download complete 09432885197f: Download complete 259a4564bedf: Download complete ce223372b98e: Download complete ... unknown blob è¿™ç§æƒ…å†µä¸»è¦çš„åŸå› æ˜¯åœ¨ repositories ä¸­å­˜åœ¨å¯¹ blob çš„å¼•ç”¨ï¼Œä½†æ˜¯ blog ä¸­å´ä¸å­˜åœ¨ï¼Œé€ æˆè¿™ç§å¯èƒ½çš„åŸå› æœ‰ï¼š GC çš„æ—¶å€™é”™è¯¯çš„åˆ é™¤äº† blobs ï¼ˆå¤§æ¦‚ç‡å¦‚æ­¤ï¼‰ blob æ‰€åœ¨çš„ç£ç›˜æŸå ï¼ˆæ¦‚ç‡è¾ƒå°ï¼‰ blob è¢«äººä¸ºåˆ é™¤ï¼ˆæ¦‚ç‡è¾ƒå°ï¼‰ è¯·æ³¨æ„ï¼šè¿™ç§æƒ…å†µé‡æ–°æ¨é€é•œåƒæ˜¯æ²¡æœ‰ç”¨çš„ï¼Œå› ä¸ºåœ¨æ¨é€çš„æ—¶å€™ï¼Œharbor è®¤ä¸ºç¼ºå¤±çš„å±‚æ˜¯å­˜åœ¨çš„ï¼Œå› ä¸º repositoriesä¸­å­˜åœ¨ï¼Œåªæœ‰åœ¨ä¸‹è½½æ—¶æ‰ä¼šå‘ç°ã€‚ è§£å†³çš„æ–¹æ³•: é€šè¿‡docker build ç¼–è¯‘é•œåƒæ—¶å¢åŠ  --no-cache å‚æ•°ï¼Œç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„é•œåƒæ¨é€åˆ°é•œåƒä»“åº“ï¼Œæ–¹æ³•å¯èƒ½ä¼šè§£å†³é—®é¢˜ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½è§£å†³ä¸äº†ï¼Œå¯ä»¥ æƒ³è±¡è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œç¼ºå¤±çš„å±‚ä¸ºåŸºç¡€é•œåƒï¼Œå¦‚æœåŸºç¡€é•œåƒç¼ºå°‘å±‚ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•å°±å¤±æ•ˆäº†ã€‚ å¯ä»¥åœ¨éƒ¨ç½²ä¸€ä¸ªé•œåƒä»“åº“ï¼ˆä¸€èˆ¬éƒ½ä¼šæœ€å°‘æœ‰ä¸¤ä¸ªä»“åº“åšäº’å¤‡ï¼‰ï¼ŒæŠŠç¼–è¯‘å¥½çš„é•œåƒæ¨é€åˆ°æ–°çš„ä»“åº“ï¼Œç„¶åæ ¹æ®ç¼ºå°‘çš„ blob id åœ¨æ–°çš„ä»“åº“ä¸­æ‰¾åˆ°å¯¹åº”çš„ blob æ•°æ®ï¼Œç„¶åæŠŠç¼ºå°‘çš„ copy åˆ°ä¹‹å‰ä»“åº“ï¼Œé—®é¢˜å³å¯å¾—åˆ°è§£å†³ã€‚å¦‚ï¼š ç¼ºå°‘ ebc05f08dcb7 è¿™ä¸€å±‚ï¼Œåœ¨æ–°çš„ä»“åº“çš„ä¸­å¯ä»¥æ‰¾åˆ°å¦‚ä¸‹ç›®å½•: docker/registry/v2/blobs/sha256/eb/ é€šè¿‡ ebc05f08dcb7 å‰ç¼€æ‰¾åˆ°å…·ä½“çš„ blob ç›®å½•ï¼Œç„¶åæŠŠæ‰¾åˆ°çš„è¿™ä¸ªç›®å½• copy åˆ°å¯¹åº”çš„ä»“åº“æ—¥å½•ï¼Œé—®é¢˜å³å¯å¾—åˆ°è§£å†³ã€‚ ","date":"2020-11-29","objectID":"/harbor-gc/:5:1","tags":["äº‘åŸç”Ÿ","harbor"],"title":"harbor gc æ—¶é‡åˆ°çš„å‘","uri":"/harbor-gc/"},{"categories":null,"content":"æ€»ç»“ è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»äº† harbor gc çš„åŸºæœ¬åŸç†ï¼Œç„¶åè®°å½•åœ¨ GC çš„è¿‡ç¨‹ä¸­è¸©çš„å‘ï¼Œåç»­æœ‰å…¶ä»–å‘æŒç»­è¡¥å……ã€‚ ","date":"2020-11-29","objectID":"/harbor-gc/:6:0","tags":["äº‘åŸç”Ÿ","harbor"],"title":"harbor gc æ—¶é‡åˆ°çš„å‘","uri":"/harbor-gc/"},{"categories":null,"content":"å‚è€ƒ https://github.com/docker/docker.github.io/blob/master/registry/garbage-collection.md ","date":"2020-11-29","objectID":"/harbor-gc/:7:0","tags":["äº‘åŸç”Ÿ","harbor"],"title":"harbor gc æ—¶é‡åˆ°çš„å‘","uri":"/harbor-gc/"},{"categories":null,"content":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-GMP","date":"2020-11-27","objectID":"/golang-gmp/","tags":["golang","GMP","è°ƒåº¦å™¨"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-GMP","uri":"/golang-gmp/"},{"categories":null,"content":"å¯¼è¯» è¿™æ˜¯ Golang ç³»åˆ—ç¬¬äºŒç¯‡ï¼Œè¿™ç¯‡ä¸»è¦è°ˆè°ˆ Golang çš„è°ƒåº¦æ¨¡å‹-GMPï¼Œæˆ‘ä»¬çŸ¥é“ Golang åœ¨å¹¶å‘æ–¹é¢æœ‰ç»å¯¹ä¼˜åŠ¿ï¼Œç°åœ¨å°±è®©æˆ‘ä»¬æ¥æ­å¼€ å®ƒç¥ç§˜çš„é¢çº±ã€‚ ","date":"2020-11-27","objectID":"/golang-gmp/:1:0","tags":["golang","GMP","è°ƒåº¦å™¨"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-GMP","uri":"/golang-gmp/"},{"categories":null,"content":"èƒŒæ™¯ ","date":"2020-11-27","objectID":"/golang-gmp/:2:0","tags":["golang","GMP","è°ƒåº¦å™¨"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-GMP","uri":"/golang-gmp/"},{"categories":null,"content":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","date":"2020-11-25","objectID":"/golang/oracle-golang/","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/golang/oracle-golang/"},{"categories":null,"content":"å¯¼è¯» è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»å¦‚ä½•åˆ©ç”¨ golang æ“ä½œ oracle æ•°æ®åº“ï¼ŒåŒ…æ‹¬åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ï¼Œæœ¬åœ° oracle ç¯å¢ƒæ­å»ºï¼Œä»¥åŠå¦‚ä½•åœ¨ docker ä¸­è¿è¡Œã€‚ oracle client é•œåƒæ„å»ºå¹¶ä¸å®¹æ˜“ï¼ŒèŠ±äº†å¾ˆé•¿æ—¶é—´å»è¸©å‘ï¼Œæ–‡ä¸­æä¾›äº†å·²ç»æ„å»ºå¥½çš„åŸºç¡€é•œåƒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè¿™é‡Œè´¡çŒ®ç»™å¤§å®¶ã€‚ ","date":"2020-11-25","objectID":"/golang/oracle-golang/:1:0","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/golang/oracle-golang/"},{"categories":null,"content":"æœ¬åœ°ç¯å¢ƒæ„å»º ","date":"2020-11-25","objectID":"/golang/oracle-golang/:2:0","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/golang/oracle-golang/"},{"categories":null,"content":"å®‰è£…å®¢æˆ·ç«¯ oracle å®¢æˆ·ç«¯ä¸‹è½½é¡µé¢: https://www.oracle.com/database/technologies/instant-client/downloads.html mac https://www.oracle.com/database/technologies/instant-client/macos-intel-x86-downloads.html åœ¨ä¸Šé¢çš„é¡µé¢ä¸‹è½½ä¹‹åæ‰§è¡Œ: # è§£å‹ cd ~ unzip instantclient-basic-macos.x64-19.3.0.0.0dbru.zip # åˆ›å»ºlink mkdir ~/lib ln -s ~/instantclient_19_3/libclntsh.dylib ~/lib/ æˆ‘æœ¬åœ°ç¯å¢ƒç¯å¢ƒæ˜¯ mac ï¼Œè¿™ä¸ªäº²æµ‹æœ‰ç”¨ã€‚linux å’Œ windows åªç»™å‡ºäº†ç›¸å…³å‚è€ƒè¿æ¥ï¼Œæ²¡æœ‰å®é™…æ“ç»ƒè¿‡ã€‚ linux https://www.oracle.com/database/technologies/instant-client/linux-x86-64-downloads.html windows https://www.oracle.com/database/technologies/instant-client/winx64-64-downloads.html ","date":"2020-11-25","objectID":"/golang/oracle-golang/:2:1","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/golang/oracle-golang/"},{"categories":null,"content":"ç”¨æ³• go æ“ä½œ oracle å¯ä»¥ä½¿ç”¨ github.com/godror/godror ï¼Œå¦‚ package main import ( \"database/sql\" \"fmt\" _ \"github.com/godror/godror\" \"os\" ) func main() { connString := \"oracle://hd40:xxx@121.196.127.xxx:1521/ylyx?charset=utf8\" db, err := sql.Open(\"godror\", connString) if err != nil { fmt.Println(err) os.Exit(10) } // æ³¨æ„ä¸è¦ sql è¯­å¥ä¸è¦ä½¿ç”¨ ; å·ç»“å°¾ï¼Œå¦åˆ™ä¼šæŠ¥é”™ // dpiStmt_execute: ORA-00911: invalid character sql := \"select * from user_tables \" rows, err1 := db.Query(sql) if err1 != nil { fmt.Println(err1) os.Exit(10) } result, err2 := GetQueryResult(rows) if err2 != nil { fmt.Println(err2) os.Exit(10) } fmt.Println(result) fmt.Println(\"end\") } func GetQueryResult(query *sql.Rows) ([]map[string]string, error) { column, _ := query.Columns() //è¯»å‡ºæŸ¥è¯¢å‡ºçš„åˆ—å­—æ®µå values := make([][]byte, len(column)) //valuesæ˜¯æ¯ä¸ªåˆ—çš„å€¼ï¼Œè¿™é‡Œè·å–åˆ°byteé‡Œ scans := make([]interface{}, len(column)) //å› ä¸ºæ¯æ¬¡æŸ¥è¯¢å‡ºæ¥çš„åˆ—æ˜¯ä¸å®šé•¿çš„ï¼Œç”¨len(column)å®šä½å½“æ¬¡æŸ¥è¯¢çš„é•¿åº¦ for i := range values { //è®©æ¯ä¸€è¡Œæ•°æ®éƒ½å¡«å……åˆ°[][]byteé‡Œé¢ scans[i] = \u0026values[i] } results := []map[string]string{} for query.Next() { //å¾ªç¯ï¼Œè®©æ¸¸æ ‡å¾€ä¸‹ç§»åŠ¨ if err := query.Scan(scans...); err != nil { //query.ScanæŸ¥è¯¢å‡ºæ¥çš„ä¸å®šé•¿å€¼æ”¾åˆ°scans[i] = \u0026values[i],ä¹Ÿå°±æ˜¯æ¯è¡Œéƒ½æ”¾åœ¨valuesé‡Œ fmt.Println(err) return nil, err } row := make(map[string]string) //æ¯è¡Œæ•°æ® for k, v := range values { //æ¯è¡Œæ•°æ®æ˜¯æ”¾åœ¨valuesé‡Œé¢ï¼Œç°åœ¨æŠŠå®ƒæŒªåˆ°rowé‡Œ key := column[k] row[key] = string(v) } results = append(results, row) } query.Close() return results, nil } ç”¨æ³•è¯´æ˜ : _ \"github.com/godror/godror\" è¿™å¥æ˜¯è¯´æ˜ sql çš„ driver æ˜¯ oracle ï¼Œå¦‚æœè¦æ“ä½œ mysql ï¼Œæ¢æˆ mysql çš„ driver (_ \"github.com/go-sql-driver/mysql\") å³å¯ã€‚ crud æ“ä½œè¿˜æ˜¯è°ƒç”¨ database/sql è¿›è¡Œå®Œæˆã€‚ æš´éœ²å‡ºæ¥ç»™ç”¨æˆ·çš„è¿˜æ˜¯ *sql.DB ã€‚æŸ¥è¯¢å¯ä»¥è°ƒç”¨ *sql.DB çš„ Query æ–¹æ³•ï¼Œæ‰§è¡Œå…¶ä»– sql åˆ™è°ƒç”¨ Exec æ–¹æ³•ã€‚ ","date":"2020-11-25","objectID":"/golang/oracle-golang/:3:0","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/golang/oracle-golang/"},{"categories":null,"content":"å¸¸è§æŠ¥é”™ å¦‚æœæŠ¥å¦‚ä¸‹é”™è¯¯: (cx_Oracle.DatabaseError) DPI-1047: Cannot locate a 64-bit Oracle Client library: \"dlopen(libclntsh.dylib, 1): image not found\". See https://cx-oracle.readthedocs.io/en/latest/user_guide/installation.html for help è¯´æ˜oracleçš„ client æ²¡æœ‰æ­£ç¡®å®‰è£… å¦‚æœæŠ¥é”™å¦‚ä¸‹: (cx_Oracle.DatabaseError) ORA-01017: invalid username/password; logon denied è¯´æ˜oracle çš„ç”¨æˆ·å¯†ç ä¸æ­£ç¡® å¦‚æœæŠ¥é”™å¦‚ä¸‹: dpiStmt_execute: ORA-00911: invalid character è¯´æ˜ sql ä¸­åŒ…å«æ— æ•ˆå­—ç¬¦ï¼Œè¯·æ³¨æ„å¦‚æœ sql ä¸­åŒ…å« ; å°±ä¼šæŠ¥é”™ï¼Œéœ€è¦æŠŠ sql ä¸­çš„ ; trim æ‰ã€‚æˆ‘å†™äº†ä¸ªæ ‡å‡†åŒ– sql çš„æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒ: // å»æ‰è¡Œé¦–å’Œè¡Œå°¾çš„ç©ºç™½å­—ç¬¦ func TrimBlankSpace(s string) string { _s := regexp.MustCompile(\"^\\\\s+\").ReplaceAll([]byte(s), []byte(\"\")) _s = regexp.MustCompile(\"\\\\s+$\").ReplaceAll(_s, []byte(\"\")) return string(_s) } // å»æ‰ ; å¹¶ä¸”å…¨éƒ¨è½¬ä¸ºå¤§å†™å­—ç¬¦ func FormatSql(sql string) string { sql = TrimBlankSpace(sql) sql = strings.TrimRight(sql, \";\") return strings.ToUpper(sql) } ","date":"2020-11-25","objectID":"/golang/oracle-golang/:4:0","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/golang/oracle-golang/"},{"categories":null,"content":"docker ä¸­è¿è¡Œ æˆ‘å°è¯•è¿‡ç”¨ alpine åšåŸºç¡€é•œåƒï¼Œç„¶åè¿›è¡Œå®‰è£… oracle clientï¼ŒæŠŠ oracle client å®‰è£…å®Œæˆä¹‹åï¼Œè¿è¡Œç¼–è¯‘å®Œçš„ golang ç¨‹åºï¼Œ å‡ºç°äº†å„ç§ç¼ºå°‘åŠ¨æ€åº“çš„é—®é¢˜ï¼ŒæŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼Œå’Œ apline çš„å®˜æ–¹æºéƒ½å½»åº•æ²¡æœ‰è§£å†³ï¼Œç„¶åå°±å‡†å¤‡åœ¨ dockerhub æ‰¾ä¸€ä¸ªç°æˆçš„æ‹¿è¿‡æ¥å‚è€ƒï¼Œ å¾ˆé—æ†¾æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥ç›´æ¥ç”¨çš„ï¼Œæœ€åæ”¾å¼ƒäº† alpine è¿™æ¡è·¯ï¼Œé€‰æ‹© alpine æ˜¯å› ä¸º alpine é•œåƒæ¯”è¾ƒå°ï¼Œè¿™æ ·åšå‡ºæ¥çš„é•œåƒæ¯”è¾ƒå°ã€‚ çœ‹äº† oracle client å®˜æ–¹ä¸‹è½½å’Œå®‰è£…è¯´æ˜ï¼Œä¹Ÿéƒ½æ˜¯ centos çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥å°±åŸºäº centos åšäº†ä¸€ä¸ªåŒ…å« oracle client çš„åŸºç¡€é•œåƒã€‚ å·²ç»ä¸Šä¼ åˆ° dockerhub äº†ï¼Œå‚è§: https://hub.docker.com/r/russellgao/oracle å¦‚æœä½ åˆšå¥½éœ€è¦ï¼Œè€Œæˆ‘åˆšå¥½æœ‰ï¼Œé‚£ä¸å¦¨è¯•ç”¨ä¸€ä¸‹ï¼ˆå¦‚æœèƒ½å¸®åˆ°æ‚¨å¯ä»¥ç»™ä¸ª star å“Ÿï¼‰ã€‚ dockerhub å¯èƒ½è®¿é—®æ¯”è¾ƒæ…¢ï¼Œæˆ–è€…å¯èƒ½ä¼šå‡ºç°æ— æ³•è®¿é—®çš„æƒ…å†µï¼Œè¿™é‡Œè´´ä¸€äº›å…³é”®ä¿¡æ¯ã€‚ ","date":"2020-11-25","objectID":"/golang/oracle-golang/:5:0","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/golang/oracle-golang/"},{"categories":null,"content":"é•œåƒè¯´æ˜ é•œåƒåç§° russellgao/oracle:centos7-client12.2 æ“ä½œç³»ç»Ÿ centos:centos7.9.2009 oracle client ç‰ˆæœ¬ oracle-instantclient12.2-basic-12.2.0.1.0-1.x86_64 åŸºäºåŸºç¡€é•œåƒä¼˜åŒ–çš„éƒ¨åˆ† è°ƒæ•´æ—¶åŒºä¸º CST æ—¶åŒº ï¼ˆUTC +8ï¼‰ é•œåƒç”¨æ³• è¿™ä¸ªä¸€èˆ¬ç”¨ä½œåŸºç¡€é•œåƒ æˆ–è€…: docker run -it --rm russellgao/oracle:centos7-client12.2 date or docker run -d russellgao/oracle:centos7-client12.2 tail -f /dev/null ","date":"2020-11-25","objectID":"/golang/oracle-golang/:5:1","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/golang/oracle-golang/"},{"categories":null,"content":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","date":"2020-11-25","objectID":"/oracle-golang/","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/oracle-golang/"},{"categories":null,"content":"å¯¼è¯» è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»å¦‚ä½•åˆ©ç”¨ golang æ“ä½œ oracle æ•°æ®åº“ï¼ŒåŒ…æ‹¬åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ï¼Œæœ¬åœ° oracle ç¯å¢ƒæ­å»ºï¼Œä»¥åŠå¦‚ä½•åœ¨ docker ä¸­è¿è¡Œã€‚ oracle client é•œåƒæ„å»ºå¹¶ä¸å®¹æ˜“ï¼ŒèŠ±äº†å¾ˆé•¿æ—¶é—´å»è¸©å‘ï¼Œæ–‡ä¸­æä¾›äº†å·²ç»æ„å»ºå¥½çš„åŸºç¡€é•œåƒï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè¿™é‡Œè´¡çŒ®ç»™å¤§å®¶ã€‚ ","date":"2020-11-25","objectID":"/oracle-golang/:1:0","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/oracle-golang/"},{"categories":null,"content":"æœ¬åœ°ç¯å¢ƒæ„å»º ","date":"2020-11-25","objectID":"/oracle-golang/:2:0","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/oracle-golang/"},{"categories":null,"content":"å®‰è£…å®¢æˆ·ç«¯ oracle å®¢æˆ·ç«¯ä¸‹è½½é¡µé¢: https://www.oracle.com/database/technologies/instant-client/downloads.html mac https://www.oracle.com/database/technologies/instant-client/macos-intel-x86-downloads.html åœ¨ä¸Šé¢çš„é¡µé¢ä¸‹è½½ä¹‹åæ‰§è¡Œ: # è§£å‹ cd ~ unzip instantclient-basic-macos.x64-19.3.0.0.0dbru.zip # åˆ›å»ºlink mkdir ~/lib ln -s ~/instantclient_19_3/libclntsh.dylib ~/lib/ æˆ‘æœ¬åœ°ç¯å¢ƒç¯å¢ƒæ˜¯ mac ï¼Œè¿™ä¸ªäº²æµ‹æœ‰ç”¨ã€‚linux å’Œ windows åªç»™å‡ºäº†ç›¸å…³å‚è€ƒè¿æ¥ï¼Œæ²¡æœ‰å®é™…æ“ç»ƒè¿‡ã€‚ linux https://www.oracle.com/database/technologies/instant-client/linux-x86-64-downloads.html windows https://www.oracle.com/database/technologies/instant-client/winx64-64-downloads.html ","date":"2020-11-25","objectID":"/oracle-golang/:2:1","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/oracle-golang/"},{"categories":null,"content":"ç”¨æ³• go æ“ä½œ oracle å¯ä»¥ä½¿ç”¨ github.com/godror/godror ï¼Œå¦‚ package main import ( \"database/sql\" \"fmt\" _ \"github.com/godror/godror\" \"os\" ) func main() { connString := \"oracle://hd40:xxx@121.196.127.xxx:1521/ylyx?charset=utf8\" db, err := sql.Open(\"godror\", connString) if err != nil { fmt.Println(err) os.Exit(10) } // æ³¨æ„ä¸è¦ sql è¯­å¥ä¸è¦ä½¿ç”¨ ; å·ç»“å°¾ï¼Œå¦åˆ™ä¼šæŠ¥é”™ // dpiStmt_execute: ORA-00911: invalid character sql := \"select * from user_tables \" rows, err1 := db.Query(sql) if err1 != nil { fmt.Println(err1) os.Exit(10) } result, err2 := GetQueryResult(rows) if err2 != nil { fmt.Println(err2) os.Exit(10) } fmt.Println(result) fmt.Println(\"end\") } func GetQueryResult(query *sql.Rows) ([]map[string]string, error) { column, _ := query.Columns() //è¯»å‡ºæŸ¥è¯¢å‡ºçš„åˆ—å­—æ®µå values := make([][]byte, len(column)) //valuesæ˜¯æ¯ä¸ªåˆ—çš„å€¼ï¼Œè¿™é‡Œè·å–åˆ°byteé‡Œ scans := make([]interface{}, len(column)) //å› ä¸ºæ¯æ¬¡æŸ¥è¯¢å‡ºæ¥çš„åˆ—æ˜¯ä¸å®šé•¿çš„ï¼Œç”¨len(column)å®šä½å½“æ¬¡æŸ¥è¯¢çš„é•¿åº¦ for i := range values { //è®©æ¯ä¸€è¡Œæ•°æ®éƒ½å¡«å……åˆ°[][]byteé‡Œé¢ scans[i] = \u0026values[i] } results := []map[string]string{} for query.Next() { //å¾ªç¯ï¼Œè®©æ¸¸æ ‡å¾€ä¸‹ç§»åŠ¨ if err := query.Scan(scans...); err != nil { //query.ScanæŸ¥è¯¢å‡ºæ¥çš„ä¸å®šé•¿å€¼æ”¾åˆ°scans[i] = \u0026values[i],ä¹Ÿå°±æ˜¯æ¯è¡Œéƒ½æ”¾åœ¨valuesé‡Œ fmt.Println(err) return nil, err } row := make(map[string]string) //æ¯è¡Œæ•°æ® for k, v := range values { //æ¯è¡Œæ•°æ®æ˜¯æ”¾åœ¨valuesé‡Œé¢ï¼Œç°åœ¨æŠŠå®ƒæŒªåˆ°rowé‡Œ key := column[k] row[key] = string(v) } results = append(results, row) } query.Close() return results, nil } ç”¨æ³•è¯´æ˜ : _ \"github.com/godror/godror\" è¿™å¥æ˜¯è¯´æ˜ sql çš„ driver æ˜¯ oracle ï¼Œå¦‚æœè¦æ“ä½œ mysql ï¼Œæ¢æˆ mysql çš„ driver (_ \"github.com/go-sql-driver/mysql\") å³å¯ã€‚ crud æ“ä½œè¿˜æ˜¯è°ƒç”¨ database/sql è¿›è¡Œå®Œæˆã€‚ æš´éœ²å‡ºæ¥ç»™ç”¨æˆ·çš„è¿˜æ˜¯ *sql.DB ã€‚æŸ¥è¯¢å¯ä»¥è°ƒç”¨ *sql.DB çš„ Query æ–¹æ³•ï¼Œæ‰§è¡Œå…¶ä»– sql åˆ™è°ƒç”¨ Exec æ–¹æ³•ã€‚ ","date":"2020-11-25","objectID":"/oracle-golang/:3:0","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/oracle-golang/"},{"categories":null,"content":"å¸¸è§æŠ¥é”™ å¦‚æœæŠ¥å¦‚ä¸‹é”™è¯¯: (cx_Oracle.DatabaseError) DPI-1047: Cannot locate a 64-bit Oracle Client library: \"dlopen(libclntsh.dylib, 1): image not found\". See https://cx-oracle.readthedocs.io/en/latest/user_guide/installation.html for help è¯´æ˜oracleçš„ client æ²¡æœ‰æ­£ç¡®å®‰è£… å¦‚æœæŠ¥é”™å¦‚ä¸‹: (cx_Oracle.DatabaseError) ORA-01017: invalid username/password; logon denied è¯´æ˜oracle çš„ç”¨æˆ·å¯†ç ä¸æ­£ç¡® å¦‚æœæŠ¥é”™å¦‚ä¸‹: dpiStmt_execute: ORA-00911: invalid character è¯´æ˜ sql ä¸­åŒ…å«æ— æ•ˆå­—ç¬¦ï¼Œè¯·æ³¨æ„å¦‚æœ sql ä¸­åŒ…å« ; å°±ä¼šæŠ¥é”™ï¼Œéœ€è¦æŠŠ sql ä¸­çš„ ; trim æ‰ã€‚æˆ‘å†™äº†ä¸ªæ ‡å‡†åŒ– sql çš„æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒ: // å»æ‰è¡Œé¦–å’Œè¡Œå°¾çš„ç©ºç™½å­—ç¬¦ func TrimBlankSpace(s string) string { _s := regexp.MustCompile(\"^\\\\s+\").ReplaceAll([]byte(s), []byte(\"\")) _s = regexp.MustCompile(\"\\\\s+$\").ReplaceAll(_s, []byte(\"\")) return string(_s) } // å»æ‰ ; å¹¶ä¸”å…¨éƒ¨è½¬ä¸ºå¤§å†™å­—ç¬¦ func FormatSql(sql string) string { sql = TrimBlankSpace(sql) sql = strings.TrimRight(sql, \";\") return strings.ToUpper(sql) } ","date":"2020-11-25","objectID":"/oracle-golang/:4:0","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/oracle-golang/"},{"categories":null,"content":"docker ä¸­è¿è¡Œ æˆ‘å°è¯•è¿‡ç”¨ alpine åšåŸºç¡€é•œåƒï¼Œç„¶åè¿›è¡Œå®‰è£… oracle clientï¼ŒæŠŠ oracle client å®‰è£…å®Œæˆä¹‹åï¼Œè¿è¡Œç¼–è¯‘å®Œçš„ golang ç¨‹åºï¼Œ å‡ºç°äº†å„ç§ç¼ºå°‘åŠ¨æ€åº“çš„é—®é¢˜ï¼ŒæŸ¥äº†å¾ˆå¤šèµ„æ–™ï¼Œå’Œ apline çš„å®˜æ–¹æºéƒ½å½»åº•æ²¡æœ‰è§£å†³ï¼Œç„¶åå°±å‡†å¤‡åœ¨ dockerhub æ‰¾ä¸€ä¸ªç°æˆçš„æ‹¿è¿‡æ¥å‚è€ƒï¼Œ å¾ˆé—æ†¾æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥ç›´æ¥ç”¨çš„ï¼Œæœ€åæ”¾å¼ƒäº† alpine è¿™æ¡è·¯ï¼Œé€‰æ‹© alpine æ˜¯å› ä¸º alpine é•œåƒæ¯”è¾ƒå°ï¼Œè¿™æ ·åšå‡ºæ¥çš„é•œåƒæ¯”è¾ƒå°ã€‚ çœ‹äº† oracle client å®˜æ–¹ä¸‹è½½å’Œå®‰è£…è¯´æ˜ï¼Œä¹Ÿéƒ½æ˜¯ centos çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥å°±åŸºäº centos åšäº†ä¸€ä¸ªåŒ…å« oracle client çš„åŸºç¡€é•œåƒã€‚ å·²ç»ä¸Šä¼ åˆ° dockerhub äº†ï¼Œå‚è§: https://hub.docker.com/r/russellgao/oracle å¦‚æœä½ åˆšå¥½éœ€è¦ï¼Œè€Œæˆ‘åˆšå¥½æœ‰ï¼Œé‚£ä¸å¦¨è¯•ç”¨ä¸€ä¸‹ï¼ˆå¦‚æœèƒ½å¸®åˆ°æ‚¨å¯ä»¥ç»™ä¸ª star å“Ÿï¼‰ã€‚ dockerhub å¯èƒ½è®¿é—®æ¯”è¾ƒæ…¢ï¼Œæˆ–è€…å¯èƒ½ä¼šå‡ºç°æ— æ³•è®¿é—®çš„æƒ…å†µï¼Œè¿™é‡Œè´´ä¸€äº›å…³é”®ä¿¡æ¯ã€‚ ","date":"2020-11-25","objectID":"/oracle-golang/:5:0","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/oracle-golang/"},{"categories":null,"content":"é•œåƒè¯´æ˜ é•œåƒåç§° russellgao/oracle:centos7-client12.2 æ“ä½œç³»ç»Ÿ centos:centos7.9.2009 oracle client ç‰ˆæœ¬ oracle-instantclient12.2-basic-12.2.0.1.0-1.x86_64 åŸºäºåŸºç¡€é•œåƒä¼˜åŒ–çš„éƒ¨åˆ† è°ƒæ•´æ—¶åŒºä¸º CST æ—¶åŒº ï¼ˆUTC +8ï¼‰ é•œåƒç”¨æ³• è¿™ä¸ªä¸€èˆ¬ç”¨ä½œåŸºç¡€é•œåƒ æˆ–è€…: docker run -it --rm russellgao/oracle:centos7-client12.2 date or docker run -d russellgao/oracle:centos7-client12.2 tail -f /dev/null ","date":"2020-11-25","objectID":"/oracle-golang/:5:1","tags":["golang","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ golang æ“çºµ oracle","uri":"/oracle-golang/"},{"categories":null,"content":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","date":"2020-11-24","objectID":"/kubernetes/pod-create/","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/kubernetes/pod-create/"},{"categories":null,"content":"å¯¼è¯» Pod åº”è¯¥ç®—æ˜¯ kubernetes çš„åŸºæœ¬ç›˜ï¼ŒPod æ˜¯ kubernetes çš„æœ€å°è°ƒåº¦å•ä½ï¼Œæˆ‘è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œè¯´é€šè¿‡ kubectl apply -f åˆ›å»ºä¸€ä¸ª Pod ï¼Œä»æ‰§è¡Œåˆ° Pod æ­£å¸¸è¿è¡Œ kubernetes åšäº†ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿéƒ½æœ‰å“ªäº›ç»„ä»¶å‚ä¸å‘¢ï¼Ÿè¿™ç¯‡æ–‡æ¡£ä¸»è¦è®²è¿°ä»æäº¤ Pod çš„åˆ›å»ºè¯·æ±‚åˆ° Pod çš„æ­£å¸¸è¿è¡Œçš„è¿™ä¸ªè¿‡ç¨‹è¿½è¸ªã€‚ ","date":"2020-11-24","objectID":"/kubernetes/pod-create/:1:0","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/kubernetes/pod-create/"},{"categories":null,"content":"kubectl é˜¶æ®µ kubectl apply é˜¶æ®µå…¶å®åˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ ï¼Œå…ˆè°ƒç”¨ get æ–¹æ³•ï¼ŒæŸ¥çœ‹èµ„æºæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è°ƒç”¨ patch, å¦åˆ™æ‰§è¡Œ create æ–¹æ³•ã€‚ è¿™ä¸ªè¿‡ç¨‹å¯ä»¥å‚è€ƒæºç ï¼ˆæ–‡ç« ä¸­æ‰€æœ‰æºç éƒ½æˆªå–äº†éƒ¨åˆ†ï¼Œè¯¦ç»†å¯ä»¥åœ¨åœ¨ç»™å‡ºçš„é“¾æ¥ä¸­æŸ¥çœ‹ï¼‰: vendor/k8s.io/kubectl/pkg/cmd/apply/apply.go // NewCmdApply creates the `apply` command func NewCmdApply(baseName string, f cmdutil.Factory, ioStreams genericclioptions.IOStreams) *cobra.Command { o := NewApplyOptions(ioStreams) cmd := \u0026cobra.Command{ Use: \"apply (-f FILENAME | -k DIRECTORY)\", DisableFlagsInUseLine: true, Short: i18n.T(\"Apply a configuration to a resource by filename or stdin\"), Long: applyLong, Example: applyExample, Run: func(cmd *cobra.Command, args []string) { cmdutil.CheckErr(o.Complete(f, cmd)) cmdutil.CheckErr(validateArgs(cmd, args)) cmdutil.CheckErr(validatePruneAll(o.Prune, o.All, o.Selector)) cmdutil.CheckErr(o.Run()) }, } ... } // Run executes the `apply` command. func (o *ApplyOptions) Run() error { ... // Iterate through all objects, applying each one. for _, info := range infos { if err := o.applyOneObject(info); err != nil { errs = append(errs, err) } } ... return nil } func (o *ApplyOptions) applyOneObject(info *resource.Info) error { ... // Get the modified configuration of the object. Embed the result // as an annotation in the modified configuration, so that it will appear // in the patch sent to the server. modified, err := util.GetModifiedConfiguration(info.Object, true, unstructured.UnstructuredJSONScheme) if err != nil { return cmdutil.AddSourceToErr(fmt.Sprintf(\"retrieving modified configuration from:\\n%s\\nfor:\", info.String()), info.Source, err) } if err := info.Get(); err != nil { if !errors.IsNotFound(err) { return cmdutil.AddSourceToErr(fmt.Sprintf(\"retrieving current configuration of:\\n%s\\nfrom server for:\", info.String()), info.Source, err) } // Create the resource if it doesn't exist // First, update the annotation used by kubectl apply if err := util.CreateApplyAnnotation(info.Object, unstructured.UnstructuredJSONScheme); err != nil { return cmdutil.AddSourceToErr(\"creating\", info.Source, err) } if o.DryRunStrategy != cmdutil.DryRunClient { // Then create the resource and skip the three-way merge obj, err := helper.Create(info.Namespace, true, info.Object) if err != nil { return cmdutil.AddSourceToErr(\"creating\", info.Source, err) } info.Refresh(obj, true) } if err := o.MarkObjectVisited(info); err != nil { return err } if o.shouldPrintObject() { return nil } printer, err := o.ToPrinter(\"created\") if err != nil { return err } if err = printer.PrintObj(info.Object, o.Out); err != nil { return err } return nil } if err := o.MarkObjectVisited(info); err != nil { return err } if o.DryRunStrategy != cmdutil.DryRunClient { metadata, _ := meta.Accessor(info.Object) annotationMap := metadata.GetAnnotations() if _, ok := annotationMap[corev1.LastAppliedConfigAnnotation]; !ok { fmt.Fprintf(o.ErrOut, warningNoLastAppliedConfigAnnotation, o.cmdBaseName) } patcher, err := newPatcher(o, info, helper) if err != nil { return err } patchBytes, patchedObject, err := patcher.Patch(info.Object, modified, info.Source, info.Namespace, info.Name, o.ErrOut) if err != nil { return cmdutil.AddSourceToErr(fmt.Sprintf(\"applying patch:\\n%s\\nto:\\n%v\\nfor:\", patchBytes, info), info.Source, err) } info.Refresh(patchedObject, true) if string(patchBytes) == \"{}\" \u0026\u0026 !o.shouldPrintObject() { printer, err := o.ToPrinter(\"unchanged\") if err != nil { return err } if err = printer.PrintObj(info.Object, o.Out); err != nil { return err } return nil } } ... return nil } apply å‘½ä»¤è°ƒç”¨ o.Run() æ‰§è¡Œ åˆ›å»ºçš„åŠ¨ä½œ applyOneObject æ–¹æ³•æ˜¯çœŸæ­£æ‰§è¡Œåˆ›å»º Pod çš„åŠ¨ä½œ åœ¨ applyOneObject æ–¹æ³•ä¸­é€šè¿‡ GetModifiedConfiguration å‡½æ•°æ‰§è¡Œ get åŠ¨ä½œ å¦‚æœæ˜¯ IsNotFound å¼‚å¸¸åˆ™ æ‰§è¡Œ Create åŠ¨ä½œ å¦åˆ™æ‰§è¡Œ Patch åŠ¨ä½œ ä¸Šè¿°è¿‡ç¨‹é™¤äº†ç”¨ kubectl ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±è°ƒç”¨ api å»åˆ›å»ºæˆ–è€…æ›´æ–° ã€‚ ","date":"2020-11-24","objectID":"/kubernetes/pod-create/:2:0","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/kubernetes/pod-create/"},{"categories":null,"content":"apiserver é€šè¿‡å®¢æˆ·ç«¯æŠŠè¯·æ±‚æäº¤åˆ° apiserver ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯ apiserver è¡¨æ¼”çš„æ—¶å€™äº†ã€‚ apiserver ä¼šæŠŠ pod æ•°æ®å­˜å‚¨åˆ° etcd ä¸­ã€‚ ","date":"2020-11-24","objectID":"/kubernetes/pod-create/:3:0","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/kubernetes/pod-create/"},{"categories":null,"content":"Schedule Scheduleé€šè¿‡å’ŒAPI Serverçš„watchæœºåˆ¶ï¼ŒæŸ¥çœ‹åˆ°æ–°çš„Podï¼ˆé€šè¿‡ pod.spec.Node == nil åˆ¤æ–­æ˜¯å¦ä¸ºæ–°çš„Podï¼‰ï¼Œå°è¯•ä¸ºPodç»‘å®šNodeã€‚Schedle çš„è¿‡ç¨‹ä¸º : è¿‡æ»¤ä¸»æœºï¼šè°ƒåº¦å™¨ç”¨ä¸€ç»„è§„åˆ™è¿‡æ»¤æ‰ä¸ç¬¦åˆè¦æ±‚çš„ä¸»æœºï¼Œæ¯”å¦‚PodæŒ‡å®šäº†æ‰€éœ€è¦çš„èµ„æºï¼Œé‚£ä¹ˆå°±è¦è¿‡æ»¤æ‰èµ„æºä¸å¤Ÿçš„ä¸»æœº ä¸»æœºæ‰“åˆ†ï¼šå¯¹ç¬¬ä¸€æ­¥ç­›é€‰å‡ºçš„ç¬¦åˆè¦æ±‚çš„ä¸»æœºè¿›è¡Œæ‰“åˆ†ï¼Œåœ¨ä¸»æœºæ‰“åˆ†é˜¶æ®µï¼Œè°ƒåº¦å™¨ä¼šè€ƒè™‘ä¸€äº›æ•´ä½“ä¼˜åŒ–ç­–ç•¥ï¼Œæ¯”å¦‚æŠŠä¸€ä¸ªReplication Controllerçš„å‰¯æœ¬åˆ†å¸ƒåˆ°ä¸åŒçš„ä¸»æœºä¸Šï¼Œä½¿ç”¨æœ€ä½è´Ÿè½½çš„ä¸»æœºç­‰ é€‰æ‹©ä¸»æœºï¼šé€‰æ‹©æ‰“åˆ†æœ€é«˜çš„ä¸»æœºï¼Œè¿›è¡Œbindingæ“ä½œ æŠŠè°ƒåº¦ç»“æœé€šè¿‡apiserver å­˜å‚¨åˆ° etcd ä¸­ ","date":"2020-11-24","objectID":"/kubernetes/pod-create/:4:0","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/kubernetes/pod-create/"},{"categories":null,"content":"kubelet kubeletä»apiserverè·å–åˆ†é…åˆ°å…¶æ‰€åœ¨èŠ‚ç‚¹çš„Podï¼ˆwatch æœºåˆ¶ï¼‰ kubeletè°ƒç”¨Dockerçš„ Api åˆ›å»ºå®¹å™¨ï¼Œåˆ›å»ºå®¹å™¨çš„è¿‡ç¨‹ä¸º: å…ˆæŒ‰é¡ºåºå¯åŠ¨ initContainers æŒ‰ç…§ yaml ä¸­ç”³æ˜çš„é¡ºåº å¹¶å‘å¯åŠ¨ containers kubeletå°†PodçŠ¶æ€æ›´æ–°åˆ°apiserver apiserverå°†çŠ¶æ€ä¿¡æ¯å†™åˆ°etcdä¸­ ","date":"2020-11-24","objectID":"/kubernetes/pod-create/:5:0","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/kubernetes/pod-create/"},{"categories":null,"content":"æ€»ç»“ ä¸Šé¢æ¯ä¸ªæ­¥éª¤å•æ‹å‡ºæ¥éƒ½èƒ½æœ‰å¥½å¤šä¸œè¥¿å¯ä»¥æ·±å…¥ä¸‹å»ï¼Œè¿™é‡Œä»æµç¨‹ä¸Šç®€å•çš„ä»‹ç»äº†ä¸€ä¸ªPod ä»å‘èµ·åˆ›å»ºè¯·æ±‚åˆ°æœ€ç»ˆåˆ›å»ºçš„ä¸€ä¸ªæ–‡å­—ç‰ˆæµç¨‹ï¼Œä»…ä¾›å‚è€ƒã€‚ åç»­å†è¯¦ç»†åˆ†ææ¯ä¸ªç»„ä»¶ã€‚ Pod çš„åˆ›å»ºè¿‡ç¨‹ : kubectl apply æ‰§è¡Œè¿‡ç¨‹: å…ˆé€šè¿‡ get æŸ¥æ‰¾èµ„æºå¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ create pod å¦åˆ™ patch pod é€šè¿‡ apply æäº¤è¯·æ±‚åˆ° apiserver ï¼Œapiserver æŠŠ pod æ•°æ®å­˜å‚¨åˆ° etcd ä¸­ Scheduleé€šè¿‡å’ŒAPI Serverçš„watchæœºåˆ¶ï¼ŒæŸ¥çœ‹åˆ°æ–°çš„Podï¼ˆé€šè¿‡ pod.spec.Node == nil åˆ¤æ–­æ˜¯å¦ä¸ºæ–°çš„Podï¼‰ï¼Œå°è¯•ä¸ºPodç»‘å®šNodeã€‚Schedle çš„è¿‡ç¨‹ä¸º: è¿‡æ»¤ä¸»æœºï¼šè°ƒåº¦å™¨ç”¨ä¸€ç»„è§„åˆ™è¿‡æ»¤æ‰ä¸ç¬¦åˆè¦æ±‚çš„ä¸»æœºï¼Œæ¯”å¦‚PodæŒ‡å®šäº†æ‰€éœ€è¦çš„èµ„æºï¼Œé‚£ä¹ˆå°±è¦è¿‡æ»¤æ‰èµ„æºä¸å¤Ÿçš„ä¸»æœº ä¸»æœºæ‰“åˆ†ï¼šå¯¹ç¬¬ä¸€æ­¥ç­›é€‰å‡ºçš„ç¬¦åˆè¦æ±‚çš„ä¸»æœºè¿›è¡Œæ‰“åˆ†ï¼Œåœ¨ä¸»æœºæ‰“åˆ†é˜¶æ®µï¼Œè°ƒåº¦å™¨ä¼šè€ƒè™‘ä¸€äº›æ•´ä½“ä¼˜åŒ–ç­–ç•¥ï¼Œæ¯”å¦‚æŠŠä¸€ä¸ªReplication Controllerçš„å‰¯æœ¬åˆ†å¸ƒåˆ°ä¸åŒçš„ä¸»æœºä¸Šï¼Œä½¿ç”¨æœ€ä½è´Ÿè½½çš„ä¸»æœºç­‰ é€‰æ‹©ä¸»æœºï¼šé€‰æ‹©æ‰“åˆ†æœ€é«˜çš„ä¸»æœºï¼Œè¿›è¡Œbindingæ“ä½œ æŠŠè°ƒåº¦ç»“æœé€šè¿‡apiserver å­˜å‚¨åˆ° etcd ä¸­ kubeletä»apiserverè·å–åˆ†é…åˆ°å…¶æ‰€åœ¨èŠ‚ç‚¹çš„Podï¼ˆwatch æœºåˆ¶ï¼‰ kubeletè°ƒç”¨Dockerçš„ Api åˆ›å»ºå®¹å™¨ï¼Œåˆ›å»ºå®¹å™¨çš„è¿‡ç¨‹ä¸º: å…ˆæŒ‰é¡ºåºå¯åŠ¨ initContainers æŒ‰ç…§ yaml ä¸­ç”³æ˜çš„é¡ºåº å¹¶å‘å¯åŠ¨ containers kubeletå°†PodçŠ¶æ€æ›´æ–°åˆ°apiserver apiserverå°†çŠ¶æ€ä¿¡æ¯å†™åˆ°etcdä¸­ ","date":"2020-11-24","objectID":"/kubernetes/pod-create/:6:0","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/kubernetes/pod-create/"},{"categories":null,"content":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","date":"2020-11-24","objectID":"/pod-create/","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/pod-create/"},{"categories":null,"content":"å¯¼è¯» Pod åº”è¯¥ç®—æ˜¯ kubernetes çš„åŸºæœ¬ç›˜ï¼ŒPod æ˜¯ kubernetes çš„æœ€å°è°ƒåº¦å•ä½ï¼Œæˆ‘è¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œè¯´é€šè¿‡ kubectl apply -f åˆ›å»ºä¸€ä¸ª Pod ï¼Œä»æ‰§è¡Œåˆ° Pod æ­£å¸¸è¿è¡Œ kubernetes åšäº†ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿéƒ½æœ‰å“ªäº›ç»„ä»¶å‚ä¸å‘¢ï¼Ÿè¿™ç¯‡æ–‡æ¡£ä¸»è¦è®²è¿°ä»æäº¤ Pod çš„åˆ›å»ºè¯·æ±‚åˆ° Pod çš„æ­£å¸¸è¿è¡Œçš„è¿™ä¸ªè¿‡ç¨‹è¿½è¸ªã€‚ ","date":"2020-11-24","objectID":"/pod-create/:1:0","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/pod-create/"},{"categories":null,"content":"kubectl é˜¶æ®µ kubectl apply é˜¶æ®µå…¶å®åˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ ï¼Œå…ˆè°ƒç”¨ get æ–¹æ³•ï¼ŒæŸ¥çœ‹èµ„æºæ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è°ƒç”¨ patch, å¦åˆ™æ‰§è¡Œ create æ–¹æ³•ã€‚ è¿™ä¸ªè¿‡ç¨‹å¯ä»¥å‚è€ƒæºç ï¼ˆæ–‡ç« ä¸­æ‰€æœ‰æºç éƒ½æˆªå–äº†éƒ¨åˆ†ï¼Œè¯¦ç»†å¯ä»¥åœ¨åœ¨ç»™å‡ºçš„é“¾æ¥ä¸­æŸ¥çœ‹ï¼‰: vendor/k8s.io/kubectl/pkg/cmd/apply/apply.go // NewCmdApply creates the `apply` command func NewCmdApply(baseName string, f cmdutil.Factory, ioStreams genericclioptions.IOStreams) *cobra.Command { o := NewApplyOptions(ioStreams) cmd := \u0026cobra.Command{ Use: \"apply (-f FILENAME | -k DIRECTORY)\", DisableFlagsInUseLine: true, Short: i18n.T(\"Apply a configuration to a resource by filename or stdin\"), Long: applyLong, Example: applyExample, Run: func(cmd *cobra.Command, args []string) { cmdutil.CheckErr(o.Complete(f, cmd)) cmdutil.CheckErr(validateArgs(cmd, args)) cmdutil.CheckErr(validatePruneAll(o.Prune, o.All, o.Selector)) cmdutil.CheckErr(o.Run()) }, } ... } // Run executes the `apply` command. func (o *ApplyOptions) Run() error { ... // Iterate through all objects, applying each one. for _, info := range infos { if err := o.applyOneObject(info); err != nil { errs = append(errs, err) } } ... return nil } func (o *ApplyOptions) applyOneObject(info *resource.Info) error { ... // Get the modified configuration of the object. Embed the result // as an annotation in the modified configuration, so that it will appear // in the patch sent to the server. modified, err := util.GetModifiedConfiguration(info.Object, true, unstructured.UnstructuredJSONScheme) if err != nil { return cmdutil.AddSourceToErr(fmt.Sprintf(\"retrieving modified configuration from:\\n%s\\nfor:\", info.String()), info.Source, err) } if err := info.Get(); err != nil { if !errors.IsNotFound(err) { return cmdutil.AddSourceToErr(fmt.Sprintf(\"retrieving current configuration of:\\n%s\\nfrom server for:\", info.String()), info.Source, err) } // Create the resource if it doesn't exist // First, update the annotation used by kubectl apply if err := util.CreateApplyAnnotation(info.Object, unstructured.UnstructuredJSONScheme); err != nil { return cmdutil.AddSourceToErr(\"creating\", info.Source, err) } if o.DryRunStrategy != cmdutil.DryRunClient { // Then create the resource and skip the three-way merge obj, err := helper.Create(info.Namespace, true, info.Object) if err != nil { return cmdutil.AddSourceToErr(\"creating\", info.Source, err) } info.Refresh(obj, true) } if err := o.MarkObjectVisited(info); err != nil { return err } if o.shouldPrintObject() { return nil } printer, err := o.ToPrinter(\"created\") if err != nil { return err } if err = printer.PrintObj(info.Object, o.Out); err != nil { return err } return nil } if err := o.MarkObjectVisited(info); err != nil { return err } if o.DryRunStrategy != cmdutil.DryRunClient { metadata, _ := meta.Accessor(info.Object) annotationMap := metadata.GetAnnotations() if _, ok := annotationMap[corev1.LastAppliedConfigAnnotation]; !ok { fmt.Fprintf(o.ErrOut, warningNoLastAppliedConfigAnnotation, o.cmdBaseName) } patcher, err := newPatcher(o, info, helper) if err != nil { return err } patchBytes, patchedObject, err := patcher.Patch(info.Object, modified, info.Source, info.Namespace, info.Name, o.ErrOut) if err != nil { return cmdutil.AddSourceToErr(fmt.Sprintf(\"applying patch:\\n%s\\nto:\\n%v\\nfor:\", patchBytes, info), info.Source, err) } info.Refresh(patchedObject, true) if string(patchBytes) == \"{}\" \u0026\u0026 !o.shouldPrintObject() { printer, err := o.ToPrinter(\"unchanged\") if err != nil { return err } if err = printer.PrintObj(info.Object, o.Out); err != nil { return err } return nil } } ... return nil } apply å‘½ä»¤è°ƒç”¨ o.Run() æ‰§è¡Œ åˆ›å»ºçš„åŠ¨ä½œ applyOneObject æ–¹æ³•æ˜¯çœŸæ­£æ‰§è¡Œåˆ›å»º Pod çš„åŠ¨ä½œ åœ¨ applyOneObject æ–¹æ³•ä¸­é€šè¿‡ GetModifiedConfiguration å‡½æ•°æ‰§è¡Œ get åŠ¨ä½œ å¦‚æœæ˜¯ IsNotFound å¼‚å¸¸åˆ™ æ‰§è¡Œ Create åŠ¨ä½œ å¦åˆ™æ‰§è¡Œ Patch åŠ¨ä½œ ä¸Šè¿°è¿‡ç¨‹é™¤äº†ç”¨ kubectl ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå·±è°ƒç”¨ api å»åˆ›å»ºæˆ–è€…æ›´æ–° ã€‚ ","date":"2020-11-24","objectID":"/pod-create/:2:0","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/pod-create/"},{"categories":null,"content":"apiserver é€šè¿‡å®¢æˆ·ç«¯æŠŠè¯·æ±‚æäº¤åˆ° apiserver ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯ apiserver è¡¨æ¼”çš„æ—¶å€™äº†ã€‚ apiserver ä¼šæŠŠ pod æ•°æ®å­˜å‚¨åˆ° etcd ä¸­ã€‚ ","date":"2020-11-24","objectID":"/pod-create/:3:0","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/pod-create/"},{"categories":null,"content":"Schedule Scheduleé€šè¿‡å’ŒAPI Serverçš„watchæœºåˆ¶ï¼ŒæŸ¥çœ‹åˆ°æ–°çš„Podï¼ˆé€šè¿‡ pod.spec.Node == nil åˆ¤æ–­æ˜¯å¦ä¸ºæ–°çš„Podï¼‰ï¼Œå°è¯•ä¸ºPodç»‘å®šNodeã€‚Schedle çš„è¿‡ç¨‹ä¸º : è¿‡æ»¤ä¸»æœºï¼šè°ƒåº¦å™¨ç”¨ä¸€ç»„è§„åˆ™è¿‡æ»¤æ‰ä¸ç¬¦åˆè¦æ±‚çš„ä¸»æœºï¼Œæ¯”å¦‚PodæŒ‡å®šäº†æ‰€éœ€è¦çš„èµ„æºï¼Œé‚£ä¹ˆå°±è¦è¿‡æ»¤æ‰èµ„æºä¸å¤Ÿçš„ä¸»æœº ä¸»æœºæ‰“åˆ†ï¼šå¯¹ç¬¬ä¸€æ­¥ç­›é€‰å‡ºçš„ç¬¦åˆè¦æ±‚çš„ä¸»æœºè¿›è¡Œæ‰“åˆ†ï¼Œåœ¨ä¸»æœºæ‰“åˆ†é˜¶æ®µï¼Œè°ƒåº¦å™¨ä¼šè€ƒè™‘ä¸€äº›æ•´ä½“ä¼˜åŒ–ç­–ç•¥ï¼Œæ¯”å¦‚æŠŠä¸€ä¸ªReplication Controllerçš„å‰¯æœ¬åˆ†å¸ƒåˆ°ä¸åŒçš„ä¸»æœºä¸Šï¼Œä½¿ç”¨æœ€ä½è´Ÿè½½çš„ä¸»æœºç­‰ é€‰æ‹©ä¸»æœºï¼šé€‰æ‹©æ‰“åˆ†æœ€é«˜çš„ä¸»æœºï¼Œè¿›è¡Œbindingæ“ä½œ æŠŠè°ƒåº¦ç»“æœé€šè¿‡apiserver å­˜å‚¨åˆ° etcd ä¸­ ","date":"2020-11-24","objectID":"/pod-create/:4:0","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/pod-create/"},{"categories":null,"content":"kubelet kubeletä»apiserverè·å–åˆ†é…åˆ°å…¶æ‰€åœ¨èŠ‚ç‚¹çš„Podï¼ˆwatch æœºåˆ¶ï¼‰ kubeletè°ƒç”¨Dockerçš„ Api åˆ›å»ºå®¹å™¨ï¼Œåˆ›å»ºå®¹å™¨çš„è¿‡ç¨‹ä¸º: å…ˆæŒ‰é¡ºåºå¯åŠ¨ initContainers æŒ‰ç…§ yaml ä¸­ç”³æ˜çš„é¡ºåº å¹¶å‘å¯åŠ¨ containers kubeletå°†PodçŠ¶æ€æ›´æ–°åˆ°apiserver apiserverå°†çŠ¶æ€ä¿¡æ¯å†™åˆ°etcdä¸­ ","date":"2020-11-24","objectID":"/pod-create/:5:0","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/pod-create/"},{"categories":null,"content":"æ€»ç»“ ä¸Šé¢æ¯ä¸ªæ­¥éª¤å•æ‹å‡ºæ¥éƒ½èƒ½æœ‰å¥½å¤šä¸œè¥¿å¯ä»¥æ·±å…¥ä¸‹å»ï¼Œè¿™é‡Œä»æµç¨‹ä¸Šç®€å•çš„ä»‹ç»äº†ä¸€ä¸ªPod ä»å‘èµ·åˆ›å»ºè¯·æ±‚åˆ°æœ€ç»ˆåˆ›å»ºçš„ä¸€ä¸ªæ–‡å­—ç‰ˆæµç¨‹ï¼Œä»…ä¾›å‚è€ƒã€‚ åç»­å†è¯¦ç»†åˆ†ææ¯ä¸ªç»„ä»¶ã€‚ Pod çš„åˆ›å»ºè¿‡ç¨‹ : kubectl apply æ‰§è¡Œè¿‡ç¨‹: å…ˆé€šè¿‡ get æŸ¥æ‰¾èµ„æºå¯¹è±¡ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ create pod å¦åˆ™ patch pod é€šè¿‡ apply æäº¤è¯·æ±‚åˆ° apiserver ï¼Œapiserver æŠŠ pod æ•°æ®å­˜å‚¨åˆ° etcd ä¸­ Scheduleé€šè¿‡å’ŒAPI Serverçš„watchæœºåˆ¶ï¼ŒæŸ¥çœ‹åˆ°æ–°çš„Podï¼ˆé€šè¿‡ pod.spec.Node == nil åˆ¤æ–­æ˜¯å¦ä¸ºæ–°çš„Podï¼‰ï¼Œå°è¯•ä¸ºPodç»‘å®šNodeã€‚Schedle çš„è¿‡ç¨‹ä¸º: è¿‡æ»¤ä¸»æœºï¼šè°ƒåº¦å™¨ç”¨ä¸€ç»„è§„åˆ™è¿‡æ»¤æ‰ä¸ç¬¦åˆè¦æ±‚çš„ä¸»æœºï¼Œæ¯”å¦‚PodæŒ‡å®šäº†æ‰€éœ€è¦çš„èµ„æºï¼Œé‚£ä¹ˆå°±è¦è¿‡æ»¤æ‰èµ„æºä¸å¤Ÿçš„ä¸»æœº ä¸»æœºæ‰“åˆ†ï¼šå¯¹ç¬¬ä¸€æ­¥ç­›é€‰å‡ºçš„ç¬¦åˆè¦æ±‚çš„ä¸»æœºè¿›è¡Œæ‰“åˆ†ï¼Œåœ¨ä¸»æœºæ‰“åˆ†é˜¶æ®µï¼Œè°ƒåº¦å™¨ä¼šè€ƒè™‘ä¸€äº›æ•´ä½“ä¼˜åŒ–ç­–ç•¥ï¼Œæ¯”å¦‚æŠŠä¸€ä¸ªReplication Controllerçš„å‰¯æœ¬åˆ†å¸ƒåˆ°ä¸åŒçš„ä¸»æœºä¸Šï¼Œä½¿ç”¨æœ€ä½è´Ÿè½½çš„ä¸»æœºç­‰ é€‰æ‹©ä¸»æœºï¼šé€‰æ‹©æ‰“åˆ†æœ€é«˜çš„ä¸»æœºï¼Œè¿›è¡Œbindingæ“ä½œ æŠŠè°ƒåº¦ç»“æœé€šè¿‡apiserver å­˜å‚¨åˆ° etcd ä¸­ kubeletä»apiserverè·å–åˆ†é…åˆ°å…¶æ‰€åœ¨èŠ‚ç‚¹çš„Podï¼ˆwatch æœºåˆ¶ï¼‰ kubeletè°ƒç”¨Dockerçš„ Api åˆ›å»ºå®¹å™¨ï¼Œåˆ›å»ºå®¹å™¨çš„è¿‡ç¨‹ä¸º: å…ˆæŒ‰é¡ºåºå¯åŠ¨ initContainers æŒ‰ç…§ yaml ä¸­ç”³æ˜çš„é¡ºåº å¹¶å‘å¯åŠ¨ containers kubeletå°†PodçŠ¶æ€æ›´æ–°åˆ°apiserver apiserverå°†çŠ¶æ€ä¿¡æ¯å†™åˆ°etcdä¸­ ","date":"2020-11-24","objectID":"/pod-create/:6:0","tags":["kubernetes","pod","kubectl","kubelet","schedule"],"title":"kubernetes ä¸­ pod æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢","uri":"/pod-create/"},{"categories":null,"content":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","date":"2020-11-23","objectID":"/openresty-server/","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"å¯¼è¯» è¿™ç¯‡æ˜¯ç»§ä¸Šä¸€ç¯‡ openresty é…ç½®æ–‡ä»¶ ï¼ˆä¸€ï¼‰ ä»‹ç»äº† openresty å…¨å±€é…ç½®ä¹‹åï¼Œä»‹ç» openresty server é…ç½®ï¼Œserver çš„é…ç½®ä¸€èˆ¬å•ç‹¬æ”¾åœ¨ conf.d ç›®å½•ä¸‹ã€‚ä¸‹é¢æ˜¯æˆ‘æ¯”è¾ƒæ¨èçš„ conf.d ç›®å½•ç»“æ„ï¼š [root@iZuf685opgs9oyozju9i2bZ conf.d]# tree . â”œâ”€â”€ 443.conf â”œâ”€â”€ 8080.conf â”œâ”€â”€ 80.conf â””â”€â”€ upstream.conf 0 directories, 4 files upstream æ”¾åœ¨å•ç‹¬çš„ é…ç½®æ–‡ä»¶ï¼Œå½“ç„¶å¦‚æœæ¯”è¾ƒå¤šï¼Œå¯ä»¥æŒ‰ç…§ service/product çš„ç»´åº¦å†è¿›è¡Œæ‹†åˆ†ã€‚ä¸åŒçš„ç›‘å¬æ”¾åœ¨å•ç‹¬çš„é…ç½®æ–‡ä»¶ï¼Œç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¥½ç»´æŠ¤ä¸€ç‚¹ï¼Œä¹Ÿæ›´å®¹æ˜“è‡ªåŠ¨åŒ–ç¨‹åºå¤„ç†ã€‚ è¿™ç¯‡æ–‡ç« æ¯”è¾ƒé•¿ï¼Œå¯ä»¥é€šè¿‡ç›®å½•ç›´æ¥è·³è½¬åˆ°è‡ªå·±æ„Ÿå…´è¶£çš„éƒ¨åˆ†ã€‚ ","date":"2020-11-23","objectID":"/openresty-server/:1:0","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"server server æ¨¡å—æ˜¯ä½äº http æ¨¡å—ä¸‹é¢ï¼Œè¿›è¡Œç«¯å£ç›‘å¬ï¼Œå¹¶æŠŠè¯·æ±‚è½¬å‘åˆ° upstream æˆ–è€…ç›´æ¥å“åº”ï¼Œå…ˆçœ‹å®ƒçš„é…ç½®æ˜¯ä»€ä¹ˆæ ·å­ã€‚ server { #é…ç½®ç›‘å¬ç«¯å£ # listen è¯¦ç»†é…ç½®å‚è€ƒ listen ä¸€èŠ‚ listen 80; #é…ç½®è®¿é—®åŸŸåï¼Œå¯ä»¥åªæœ‰ä¸€ä¸ªåç§°ï¼Œä¹Ÿå¯ä»¥ç”±å¤šä¸ªåç§°å¹¶åˆ—ï¼Œä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚æ¯ä¸ªåå­—å°±æ˜¯ä¸€ä¸ªåŸŸåï¼Œç”±ä¸¤æ®µæˆ–è€…ä¸‰æ®µç»„æˆï¼Œä¹‹é—´ç”±ç‚¹å·â€œ.â€éš”å¼€ # ç¬¬ä¸€ä¸ªåç§°ä½œä¸ºæ­¤è™šæ‹Ÿä¸»æœºçš„ä¸»è¦åç§° # server_name æ›´åŠ è¯¦ç»†çš„ç”¨æ³•å‚è€ƒä¸‹é¢ server_name ä¸€èŠ‚ server_name russellgao.cn russellgao.com localhost 127.0.0.1; # log åœ¨å…¨å±€å˜é‡ä¸­å·²ç»é…ç½®ï¼Œä½†æ˜¯æ¯ä¸ªç›‘å¬ä¸­ä¹Ÿå¯ä»¥é…ç½®ï¼Œè¿™æ ·åšçš„å¥½å¤„ï¼Œåœ¨åˆ†ææ—¥å¿—æ—¶æ¯”è¾ƒæ–¹ä¾¿ï¼Œé€šè¿‡æ—¥å¿—å°±å¯ä»¥çŸ¥é“è¯·æ±‚ä»å“ªä¸ªç›‘å¬ä¸­è¿›æ¥çš„ # ä¹Ÿå¯ä»¥æ”¾åœ¨å…·ä½“çš„ location ä¸­ã€‚ access_log /usr/local/openresty/nginx/logs/access.log custom; error_log /usr/local/openresty/nginx/logs/error.log; # ssl é…ç½® ssl on; ssl_certificate /usr/local/openresty/nginx/ssl/4753767.pem; ssl_certificate_key /usr/local/openresty/nginx/ssl/4753767.key; ssl_session_timeout 5m; ssl_protocols SSLv2 SSLv3 TLSv1 TLSv1.2 TLSv1.1; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; # location é…ç½®ï¼Œlocation ä»‹ç»å‚è€ƒä¸‹é¢è¯¦ç»†ä»‹ç» location / { root /usr/local/openresty/nginx/docs; index index.html index.htm; } error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/local/openresty/nginx/html; } error_page 404 /404.html; location = /404.html { root /usr/local/openresty/nginx/docs; } } ä¸€ä¸ª server åªèƒ½ç›‘å¬ä¸€ä¸ªç«¯å£ã€‚ ","date":"2020-11-23","objectID":"/openresty-server/:2:0","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"listen listen æœ‰ä¸‰ç§é…ç½®è¯­æ³•ã€‚è¿™ä¸ªæŒ‡ä»¤é»˜è®¤çš„é…ç½®å€¼æ˜¯ï¼šlisten *:80 | *:8000ï¼›åªèƒ½åœ¨serverå—ç§é…ç½®è¿™ä¸ªæŒ‡ä»¤ã€‚ //ç¬¬ä¸€ç§ listen address[:port] [default_server] [ssl] [http2 | spdy] [proxy_protocol] [setfib=number] [fastopen=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [ipv6only=on|off] [reuseport] [so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]]; //ç¬¬äºŒç§ listen port [default_server] [ssl] [http2 | spdy] [proxy_protocol] [setfib=number] [fastopen=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [ipv6only=on|off] [reuseport] [so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]]; //ç¬¬ä¸‰ç§ï¼ˆå¯ä»¥ä¸ç”¨é‡ç‚¹å…³æ³¨ï¼‰ listen unix:path [default_server] [ssl] [http2 | spdy] [proxy_protocol] [backlog=number] [rcvbuf=size] [sndbuf=size] [accept_filter=filter] [deferred] [bind] [so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]]; listenæŒ‡ä»¤çš„é…ç½®éå¸¸çµæ´»ï¼Œå¯ä»¥å•ç‹¬åˆ¶å®šipï¼Œå•ç‹¬æŒ‡å®šç«¯å£æˆ–è€…åŒæ—¶æŒ‡å®šipå’Œç«¯å£ã€‚ å…³äºä¸Šé¢çš„ä¸€äº›é‡è¦å‚æ•°åšå¦‚ä¸‹è¯´æ˜ï¼š addressï¼šç›‘å¬çš„IPåœ°å€ï¼ˆè¯·æ±‚æ¥æºçš„IPåœ°å€ï¼‰ï¼Œå¦‚æœæ˜¯IPv6çš„åœ°å€ï¼Œéœ€è¦ä½¿ç”¨ä¸­æ‹¬å·â€œ[]â€æ‹¬èµ·æ¥ï¼Œæ¯”å¦‚[fe80::1]ç­‰ã€‚ portï¼šç«¯å£å·ï¼Œå¦‚æœåªå®šä¹‰äº†IPåœ°å€æ²¡æœ‰å®šä¹‰ç«¯å£å·ï¼Œå°±ä½¿ç”¨80ç«¯å£ã€‚è¿™è¾¹éœ€è¦åšä¸ªè¯´æ˜ï¼šè¦æ˜¯ä½ å‹æ ¹æ²¡é…ç½®listenæŒ‡ä»¤ï¼Œé‚£ä¹ˆé‚£ä¹ˆå¦‚æœnginxä»¥è¶…çº§ç”¨æˆ·æƒé™è¿è¡Œï¼Œåˆ™ä½¿ç”¨*:80ï¼Œå¦åˆ™ä½¿ç”¨*:8000ã€‚å¤šä¸ªè™šæ‹Ÿä¸»æœºå¯ä»¥åŒæ—¶ç›‘å¬åŒä¸€ä¸ªç«¯å£,ä½†æ˜¯server_nameéœ€è¦è®¾ç½®æˆä¸ä¸€æ ·ï¼› default_serverï¼šå‡å¦‚é€šè¿‡Hostæ²¡åŒ¹é…åˆ°å¯¹åº”çš„è™šæ‹Ÿä¸»æœºï¼Œåˆ™é€šè¿‡è¿™å°è™šæ‹Ÿä¸»æœºå¤„ç†ã€‚ backlog=numberï¼šè®¾ç½®ç›‘å¬å‡½æ•°listen()æœ€å¤šå…è®¸å¤šå°‘ç½‘ç»œè¿æ¥åŒæ—¶å¤„äºæŒ‚èµ·çŠ¶æ€ï¼Œåœ¨FreeBSDä¸­é»˜è®¤ä¸º-1ï¼Œå…¶ä»–å¹³å°é»˜è®¤ä¸º511ã€‚ accept_filter=filterï¼Œè®¾ç½®ç›‘å¬ç«¯å£å¯¹è¯·æ±‚çš„è¿‡æ»¤ï¼Œè¢«è¿‡æ»¤çš„å†…å®¹ä¸èƒ½è¢«æ¥æ”¶å’Œå¤„ç†ã€‚æœ¬æŒ‡ä»¤åªåœ¨FreeBSDå’ŒNetBSD 5.0+å¹³å°ä¸‹æœ‰æ•ˆã€‚filterå¯ä»¥è®¾ç½®ä¸ºdatareadyæˆ–httpreadyï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥å‚é˜…Nginxçš„å®˜æ–¹æ–‡æ¡£ã€‚ bindï¼šæ ‡è¯†ç¬¦ï¼Œä½¿ç”¨ç‹¬ç«‹çš„bind()å¤„ç†æ­¤address:portï¼›ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äºç«¯å£ç›¸åŒè€ŒIPåœ°å€ä¸åŒçš„å¤šä¸ªè¿æ¥ï¼ŒNginxæœåŠ¡å™¨å°†åªä½¿ç”¨ä¸€ä¸ªç›‘å¬å‘½ä»¤ï¼Œå¹¶ä½¿ç”¨bind()å¤„ç†ç«¯å£ç›¸åŒçš„æ‰€æœ‰è¿æ¥ã€‚ sslï¼šæ ‡è¯†ç¬¦ï¼Œè®¾ç½®ä¼šè¯è¿æ¥ä½¿ç”¨SSLæ¨¡å¼è¿›è¡Œï¼Œæ­¤æ ‡è¯†ç¬¦å’ŒNginxæœåŠ¡å™¨æä¾›çš„HTTPSæœåŠ¡æœ‰å…³ã€‚ ","date":"2020-11-23","objectID":"/openresty-server/:2:1","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"server_name ç”¨äºé…ç½®è™šæ‹Ÿä¸»æœºçš„åç§°ã€‚è¯­æ³•æ˜¯ï¼š Syntax: server_name name ...; Default: server_name \"\"; Context: server å¯¹äºname æ¥è¯´ï¼Œå¯ä»¥åªæœ‰ä¸€ä¸ªåç§°ï¼Œä¹Ÿå¯ä»¥ç”±å¤šä¸ªåç§°å¹¶åˆ—ï¼Œä¹‹é—´ç”¨ç©ºæ ¼éš”å¼€ã€‚æ¯ä¸ªåå­—å°±æ˜¯ä¸€ä¸ªåŸŸåï¼Œç”±ä¸¤æ®µæˆ–è€…ä¸‰æ®µç»„æˆï¼Œä¹‹é—´ç”±ç‚¹å·â€œ.â€éš”å¼€ã€‚æ¯”å¦‚ server_name myserver.com www.myserver.com åœ¨è¯¥ä¾‹ä¸­ï¼Œæ­¤è™šæ‹Ÿä¸»æœºçš„åç§°è®¾ç½®ä¸ºmyserver.comæˆ–www. myserver.comã€‚NginxæœåŠ¡å™¨è§„å®šï¼Œç¬¬ä¸€ä¸ªåç§°ä½œä¸ºæ­¤è™šæ‹Ÿä¸»æœºçš„ä¸»è¦åç§°ã€‚ åœ¨name ä¸­å¯ä»¥ä½¿ç”¨é€šé…ç¬¦â€œ*â€ï¼Œä½†é€šé…ç¬¦åªèƒ½ç”¨åœ¨ç”±ä¸‰æ®µå­—ç¬¦ä¸²ç»„æˆçš„åç§°çš„é¦–æ®µæˆ–å°¾æ®µï¼Œæˆ–è€…ç”±ä¸¤æ®µå­—ç¬¦ä¸²ç»„æˆçš„åç§°çš„å°¾æ®µï¼Œå¦‚ï¼š server_name myserver.* *.myserver.com å¦å¤–nameè¿˜æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼çš„å½¢å¼ ç”±äºserver_nameæŒ‡ä»¤æ”¯æŒä½¿ç”¨é€šé…ç¬¦å’Œæ­£åˆ™è¡¨è¾¾å¼ä¸¤ç§é…ç½®åç§°çš„æ–¹å¼ï¼Œå› æ­¤åœ¨åŒ…å«æœ‰å¤šä¸ªè™šæ‹Ÿä¸»æœºçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªåç§°è¢«å¤šä¸ªè™šæ‹Ÿä¸»æœºçš„server_nameåŒ¹é…æˆåŠŸã€‚é‚£ä¹ˆï¼Œæ¥è‡ªè¿™ä¸ªåç§°çš„è¯·æ±‚åˆ°åº•è¦äº¤ç»™å“ªä¸ªè™šæ‹Ÿä¸»æœºå¤„ç†å‘¢ï¼ŸNginxæœåŠ¡å™¨åšå‡ºå¦‚ä¸‹è§„å®šï¼š a. å¯¹äºåŒ¹é…æ–¹å¼ä¸åŒçš„ï¼ŒæŒ‰ç…§ä»¥ä¸‹çš„ä¼˜å…ˆçº§é€‰æ‹©è™šæ‹Ÿä¸»æœºï¼Œæ’åœ¨å‰é¢çš„ä¼˜å…ˆå¤„ç†è¯·æ±‚ã€‚ å‡†ç¡®åŒ¹é…server_name é€šé…ç¬¦åœ¨å¼€å§‹æ—¶åŒ¹é…server_nameæˆåŠŸ é€šé…ç¬¦åœ¨ç»“å°¾æ—¶åŒ¹é…server_nameæˆåŠŸ æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…server_nameæˆåŠŸ b. åœ¨ä»¥ä¸Šå››ç§åŒ¹é…æ–¹å¼ä¸­ï¼Œå¦‚æœserver_nameè¢«å¤„äºåŒä¸€ä¼˜å…ˆçº§çš„åŒ¹é…æ–¹å¼å¤šæ¬¡åŒ¹é…æˆåŠŸï¼Œåˆ™é¦–æ¬¡åŒ¹é…æˆåŠŸçš„è™šæ‹Ÿä¸»æœºå¤„ç†è¯·æ±‚ã€‚ ","date":"2020-11-23","objectID":"/openresty-server/:2:2","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"location ","date":"2020-11-23","objectID":"/openresty-server/:3:0","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"åŸºæœ¬è¯­æ³• location [=|~|~*|^~] /uri/ { ... } = : è¡¨ç¤ºç²¾ç¡®åŒ¹é…åé¢çš„url ~ : è¡¨ç¤ºæ­£åˆ™åŒ¹é…ï¼Œä½†æ˜¯åŒºåˆ†å¤§å°å†™ ~* : æ­£åˆ™åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™ ^~ : å¦‚æœæŠŠè¿™ä¸ªå‰ç¼€ç”¨äºä¸€ä¸ªå¸¸è§„å­—ç¬¦ä¸²,é‚£ä¹ˆå‘Šè¯‰nginx å¦‚æœè·¯å¾„åŒ¹é…é‚£ä¹ˆä¸æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼ ã€Œ=ã€ ä¿®é¥°ç¬¦ï¼šè¦æ±‚è·¯å¾„å®Œå…¨åŒ¹é… server { server_name russellgao.cn; location = /abcd { [â€¦] } } https://russellgao.cn/abcdåŒ¹é… https://russellgao.cn/ABCDå¯èƒ½ä¼šåŒ¹é… ï¼Œä¹Ÿå¯ä»¥ä¸åŒ¹é…ï¼Œå–å†³äºæ“ä½œç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿæ˜¯å¦å¤§å°å†™æ•æ„Ÿï¼ˆcase-sensitiveï¼‰ã€‚ https://russellgao.cn/abcd?param1\u0026param2åŒ¹é…ï¼Œå¿½ç•¥ querystring https://russellgao.cn/abcd/ä¸åŒ¹é…ï¼Œå¸¦æœ‰ç»“å°¾çš„/ https://russellgao.cn/abcdeä¸åŒ¹é… ã€Œ~ã€ä¿®é¥°ç¬¦ï¼šåŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é… server { server_name russellgao.cn; location ~ ^/abcd$ { [â€¦] } } ^/abcd$ è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼è¡¨ç¤ºå­—ç¬¦ä¸²å¿…é¡»ä»¥/å¼€å§‹ï¼Œä»¥dç»“æŸï¼Œä¸­é—´å¿…é¡»æ˜¯abcï¼Œæ¢è¨€ä¹‹åªèƒ½åŒ¹é… /abcd https://russellgao.cn/abcdåŒ¹é…ï¼ˆå®Œå…¨åŒ¹é…ï¼‰ https://russellgao.cn/ABCDä¸åŒ¹é…ï¼Œå¤§å°å†™æ•æ„Ÿ https://russellgao.cn/abcd?param1\u0026param2åŒ¹é… https://russellgao.cn/abcd/ä¸åŒ¹é…ï¼Œä¸èƒ½åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ https://russellgao.cn/abcdeä¸åŒ¹é…ï¼Œä¸èƒ½åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ ã€Œ~*ã€ä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™åŒ¹é… server { server_name russellgao.cn; location ~* ^/abcd$ { [â€¦] } } https://russellgao.cn/abcdåŒ¹é… (å®Œå…¨åŒ¹é…) https://russellgao.cn/ABCDåŒ¹é… (å¤§å°å†™ä¸æ•æ„Ÿ) https://russellgao.cn/abcd?param1\u0026param2åŒ¹é… https://russellgao.cn/abcd/ ä¸åŒ¹é…ï¼Œä¸èƒ½åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ https://russellgao.cn/abcde ä¸åŒ¹é…ï¼Œä¸èƒ½åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ ã€Œ^~ã€ä¿®é¥°ç¬¦ å‰ç¼€åŒ¹é… å¦‚æœè¯¥ location æ˜¯æœ€ä½³çš„åŒ¹é…ï¼Œé‚£ä¹ˆå¯¹äºåŒ¹é…è¿™ä¸ª location çš„å­—ç¬¦ä¸²ï¼Œ è¯¥ä¿®é¥°ç¬¦ä¸å†è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼æ£€æµ‹ã€‚æ³¨æ„ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œå®ƒçš„ç›®çš„æ˜¯ä¼˜å…ˆäºæ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…ã€‚ ","date":"2020-11-23","objectID":"/openresty-server/:3:1","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"æŸ¥æ‰¾çš„é¡ºåºåŠä¼˜å…ˆçº§ å½“æœ‰å¤šæ¡ location è§„åˆ™æ—¶ï¼Œnginx æœ‰ä¸€å¥—æ¯”è¾ƒå¤æ‚çš„è§„åˆ™ï¼Œä¼˜å…ˆçº§å¦‚ä¸‹ï¼š ç²¾ç¡®åŒ¹é… = å‰ç¼€åŒ¹é… ^~ï¼ˆç«‹åˆ»åœæ­¢åç»­çš„æ­£åˆ™æœç´¢ï¼‰ æŒ‰æ–‡ä»¶ä¸­é¡ºåºçš„æ­£åˆ™åŒ¹é… ~æˆ–~* åŒ¹é…ä¸å¸¦ä»»ä½•ä¿®é¥°çš„å‰ç¼€åŒ¹é…ã€‚ è¿™ä¸ªè§„åˆ™å¤§ä½“çš„æ€è·¯æ˜¯: å…ˆç²¾ç¡®åŒ¹é…ï¼Œæ²¡æœ‰åˆ™æŸ¥æ‰¾å¸¦æœ‰ ^~çš„å‰ç¼€åŒ¹é…ï¼Œæ²¡æœ‰åˆ™è¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œæœ€åæ‰è¿”å›å‰ç¼€åŒ¹é…çš„ç»“æœï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ ","date":"2020-11-23","objectID":"/openresty-server/:3:2","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"alias ä¸ root åŒºåˆ« root å®é™…è®¿é—®æ–‡ä»¶è·¯å¾„ä¼šæ‹¼æ¥URLä¸­çš„è·¯å¾„ alias å®é™…è®¿é—®æ–‡ä»¶è·¯å¾„ä¸ä¼šæ‹¼æ¥URLä¸­çš„è·¯å¾„ çœ‹ä¸€ä¸ªä¾‹å­ location ^~ /sta/ { alias /usr/local/nginx/html/static/; } è¯·æ±‚ï¼šhttps://russellgao.cn/sta/index.html å®é™…è®¿é—®ï¼š/usr/local/nginx/html/static/index.html æ–‡ä»¶ location ^~ /static/ { root /usr/local/nginx/html/; } è¯·æ±‚ï¼šhttps://russellgao.cn/static/index.html å®é™…è®¿é—®ï¼š/usr/local/nginx/html/static/index.html æ–‡ä»¶ ","date":"2020-11-23","objectID":"/openresty-server/:3:3","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"rewrite rewrite æ¨¡å—ä¸»è¦ç”¨äºé‡å®šå‘ã€‚ æŒ‡ä»¤è¯­æ³•ï¼šrewrite regex replacement[flag]; ï¼Œé»˜è®¤å€¼ä¸º none ã€‚ çœ‹ä¸ªç®€å•ä¾‹å­ : location / { rewrite ^/(.*) https://russellgao.cn/$1 permanent; } è¿™æ˜¯æˆ‘ http å¼ºè½¬ https çš„ä¾‹å­ã€‚ ","date":"2020-11-23","objectID":"/openresty-server/:3:4","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"å¸¸ç”¨æ­£åˆ™è¡¨è¾¾å¼ å­—ç¬¦ æè¿° \\ å°†åé¢æ¥ç€çš„å­—ç¬¦æ ‡è®°ä¸ºä¸€ä¸ªç‰¹æ®Šå­—ç¬¦æˆ–è€…ä¸€ä¸ªåŸä¹‰å­—ç¬¦æˆ–ä¸€ä¸ªå‘åå¼•ç”¨ ^ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„èµ·å§‹ä½ç½® $ åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„ç»“æŸä½ç½® * åŒ¹é…å‰é¢çš„å­—ç¬¦é›¶æ¬¡æˆ–è€…å¤šæ¬¡ + åŒ¹é…å‰é¢å­—ç¬¦ä¸²ä¸€æ¬¡æˆ–è€…å¤šæ¬¡ ? åŒ¹é…å‰é¢å­—ç¬¦ä¸²çš„é›¶æ¬¡æˆ–è€…ä¸€æ¬¡ . åŒ¹é…é™¤â€œ\\nâ€ä¹‹å¤–çš„æ‰€æœ‰å•ä¸ªå­—ç¬¦ (pattern) åŒ¹é…æ‹¬å·å†…çš„pattern ","date":"2020-11-23","objectID":"/openresty-server/:3:5","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"flagå‚æ•° æ ‡è®°ç¬¦å· è¯´æ˜ last æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆåç»§ç»­å‘ä¸‹åŒ¹é…æ–°çš„location URIè§„åˆ™ break æœ¬æ¡è§„åˆ™åŒ¹é…å®Œæˆåç»ˆæ­¢ï¼Œä¸åœ¨åŒ¹é…ä»»ä½•è§„åˆ™ redirect è¿”å›302ä¸´æ—¶é‡å®šå‘ permanent è¿”å›301æ°¸ä¹…é‡å®šå‘ last å’Œ breakå…³é”®å­—çš„åŒºåˆ« last åŒ¹é…åˆ°äº†è¿˜ä¼šç»§ç»­å‘ä¸‹åŒ¹é… break åŒ¹é…åˆ°äº†ä¸ä¼šç»§ç»­å‘ä¸‹åŒ¹é…ï¼Œä¼šç»ˆæ­¢æ‰ permanent å’Œ redirectå…³é”®å­—çš„åŒºåˆ« last å’Œ break å½“å‡ºç°åœ¨location ä¹‹å¤–æ—¶ï¼Œä¸¤è€…çš„ä½œç”¨æ˜¯ä¸€è‡´çš„æ²¡æœ‰ä»»ä½•å·®å¼‚ last å’Œ break å½“å‡ºç°åœ¨location å†…éƒ¨æ—¶ï¼š rewrite â€¦ permanent æ°¸ä¹…æ€§é‡å®šå‘ï¼Œè¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º301 rewrite â€¦ redirect ä¸´æ—¶é‡å®šå‘ï¼Œè¯·æ±‚æ—¥å¿—ä¸­çš„çŠ¶æ€ç ä¸º302 ","date":"2020-11-23","objectID":"/openresty-server/:3:6","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"proxy_pass åœ¨nginxä¸­é…ç½®proxy_passä»£ç†è½¬å‘æ—¶ï¼Œå¦‚æœåœ¨proxy_passåé¢çš„urlåŠ /ï¼Œè¡¨ç¤ºç»å¯¹æ ¹è·¯å¾„ï¼›å¦‚æœæ²¡æœ‰/ï¼Œè¡¨ç¤ºç›¸å¯¹è·¯å¾„ï¼ŒæŠŠåŒ¹é…çš„è·¯å¾„éƒ¨åˆ†ä¹Ÿç»™ä»£ç†èµ°ã€‚ å‡è®¾æˆ‘ä»¬è®¿é—®åœ°å€ä¸º : https://russellgao.cn/proxypass/index.html å½“é…ç½®ä¸º location /proxypass/ { proxy_pass https://russellgao.cn/; } ä»£ç†åˆ°: https://russellgao.cn/index.html å½“é…ç½®ä¸º location /proxypass/ { proxy_pass https://russellgao.cn; } ä»£ç†åˆ°: https://russellgao.cn/proxypass/index.html è¯·æ³¨æ„ï¼šproxy_pass æœ€åæ²¡æœ‰ / å½“é…ç½®ä¸º location /proxypass/ { proxy_pass https://russellgao.cn/test/; } ä»£ç†åˆ°: https://russellgao.cn/test/index.html å½“é…ç½®ä¸º location /proxypass/ { proxy_pass https://russellgao.cn/test; } ä»£ç†åˆ°: https://russellgao.cn/testindex.html nginx çš„ ngx_http_proxy_module å’Œ ngx_stream_proxy_module æ¨¡å—éƒ½æœ‰ proxy_pass ï¼Œä¸‹é¢çœ‹çœ‹ä¸¤è€…ä¹‹é—´çš„å…³ç³»ä¸åŒºåˆ«ã€‚ ngx_http_proxy_module è¯­æ³•: proxy_pass URL åœºæ™¯: location if in location limit_except è®¾ç½®åç«¯ä»£ç†æœåŠ¡å™¨çš„åè®®(protocol)å’Œåœ°å€(address),ä»¥åŠlocationä¸­å¯ä»¥åŒ¹é…çš„ä¸€ä¸ªå¯é€‰çš„URIã€‚åè®®å¯ä»¥æ˜¯\"http\"æˆ–\"httpsâ€ã€‚åœ°å€å¯ä»¥æ˜¯ä¸€ä¸ªåŸŸåæˆ–ipåœ°å€å’Œç«¯å£ï¼Œæˆ–è€…ä¸€ä¸ª unix-domain socket è·¯å¾„ã€‚ ä¾‹: location ~* (/api/v1/blog-server) { proxy_pass_header Server; proxy_pass http://blog_server; } ngx_stream_proxy_module è¯­æ³•: proxy_pass address; åœºæ™¯: server è®¾ç½®åç«¯ä»£ç†æœåŠ¡å™¨çš„åœ°å€ã€‚è¿™ä¸ªåœ°å€(address)å¯ä»¥æ˜¯ä¸€ä¸ªåŸŸåæˆ–ipåœ°å€å’Œç«¯å£ï¼Œæˆ–è€…ä¸€ä¸ª unix-domain socketè·¯å¾„ã€‚ ä¾‹: server { listen 127.0.0.1:12345; proxy_pass 127.0.0.1:8080; } åœ¨ä¸¤ä¸ªæ¨¡å—ä¸­ï¼Œä¸¤ä¸ªproxy_passéƒ½æ˜¯ç”¨æ¥åšåç«¯ä»£ç†çš„æŒ‡ä»¤ã€‚ ngx_stream_proxy_moduleæ¨¡å—çš„proxy_passæŒ‡ä»¤åªèƒ½åœ¨serveræ®µä½¿ç”¨ä½¿ç”¨, åªéœ€è¦æä¾›åŸŸåæˆ–ipåœ°å€å’Œç«¯å£ã€‚å¯ä»¥ç†è§£ä¸ºç«¯å£è½¬å‘ï¼Œå¯ä»¥æ˜¯tcpç«¯å£ï¼Œä¹Ÿå¯ä»¥æ˜¯udpç«¯å£ã€‚ ngx_http_proxy_moduleæ¨¡å—çš„proxy_passæŒ‡ä»¤éœ€è¦åœ¨locationæ®µï¼Œlocationä¸­çš„ifæ®µï¼Œlimit_exceptæ®µä¸­ä½¿ç”¨ï¼Œå¤„ç†éœ€è¦æä¾›åŸŸåæˆ–ipåœ°å€å’Œç«¯å£å¤–ï¼Œè¿˜éœ€è¦æä¾›åè®®ï¼Œå¦‚\"http\"æˆ–\"httpsâ€ï¼Œè¿˜æœ‰ä¸€ä¸ªå¯é€‰çš„uriå¯ä»¥é…ç½®ã€‚ ","date":"2020-11-23","objectID":"/openresty-server/:3:7","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"å¸¸è§ location é…ç½®æ ·ä¾‹ é™æ€ç½‘ç«™ server { listen 80; server_name russellgao.cn; access_log /usr/local/openresty/nginx/logs/access.log custom; error_log /usr/local/openresty/nginx/logs/error.log; location / { rewrite ^/(.*) https://russellgao.cn/$1 permanent; } error_page 500 502 503 504 /50x.html; location = /50x.html { root /usr/local/openresty/nginx/html; } error_page 404 /404.html; location = /404.html { root /usr/local/openresty/nginx/blog; } } åå‘ä»£ç† location ~* (/api/v1/blog-server) { access_log /var/nginx/logs/blog_access.log custom; error_log /var/nginx/logs/blog_error.log error; proxy_pass_header Server; proxy_set_header Host $http_host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Scheme $scheme; # rewrite åªæ˜¯ä¸¾ä¸ªä¾‹å­ï¼Œæ ¹æ®å®é™…æƒ…å†µé…ç½® # rewrite /api/v1/blog-server/(.*)$ /api/$1 break; proxy_pass http://blog_server; } å¯ä»¥åœ¨ location çº§åˆ«è®¾ç½®æ—¥å¿—æ ¼å¼ä»¥åŠç›®å½•ï¼Œæ–¹ä¾¿ç²¾ç»†åŒ–ç®¡ç† é€šè¿‡proxy_pass è·³è½¬åˆ° upstream ","date":"2020-11-23","objectID":"/openresty-server/:3:8","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"upstream upstream æ˜¯åç«¯æœåŠ¡å™¨ç»„ï¼Œä¹Ÿç§°ä¸ºè™šæ‹ŸæœåŠ¡å™¨ç»„ï¼Œä½œç”¨æ˜¯è´Ÿè½½å‡è¡¡ã€‚é…ç½®æ ·ä¾‹å‚è€ƒ upstream blog_server { #upstreamçš„è´Ÿè½½å‡è¡¡ï¼Œweightæ˜¯æƒé‡ï¼Œå¯ä»¥æ ¹æ®æœºå™¨é…ç½®å®šä¹‰æƒé‡ã€‚weigthå‚æ•°è¡¨ç¤ºæƒå€¼ï¼Œæƒå€¼è¶Šé«˜è¢«åˆ†é…åˆ°çš„å‡ ç‡è¶Šå¤§ã€‚ server 172.19.208.76:80 weight=10; server 172.19.208.77:80 weight=50; server 172.19.208.78:80 weight=40; } nginxçš„upstreamç›®å‰æ”¯æŒ 5 ç§æ–¹å¼çš„åˆ†é…: è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ï¼šæ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡ã€‚å¦‚: upstream server { server 172.19.208.76:80; server 172.19.208.77:80; server 172.19.208.78:80; } æƒé‡ ï¼šæŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ upstream server { server 172.19.208.76:80 weight=10; server 172.19.208.77:80 weight=50; server 172.19.208.78:80 weight=40; } ip_hashï¼šæ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚ upstream server { ip_hash; server 172.19.208.76:80; server 172.19.208.77:80; server 172.19.208.78:80; } fairï¼šæŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ upstream server { fair; server 172.19.208.76:80; server 172.19.208.77:80; server 172.19.208.78:80; } url_hashï¼šæŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚åœ¨upstreamä¸­åŠ å…¥hashè¯­å¥ï¼Œserverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³•ã€‚å¦‚: upstream server { hash $request_uri; hash_method crc32; server 172.19.208.76:80; server 172.19.208.77:80; server 172.19.208.78:80; } åœ¨ upstream ä¸­å¯ä»¥ç»™ server è®¾ç½®çŠ¶æ€ï¼Œå¦‚: upstream server { server 172.19.208.76:80 down; server 172.19.208.77:80 weight=10; server 172.19.208.78:80 backup; } æ”¯æŒçš„çŠ¶æ€æœ‰: downè¡¨ç¤ºå•å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½ weightä¸ºweightè¶Šå¤§ï¼Œè´Ÿè½½çš„æƒé‡å°±è¶Šå¤§ã€‚ max_failsï¼šå…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°é»˜è®¤ä¸º1.å½“è¶…è¿‡æœ€å¤§æ¬¡æ•°æ—¶ï¼Œè¿”å›proxy_next_upstreamæ¨¡å—å®šä¹‰çš„é”™è¯¯ fail_timeout:max_failsæ¬¡å¤±è´¥åï¼Œæš‚åœçš„æ—¶é—´ã€‚ backupï¼š å…¶å®ƒæ‰€æœ‰çš„ébackupæœºå™¨downæˆ–è€…å¿™çš„æ—¶å€™ï¼Œè¯·æ±‚backupæœºå™¨ã€‚æ‰€ä»¥è¿™å°æœºå™¨å‹åŠ›ä¼šæœ€è½»ã€‚ ","date":"2020-11-23","objectID":"/openresty-server/:4:0","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"å‚è€ƒ https://www.cnblogs.com/54chensongxia/p/12938929.html https://juejin.cn/post/6844903849166110733 ","date":"2020-11-23","objectID":"/openresty-server/:5:0","tags":["nginx","openresty","server","location"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆäºŒï¼‰","uri":"/openresty-server/"},{"categories":null,"content":"openresty é…ç½®æ–‡ä»¶ ï¼ˆä¸€ï¼‰","date":"2020-11-22","objectID":"/openresty-nginx.conf/","tags":["nginx","openresty","nginx.conf"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆä¸€ï¼‰","uri":"/openresty-nginx.conf/"},{"categories":null,"content":"å¯¼è¯» openrestyï¼ˆnginx plusï¼‰ åœ¨æ—¥å¸¸å·¥ä½œä¸­ç”¨çš„åº”è¯¥æ¯”è¾ƒå¤šï¼Œè¦æƒ³çœŸæ­£äº†è§£æ¸…æ¥šå…¶åŸç†å¹¶ä¸å®¹æ˜“ã€‚æˆ‘å°è¯•ç€ä»é…ç½®çš„è§’åº¦å»åˆ†æ nginx çš„åŸºæœ¬åŸç†ã€‚è¿™ç¯‡ä¸»è¦ä»‹ç» nginx.conf è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œåç»­å†ä»‹ç»å…¶ä»–çš„é…ç½®æ–‡ä»¶ã€‚ nginx.conf ä¸­ä¸»è¦é…ç½®å…¨å±€é…ç½®ï¼Œé…ç½®å¥½ä¹‹åä¸€èˆ¬å¾ˆå°‘æ”¹åŠ¨ã€‚ ","date":"2020-11-22","objectID":"/openresty-nginx.conf/:1:0","tags":["nginx","openresty","nginx.conf"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆä¸€ï¼‰","uri":"/openresty-nginx.conf/"},{"categories":null,"content":"nginx.conf é…ç½®é¡¹è¯´æ˜ #å®šä¹‰Nginxè¿è¡Œçš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ #user nobody; #nginxè¿›ç¨‹æ•°ï¼Œå»ºè®®è®¾ç½®ä¸ºç­‰äºCPUæ€»æ ¸å¿ƒæ•°ã€‚ worker_processes 1; #å…¨å±€é”™è¯¯æ—¥å¿—å®šä¹‰ç±»å‹ï¼Œ[ debug | info | notice | warn | error | crit ] #error_log logs/error.log; #error_log logs/error.log notice; #error_log logs/error.log info; #è¿›ç¨‹æ–‡ä»¶ #pid logs/nginx.pid; #æŒ‡å®šè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æè¿°ç¬¦ #å·¥ä½œæ¨¡å¼ä¸è¿æ¥æ•°ä¸Šé™ ##è¿™ä¸ªæŒ‡ä»¤æ˜¯æŒ‡å½“ä¸€ä¸ªnginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆulimit -nï¼‰ä¸nginxè¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯nginxåˆ†é…è¯·æ±‚å¹¶ä¸æ˜¯é‚£ä¹ˆå‡åŒ€ï¼Œæ‰€ä»¥æœ€å¥½ä¸ulimit -n çš„å€¼ä¿æŒä¸€è‡´ã€‚ #è¿™æ˜¯å› ä¸ºnginxè°ƒåº¦æ—¶åˆ†é…è¯·æ±‚åˆ°è¿›ç¨‹å¹¶ä¸æ˜¯é‚£ä¹ˆçš„å‡è¡¡ï¼Œæ‰€ä»¥å‡å¦‚å¡«å†™10240ï¼Œæ€»å¹¶å‘é‡è¾¾åˆ°3-4ä¸‡æ—¶å°±æœ‰è¿›ç¨‹å¯èƒ½è¶…è¿‡10240äº†ï¼Œè¿™æ—¶ä¼šè¿”å›502é”™è¯¯ã€‚ worker_rlimit_nofile 65535; events { #å‚è€ƒäº‹ä»¶æ¨¡å‹ï¼Œuse [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epollæ¨¡å‹ #æ˜¯Linux 2.6ä»¥ä¸Šç‰ˆæœ¬å†…æ ¸ä¸­çš„é«˜æ€§èƒ½ç½‘ç»œI/Oæ¨¡å‹ï¼Œlinuxå»ºè®®epollï¼Œå¦‚æœè·‘åœ¨FreeBSDä¸Šé¢ï¼Œå°±ç”¨kqueueæ¨¡å‹ã€‚ #è¡¥å……è¯´æ˜ï¼š #ä¸apacheç›¸ç±»ï¼Œnginxé’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œæœ‰ä¸åŒçš„äº‹ä»¶æ¨¡å‹ #Aï¼‰æ ‡å‡†äº‹ä»¶æ¨¡å‹ #Selectã€pollå±äºæ ‡å‡†äº‹ä»¶æ¨¡å‹ï¼Œå¦‚æœå½“å‰ç³»ç»Ÿä¸å­˜åœ¨æ›´æœ‰æ•ˆçš„æ–¹æ³•ï¼Œnginxä¼šé€‰æ‹©selectæˆ–poll #Bï¼‰é«˜æ•ˆäº‹ä»¶æ¨¡å‹ #Kqueueï¼šä½¿ç”¨äºFreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 å’Œ MacOS X.ä½¿ç”¨åŒå¤„ç†å™¨çš„MacOS Xç³»ç»Ÿä½¿ç”¨kqueueå¯èƒ½ä¼šé€ æˆå†…æ ¸å´©æºƒã€‚ #Epollï¼šä½¿ç”¨äºLinuxå†…æ ¸2.6ç‰ˆæœ¬åŠä»¥åçš„ç³»ç»Ÿã€‚ #/dev/pollï¼šä½¿ç”¨äºSolaris 7 11/99+ï¼ŒHP/UX 11.22+ (eventport)ï¼ŒIRIX 6.5.15+ å’Œ Tru64 UNIX 5.1A+ã€‚ #Eventportï¼šä½¿ç”¨äºSolaris 10ã€‚ ä¸ºäº†é˜²æ­¢å‡ºç°å†…æ ¸å´©æºƒçš„é—®é¢˜ï¼Œ æœ‰å¿…è¦å®‰è£…å®‰å…¨è¡¥ä¸ã€‚ use epoll #å•ä¸ªè¿›ç¨‹æœ€å¤§è¿æ¥æ•°ï¼ˆæœ€å¤§è¿æ¥æ•°=è¿æ¥æ•°+è¿›ç¨‹æ•°ï¼‰ worker_connections 65535; #keepalive è¶…æ—¶æ—¶é—´ keepalive_timeout 60; #å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°ã€‚è¿™ä¸ªå¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿåˆ†é¡µå¤§å°æ¥è®¾ç½®ï¼Œä¸€èˆ¬ä¸€ä¸ªè¯·æ±‚å¤´çš„å¤§å°ä¸ä¼šè¶…è¿‡1kï¼Œä¸è¿‡ç”±äºä¸€èˆ¬ç³»ç»Ÿåˆ†é¡µéƒ½è¦å¤§äº1kï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸ºåˆ†é¡µå¤§å°ã€‚ #åˆ†é¡µå¤§å°å¯ä»¥ç”¨å‘½ä»¤getconf PAGESIZE å–å¾—ã€‚ #[root@web001 ~]# getconf PAGESIZE #ä½†ä¹Ÿæœ‰client_header_buffer_sizeè¶…è¿‡4kçš„æƒ…å†µï¼Œä½†æ˜¯client_header_buffer_sizeè¯¥å€¼å¿…é¡»è®¾ç½®ä¸ºâ€œç³»ç»Ÿåˆ†é¡µå¤§å°â€çš„æ•´å€æ•°ã€‚ client_header_buffer_size 4k; #è¿™ä¸ªå°†ä¸ºæ‰“å¼€æ–‡ä»¶æŒ‡å®šç¼“å­˜ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å¯ç”¨çš„ï¼ŒmaxæŒ‡å®šç¼“å­˜æ•°é‡ï¼Œå»ºè®®å’Œæ‰“å¼€æ–‡ä»¶æ•°ä¸€è‡´ï¼Œinactiveæ˜¯æŒ‡ç»è¿‡å¤šé•¿æ—¶é—´æ–‡ä»¶æ²¡è¢«è¯·æ±‚ååˆ é™¤ç¼“å­˜ã€‚ open_file_cache max=65535 inactive=60s; #è¿™ä¸ªæ˜¯æŒ‡å¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡ç¼“å­˜çš„æœ‰æ•ˆä¿¡æ¯ã€‚ #è¯­æ³•:open_file_cache_valid time é»˜è®¤å€¼:open_file_cache_valid 60 ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šäº†ä½•æ—¶éœ€è¦æ£€æŸ¥open_file_cacheä¸­ç¼“å­˜é¡¹ç›®çš„æœ‰æ•ˆä¿¡æ¯. open_file_cache_valid 80s; #open_file_cacheæŒ‡ä»¤ä¸­çš„inactiveå‚æ•°æ—¶é—´å†…æ–‡ä»¶çš„æœ€å°‘ä½¿ç”¨æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œæ–‡ä»¶æè¿°ç¬¦ä¸€ç›´æ˜¯åœ¨ç¼“å­˜ä¸­æ‰“å¼€çš„ï¼Œå¦‚ä¸Šä¾‹ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶åœ¨inactiveæ—¶é—´å†…ä¸€æ¬¡æ²¡è¢«ä½¿ç”¨ï¼Œå®ƒå°†è¢«ç§»é™¤ã€‚ #è¯­æ³•:open_file_cache_min_uses number é»˜è®¤å€¼:open_file_cache_min_uses 1 ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šäº†åœ¨open_file_cacheæŒ‡ä»¤æ— æ•ˆçš„å‚æ•°ä¸­ä¸€å®šçš„æ—¶é—´èŒƒå›´å†…å¯ä»¥ä½¿ç”¨çš„æœ€å°æ–‡ä»¶æ•°,å¦‚æœä½¿ç”¨æ›´å¤§çš„å€¼,æ–‡ä»¶æè¿°ç¬¦åœ¨cacheä¸­æ€»æ˜¯æ‰“å¼€çŠ¶æ€. open_file_cache_min_uses 1; #è¯­æ³•:open_file_cache_errors on | off é»˜è®¤å€¼:open_file_cache_errors off ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šæ˜¯å¦åœ¨æœç´¢ä¸€ä¸ªæ–‡ä»¶æ˜¯è®°å½•cacheé”™è¯¯. open_file_cache_errors on; #é»˜è®¤æ˜¯onã€‚è®¾ç½®ä¸ºonåï¼Œå¤šä¸ªworkeræŒ‰ä¸²è¡Œæ–¹å¼æ¥å¤„ç†è¿æ¥ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªè¿æ¥åªæœ‰ä¸€ä¸ªworkerè¢«å”¤é†’ï¼Œå…¶ä»–çš„å¤„äºä¼‘çœ çŠ¶æ€ã€‚ #è®¾ç½®ä¸ºoffåï¼Œå¤šä¸ªworkeræŒ‰å¹¶è¡Œæ–¹å¼æ¥å¤„ç†è¿æ¥ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªè¿æ¥ä¼šå”¤é†’æ‰€æœ‰çš„workerï¼ŒçŸ¥é“è¿æ¥åˆ†é…å®Œæ¯•ï¼Œæ²¡æœ‰å–å¾—è¿æ¥çš„ç»§ç»­ä¼‘çœ ã€‚ #å½“ä½ çš„æœåŠ¡å™¨è¿æ¥æ•°ä¸å¤šæ—¶ï¼Œå¼€å¯è¿™ä¸ªå‚æ•°ä¼šè®©è´Ÿè½½æœ‰ä¸€å®šç¨‹åº¦çš„é™ä½ã€‚ä½†æ˜¯å½“æœåŠ¡å™¨çš„ååé‡å¾ˆå¤§æ—¶ï¼Œä¸ºäº†æ•ˆç‡ï¼Œè¯·å…³é—­è¿™ä¸ªå‚æ•°ã€‚ multi_accept off; } #è®¾å®šhttpæœåŠ¡å™¨ http { #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨ include mime.types; #é»˜è®¤æ–‡ä»¶ç±»å‹ default_type application/octet-stream; # å¢åŠ  header add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Methods \"GET, POST, OPTIONS\"; #é»˜è®¤ç¼–ç  charset utf-8; #æœåŠ¡å™¨åå­—çš„hashè¡¨å¤§å° #ä¿å­˜æœåŠ¡å™¨åå­—çš„hashè¡¨æ˜¯ç”±æŒ‡ä»¤server_names_hash_max_size å’Œserver_names_hash_bucket_sizeæ‰€æ§åˆ¶çš„ã€‚å‚æ•°hash bucket sizeæ€»æ˜¯ç­‰äºhashè¡¨çš„å¤§å°ï¼Œå¹¶ä¸”æ˜¯ä¸€è·¯å¤„ç†å™¨ç¼“å­˜å¤§å°çš„å€æ•°ã€‚åœ¨å‡å°‘äº†åœ¨å†…å­˜ä¸­çš„å­˜å–æ¬¡æ•°åï¼Œä½¿åœ¨å¤„ç†å™¨ä¸­åŠ é€ŸæŸ¥æ‰¾hashè¡¨é”®å€¼æˆä¸ºå¯èƒ½ã€‚å¦‚æœhash bucket sizeç­‰äºä¸€è·¯å¤„ç†å™¨ç¼“å­˜çš„å¤§å°ï¼Œé‚£ä¹ˆåœ¨æŸ¥æ‰¾é”®çš„æ—¶å€™ï¼Œæœ€åçš„æƒ…å†µä¸‹åœ¨å†…å­˜ä¸­æŸ¥æ‰¾çš„æ¬¡æ•°ä¸º2ã€‚ç¬¬ä¸€æ¬¡æ˜¯ç¡®å®šå­˜å‚¨å•å…ƒçš„åœ°å€ï¼Œç¬¬äºŒæ¬¡æ˜¯åœ¨å­˜å‚¨å•å…ƒä¸­æŸ¥æ‰¾é”® å€¼ã€‚å› æ­¤ï¼Œå¦‚æœNginxç»™å‡ºéœ€è¦å¢å¤§hash max size æˆ– hash bucket sizeçš„æç¤ºï¼Œé‚£ä¹ˆé¦–è¦çš„æ˜¯å¢å¤§å‰ä¸€ä¸ªå‚æ•°çš„å¤§å°. server_names_hash_bucket_size 128; #å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°ã€‚è¿™ä¸ªå¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿåˆ†é¡µå¤§å°æ¥è®¾ç½®ï¼Œä¸€èˆ¬ä¸€ä¸ªè¯·æ±‚çš„å¤´éƒ¨å¤§å°ä¸ä¼šè¶…è¿‡1kï¼Œä¸è¿‡ç”±äºä¸€èˆ¬ç³»ç»Ÿåˆ†é¡µéƒ½è¦å¤§äº1kï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸ºåˆ†é¡µå¤§å°ã€‚åˆ†é¡µå¤§å°å¯ä»¥ç”¨å‘½ä»¤getconf PAGESIZEå–å¾—ã€‚ client_header_buffer_size 32k; #å®¢æˆ·è¯·æ±‚å¤´ç¼“å†²å¤§å°ã€‚nginxé»˜è®¤ä¼šç”¨client_header_buffer_sizeè¿™ä¸ªbufferæ¥è¯»å–headerå€¼ï¼Œå¦‚æœheaderè¿‡å¤§ï¼Œå®ƒä¼šä½¿ç”¨large_client_header_buffersæ¥è¯»å–ã€‚ large_client_header_buffers 4 64k; #è®¾å®šé€šè¿‡nginxä¸Šä¼ æ–‡ä»¶çš„å¤§å° client_max_body_size 8m; #å¼€å¯ç›®å½•åˆ—è¡¨è®¿é—®ï¼Œåˆé€‚ä¸‹è½½æœåŠ¡å™¨ï¼Œé»˜è®¤å…³é—­ã€‚ autoindex on; # é™æµ limit_req_zone $server_name zone=xiaozhi_log:50m rate=40r/s; limit_req_zone $server_name zone=tico_log:50m rate=40r/s; #å¼€å¯é™åˆ¶IPè¿æ¥æ•°çš„æ—¶å€™éœ€è¦ä½¿ç”¨ #limit_zone crawler $binary_remote_addr 10m; # æ—¥å¿—æ ¼å¼å®šä¹‰ï¼Œè¿™é‡Œå¯ä»¥æ ¹æ®è‡ªå·±çš„æ—¥å¿—è§„èŒƒè¿›è¡Œè‡ªå®šä¹‰ #log_format main '$remote_addr - $remote_user [$time_local] \"$request\" ' # '$status $body_bytes_sent \"$http_referer\" ' # '\"$http_user_agent\" \"$http_x_forwarded_for\"'; # è¿™é‡Œæ¨èä¸€ä¸ªæ—¥å¿—æ ¼å¼ log_format custom '[$time_local] $remote_addr $remote_user $request ' '$status $upstream_response_time $request_time $body_bytes_sent $http_referer ' '$http_user_agent $http_x_forwarded_for ' ; #access_log logs/access.log main; #å¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼Œsendfil","date":"2020-11-22","objectID":"/openresty-nginx.conf/:2:0","tags":["nginx","openresty","nginx.conf"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆä¸€ï¼‰","uri":"/openresty-nginx.conf/"},{"categories":null,"content":"nginx.conf æ ·ä¾‹ worker_processes 2; events { worker_connections 65535; } http { include mime.types; default_type application/octet-stream; log_format custom '[$time_local] $remote_addr $remote_user $request ' '$status $upstream_response_time $request_time $body_bytes_sent $http_referer ' '$http_user_agent $http_x_forwarded_for ' ; client_body_temp_path /var/run/openresty/nginx-client-body; proxy_temp_path /var/run/openresty/nginx-proxy; fastcgi_temp_path /var/run/openresty/nginx-fastcgi; uwsgi_temp_path /var/run/openresty/nginx-uwsgi; scgi_temp_path /var/run/openresty/nginx-scgi; sendfile on; keepalive_timeout 90; include /etc/nginx/conf.d/*.conf; } ","date":"2020-11-22","objectID":"/openresty-nginx.conf/:3:0","tags":["nginx","openresty","nginx.conf"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆä¸€ï¼‰","uri":"/openresty-nginx.conf/"},{"categories":null,"content":"æ¥ä¸‹æ¥ è¿™æ˜¯ openresty é…ç½®æ–‡ä»¶ç³»åˆ—ç¯‡ï¼Œè¿™ç¯‡ä»‹ç»äº† nginx.conf (å…¨å±€é…ç½®) ï¼Œæ¥ä¸‹æ¥è¿˜æœ‰ server ã€ upstreamã€location ç­‰ä»‹ç»ã€‚ æ¯å¤©æŒæ¡ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œç§¯å°‘æˆå¤šï¼Œä¸€å‘¨ç©è½¬ openresty ã€‚ ","date":"2020-11-22","objectID":"/openresty-nginx.conf/:4:0","tags":["nginx","openresty","nginx.conf"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆä¸€ï¼‰","uri":"/openresty-nginx.conf/"},{"categories":null,"content":"å‚è€ƒ https://juejin.cn/post/6844903741678698510 ","date":"2020-11-22","objectID":"/openresty-nginx.conf/:5:0","tags":["nginx","openresty","nginx.conf"],"title":"openresty é…ç½®æ–‡ä»¶ ï¼ˆä¸€ï¼‰","uri":"/openresty-nginx.conf/"},{"categories":null,"content":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","date":"2020-11-21","objectID":"/kubernetes/patch-update/","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/kubernetes/patch-update/"},{"categories":null,"content":"å¯¼è¯» ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä¸€ä¸ªé—®é¢˜ï¼šå¯¹äºä¸€ä¸ª K8s èµ„æºå¯¹è±¡æ¯”å¦‚ Deploymentï¼Œæˆ‘ä»¬å°è¯•åœ¨ä¿®æ”¹å…¶ä¸­ image é•œåƒæ—¶ï¼Œå¦‚æœæœ‰å…¶ä»–äººåŒæ—¶ä¹Ÿåœ¨å¯¹è¿™ä¸ª Deployment åšä¿®æ”¹ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å½“ç„¶ï¼Œè¿™é‡Œè¿˜å¯ä»¥å¼•ç”³å‡ºä¸¤ä¸ªé—®é¢˜ï¼š å¦‚æœåŒæ–¹ä¿®æ”¹çš„æ˜¯åŒä¸€ä¸ªå­—æ®µï¼Œæ¯”å¦‚ image å­—æ®µï¼Œç»“æœä¼šæ€æ ·ï¼Ÿ å¦‚æœåŒæ–¹ä¿®æ”¹çš„æ˜¯ä¸åŒå­—æ®µï¼Œæ¯”å¦‚ä¸€ä¸ªä¿®æ”¹ imageï¼Œå¦ä¸€ä¸ªä¿®æ”¹ replicasï¼Œåˆä¼šæ€ä¹ˆæ ·ï¼Ÿ å…¶å®ï¼Œå¯¹ä¸€ä¸ª Kubernetes èµ„æºå¯¹è±¡åšâ€œæ›´æ–°â€æ“ä½œï¼Œç®€å•æ¥è¯´å°±æ˜¯é€šçŸ¥ kube-apiserver ç»„ä»¶æˆ‘ä»¬å¸Œæœ›å¦‚ä½•ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ã€‚è€Œ K8s ä¸ºè¿™ç±»éœ€æ±‚å®šä¹‰äº†ä¸¤ç§â€œé€šçŸ¥â€æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ update å’Œ patchã€‚åœ¨ update è¯·æ±‚ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†æ•´ä¸ªä¿®æ”¹åçš„å¯¹è±¡æäº¤ç»™ K8sï¼›è€Œå¯¹äº patch è¯·æ±‚ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å¯¹è±¡ä¸­æŸäº›å­—æ®µçš„ä¿®æ”¹æäº¤ç»™ K8sã€‚ ","date":"2020-11-21","objectID":"/kubernetes/patch-update/:1:0","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/kubernetes/patch-update/"},{"categories":null,"content":"Update æœºåˆ¶ Kubernetes ä¸­çš„æ‰€æœ‰èµ„æºå¯¹è±¡ï¼Œéƒ½æœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ç‰ˆæœ¬å·ï¼ˆmetadata.resourceVersionï¼‰ã€‚æ¯ä¸ªèµ„æºå¯¹è±¡ä»åˆ›å»ºå¼€å§‹å°±ä¼šæœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œè€Œåæ¯æ¬¡è¢«ä¿®æ”¹ï¼ˆä¸ç®¡æ˜¯ update è¿˜æ˜¯ patch ä¿®æ”¹ï¼‰ï¼Œç‰ˆæœ¬å·éƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ å®˜æ–¹æ–‡æ¡£ å‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™ä¸ªç‰ˆæœ¬å·æ˜¯ä¸€ä¸ª K8s çš„å†…éƒ¨æœºåˆ¶ï¼Œç”¨æˆ·ä¸åº”è¯¥å‡è®¾å®ƒæ˜¯ä¸€ä¸ªæ•°å­—æˆ–è€…é€šè¿‡æ¯”è¾ƒä¸¤ä¸ªç‰ˆæœ¬å·å¤§å°æ¥ç¡®å®šèµ„æºå¯¹è±¡çš„æ–°æ—§ï¼Œå”¯ä¸€èƒ½åšçš„å°±æ˜¯é€šè¿‡æ¯”è¾ƒç‰ˆæœ¬å·ç›¸ç­‰æ¥ç¡®å®šå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªç‰ˆæœ¬ï¼ˆå³æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼‰ã€‚è€Œ resourceVersion ä¸€ä¸ªé‡è¦çš„ç”¨å¤„ï¼Œå°±æ˜¯æ¥åš update è¯·æ±‚çš„ç‰ˆæœ¬æ§åˆ¶ã€‚ K8s è¦æ±‚ç”¨æˆ· update è¯·æ±‚ä¸­æäº¤çš„å¯¹è±¡å¿…é¡»å¸¦æœ‰ resourceVersionï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æäº¤ update çš„æ•°æ®å¿…é¡»å…ˆæ¥æºäº K8s ä¸­å·²ç»å­˜åœ¨çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œä¸€æ¬¡å®Œæ•´çš„ update æ“ä½œæµç¨‹æ˜¯ï¼š é¦–å…ˆï¼Œä» K8s ä¸­æ‹¿åˆ°ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å¯¹è±¡ï¼ˆå¯ä»¥é€‰æ‹©ç›´æ¥ä» K8s ä¸­æŸ¥è¯¢ï¼›å¦‚æœåœ¨å®¢æˆ·ç«¯åšäº† list watchï¼Œæ¨èä»æœ¬åœ° informer ä¸­è·å–ï¼‰ï¼› ç„¶åï¼ŒåŸºäºè¿™ä¸ªå–å‡ºæ¥çš„å¯¹è±¡åšä¸€äº›ä¿®æ”¹ï¼Œæ¯”å¦‚å°† Deployment ä¸­çš„ replicas åšå¢å‡ï¼Œæˆ–æ˜¯å°† image å­—æ®µä¿®æ”¹ä¸ºä¸€ä¸ªæ–°ç‰ˆæœ¬çš„é•œåƒï¼› æœ€åï¼Œå°†ä¿®æ”¹åçš„å¯¹è±¡é€šè¿‡ update è¯·æ±‚æäº¤ç»™ K8sï¼› æ­¤æ—¶ï¼Œkube-apiserver ä¼šæ ¡éªŒç”¨æˆ· update è¯·æ±‚æäº¤å¯¹è±¡ä¸­çš„ resourceVersion ä¸€å®šè¦å’Œå½“å‰ K8s ä¸­è¿™ä¸ªå¯¹è±¡æœ€æ–°çš„ resourceVersion ä¸€è‡´ï¼Œæ‰èƒ½æ¥å—æœ¬æ¬¡ updateã€‚å¦åˆ™ï¼ŒK8s ä¼šæ‹’ç»è¯·æ±‚ï¼Œå¹¶å‘Šè¯‰ç”¨æˆ·å‘ç”Ÿäº†ç‰ˆæœ¬å†²çªï¼ˆConflictï¼‰ã€‚ ä¸Šå›¾å±•ç¤ºäº†å¤šä¸ªç”¨æˆ·åŒæ—¶ update æŸä¸€ä¸ªèµ„æºå¯¹è±¡æ—¶ä¼šå‘ç”Ÿçš„äº‹æƒ…ã€‚è€Œå¦‚æœå¦‚æœå‘ç”Ÿäº† Conflict å†²çªï¼Œå¯¹äº User A è€Œè¨€åº”è¯¥åšçš„å°±æ˜¯åšä¸€æ¬¡é‡è¯•ï¼Œå†æ¬¡è·å–åˆ°æœ€æ–°ç‰ˆæœ¬çš„å¯¹è±¡ï¼Œä¿®æ”¹åé‡æ–°æäº¤ updateã€‚ å› æ­¤ï¼Œæˆ‘ä»¬ä¸Šé¢çš„ä¸¤ä¸ªé—®é¢˜ä¹Ÿéƒ½å¾—åˆ°äº†è§£ç­”ï¼š ç”¨æˆ·ä¿®æ”¹ YAML åæäº¤ update å¤±è´¥ï¼Œæ˜¯å› ä¸º YAML æ–‡ä»¶ä¸­æ²¡æœ‰åŒ…å« resourceVersion å­—æ®µã€‚å¯¹äº update è¯·æ±‚è€Œè¨€ï¼Œåº”è¯¥å–å‡ºå½“å‰ K8s ä¸­çš„å¯¹è±¡åšä¿®æ”¹åæäº¤ï¼› å¦‚æœä¸¤ä¸ªç”¨æˆ·åŒæ—¶å¯¹ä¸€ä¸ªèµ„æºå¯¹è±¡åš updateï¼Œä¸ç®¡æ“ä½œçš„æ˜¯å¯¹è±¡ä¸­åŒä¸€ä¸ªå­—æ®µè¿˜æ˜¯ä¸åŒå­—æ®µï¼Œéƒ½å­˜åœ¨ç‰ˆæœ¬æ§åˆ¶çš„æœºåˆ¶ç¡®ä¿ä¸¤ä¸ªç”¨æˆ·çš„ update è¯·æ±‚ä¸ä¼šå‘ç”Ÿè¦†ç›–ã€‚ ","date":"2020-11-21","objectID":"/kubernetes/patch-update/:2:0","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/kubernetes/patch-update/"},{"categories":null,"content":"Patch æœºåˆ¶ ç›¸æ¯”äº update çš„ç‰ˆæœ¬æ§åˆ¶ï¼ŒK8s çš„ patch æœºåˆ¶åˆ™æ˜¾å¾—æ›´åŠ ç®€å•ã€‚ å½“ç”¨æˆ·å¯¹æŸä¸ªèµ„æºå¯¹è±¡æäº¤ä¸€ä¸ª patch è¯·æ±‚æ—¶ï¼Œkube-apiserver ä¸ä¼šè€ƒè™‘ç‰ˆæœ¬é—®é¢˜ï¼Œè€Œæ˜¯â€œæ— è„‘â€åœ°æ¥å—ç”¨æˆ·çš„è¯·æ±‚ï¼ˆåªè¦è¯·æ±‚å‘é€çš„ patch å†…å®¹åˆæ³•ï¼‰ï¼Œä¹Ÿå°±æ˜¯å°† patch æ‰“åˆ°å¯¹è±¡ä¸Šã€åŒæ—¶æ›´æ–°ç‰ˆæœ¬å·ã€‚ ä¸è¿‡ï¼Œpatch çš„å¤æ‚ç‚¹åœ¨äºï¼Œç›®å‰ K8s æä¾›äº† 4 ç§ patch ç­–ç•¥ï¼šjson patchã€merge patchã€strategic merge patchã€apply patchï¼ˆä» K8s 1.14 æ”¯æŒ server-side apply å¼€å§‹ï¼‰ã€‚é€šè¿‡ kubectl patch -h å‘½ä»¤æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°è¿™ä¸ªç­–ç•¥é€‰é¡¹ï¼ˆé»˜è®¤é‡‡ç”¨ strategicï¼‰ï¼š $ kubectl patch -h # ... --type='strategic': The type of patch being provided; one of [json merge strategic] ç¯‡å¹…é™åˆ¶è¿™é‡Œæš‚ä¸å¯¹æ¯ä¸ªç­–ç•¥åšè¯¦ç»†çš„ä»‹ç»äº†ï¼Œæˆ‘ä»¬å°±ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹ä¸€ä¸‹å®ƒä»¬çš„å·®å¼‚æ€§ã€‚å¦‚æœé’ˆå¯¹ä¸€ä¸ªå·²æœ‰çš„ Deployment å¯¹è±¡ï¼Œå‡è®¾ template ä¸­å·²ç»æœ‰äº†ä¸€ä¸ªåä¸º app çš„å®¹å™¨ï¼š å¦‚æœè¦åœ¨å…¶ä¸­æ–°å¢ä¸€ä¸ª nginx å®¹å™¨ï¼Œå¦‚ä½• patch æ›´æ–°ï¼Ÿ å¦‚æœè¦ä¿®æ”¹ app å®¹å™¨çš„é•œåƒï¼Œå¦‚ä½• patch æ›´æ–°ï¼Ÿ ","date":"2020-11-21","objectID":"/kubernetes/patch-update/:3:0","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/kubernetes/patch-update/"},{"categories":null,"content":"json patch æ–°å¢å®¹å™¨ï¼š kubectl patch deployment/foo --type='json' -p \\ '[{\"op\":\"add\",\"path\":\"/spec/template/spec/containers/1\",\"value\":{\"name\":\"nginx\",\"image\":\"nginx:alpine\"}}]' ä¿®æ”¹å·²æœ‰å®¹å™¨ imageï¼š kubectl patch deployment/foo --type='json' -p \\ '[{\"op\":\"replace\",\"path\":\"/spec/template/spec/containers/0/image\",\"value\":\"app-image:v2\"}]' è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœæˆ‘ä»¬ patch ä¹‹å‰è¿™ä¸ªå¯¹è±¡å·²ç»è¢«å…¶ä»–äººä¿®æ”¹äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ patch æœ‰å¯èƒ½äº§ç”Ÿéé¢„æœŸçš„åæœã€‚æ¯”å¦‚åœ¨æ‰§è¡Œ app å®¹å™¨é•œåƒæ›´æ–°æ—¶ï¼Œæˆ‘ä»¬æŒ‡å®šçš„åºå·æ˜¯ 0ï¼Œä½†æ­¤æ—¶ containers åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªä½ç½®è¢«æ’å…¥äº†å¦ä¸€ä¸ªå®¹å™¨ï¼Œåˆ™æ›´æ–°çš„é•œåƒå°±è¢«é”™è¯¯åœ°æ’å…¥åˆ°è¿™ä¸ªéé¢„æœŸçš„å®¹å™¨ä¸­ã€‚ ","date":"2020-11-21","objectID":"/kubernetes/patch-update/:3:1","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/kubernetes/patch-update/"},{"categories":null,"content":"merge patch merge patch æ— æ³•å•ç‹¬æ›´æ–°ä¸€ä¸ªåˆ—è¡¨ä¸­çš„æŸä¸ªå…ƒç´ ï¼Œå› æ­¤ä¸ç®¡æˆ‘ä»¬æ˜¯è¦åœ¨ containers é‡Œæ–°å¢å®¹å™¨ã€è¿˜æ˜¯ä¿®æ”¹å·²æœ‰å®¹å™¨çš„ imageã€env ç­‰å­—æ®µï¼Œéƒ½è¦ç”¨æ•´ä¸ª containers åˆ—è¡¨æ¥æäº¤ patchï¼š kubectl patch deployment/foo --type='merge' -p \\ '{\"spec\":{\"template\":{\"spec\":{\"containers\":[{\"name\":\"app\",\"image\":\"app-image:v2\"},{\"name\":\"nginx\",\"image\":\"nginx:alpline\"}]}}}}' æ˜¾ç„¶ï¼Œè¿™ä¸ªç­–ç•¥å¹¶ä¸é€‚åˆæˆ‘ä»¬å¯¹ä¸€äº›åˆ—è¡¨æ·±å±‚çš„å­—æ®µåšæ›´æ–°ï¼Œæ›´é€‚ç”¨äºå¤§ç‰‡æ®µçš„è¦†ç›–æ›´æ–°ã€‚ ä¸è¿‡å¯¹äº labels/annotations è¿™äº› map ç±»å‹çš„å…ƒç´ æ›´æ–°ï¼Œmerge patch æ˜¯å¯ä»¥å•ç‹¬æŒ‡å®š key-value æ“ä½œçš„ï¼Œç›¸æ¯”äº json patch æ–¹ä¾¿ä¸€äº›ï¼Œå†™èµ·æ¥ä¹Ÿæ›´åŠ ç›´è§‚ï¼š kubectl patch deployment/foo â€“type='mergeâ€™ -p â€˜{â€œmetadataâ€:{â€œlabelsâ€:{â€œtest-keyâ€:â€œfooâ€}}}â€™ ","date":"2020-11-21","objectID":"/kubernetes/patch-update/:3:2","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/kubernetes/patch-update/"},{"categories":null,"content":"strategic merge patch è¿™ç§ patch ç­–ç•¥å¹¶æ²¡æœ‰ä¸€ä¸ªé€šç”¨çš„ RFC æ ‡å‡†ï¼Œè€Œæ˜¯ K8s ç‹¬æœ‰çš„ï¼Œä¸è¿‡ç›¸æ¯”å‰ä¸¤ç§è€Œè¨€å´æ›´ä¸ºå¼ºå¤§çš„ã€‚ æˆ‘ä»¬å…ˆä» K8s æºç çœ‹èµ·ï¼Œåœ¨ K8s åŸç”Ÿèµ„æºçš„æ•°æ®ç»“æ„å®šä¹‰ä¸­é¢å¤–å®šä¹‰äº†ä¸€äº›çš„ç­–ç•¥æ³¨è§£ã€‚æ¯”å¦‚ä»¥ä¸‹è¿™ä¸ªæˆªå–äº† podSpec ä¸­é’ˆå¯¹ containers åˆ—è¡¨çš„å®šä¹‰ // ... // +patchMergeKey=name // +patchStrategy=merge Containers []Container `json:\"containers\" patchStrategy:\"merge\" patchMergeKey:\"name\" protobuf:\"bytes,2,rep,name=containers\"` å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰ä¸¤ä¸ªå…³é”®ä¿¡æ¯ï¼špatchStrategy:â€œmergeâ€ patchMergeKey:â€œnameâ€ ã€‚è¿™å°±ä»£è¡¨äº†ï¼Œcontainers åˆ—è¡¨ä½¿ç”¨ strategic merge patch ç­–ç•¥æ›´æ–°æ—¶ï¼Œä¼šæŠŠä¸‹é¢æ¯ä¸ªå…ƒç´ ä¸­çš„ name å­—æ®µçœ‹ä½œ keyã€‚ ç®€å•æ¥è¯´ï¼Œåœ¨æˆ‘ä»¬ patch æ›´æ–° containers ä¸å†éœ€è¦æŒ‡å®šä¸‹æ ‡åºå·äº†ï¼Œè€Œæ˜¯æŒ‡å®š name æ¥ä¿®æ”¹ï¼ŒK8s ä¼šæŠŠ name ä½œä¸º key æ¥è®¡ç®— mergeã€‚æ¯”å¦‚é’ˆå¯¹ä»¥ä¸‹çš„ patch æ“ä½œï¼š kubectl patch deployment/foo -p \\ '{\"spec\":{\"template\":{\"spec\":{\"containers\":[{\"name\":\"nginx\",\"image\":\"nginx:mainline\"}]}}}}' å¦‚æœ K8s å‘ç°å½“å‰ containers ä¸­å·²ç»æœ‰åå­—ä¸º nginx çš„å®¹å™¨ï¼Œåˆ™åªä¼šæŠŠ image æ›´æ–°ä¸Šå»ï¼›è€Œå¦‚æœå½“å‰ containers ä¸­æ²¡æœ‰ nginx å®¹å™¨ï¼ŒK8s ä¼šæŠŠè¿™ä¸ªå®¹å™¨æ’å…¥ containers åˆ—è¡¨ã€‚ æ­¤å¤–è¿˜è¦è¯´æ˜çš„æ˜¯ï¼Œç›®å‰ strategic ç­–ç•¥åªèƒ½ç”¨äºåŸç”Ÿ K8s èµ„æºä»¥åŠ Aggregated API æ–¹å¼çš„è‡ªå®šä¹‰èµ„æºï¼Œå¯¹äº CRD å®šä¹‰çš„èµ„æºå¯¹è±¡ï¼Œæ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚è¿™å¾ˆå¥½ç†è§£ï¼Œå› ä¸º kube-apiserver æ— æ³•å¾—çŸ¥ CRD èµ„æºçš„ç»“æ„å’Œ merge ç­–ç•¥ã€‚å¦‚æœç”¨ kubectl patch å‘½ä»¤æ›´æ–°ä¸€ä¸ª CRï¼Œåˆ™é»˜è®¤ä¼šé‡‡ç”¨ merge patch çš„ç­–ç•¥æ¥æ“ä½œã€‚ ","date":"2020-11-21","objectID":"/kubernetes/patch-update/:3:3","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/kubernetes/patch-update/"},{"categories":null,"content":"kubectl å°è£… äº†è§£å®Œäº† K8s çš„åŸºç¡€æ›´æ–°æœºåˆ¶ï¼Œæˆ‘ä»¬å†æ¬¡å›åˆ°æœ€åˆçš„é—®é¢˜ä¸Šã€‚ä¸ºä»€ä¹ˆç”¨æˆ·ä¿®æ”¹ YAML æ–‡ä»¶åæ— æ³•ç›´æ¥è°ƒç”¨ update æ¥å£æ›´æ–°ï¼Œå´å¯ä»¥é€šè¿‡ kubectl apply å‘½ä»¤æ›´æ–°å‘¢ï¼Ÿ å…¶å® kubectl ä¸ºäº†ç»™å‘½ä»¤è¡Œç”¨æˆ·æä¾›è‰¯å¥½çš„äº¤äº’ä½“æ„Ÿï¼Œè®¾è®¡äº†è¾ƒä¸ºå¤æ‚çš„å†…éƒ¨æ‰§è¡Œé€»è¾‘ï¼Œè¯¸å¦‚ applyã€edit è¿™äº›å¸¸ç”¨æ“ä½œå…¶å®èƒŒåå¹¶éå¯¹åº”ä¸€æ¬¡ç®€å•çš„ update è¯·æ±‚ã€‚æ¯•ç«Ÿ update æ˜¯æœ‰ç‰ˆæœ¬æ§åˆ¶çš„ï¼Œå¦‚æœå‘ç”Ÿäº†æ›´æ–°å†²çªå¯¹äºæ™®é€šç”¨æˆ·å¹¶ä¸å‹å¥½ã€‚ä»¥ä¸‹ç®€ç•¥ä»‹ç»ä¸‹ kubectl å‡ ç§æ›´æ–°æ“ä½œçš„é€»è¾‘ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹ link:https://github.com/kubernetes/kubectl[kubectl] å°è£…çš„æºç ã€‚ ","date":"2020-11-21","objectID":"/kubernetes/patch-update/:3:4","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/kubernetes/patch-update/"},{"categories":null,"content":"apply åœ¨ä½¿ç”¨é»˜è®¤å‚æ•°æ‰§è¡Œ apply æ—¶ï¼Œè§¦å‘çš„æ˜¯ client-side applyã€‚kubectl é€»è¾‘å¦‚ä¸‹ï¼š é¦–å…ˆè§£æç”¨æˆ·æäº¤çš„æ•°æ®ï¼ˆYAML/JSONï¼‰ä¸ºä¸€ä¸ªå¯¹è±¡ Aï¼›ç„¶åè°ƒç”¨ Get æ¥å£ä» K8s ä¸­æŸ¥è¯¢è¿™ä¸ªèµ„æºå¯¹è±¡ï¼š å¦‚æœæŸ¥è¯¢ç»“æœä¸å­˜åœ¨ï¼Œkubectl å°†æœ¬æ¬¡ç”¨æˆ·æäº¤çš„æ•°æ®è®°å½•åˆ°å¯¹è±¡ A çš„ annotation ä¸­ï¼ˆkey ä¸º kubectl.kubernetes.io/last-applied-configurationï¼‰ï¼Œæœ€åå°†å¯¹è±¡ Aæäº¤ç»™ K8s åˆ›å»ºï¼› å¦‚æœæŸ¥è¯¢åˆ° K8s ä¸­å·²æœ‰è¿™ä¸ªèµ„æºï¼Œå‡è®¾ä¸ºå¯¹è±¡ Bï¼š1. kubectl å°è¯•ä»å¯¹è±¡ B çš„ annotation ä¸­å–å‡º kubectl.kubernetes.io/last-applied-configuration çš„å€¼ï¼ˆå¯¹åº”äº†ä¸Šä¸€æ¬¡ apply æäº¤çš„å†…å®¹ï¼‰ï¼›2. kubectl æ ¹æ®å‰ä¸€æ¬¡ apply çš„å†…å®¹å’Œæœ¬æ¬¡ apply çš„å†…å®¹è®¡ç®—å‡º diffï¼ˆé»˜è®¤ä¸º strategic merge patch æ ¼å¼ï¼Œå¦‚æœéåŸç”Ÿèµ„æºåˆ™é‡‡ç”¨ merge patchï¼‰ï¼›3. å°† diff ä¸­æ·»åŠ æœ¬æ¬¡çš„ kubectl.kubernetes.io/last-applied-configuration annotationï¼Œæœ€åç”¨ patch è¯·æ±‚æäº¤ç»™ K8s åšæ›´æ–°ã€‚ ","date":"2020-11-21","objectID":"/kubernetes/patch-update/:3:5","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/kubernetes/patch-update/"},{"categories":null,"content":"edit kubectl edit é€»è¾‘ä¸Šæ›´ç®€å•ä¸€äº›ã€‚åœ¨ç”¨æˆ·æ‰§è¡Œå‘½ä»¤ä¹‹åï¼Œkubectl ä» K8s ä¸­æŸ¥åˆ°å½“å‰çš„èµ„æºå¯¹è±¡ï¼Œå¹¶æ‰“å¼€ä¸€ä¸ªå‘½ä»¤è¡Œç¼–è¾‘å™¨ï¼ˆé»˜è®¤ç”¨ viï¼‰ä¸ºç”¨æˆ·æä¾›ç¼–è¾‘ç•Œé¢ã€‚ å½“ç”¨æˆ·ä¿®æ”¹å®Œæˆã€ä¿å­˜é€€å‡ºæ—¶ï¼Œkubectl å¹¶éç›´æ¥æŠŠä¿®æ”¹åçš„å¯¹è±¡æäº¤ updateï¼ˆé¿å… Conflictï¼Œå¦‚æœç”¨æˆ·ä¿®æ”¹çš„è¿‡ç¨‹ä¸­èµ„æºå¯¹è±¡åˆè¢«æ›´æ–°ï¼‰ï¼Œè€Œæ˜¯ä¼šæŠŠä¿®æ”¹åçš„å¯¹è±¡å’Œåˆå§‹æ‹¿åˆ°çš„å¯¹è±¡è®¡ç®— diffï¼Œæœ€åå°† diff å†…å®¹ç”¨ patch è¯·æ±‚æäº¤ç»™ K8sã€‚ ","date":"2020-11-21","objectID":"/kubernetes/patch-update/:3:6","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/kubernetes/patch-update/"},{"categories":null,"content":"æ€»ç»“ çœ‹äº†ä¸Šè¿°çš„ä»‹ç»ï¼Œå¤§å®¶åº”è¯¥å¯¹ K8s æ›´æ–°æœºåˆ¶æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„äº†è§£äº†ã€‚æ¥ä¸‹æ¥æƒ³ä¸€æƒ³ï¼Œæ—¢ç„¶ K8s æä¾›äº†ä¸¤ç§æ›´æ–°æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨ä¸åŒçš„åœºæ™¯ä¸‹æ€ä¹ˆé€‰æ‹© update æˆ– patch æ¥ä½¿ç”¨å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬çš„å»ºè®®æ˜¯ï¼š å¦‚æœè¦æ›´æ–°çš„å­—æ®µåªæœ‰æˆ‘ä»¬è‡ªå·±ä¼šä¿®æ”¹ï¼ˆæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€äº›è‡ªå®šä¹‰æ ‡ç­¾ï¼Œå¹¶å†™äº† operator æ¥ç®¡ç†ï¼‰ï¼Œåˆ™ä½¿ç”¨ patch æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼› å¦‚æœè¦æ›´æ–°çš„å­—æ®µå¯èƒ½ä¼šè¢«å…¶ä»–æ–¹ä¿®æ”¹ï¼ˆæ¯”å¦‚æˆ‘ä»¬ä¿®æ”¹çš„ replicas å­—æ®µï¼Œå¯èƒ½æœ‰ä¸€äº›å…¶ä»–ç»„ä»¶æ¯”å¦‚ HPA ä¹Ÿä¼šåšä¿®æ”¹ï¼‰ï¼Œåˆ™å»ºè®®ä½¿ç”¨ update æ¥æ›´æ–°ï¼Œé¿å…å‡ºç°äº’ç›¸è¦†ç›–ã€‚ ","date":"2020-11-21","objectID":"/kubernetes/patch-update/:4:0","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/kubernetes/patch-update/"},{"categories":null,"content":"å‚è€ƒ https://aijishu.com/a/1060000000118183 ","date":"2020-11-21","objectID":"/kubernetes/patch-update/:5:0","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/kubernetes/patch-update/"},{"categories":null,"content":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","date":"2020-11-21","objectID":"/patch-update/","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/patch-update/"},{"categories":null,"content":"å¯¼è¯» ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä¸€ä¸ªé—®é¢˜ï¼šå¯¹äºä¸€ä¸ª K8s èµ„æºå¯¹è±¡æ¯”å¦‚ Deploymentï¼Œæˆ‘ä»¬å°è¯•åœ¨ä¿®æ”¹å…¶ä¸­ image é•œåƒæ—¶ï¼Œå¦‚æœæœ‰å…¶ä»–äººåŒæ—¶ä¹Ÿåœ¨å¯¹è¿™ä¸ª Deployment åšä¿®æ”¹ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å½“ç„¶ï¼Œè¿™é‡Œè¿˜å¯ä»¥å¼•ç”³å‡ºä¸¤ä¸ªé—®é¢˜ï¼š å¦‚æœåŒæ–¹ä¿®æ”¹çš„æ˜¯åŒä¸€ä¸ªå­—æ®µï¼Œæ¯”å¦‚ image å­—æ®µï¼Œç»“æœä¼šæ€æ ·ï¼Ÿ å¦‚æœåŒæ–¹ä¿®æ”¹çš„æ˜¯ä¸åŒå­—æ®µï¼Œæ¯”å¦‚ä¸€ä¸ªä¿®æ”¹ imageï¼Œå¦ä¸€ä¸ªä¿®æ”¹ replicasï¼Œåˆä¼šæ€ä¹ˆæ ·ï¼Ÿ å…¶å®ï¼Œå¯¹ä¸€ä¸ª Kubernetes èµ„æºå¯¹è±¡åšâ€œæ›´æ–°â€æ“ä½œï¼Œç®€å•æ¥è¯´å°±æ˜¯é€šçŸ¥ kube-apiserver ç»„ä»¶æˆ‘ä»¬å¸Œæœ›å¦‚ä½•ä¿®æ”¹è¿™ä¸ªå¯¹è±¡ã€‚è€Œ K8s ä¸ºè¿™ç±»éœ€æ±‚å®šä¹‰äº†ä¸¤ç§â€œé€šçŸ¥â€æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ update å’Œ patchã€‚åœ¨ update è¯·æ±‚ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°†æ•´ä¸ªä¿®æ”¹åçš„å¯¹è±¡æäº¤ç»™ K8sï¼›è€Œå¯¹äº patch è¯·æ±‚ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å¯¹è±¡ä¸­æŸäº›å­—æ®µçš„ä¿®æ”¹æäº¤ç»™ K8sã€‚ ","date":"2020-11-21","objectID":"/patch-update/:1:0","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/patch-update/"},{"categories":null,"content":"Update æœºåˆ¶ Kubernetes ä¸­çš„æ‰€æœ‰èµ„æºå¯¹è±¡ï¼Œéƒ½æœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ç‰ˆæœ¬å·ï¼ˆmetadata.resourceVersionï¼‰ã€‚æ¯ä¸ªèµ„æºå¯¹è±¡ä»åˆ›å»ºå¼€å§‹å°±ä¼šæœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œè€Œåæ¯æ¬¡è¢«ä¿®æ”¹ï¼ˆä¸ç®¡æ˜¯ update è¿˜æ˜¯ patch ä¿®æ”¹ï¼‰ï¼Œç‰ˆæœ¬å·éƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ å®˜æ–¹æ–‡æ¡£ å‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™ä¸ªç‰ˆæœ¬å·æ˜¯ä¸€ä¸ª K8s çš„å†…éƒ¨æœºåˆ¶ï¼Œç”¨æˆ·ä¸åº”è¯¥å‡è®¾å®ƒæ˜¯ä¸€ä¸ªæ•°å­—æˆ–è€…é€šè¿‡æ¯”è¾ƒä¸¤ä¸ªç‰ˆæœ¬å·å¤§å°æ¥ç¡®å®šèµ„æºå¯¹è±¡çš„æ–°æ—§ï¼Œå”¯ä¸€èƒ½åšçš„å°±æ˜¯é€šè¿‡æ¯”è¾ƒç‰ˆæœ¬å·ç›¸ç­‰æ¥ç¡®å®šå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªç‰ˆæœ¬ï¼ˆå³æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼‰ã€‚è€Œ resourceVersion ä¸€ä¸ªé‡è¦çš„ç”¨å¤„ï¼Œå°±æ˜¯æ¥åš update è¯·æ±‚çš„ç‰ˆæœ¬æ§åˆ¶ã€‚ K8s è¦æ±‚ç”¨æˆ· update è¯·æ±‚ä¸­æäº¤çš„å¯¹è±¡å¿…é¡»å¸¦æœ‰ resourceVersionï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æäº¤ update çš„æ•°æ®å¿…é¡»å…ˆæ¥æºäº K8s ä¸­å·²ç»å­˜åœ¨çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œä¸€æ¬¡å®Œæ•´çš„ update æ“ä½œæµç¨‹æ˜¯ï¼š é¦–å…ˆï¼Œä» K8s ä¸­æ‹¿åˆ°ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å¯¹è±¡ï¼ˆå¯ä»¥é€‰æ‹©ç›´æ¥ä» K8s ä¸­æŸ¥è¯¢ï¼›å¦‚æœåœ¨å®¢æˆ·ç«¯åšäº† list watchï¼Œæ¨èä»æœ¬åœ° informer ä¸­è·å–ï¼‰ï¼› ç„¶åï¼ŒåŸºäºè¿™ä¸ªå–å‡ºæ¥çš„å¯¹è±¡åšä¸€äº›ä¿®æ”¹ï¼Œæ¯”å¦‚å°† Deployment ä¸­çš„ replicas åšå¢å‡ï¼Œæˆ–æ˜¯å°† image å­—æ®µä¿®æ”¹ä¸ºä¸€ä¸ªæ–°ç‰ˆæœ¬çš„é•œåƒï¼› æœ€åï¼Œå°†ä¿®æ”¹åçš„å¯¹è±¡é€šè¿‡ update è¯·æ±‚æäº¤ç»™ K8sï¼› æ­¤æ—¶ï¼Œkube-apiserver ä¼šæ ¡éªŒç”¨æˆ· update è¯·æ±‚æäº¤å¯¹è±¡ä¸­çš„ resourceVersion ä¸€å®šè¦å’Œå½“å‰ K8s ä¸­è¿™ä¸ªå¯¹è±¡æœ€æ–°çš„ resourceVersion ä¸€è‡´ï¼Œæ‰èƒ½æ¥å—æœ¬æ¬¡ updateã€‚å¦åˆ™ï¼ŒK8s ä¼šæ‹’ç»è¯·æ±‚ï¼Œå¹¶å‘Šè¯‰ç”¨æˆ·å‘ç”Ÿäº†ç‰ˆæœ¬å†²çªï¼ˆConflictï¼‰ã€‚ ä¸Šå›¾å±•ç¤ºäº†å¤šä¸ªç”¨æˆ·åŒæ—¶ update æŸä¸€ä¸ªèµ„æºå¯¹è±¡æ—¶ä¼šå‘ç”Ÿçš„äº‹æƒ…ã€‚è€Œå¦‚æœå¦‚æœå‘ç”Ÿäº† Conflict å†²çªï¼Œå¯¹äº User A è€Œè¨€åº”è¯¥åšçš„å°±æ˜¯åšä¸€æ¬¡é‡è¯•ï¼Œå†æ¬¡è·å–åˆ°æœ€æ–°ç‰ˆæœ¬çš„å¯¹è±¡ï¼Œä¿®æ”¹åé‡æ–°æäº¤ updateã€‚ å› æ­¤ï¼Œæˆ‘ä»¬ä¸Šé¢çš„ä¸¤ä¸ªé—®é¢˜ä¹Ÿéƒ½å¾—åˆ°äº†è§£ç­”ï¼š ç”¨æˆ·ä¿®æ”¹ YAML åæäº¤ update å¤±è´¥ï¼Œæ˜¯å› ä¸º YAML æ–‡ä»¶ä¸­æ²¡æœ‰åŒ…å« resourceVersion å­—æ®µã€‚å¯¹äº update è¯·æ±‚è€Œè¨€ï¼Œåº”è¯¥å–å‡ºå½“å‰ K8s ä¸­çš„å¯¹è±¡åšä¿®æ”¹åæäº¤ï¼› å¦‚æœä¸¤ä¸ªç”¨æˆ·åŒæ—¶å¯¹ä¸€ä¸ªèµ„æºå¯¹è±¡åš updateï¼Œä¸ç®¡æ“ä½œçš„æ˜¯å¯¹è±¡ä¸­åŒä¸€ä¸ªå­—æ®µè¿˜æ˜¯ä¸åŒå­—æ®µï¼Œéƒ½å­˜åœ¨ç‰ˆæœ¬æ§åˆ¶çš„æœºåˆ¶ç¡®ä¿ä¸¤ä¸ªç”¨æˆ·çš„ update è¯·æ±‚ä¸ä¼šå‘ç”Ÿè¦†ç›–ã€‚ ","date":"2020-11-21","objectID":"/patch-update/:2:0","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/patch-update/"},{"categories":null,"content":"Patch æœºåˆ¶ ç›¸æ¯”äº update çš„ç‰ˆæœ¬æ§åˆ¶ï¼ŒK8s çš„ patch æœºåˆ¶åˆ™æ˜¾å¾—æ›´åŠ ç®€å•ã€‚ å½“ç”¨æˆ·å¯¹æŸä¸ªèµ„æºå¯¹è±¡æäº¤ä¸€ä¸ª patch è¯·æ±‚æ—¶ï¼Œkube-apiserver ä¸ä¼šè€ƒè™‘ç‰ˆæœ¬é—®é¢˜ï¼Œè€Œæ˜¯â€œæ— è„‘â€åœ°æ¥å—ç”¨æˆ·çš„è¯·æ±‚ï¼ˆåªè¦è¯·æ±‚å‘é€çš„ patch å†…å®¹åˆæ³•ï¼‰ï¼Œä¹Ÿå°±æ˜¯å°† patch æ‰“åˆ°å¯¹è±¡ä¸Šã€åŒæ—¶æ›´æ–°ç‰ˆæœ¬å·ã€‚ ä¸è¿‡ï¼Œpatch çš„å¤æ‚ç‚¹åœ¨äºï¼Œç›®å‰ K8s æä¾›äº† 4 ç§ patch ç­–ç•¥ï¼šjson patchã€merge patchã€strategic merge patchã€apply patchï¼ˆä» K8s 1.14 æ”¯æŒ server-side apply å¼€å§‹ï¼‰ã€‚é€šè¿‡ kubectl patch -h å‘½ä»¤æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°è¿™ä¸ªç­–ç•¥é€‰é¡¹ï¼ˆé»˜è®¤é‡‡ç”¨ strategicï¼‰ï¼š $ kubectl patch -h # ... --type='strategic': The type of patch being provided; one of [json merge strategic] ç¯‡å¹…é™åˆ¶è¿™é‡Œæš‚ä¸å¯¹æ¯ä¸ªç­–ç•¥åšè¯¦ç»†çš„ä»‹ç»äº†ï¼Œæˆ‘ä»¬å°±ä»¥ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹ä¸€ä¸‹å®ƒä»¬çš„å·®å¼‚æ€§ã€‚å¦‚æœé’ˆå¯¹ä¸€ä¸ªå·²æœ‰çš„ Deployment å¯¹è±¡ï¼Œå‡è®¾ template ä¸­å·²ç»æœ‰äº†ä¸€ä¸ªåä¸º app çš„å®¹å™¨ï¼š å¦‚æœè¦åœ¨å…¶ä¸­æ–°å¢ä¸€ä¸ª nginx å®¹å™¨ï¼Œå¦‚ä½• patch æ›´æ–°ï¼Ÿ å¦‚æœè¦ä¿®æ”¹ app å®¹å™¨çš„é•œåƒï¼Œå¦‚ä½• patch æ›´æ–°ï¼Ÿ ","date":"2020-11-21","objectID":"/patch-update/:3:0","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/patch-update/"},{"categories":null,"content":"json patch æ–°å¢å®¹å™¨ï¼š kubectl patch deployment/foo --type='json' -p \\ '[{\"op\":\"add\",\"path\":\"/spec/template/spec/containers/1\",\"value\":{\"name\":\"nginx\",\"image\":\"nginx:alpine\"}}]' ä¿®æ”¹å·²æœ‰å®¹å™¨ imageï¼š kubectl patch deployment/foo --type='json' -p \\ '[{\"op\":\"replace\",\"path\":\"/spec/template/spec/containers/0/image\",\"value\":\"app-image:v2\"}]' è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœæˆ‘ä»¬ patch ä¹‹å‰è¿™ä¸ªå¯¹è±¡å·²ç»è¢«å…¶ä»–äººä¿®æ”¹äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ patch æœ‰å¯èƒ½äº§ç”Ÿéé¢„æœŸçš„åæœã€‚æ¯”å¦‚åœ¨æ‰§è¡Œ app å®¹å™¨é•œåƒæ›´æ–°æ—¶ï¼Œæˆ‘ä»¬æŒ‡å®šçš„åºå·æ˜¯ 0ï¼Œä½†æ­¤æ—¶ containers åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªä½ç½®è¢«æ’å…¥äº†å¦ä¸€ä¸ªå®¹å™¨ï¼Œåˆ™æ›´æ–°çš„é•œåƒå°±è¢«é”™è¯¯åœ°æ’å…¥åˆ°è¿™ä¸ªéé¢„æœŸçš„å®¹å™¨ä¸­ã€‚ ","date":"2020-11-21","objectID":"/patch-update/:3:1","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/patch-update/"},{"categories":null,"content":"merge patch merge patch æ— æ³•å•ç‹¬æ›´æ–°ä¸€ä¸ªåˆ—è¡¨ä¸­çš„æŸä¸ªå…ƒç´ ï¼Œå› æ­¤ä¸ç®¡æˆ‘ä»¬æ˜¯è¦åœ¨ containers é‡Œæ–°å¢å®¹å™¨ã€è¿˜æ˜¯ä¿®æ”¹å·²æœ‰å®¹å™¨çš„ imageã€env ç­‰å­—æ®µï¼Œéƒ½è¦ç”¨æ•´ä¸ª containers åˆ—è¡¨æ¥æäº¤ patchï¼š kubectl patch deployment/foo --type='merge' -p \\ '{\"spec\":{\"template\":{\"spec\":{\"containers\":[{\"name\":\"app\",\"image\":\"app-image:v2\"},{\"name\":\"nginx\",\"image\":\"nginx:alpline\"}]}}}}' æ˜¾ç„¶ï¼Œè¿™ä¸ªç­–ç•¥å¹¶ä¸é€‚åˆæˆ‘ä»¬å¯¹ä¸€äº›åˆ—è¡¨æ·±å±‚çš„å­—æ®µåšæ›´æ–°ï¼Œæ›´é€‚ç”¨äºå¤§ç‰‡æ®µçš„è¦†ç›–æ›´æ–°ã€‚ ä¸è¿‡å¯¹äº labels/annotations è¿™äº› map ç±»å‹çš„å…ƒç´ æ›´æ–°ï¼Œmerge patch æ˜¯å¯ä»¥å•ç‹¬æŒ‡å®š key-value æ“ä½œçš„ï¼Œç›¸æ¯”äº json patch æ–¹ä¾¿ä¸€äº›ï¼Œå†™èµ·æ¥ä¹Ÿæ›´åŠ ç›´è§‚ï¼š kubectl patch deployment/foo â€“type='mergeâ€™ -p â€˜{â€œmetadataâ€:{â€œlabelsâ€:{â€œtest-keyâ€:â€œfooâ€}}}â€™ ","date":"2020-11-21","objectID":"/patch-update/:3:2","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/patch-update/"},{"categories":null,"content":"strategic merge patch è¿™ç§ patch ç­–ç•¥å¹¶æ²¡æœ‰ä¸€ä¸ªé€šç”¨çš„ RFC æ ‡å‡†ï¼Œè€Œæ˜¯ K8s ç‹¬æœ‰çš„ï¼Œä¸è¿‡ç›¸æ¯”å‰ä¸¤ç§è€Œè¨€å´æ›´ä¸ºå¼ºå¤§çš„ã€‚ æˆ‘ä»¬å…ˆä» K8s æºç çœ‹èµ·ï¼Œåœ¨ K8s åŸç”Ÿèµ„æºçš„æ•°æ®ç»“æ„å®šä¹‰ä¸­é¢å¤–å®šä¹‰äº†ä¸€äº›çš„ç­–ç•¥æ³¨è§£ã€‚æ¯”å¦‚ä»¥ä¸‹è¿™ä¸ªæˆªå–äº† podSpec ä¸­é’ˆå¯¹ containers åˆ—è¡¨çš„å®šä¹‰ // ... // +patchMergeKey=name // +patchStrategy=merge Containers []Container `json:\"containers\" patchStrategy:\"merge\" patchMergeKey:\"name\" protobuf:\"bytes,2,rep,name=containers\"` å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰ä¸¤ä¸ªå…³é”®ä¿¡æ¯ï¼špatchStrategy:â€œmergeâ€ patchMergeKey:â€œnameâ€ ã€‚è¿™å°±ä»£è¡¨äº†ï¼Œcontainers åˆ—è¡¨ä½¿ç”¨ strategic merge patch ç­–ç•¥æ›´æ–°æ—¶ï¼Œä¼šæŠŠä¸‹é¢æ¯ä¸ªå…ƒç´ ä¸­çš„ name å­—æ®µçœ‹ä½œ keyã€‚ ç®€å•æ¥è¯´ï¼Œåœ¨æˆ‘ä»¬ patch æ›´æ–° containers ä¸å†éœ€è¦æŒ‡å®šä¸‹æ ‡åºå·äº†ï¼Œè€Œæ˜¯æŒ‡å®š name æ¥ä¿®æ”¹ï¼ŒK8s ä¼šæŠŠ name ä½œä¸º key æ¥è®¡ç®— mergeã€‚æ¯”å¦‚é’ˆå¯¹ä»¥ä¸‹çš„ patch æ“ä½œï¼š kubectl patch deployment/foo -p \\ '{\"spec\":{\"template\":{\"spec\":{\"containers\":[{\"name\":\"nginx\",\"image\":\"nginx:mainline\"}]}}}}' å¦‚æœ K8s å‘ç°å½“å‰ containers ä¸­å·²ç»æœ‰åå­—ä¸º nginx çš„å®¹å™¨ï¼Œåˆ™åªä¼šæŠŠ image æ›´æ–°ä¸Šå»ï¼›è€Œå¦‚æœå½“å‰ containers ä¸­æ²¡æœ‰ nginx å®¹å™¨ï¼ŒK8s ä¼šæŠŠè¿™ä¸ªå®¹å™¨æ’å…¥ containers åˆ—è¡¨ã€‚ æ­¤å¤–è¿˜è¦è¯´æ˜çš„æ˜¯ï¼Œç›®å‰ strategic ç­–ç•¥åªèƒ½ç”¨äºåŸç”Ÿ K8s èµ„æºä»¥åŠ Aggregated API æ–¹å¼çš„è‡ªå®šä¹‰èµ„æºï¼Œå¯¹äº CRD å®šä¹‰çš„èµ„æºå¯¹è±¡ï¼Œæ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚è¿™å¾ˆå¥½ç†è§£ï¼Œå› ä¸º kube-apiserver æ— æ³•å¾—çŸ¥ CRD èµ„æºçš„ç»“æ„å’Œ merge ç­–ç•¥ã€‚å¦‚æœç”¨ kubectl patch å‘½ä»¤æ›´æ–°ä¸€ä¸ª CRï¼Œåˆ™é»˜è®¤ä¼šé‡‡ç”¨ merge patch çš„ç­–ç•¥æ¥æ“ä½œã€‚ ","date":"2020-11-21","objectID":"/patch-update/:3:3","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/patch-update/"},{"categories":null,"content":"kubectl å°è£… äº†è§£å®Œäº† K8s çš„åŸºç¡€æ›´æ–°æœºåˆ¶ï¼Œæˆ‘ä»¬å†æ¬¡å›åˆ°æœ€åˆçš„é—®é¢˜ä¸Šã€‚ä¸ºä»€ä¹ˆç”¨æˆ·ä¿®æ”¹ YAML æ–‡ä»¶åæ— æ³•ç›´æ¥è°ƒç”¨ update æ¥å£æ›´æ–°ï¼Œå´å¯ä»¥é€šè¿‡ kubectl apply å‘½ä»¤æ›´æ–°å‘¢ï¼Ÿ å…¶å® kubectl ä¸ºäº†ç»™å‘½ä»¤è¡Œç”¨æˆ·æä¾›è‰¯å¥½çš„äº¤äº’ä½“æ„Ÿï¼Œè®¾è®¡äº†è¾ƒä¸ºå¤æ‚çš„å†…éƒ¨æ‰§è¡Œé€»è¾‘ï¼Œè¯¸å¦‚ applyã€edit è¿™äº›å¸¸ç”¨æ“ä½œå…¶å®èƒŒåå¹¶éå¯¹åº”ä¸€æ¬¡ç®€å•çš„ update è¯·æ±‚ã€‚æ¯•ç«Ÿ update æ˜¯æœ‰ç‰ˆæœ¬æ§åˆ¶çš„ï¼Œå¦‚æœå‘ç”Ÿäº†æ›´æ–°å†²çªå¯¹äºæ™®é€šç”¨æˆ·å¹¶ä¸å‹å¥½ã€‚ä»¥ä¸‹ç®€ç•¥ä»‹ç»ä¸‹ kubectl å‡ ç§æ›´æ–°æ“ä½œçš„é€»è¾‘ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹ link:https://github.com/kubernetes/kubectl[kubectl] å°è£…çš„æºç ã€‚ ","date":"2020-11-21","objectID":"/patch-update/:3:4","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/patch-update/"},{"categories":null,"content":"apply åœ¨ä½¿ç”¨é»˜è®¤å‚æ•°æ‰§è¡Œ apply æ—¶ï¼Œè§¦å‘çš„æ˜¯ client-side applyã€‚kubectl é€»è¾‘å¦‚ä¸‹ï¼š é¦–å…ˆè§£æç”¨æˆ·æäº¤çš„æ•°æ®ï¼ˆYAML/JSONï¼‰ä¸ºä¸€ä¸ªå¯¹è±¡ Aï¼›ç„¶åè°ƒç”¨ Get æ¥å£ä» K8s ä¸­æŸ¥è¯¢è¿™ä¸ªèµ„æºå¯¹è±¡ï¼š å¦‚æœæŸ¥è¯¢ç»“æœä¸å­˜åœ¨ï¼Œkubectl å°†æœ¬æ¬¡ç”¨æˆ·æäº¤çš„æ•°æ®è®°å½•åˆ°å¯¹è±¡ A çš„ annotation ä¸­ï¼ˆkey ä¸º kubectl.kubernetes.io/last-applied-configurationï¼‰ï¼Œæœ€åå°†å¯¹è±¡ Aæäº¤ç»™ K8s åˆ›å»ºï¼› å¦‚æœæŸ¥è¯¢åˆ° K8s ä¸­å·²æœ‰è¿™ä¸ªèµ„æºï¼Œå‡è®¾ä¸ºå¯¹è±¡ Bï¼š1. kubectl å°è¯•ä»å¯¹è±¡ B çš„ annotation ä¸­å–å‡º kubectl.kubernetes.io/last-applied-configuration çš„å€¼ï¼ˆå¯¹åº”äº†ä¸Šä¸€æ¬¡ apply æäº¤çš„å†…å®¹ï¼‰ï¼›2. kubectl æ ¹æ®å‰ä¸€æ¬¡ apply çš„å†…å®¹å’Œæœ¬æ¬¡ apply çš„å†…å®¹è®¡ç®—å‡º diffï¼ˆé»˜è®¤ä¸º strategic merge patch æ ¼å¼ï¼Œå¦‚æœéåŸç”Ÿèµ„æºåˆ™é‡‡ç”¨ merge patchï¼‰ï¼›3. å°† diff ä¸­æ·»åŠ æœ¬æ¬¡çš„ kubectl.kubernetes.io/last-applied-configuration annotationï¼Œæœ€åç”¨ patch è¯·æ±‚æäº¤ç»™ K8s åšæ›´æ–°ã€‚ ","date":"2020-11-21","objectID":"/patch-update/:3:5","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/patch-update/"},{"categories":null,"content":"edit kubectl edit é€»è¾‘ä¸Šæ›´ç®€å•ä¸€äº›ã€‚åœ¨ç”¨æˆ·æ‰§è¡Œå‘½ä»¤ä¹‹åï¼Œkubectl ä» K8s ä¸­æŸ¥åˆ°å½“å‰çš„èµ„æºå¯¹è±¡ï¼Œå¹¶æ‰“å¼€ä¸€ä¸ªå‘½ä»¤è¡Œç¼–è¾‘å™¨ï¼ˆé»˜è®¤ç”¨ viï¼‰ä¸ºç”¨æˆ·æä¾›ç¼–è¾‘ç•Œé¢ã€‚ å½“ç”¨æˆ·ä¿®æ”¹å®Œæˆã€ä¿å­˜é€€å‡ºæ—¶ï¼Œkubectl å¹¶éç›´æ¥æŠŠä¿®æ”¹åçš„å¯¹è±¡æäº¤ updateï¼ˆé¿å… Conflictï¼Œå¦‚æœç”¨æˆ·ä¿®æ”¹çš„è¿‡ç¨‹ä¸­èµ„æºå¯¹è±¡åˆè¢«æ›´æ–°ï¼‰ï¼Œè€Œæ˜¯ä¼šæŠŠä¿®æ”¹åçš„å¯¹è±¡å’Œåˆå§‹æ‹¿åˆ°çš„å¯¹è±¡è®¡ç®— diffï¼Œæœ€åå°† diff å†…å®¹ç”¨ patch è¯·æ±‚æäº¤ç»™ K8sã€‚ ","date":"2020-11-21","objectID":"/patch-update/:3:6","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/patch-update/"},{"categories":null,"content":"æ€»ç»“ çœ‹äº†ä¸Šè¿°çš„ä»‹ç»ï¼Œå¤§å®¶åº”è¯¥å¯¹ K8s æ›´æ–°æœºåˆ¶æœ‰äº†ä¸€ä¸ªåˆæ­¥çš„äº†è§£äº†ã€‚æ¥ä¸‹æ¥æƒ³ä¸€æƒ³ï¼Œæ—¢ç„¶ K8s æä¾›äº†ä¸¤ç§æ›´æ–°æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨ä¸åŒçš„åœºæ™¯ä¸‹æ€ä¹ˆé€‰æ‹© update æˆ– patch æ¥ä½¿ç”¨å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬çš„å»ºè®®æ˜¯ï¼š å¦‚æœè¦æ›´æ–°çš„å­—æ®µåªæœ‰æˆ‘ä»¬è‡ªå·±ä¼šä¿®æ”¹ï¼ˆæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€äº›è‡ªå®šä¹‰æ ‡ç­¾ï¼Œå¹¶å†™äº† operator æ¥ç®¡ç†ï¼‰ï¼Œåˆ™ä½¿ç”¨ patch æ˜¯æœ€ç®€å•çš„æ–¹å¼ï¼› å¦‚æœè¦æ›´æ–°çš„å­—æ®µå¯èƒ½ä¼šè¢«å…¶ä»–æ–¹ä¿®æ”¹ï¼ˆæ¯”å¦‚æˆ‘ä»¬ä¿®æ”¹çš„ replicas å­—æ®µï¼Œå¯èƒ½æœ‰ä¸€äº›å…¶ä»–ç»„ä»¶æ¯”å¦‚ HPA ä¹Ÿä¼šåšä¿®æ”¹ï¼‰ï¼Œåˆ™å»ºè®®ä½¿ç”¨ update æ¥æ›´æ–°ï¼Œé¿å…å‡ºç°äº’ç›¸è¦†ç›–ã€‚ ","date":"2020-11-21","objectID":"/patch-update/:4:0","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/patch-update/"},{"categories":null,"content":"å‚è€ƒ https://aijishu.com/a/1060000000118183 ","date":"2020-11-21","objectID":"/patch-update/:5:0","tags":["kubernetes","api","patch","update"],"title":"kubernetes ä¸­patchä¸updateæ¯”è¾ƒ","uri":"/patch-update/"},{"categories":null,"content":"kubectl å¸¸ç”¨å‘½ä»¤æŒ‡å—","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"å¯¼è¯» kubectl åº”è¯¥æ˜¯æ¯ä¸ªæ¥è§¦ kubernetes çš„äººéƒ½ä¼šæ¥è§¦çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒå¸¦ç»™æˆ‘ä»¬å¼ºå¤§çš„å‘½ä»¤è¡Œä½“éªŒï¼Œæœ¬ç¯‡æ–‡ç« å°±æ˜¯ä»‹ç» kubectl ä¸­çš„ä¸€äº›å¸¸ç”¨å‘½ä»¤ï¼Œåœ¨ç»“åˆä¸€äº›å…·ä½“çš„ä½¿ç”¨åœºæ™¯è¯´è¯´å¦‚ä½•åˆ©ç”¨ kubectl å®ç°ã€‚å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œåœ¨è¿™é‡Œå°½å¯èƒ½å…¨çš„ç½—åˆ—ï¼Œæ–¹ä¾¿åç»­ ç”¨çš„æ—¶å€™æŸ¥æ‰¾ã€‚å¦‚æœèƒ½å¸®åˆ°æ‚¨å°±æ”¶è—èµ·æ¥å§(ğŸ˜„)ã€‚ æœ¬æ¬¡å®éªŒç¯å¢ƒæ˜¯ kubernetes-1.16.9ï¼Œæœ¬ç¯‡æ–‡æ¡£çš„å†™ä½œæ€è·¯æ˜¯æŒ‰ç…§å¹³æ—¶ çš„ä½¿ç”¨åœºæ™¯è¿›è¡Œå†™ä½œï¼Œä¸ä¼šè¯¦ç»†ä»‹ç» kubectl çš„å‘½ä»¤ï¼Œkubectl è¯¦ç»†çš„å¸®åŠ©æ–‡æ¡£å‚è€ƒ kubectl --help or kubectl command --help ã€‚ ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:1:0","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"kubectl æ”¯æŒçš„å‘½ä»¤ kubectl --help kubectl controls the Kubernetes cluster manager. Find more information at: https://kubernetes.io/docs/reference/kubectl/overview/ Basic Commands (Beginner): create Create a resource from a file or from stdin. expose ä½¿ç”¨ replication controller, service, deployment æˆ–è€… pod å¹¶æš´éœ²å®ƒä½œä¸ºä¸€ä¸ª æ–°çš„ Kubernetes Service run åœ¨é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„é•œåƒ set ä¸º objects è®¾ç½®ä¸€ä¸ªæŒ‡å®šçš„ç‰¹å¾ Basic Commands (Intermediate): explain æŸ¥çœ‹èµ„æºçš„æ–‡æ¡£ get æ˜¾ç¤ºä¸€ä¸ªæˆ–æ›´å¤š resources edit åœ¨æœåŠ¡å™¨ä¸Šç¼–è¾‘ä¸€ä¸ªèµ„æº delete Delete resources by filenames, stdin, resources and names, or by resources and label selector Deploy Commands: rollout Manage the rollout of a resource scale ä¸º Deployment, ReplicaSet, Replication Controller æˆ–è€… Job è®¾ç½®ä¸€ä¸ªæ–°çš„å‰¯æœ¬æ•°é‡ autoscale è‡ªåŠ¨è°ƒæ•´ä¸€ä¸ª Deployment, ReplicaSet, æˆ–è€… ReplicationController çš„å‰¯æœ¬æ•°é‡ Cluster Management Commands: certificate ä¿®æ”¹ certificate èµ„æº. cluster-info æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯ top Display Resource (CPU/Memory/Storage) usage. cordon æ ‡è®° node ä¸º unschedulable uncordon æ ‡è®° node ä¸º schedulable drain Drain node in preparation for maintenance taint æ›´æ–°ä¸€ä¸ªæˆ–è€…å¤šä¸ª node ä¸Šçš„ taints Troubleshooting and Debugging Commands: describe æ˜¾ç¤ºä¸€ä¸ªæŒ‡å®š resource æˆ–è€… group çš„ resources è¯¦æƒ… logs è¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿— attach Attach åˆ°ä¸€ä¸ªè¿è¡Œä¸­çš„ container exec åœ¨ä¸€ä¸ª container ä¸­æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ port-forward Forward one or more local ports to a pod proxy è¿è¡Œä¸€ä¸ª proxy åˆ° Kubernetes API server cp å¤åˆ¶ files å’Œ directories åˆ° containers å’Œä»å®¹å™¨ä¸­å¤åˆ¶ files å’Œ directories. auth Inspect authorization Advanced Commands: diff Diff live version against would-be applied version apply é€šè¿‡æ–‡ä»¶åæˆ–æ ‡å‡†è¾“å…¥æµ(stdin)å¯¹èµ„æºè¿›è¡Œé…ç½® patch ä½¿ç”¨ strategic merge patch æ›´æ–°ä¸€ä¸ªèµ„æºçš„ field(s) replace é€šè¿‡ filename æˆ–è€… stdinæ›¿æ¢ä¸€ä¸ªèµ„æº wait Experimental: Wait for a specific condition on one or many resources. convert åœ¨ä¸åŒçš„ API versions è½¬æ¢é…ç½®æ–‡ä»¶ kustomize Build a kustomization target from a directory or a remote url. Settings Commands: label æ›´æ–°åœ¨è¿™ä¸ªèµ„æºä¸Šçš„ labels annotate æ›´æ–°ä¸€ä¸ªèµ„æºçš„æ³¨è§£ completion Output shell completion code for the specified shell (bash or zsh) Other Commands: api-resources Print the supported API resources on the server api-versions Print the supported API versions on the server, in the form of \"group/version\" config ä¿®æ”¹ kubeconfig æ–‡ä»¶ plugin Provides utilities for interacting with plugins. version è¾“å‡º client å’Œ server çš„ç‰ˆæœ¬ä¿¡æ¯ Usage: kubectl [flags] [options] Use \"kubectl \u003ccommand\u003e --help\" for more information about a given command. Use \"kubectl options\" for a list of global command-line options (applies to all commands). ä»ä¸Šé¢çš„å¸®åŠ©æ–‡æ¡£å¯ä»¥çœ‹å‡ºï¼Œ kubectl åŸºæœ¬æ ¼å¼ä¸º kubectl verb resource options , kubectl åè·Ÿè°“è¯­åŠ¨è¯ï¼Œ å†è·Ÿè¦æ“ä½œçš„èµ„æºï¼Œå¯ä»¥åŠ  options ï¼Œå¦‚ï¼š è¦çœ‹ monitoring namespace ä¸‹é¢æœ‰å“ªäº›pod : kubectl -n monitoring get po ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:2:0","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"pod pod åœºæ™¯ä¸‹ï¼Œå¯èƒ½ä¼šæœ‰å¦‚ä¸‹éœ€æ±‚: ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:0","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹æŸä¸ª namespace ä¸‹ï¼Œæ‰€æœ‰çš„pod # å…ˆæŸ¥çœ‹æœ‰å“ªäº›namespace kubectl get namespace # æŸ¥çœ‹ pod kubectl -n $namespace get po # æˆ–è€… kubectl get po -n $namespace ä¸Šé¢ä¸¤ç§å†™æ³•åœ¨è¾¾åˆ°çš„æ•ˆæœä¸Šæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªç»†èŠ‚å¯ä»¥æ³¨æ„ä¸€ä¸‹ï¼Œå¦‚æœ kubectl ç¯å¢ƒæœ‰å‘½ä»¤è‡ªåŠ¨è¡¥å…¨çš„è¯ï¼Œèµ„æºå¯¹è±¡åˆæ¯”è¾ƒå¤š çš„æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ç§å†™æ³•å°†ä¼šæœ‰æå¤§çš„ä¼˜åŠ¿ï¼Œå¯ä»¥æ€è€ƒè¿™ä¹ˆä¸ªåœºæ™¯ï¼Œå¦‚ï¼šè¦æŸ¥çœ‹ monitoring namespace ä¸‹çš„æŸä¸ªpod è¯¦æƒ…, å°±å¯ä»¥é€šè¿‡: kubectl -n monitoring get po åŠ  tab é”®ï¼Œåˆ—å‡ºè¿™ä¸ªnamespace ä¸‹çš„æ‰€æœ‰ pod ä¾›ç­›é€‰ã€‚ centos ä¸‹å‘½ä»¤è‡ªåŠ¨è¡¥å…¨éœ€è¦å®‰è£… bash-completion ï¼Œæ–¹æ³•ä¸º yum install -y bash-completion å¦‚æœä¸åŠ  -n $namespace ï¼Œåˆ™é»˜è®¤æ˜¯ default namespace ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:1","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹æ‰€æœ‰namespace çš„pod kubectl get po --all-namespaces # or kubectl get po -A ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:2","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹æŸä¸ªå…·ä½“çš„ pod ä¿¡æ¯ ï¼Œä»¥ wideã€jsonã€yaml çš„æ ¼å¼è¾“å‡º kubectl -n $namespace get po xxx -o wide/json/yaml # å¦‚ æŸ¥çœ‹ monitoring ä¸‹çš„ prometheus-0 pod ä¿¡æ¯ï¼Œå¹¶ä»¥yaml å½¢å¼è¾“å‡ºã€‚ kubectl -n monitoring get po prometheus-0 -o yaml ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:3","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹æŸä¸ª pod çš„æŸä¸ªå­—æ®µä¿¡æ¯ å¦‚æœæˆ‘ä»¬åªæƒ³çŸ¥é“ pod çš„ hostIP æˆ–è€…å…¶ä»–çš„ ä¸€äº›å­—æ®µï¼Œ å¯ä»¥é€šè¿‡ -o jsonpath or -o template or -o go-template å…¶ä¸­template è¯­æ³•éµå¾ª golang template éœ€è¦å¯¹ pod çš„å¯¹è±¡æ¨¡å‹æœ‰ä¸€å®šçš„äº†è§£ï¼Œå¦‚æœä¸äº†è§£ï¼Œå¯ä»¥ -o yaml or -o json ç›´æ¥æŸ¥çœ‹ã€‚ æŸ¥çœ‹ hostIP çš„æ–¹æ³•å¦‚ä¸‹: # -o jsonpath kubectl -n monitoring get po prometheus-k8s-0 -o jsonpath=\"{.status.hostIP}\" # -o template kubectl -n monitoring get po prometheus-k8s-0 -o template --template=\"{{.status.hostIP}}\" # -o go-template kubectl -n monitoring get po prometheus-k8s-0 -o go-template=\"{{.status.hostIP}}\" å¦‚æœéœ€è¦æŸ¥çœ‹å…¶ä»–çš„å­—æ®µç…§çŒ«ç”»è™å³å¯ã€‚ ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:4","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"é€šè¿‡æ ‡ç­¾é€‰æ‹©æŸ¥çœ‹ pod é€šè¿‡ -l key1=value1,key2=value2 è¿›è¡Œé€‰æ‹©ï¼Œå¦‚ kubectl -n monitoring get po -l app=prometheus kubectl -n monitoring get po -l app=prometheus,prometheus=k8s ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:5","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹æŸä¸ªnode ä¸Šéƒ¨ç½²çš„æ‰€æœ‰ pod #å…ˆè·å–é›†ç¾¤å†…æ‰€æœ‰çš„node kubectl get node -o wide # å‡è®¾å…¶ä¸­ä¸€ä¸ª node çš„åç§°ä¸º node-0001 kubectl get po -A -o wide | grep node-0001 é€šè¿‡ kubectl get po -A -o wide | grep å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œå…·ä½“å¯ä»¥æ ¹æ®æƒ…å†µè€Œå®šï¼Œæ¯”å¦‚æŸ¥çœ‹æ‰€æœ‰çŠ¶æ€å¼‚å¸¸çš„ pod ï¼ˆé Runningï¼‰ kubectl get po -A -o wide | grep -v Running ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:6","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹ pod çš„è¯¦ç»†ä¿¡æ¯ kubectl -n monitoring describe po prometheus-k8s-0 è¿™ä¸ªå‘½ä»¤åœ¨æŸ¥çœ‹ pod çš„åŸºæœ¬ä¿¡æ¯å’Œé—®é¢˜å®šä½æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œå½“ pod å¼‚å¸¸ï¼Œå¯ä»¥æŸ¥çœ‹ Events æˆ–è®¸å°±èƒ½å‘ç°é—®é¢˜æ‰€åœ¨ã€‚ ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:7","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹ pod log kubectl -n $namespace logs -f $podName $containerName # å…¶ä¸­ $namespaceï¼Œ$podNameï¼Œ$containerName æ›¿æ¢æˆçœŸå®å€¼å³å¯ï¼Œå½“ pod ä¸­åªæœ‰ä¸€ä¸ª å®¹å™¨æ—¶å¯çœç•¥ $containerNameï¼Œå¦‚ï¼š kubectl -n monitoring logs -f prometheus-k8s-0 prometheus ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:8","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"è¿›å…¥å®¹å™¨ kubectl -n $namespace exec -it $podName -c $containerName sh # å…¶ä¸­ $namespaceï¼Œ$podNameï¼Œ$containerName æ›¿æ¢æˆçœŸå®å€¼å³å¯ï¼Œå½“ pod ä¸­åªæœ‰ä¸€ä¸ª å®¹å™¨æ—¶å¯çœç•¥ -c $containerNameï¼Œå¦‚ï¼š kubectl -n monitoring exec -it prometheus-k8s-0 -c prometheus sh ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:9","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹ pod çš„èµ„æºä½¿ç”¨æƒ…å†µ kubectl -n $namespace top pod # å…¶ä¸­ $namespace æ›¿æ¢æˆçœŸå®å€¼å³å¯ï¼Œå¦‚ï¼š kubectl -n monitoring top pod ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:10","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"åˆ é™¤ pod kubectl -n $namespace delete po $podName kubectl -n monitoring delete po prometheus-k8s-0 # åœ¨æŸäº›å¼‚å¸¸æƒ…å†µä¸‹åˆ é™¤ pod ä¼šå¡ä½ï¼Œåˆ ä¸æ‰ï¼Œéœ€è¦å¼ºåˆ¶æ‰èƒ½åˆ é™¤ ï¼Œå¼ºåˆ¶åˆ é™¤éœ€è¦å¢åŠ  --grace-period=0 --force ï¼Œ kubectl -n monitoring delete po prometheus-k8s-0 --grace-period=0 --force åŸç†å¦‚ä¸‹ï¼Œ é»˜è®¤æ‰§è¡Œ delete po æ—¶ï¼Œkubectl ä¼šå¢åŠ â€“grace-period=30 å‚æ•°ï¼Œè¡¨ç¤ºé¢„ç•™30ç§’çš„æ—¶é—´ç»™ pod å¤„ç†å½“å‰çš„è¯·æ±‚ï¼Œ ä½†åŒæ—¶ä¹Ÿä¸æ¥æ”¶æ–°çš„è¯·æ±‚äº†ï¼Œä»¥ä¸€ç§ç›¸å¯¹ä¼˜é›…çš„æ–¹å¼åœæ­¢å®¹å™¨ï¼Œæ³¨æ„è¿™ä¸ªå‚æ•°åœ¨åˆ›å»º pod æ—¶å¯ä»¥æŒ‡å®šï¼Œé»˜è®¤æ˜¯30ç§’ã€‚å¼ºåˆ¶åˆ é™¤æ—¶éœ€è¦æŠŠâ€“grace-period è®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºä¸ç­‰å¾…é©¬ä¸Šåˆ é™¤ï¼Œå¦åˆ™å¼ºåˆ¶åˆ é™¤å°±ä¼šå¤±æ•ˆã€‚ ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:11","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"pod æ ‡ç­¾ç®¡ç† pod çš„å¤§å¤šæ•°çš„æƒ…å†µéƒ½ä¼šç”± deployment or statefulset æ¥ç®¡ç†ï¼Œæ‰€ä»¥æ ‡ç­¾ä¹Ÿä¼šé€šè¿‡å®ƒä»¬ç®¡ç†ï¼Œå®é™…æƒ…å†µä¸‹å¾ˆå°‘ä¼šé€šè¿‡ kubectl å¯¹ pod label åšå¢åˆ æ”¹ï¼Œå¦‚æœ‰éœ€è¦å¯å‚è€ƒ ä¸‹é¢ node çš„ç”¨æ³•ï¼Œåªéœ€è¦æŠŠèµ„æºå¯¹è±¡æ¢æˆ pod å³å¯ã€‚ ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:12","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æ–‡ä»¶ copy ä» pod ä¸­ copy æ–‡ä»¶æˆ–è€… copy åˆ° pod ä¸­å»ã€‚ å®¹å™¨ä¸­éœ€è¦æœ‰ tar å‘½ä»¤ï¼Œå¦åˆ™ä¼šå¤±è´¥ # ä»æœ¬åœ° copy åˆ° pod kubectl cp /tmp/foo_dir \u003csome-pod\u003e:/tmp/bar_dir kubectl -n monitoring cp abc.txt prometheus-k8s-0:/tmp/abc.txt # å¦‚æœ pod ä¸­æœ‰å¤šä¸ª container å¯ä»¥ç”¨ -c æŒ‡å®š container kubectl cp /tmp/foo \u003csome-pod\u003e:/tmp/bar -c \u003cspecific-container\u003e kubectl -n monitoring cp abc.txt prometheus-k8s-0:/tmp/abc.txt -c prometheus # ä» pod copy åˆ° æœ¬åœ° kubectl cp \u003csome-pod\u003e:/tmp/foo /tmp/bar kubectl -n monitoring cp prometheus-k8s-0:/tmp/abc.txt /tmp/abd.txt ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:3:13","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"node åœ¨ pod ä¸€èŠ‚ å·²ç»äº†è§£äº† kubectl get ,kubectl describe , ç­‰ç›¸å…³çš„ç”¨æ³•ï¼Œnode çš„æ“ä½œå’Œ pod ç±»ä¼¼ï¼Œåªæ˜¯åé¢æ¥çš„èµ„æºå¯¹è±¡ä¸åŒã€‚ ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:4:0","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹æœ‰å“ªäº›nodeä»¥åŠå…¶åŸºæœ¬ä¿¡æ¯ kubectl get node -o wide ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:4:1","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹ node ä¸Šçš„è¯¦ç»†æƒ…å†µ # æŸ¥çœ‹æ‰€æœ‰ node çš„è¯¦ç»†ä¿¡æ¯ kubectl describe node # ä¹Ÿå¯ä»¥æŸ¥çœ‹æŸä¸ª node çš„ä¿¡æ¯ kubectl describe node node-0001 ... è¿™ä¸ªå‘½ä»¤åœ¨å®šä½ node çš„é—®é¢˜å¾ˆæœ‰ç”¨ï¼Œä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯: Labels Annotations Non-terminated Pods (æ­£åœ¨è¿è¡Œçš„ pod) Allocated resources (å·²ç»åˆ†é…çš„èµ„æº) â€¦ ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:4:2","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹ node çš„èµ„æºä½¿ç”¨æƒ…å†µ kubectl top node ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:4:3","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"node çš„æ ‡ç­¾ç®¡ç† å¢åŠ æ ‡ç­¾ kubectl label node $nodename key1=value1 key2=value2 # å¦‚ kubectl label node node-0001 a1=bbb a2=ccc æ›´æ–°æ ‡ç­¾ # åœ¨ å¢åŠ æ ‡ç­¾çš„åŸºç¡€ åŠ  --overwrite å‚æ•° kubectl label node node-0001 a1=bbb --overwrite # å½“æ ‡ç­¾ä¸å­˜åœ¨ä¹Ÿå¯ä»¥ åŠ  --overwrite å‚æ•° kubectl label node node-0001 a10=bbb --overwrite åˆ é™¤æ ‡ç­¾ kubectl label node $nodename key1- key2- kubectl label node node-0001 a10- a3- ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:4:4","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"å°†ä¸€ä¸ª node æ ‡è®°ä¸ºä¸å¯è°ƒåº¦/å¯è°ƒåº¦ åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­æˆ–è€…å½“å…¶ä¸­çš„æŸäº› node å‡ºç°é—®é¢˜æ—¶ï¼Œéœ€è¦å°† node æ ‡è®°ä¸ºä¸å¯è°ƒåº¦ï¼Œç­‰æ¢å¤å›æ¥å†æ ‡è®°å›æ¥ã€‚ # å°†ä¸€ä¸ª node å¯ä»¥ æ ‡è®°ä¸ºä¸å¯è°ƒåº¦(unschedulable) ï¼Œå¦‚æœåªæ˜¯çœ‹çœ‹æ•ˆæœï¼Œè€Œä¸æ˜¯çœŸæ­£æ ‡è®°å¯åŠ  --dry-run å‚æ•° kubectl cordon $nodeName kubectl cordon node-0001 kubectl cordon node-0001 --dry-run # å°†ä¸€ä¸ª node å¯ä»¥ æ ‡è®°ä¸ºå¯è°ƒåº¦(schedulable) ï¼Œå¦‚æœåªæ˜¯çœ‹çœ‹æ•ˆæœï¼Œè€Œä¸æ˜¯çœŸæ­£æ ‡è®°å¯åŠ  --dry-run å‚æ•° kubectl uncordon $nodeName kubectl uncordon node-0001 kubectl uncordon node-0001 --dry-run ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:4:5","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æ’ç©º node ä¸Šçš„ pod # æ’ç©ºnode ä¸Šçš„æ‰€æœ‰ pod ï¼Œå³ä½¿æ²¡æœ‰è¢« rc ç®¡ç†ï¼Œä½†æ˜¯ä¸ä¼šæ’ç©º è¢« daemonset ç®¡ç†çš„ podï¼Œ å› ä¸ºæ’ç©ºä¹‹ååˆä¼šé©¬ä¸Šåˆ›å»ºå‡ºæ¥ kubectl drain foo --force ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:4:6","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"node ä¸Šçš„æ±¡ç‚¹ï¼ˆtaintï¼‰ç®¡ç† æ±¡ç‚¹éœ€è¦é…åˆ pod çš„äº²å’Œæ€§ä½¿ç”¨ï¼Œå¦åˆ™æ±¡ç‚¹æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ # å¢åŠ /æ›´æ–° taint kubectl taint nodes node-0001 dedicated=special-user:NoSchedule --overwrite # åˆ é™¤ taint kubectl taint nodes foo dedicated:NoSchedule- kubectl taint nodes foo dedicated- æ•´ä½“ç”¨æ³•å’Œ label ç±»ä¼¼ ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:4:7","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"node çš„ annotate ç®¡ç† å’Œ label æ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯æŠŠ verb æ¢æˆ annotate å³å¯ ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:4:8","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"å…¶ä»–åœºæ™¯ ä¸Šé¢é€šè¿‡ pod å’Œ node çš„ä¾‹å­ï¼Œç©¿æ’çš„ä»‹ç»äº†å¤§éƒ¨åˆ†çš„ verbï¼ˆå¦‚ get ã€describeã€top â€¦ ï¼‰ï¼Œè¿™ä¸ªå°èŠ‚å†ä»‹ç»å…¶ä»–çš„ä¸€äº›å¸¸ç”¨åœºæ™¯ ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:5:0","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"apply åœ¨å‡†å¤‡å¥½ä¸€ä¸ªèµ„æºå¯¹è±¡çš„ yaml æ–‡ä»¶æ—¶å¯ä»¥ç”¨ kubectl apply -f xxx.ymal ä½¿ä¹‹ç”Ÿæ•ˆï¼Œkubernetes çš„api ä¸­å¹¶æ²¡æœ‰ applyï¼Œapi ä¸­æœ‰çš„æ˜¯ create ã€updateã€patch ç­‰ï¼Œapply æ˜¯kubectl è‡ªå·±å°è£…å®ç°çš„ï¼Œå…ˆæ‰§è¡Œ get ï¼Œå†åˆ¤æ–­æ˜¯ create è¿˜æ˜¯ patchï¼Œæ‰€ä»¥ç”¨kubectl åˆ›å»ºæˆ–è€…æ›´æ–°èµ„æºæ—¶ éƒ½å¯ä»¥ç”¨ apply å‘½ä»¤ã€‚ # åˆ›å»ºèµ„æº kubectl apply -f xxx.ymal kubectl create -f xxx.ymal # æ›´æ–°èµ„æº kubectl apply -f xxx.ymal kubectl update -f xxx.ymal kubectl patch -f xxx.ymal ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:5:1","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æ»šåŠ¨æ›´æ–° æƒ³è±¡è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œå¦‚æœä½¿ç”¨ configmap æˆ–è€… secret å½“ä½œ pod çš„ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆå½“ configmap æˆ–è€… secret æ›´æ–°äº†åº”è¯¥å¦‚ä½•æ›´æ–° å¯¹åº”çš„pod å‘¢ï¼Ÿ pod åº”è¯¥éƒ½ä¼šé€šè¿‡ deployment æˆ–è€… statefulset æ¥ç¯å¢ƒï¼Œ æ¢è¨€ä¹‹è¯¥å¦‚ä½•æ›´æ–° deployment æˆ–è€… statefulset å‘¢ï¼Ÿé»˜è®¤æƒ…å†µä¸‹ configmap æˆ–è€… secret çš„æ›´æ–°æ˜¯ä¸ä¼šè§¦å‘ deployment æˆ–è€… statefulset çš„æ›´æ–°ï¼Œä¸€ç§å¯è¡Œçš„æ–¹æ³•ä¸º: æ›´æ–° annotations ä¸­ä¸€ä¸ªæ— å…³çš„å­—æ®µ: kubectl -n $namespace patch deployment $deploymentName -p \\ \"{\\\"spec\\\":{\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"test_date\\\":\\\"`date +'%s'`\\\"}}}}}\" kubectl -n monitor patch deployment prometheus -p \\ \"{\\\"spec\\\":{\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"test_date\\\":\\\"`date +'%s'`\\\"}}}}}\" ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:5:2","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"æ€»ç»“ è¿™ç¯‡æ–‡ç« ä»‹ç»äº† kubectl çš„åŸºæœ¬ç”¨æ³•ï¼Œå¸¸è§åœºæ™¯ä¸­çš„ä¸€äº›æ“ä½œï¼Œå¦‚æœæœ‰å…¶ä»–åœºæ™¯å¯ä»¥é€šè¿‡ kubectl --help å’Œ kubectl command --help æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ã€‚ å¦‚æœ‰ä¸æ­£ç¡®ä¹‹å¤„æ¬¢è¿æŒ‡æ­£ã€‚ ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:6:0","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"å‚è€ƒ https://kubernetes.io/zh/docs/reference/kubectl/cheatsheet/ https://mp.weixin.qq.com/s/OxYbLmTKXn5jrgStIQ6ohQ ","date":"2020-11-20","objectID":"/kubernetes/kubectl-command/:7:0","tags":["kubernetes","kubectl"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubernetes/kubectl-command/"},{"categories":null,"content":"kubectl å¸¸ç”¨å‘½ä»¤æŒ‡å—","date":"2020-11-20","objectID":"/kubectl-command/","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"å¯¼è¯» kubectl åº”è¯¥æ˜¯æ¯ä¸ªæ¥è§¦ kubernetes çš„äººéƒ½ä¼šæ¥è§¦çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒå¸¦ç»™æˆ‘ä»¬å¼ºå¤§çš„å‘½ä»¤è¡Œä½“éªŒï¼Œæœ¬ç¯‡æ–‡ç« å°±æ˜¯ä»‹ç» kubectl ä¸­çš„ä¸€äº›å¸¸ç”¨å‘½ä»¤ï¼Œåœ¨ç»“åˆä¸€äº›å…·ä½“çš„ä½¿ç”¨åœºæ™¯è¯´è¯´å¦‚ä½•åˆ©ç”¨ kubectl å®ç°ã€‚å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œåœ¨è¿™é‡Œå°½å¯èƒ½å…¨çš„ç½—åˆ—ï¼Œæ–¹ä¾¿åç»­ ç”¨çš„æ—¶å€™æŸ¥æ‰¾ã€‚å¦‚æœèƒ½å¸®åˆ°æ‚¨å°±æ”¶è—èµ·æ¥å§(ğŸ˜„)ã€‚ æœ¬æ¬¡å®éªŒç¯å¢ƒæ˜¯ kubernetes-1.16.9ï¼Œæœ¬ç¯‡æ–‡æ¡£çš„å†™ä½œæ€è·¯æ˜¯æŒ‰ç…§å¹³æ—¶ çš„ä½¿ç”¨åœºæ™¯è¿›è¡Œå†™ä½œï¼Œä¸ä¼šè¯¦ç»†ä»‹ç» kubectl çš„å‘½ä»¤ï¼Œkubectl è¯¦ç»†çš„å¸®åŠ©æ–‡æ¡£å‚è€ƒ kubectl --help or kubectl command --help ã€‚ ","date":"2020-11-20","objectID":"/kubectl-command/:1:0","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"kubectl æ”¯æŒçš„å‘½ä»¤ kubectl --help kubectl controls the Kubernetes cluster manager. Find more information at: https://kubernetes.io/docs/reference/kubectl/overview/ Basic Commands (Beginner): create Create a resource from a file or from stdin. expose ä½¿ç”¨ replication controller, service, deployment æˆ–è€… pod å¹¶æš´éœ²å®ƒä½œä¸ºä¸€ä¸ª æ–°çš„ Kubernetes Service run åœ¨é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„é•œåƒ set ä¸º objects è®¾ç½®ä¸€ä¸ªæŒ‡å®šçš„ç‰¹å¾ Basic Commands (Intermediate): explain æŸ¥çœ‹èµ„æºçš„æ–‡æ¡£ get æ˜¾ç¤ºä¸€ä¸ªæˆ–æ›´å¤š resources edit åœ¨æœåŠ¡å™¨ä¸Šç¼–è¾‘ä¸€ä¸ªèµ„æº delete Delete resources by filenames, stdin, resources and names, or by resources and label selector Deploy Commands: rollout Manage the rollout of a resource scale ä¸º Deployment, ReplicaSet, Replication Controller æˆ–è€… Job è®¾ç½®ä¸€ä¸ªæ–°çš„å‰¯æœ¬æ•°é‡ autoscale è‡ªåŠ¨è°ƒæ•´ä¸€ä¸ª Deployment, ReplicaSet, æˆ–è€… ReplicationController çš„å‰¯æœ¬æ•°é‡ Cluster Management Commands: certificate ä¿®æ”¹ certificate èµ„æº. cluster-info æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯ top Display Resource (CPU/Memory/Storage) usage. cordon æ ‡è®° node ä¸º unschedulable uncordon æ ‡è®° node ä¸º schedulable drain Drain node in preparation for maintenance taint æ›´æ–°ä¸€ä¸ªæˆ–è€…å¤šä¸ª node ä¸Šçš„ taints Troubleshooting and Debugging Commands: describe æ˜¾ç¤ºä¸€ä¸ªæŒ‡å®š resource æˆ–è€… group çš„ resources è¯¦æƒ… logs è¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿— attach Attach åˆ°ä¸€ä¸ªè¿è¡Œä¸­çš„ container exec åœ¨ä¸€ä¸ª container ä¸­æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ port-forward Forward one or more local ports to a pod proxy è¿è¡Œä¸€ä¸ª proxy åˆ° Kubernetes API server cp å¤åˆ¶ files å’Œ directories åˆ° containers å’Œä»å®¹å™¨ä¸­å¤åˆ¶ files å’Œ directories. auth Inspect authorization Advanced Commands: diff Diff live version against would-be applied version apply é€šè¿‡æ–‡ä»¶åæˆ–æ ‡å‡†è¾“å…¥æµ(stdin)å¯¹èµ„æºè¿›è¡Œé…ç½® patch ä½¿ç”¨ strategic merge patch æ›´æ–°ä¸€ä¸ªèµ„æºçš„ field(s) replace é€šè¿‡ filename æˆ–è€… stdinæ›¿æ¢ä¸€ä¸ªèµ„æº wait Experimental: Wait for a specific condition on one or many resources. convert åœ¨ä¸åŒçš„ API versions è½¬æ¢é…ç½®æ–‡ä»¶ kustomize Build a kustomization target from a directory or a remote url. Settings Commands: label æ›´æ–°åœ¨è¿™ä¸ªèµ„æºä¸Šçš„ labels annotate æ›´æ–°ä¸€ä¸ªèµ„æºçš„æ³¨è§£ completion Output shell completion code for the specified shell (bash or zsh) Other Commands: api-resources Print the supported API resources on the server api-versions Print the supported API versions on the server, in the form of \"group/version\" config ä¿®æ”¹ kubeconfig æ–‡ä»¶ plugin Provides utilities for interacting with plugins. version è¾“å‡º client å’Œ server çš„ç‰ˆæœ¬ä¿¡æ¯ Usage: kubectl [flags] [options] Use \"kubectl \u003ccommand\u003e --help\" for more information about a given command. Use \"kubectl options\" for a list of global command-line options (applies to all commands). ä»ä¸Šé¢çš„å¸®åŠ©æ–‡æ¡£å¯ä»¥çœ‹å‡ºï¼Œ kubectl åŸºæœ¬æ ¼å¼ä¸º kubectl verb resource options , kubectl åè·Ÿè°“è¯­åŠ¨è¯ï¼Œ å†è·Ÿè¦æ“ä½œçš„èµ„æºï¼Œå¯ä»¥åŠ  options ï¼Œå¦‚ï¼š è¦çœ‹ monitoring namespace ä¸‹é¢æœ‰å“ªäº›pod : kubectl -n monitoring get po ","date":"2020-11-20","objectID":"/kubectl-command/:2:0","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"pod pod åœºæ™¯ä¸‹ï¼Œå¯èƒ½ä¼šæœ‰å¦‚ä¸‹éœ€æ±‚: ","date":"2020-11-20","objectID":"/kubectl-command/:3:0","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹æŸä¸ª namespace ä¸‹ï¼Œæ‰€æœ‰çš„pod # å…ˆæŸ¥çœ‹æœ‰å“ªäº›namespace kubectl get namespace # æŸ¥çœ‹ pod kubectl -n $namespace get po # æˆ–è€… kubectl get po -n $namespace ä¸Šé¢ä¸¤ç§å†™æ³•åœ¨è¾¾åˆ°çš„æ•ˆæœä¸Šæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªç»†èŠ‚å¯ä»¥æ³¨æ„ä¸€ä¸‹ï¼Œå¦‚æœ kubectl ç¯å¢ƒæœ‰å‘½ä»¤è‡ªåŠ¨è¡¥å…¨çš„è¯ï¼Œèµ„æºå¯¹è±¡åˆæ¯”è¾ƒå¤š çš„æƒ…å†µä¸‹ï¼Œç¬¬ä¸€ç§å†™æ³•å°†ä¼šæœ‰æå¤§çš„ä¼˜åŠ¿ï¼Œå¯ä»¥æ€è€ƒè¿™ä¹ˆä¸ªåœºæ™¯ï¼Œå¦‚ï¼šè¦æŸ¥çœ‹ monitoring namespace ä¸‹çš„æŸä¸ªpod è¯¦æƒ…, å°±å¯ä»¥é€šè¿‡: kubectl -n monitoring get po åŠ  tab é”®ï¼Œåˆ—å‡ºè¿™ä¸ªnamespace ä¸‹çš„æ‰€æœ‰ pod ä¾›ç­›é€‰ã€‚ centos ä¸‹å‘½ä»¤è‡ªåŠ¨è¡¥å…¨éœ€è¦å®‰è£… bash-completion ï¼Œæ–¹æ³•ä¸º yum install -y bash-completion å¦‚æœä¸åŠ  -n $namespace ï¼Œåˆ™é»˜è®¤æ˜¯ default namespace ","date":"2020-11-20","objectID":"/kubectl-command/:3:1","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹æ‰€æœ‰namespace çš„pod kubectl get po --all-namespaces # or kubectl get po -A ","date":"2020-11-20","objectID":"/kubectl-command/:3:2","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹æŸä¸ªå…·ä½“çš„ pod ä¿¡æ¯ ï¼Œä»¥ wideã€jsonã€yaml çš„æ ¼å¼è¾“å‡º kubectl -n $namespace get po xxx -o wide/json/yaml # å¦‚ æŸ¥çœ‹ monitoring ä¸‹çš„ prometheus-0 pod ä¿¡æ¯ï¼Œå¹¶ä»¥yaml å½¢å¼è¾“å‡ºã€‚ kubectl -n monitoring get po prometheus-0 -o yaml ","date":"2020-11-20","objectID":"/kubectl-command/:3:3","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"é€šè¿‡ go-template è¿›è¡ŒæŸ¥çœ‹ kubectl get pods -l app=hostnames \\ -o go-template='{{range .items}}{{.status.podIP}}{{\"\\n\"}}{{end}}' ","date":"2020-11-20","objectID":"/kubectl-command/:3:4","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹æŸä¸ª pod çš„æŸä¸ªå­—æ®µä¿¡æ¯ å¦‚æœæˆ‘ä»¬åªæƒ³çŸ¥é“ pod çš„ hostIP æˆ–è€…å…¶ä»–çš„ ä¸€äº›å­—æ®µï¼Œ å¯ä»¥é€šè¿‡ -o jsonpath or -o template or -o go-template å…¶ä¸­template è¯­æ³•éµå¾ª golang template éœ€è¦å¯¹ pod çš„å¯¹è±¡æ¨¡å‹æœ‰ä¸€å®šçš„äº†è§£ï¼Œå¦‚æœä¸äº†è§£ï¼Œå¯ä»¥ -o yaml or -o json ç›´æ¥æŸ¥çœ‹ã€‚ æŸ¥çœ‹ hostIP çš„æ–¹æ³•å¦‚ä¸‹: # -o jsonpath kubectl -n monitoring get po prometheus-k8s-0 -o jsonpath=\"{.status.hostIP}\" # -o template kubectl -n monitoring get po prometheus-k8s-0 -o template --template=\"{{.status.hostIP}}\" # -o go-template kubectl -n monitoring get po prometheus-k8s-0 -o go-template=\"{{.status.hostIP}}\" å¦‚æœéœ€è¦æŸ¥çœ‹å…¶ä»–çš„å­—æ®µç…§çŒ«ç”»è™å³å¯ã€‚ ","date":"2020-11-20","objectID":"/kubectl-command/:3:5","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"é€šè¿‡æ ‡ç­¾é€‰æ‹©æŸ¥çœ‹ pod é€šè¿‡ -l key1=value1,key2=value2 è¿›è¡Œé€‰æ‹©ï¼Œå¦‚ kubectl -n monitoring get po -l app=prometheus kubectl -n monitoring get po -l app=prometheus,prometheus=k8s ","date":"2020-11-20","objectID":"/kubectl-command/:3:6","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹æŸä¸ªnode ä¸Šéƒ¨ç½²çš„æ‰€æœ‰ pod #å…ˆè·å–é›†ç¾¤å†…æ‰€æœ‰çš„node kubectl get node -o wide # å‡è®¾å…¶ä¸­ä¸€ä¸ª node çš„åç§°ä¸º node-0001 kubectl get po -A -o wide | grep node-0001 é€šè¿‡ kubectl get po -A -o wide | grep å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œå…·ä½“å¯ä»¥æ ¹æ®æƒ…å†µè€Œå®šï¼Œæ¯”å¦‚æŸ¥çœ‹æ‰€æœ‰çŠ¶æ€å¼‚å¸¸çš„ pod ï¼ˆé Runningï¼‰ kubectl get po -A -o wide | grep -v Running ","date":"2020-11-20","objectID":"/kubectl-command/:3:7","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹ pod çš„è¯¦ç»†ä¿¡æ¯ kubectl -n monitoring describe po prometheus-k8s-0 è¿™ä¸ªå‘½ä»¤åœ¨æŸ¥çœ‹ pod çš„åŸºæœ¬ä¿¡æ¯å’Œé—®é¢˜å®šä½æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œå½“ pod å¼‚å¸¸ï¼Œå¯ä»¥æŸ¥çœ‹ Events æˆ–è®¸å°±èƒ½å‘ç°é—®é¢˜æ‰€åœ¨ã€‚ ","date":"2020-11-20","objectID":"/kubectl-command/:3:8","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹ pod log kubectl -n $namespace logs -f $podName $containerName # å…¶ä¸­ $namespaceï¼Œ$podNameï¼Œ$containerName æ›¿æ¢æˆçœŸå®å€¼å³å¯ï¼Œå½“ pod ä¸­åªæœ‰ä¸€ä¸ª å®¹å™¨æ—¶å¯çœç•¥ $containerNameï¼Œå¦‚ï¼š kubectl -n monitoring logs -f prometheus-k8s-0 prometheus ","date":"2020-11-20","objectID":"/kubectl-command/:3:9","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"è¿›å…¥å®¹å™¨ kubectl -n $namespace exec -it $podName -c $containerName sh # å…¶ä¸­ $namespaceï¼Œ$podNameï¼Œ$containerName æ›¿æ¢æˆçœŸå®å€¼å³å¯ï¼Œå½“ pod ä¸­åªæœ‰ä¸€ä¸ª å®¹å™¨æ—¶å¯çœç•¥ -c $containerNameï¼Œå¦‚ï¼š kubectl -n monitoring exec -it prometheus-k8s-0 -c prometheus sh ","date":"2020-11-20","objectID":"/kubectl-command/:3:10","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹ pod çš„èµ„æºä½¿ç”¨æƒ…å†µ kubectl -n $namespace top pod # å…¶ä¸­ $namespace æ›¿æ¢æˆçœŸå®å€¼å³å¯ï¼Œå¦‚ï¼š kubectl -n monitoring top pod ","date":"2020-11-20","objectID":"/kubectl-command/:3:11","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"åˆ é™¤ pod kubectl -n $namespace delete po $podName kubectl -n monitoring delete po prometheus-k8s-0 # åœ¨æŸäº›å¼‚å¸¸æƒ…å†µä¸‹åˆ é™¤ pod ä¼šå¡ä½ï¼Œåˆ ä¸æ‰ï¼Œéœ€è¦å¼ºåˆ¶æ‰èƒ½åˆ é™¤ ï¼Œå¼ºåˆ¶åˆ é™¤éœ€è¦å¢åŠ  --grace-period=0 --force ï¼Œ kubectl -n monitoring delete po prometheus-k8s-0 --grace-period=0 --force åŸç†å¦‚ä¸‹ï¼Œ é»˜è®¤æ‰§è¡Œ delete po æ—¶ï¼Œkubectl ä¼šå¢åŠ â€“grace-period=30 å‚æ•°ï¼Œè¡¨ç¤ºé¢„ç•™30ç§’çš„æ—¶é—´ç»™ pod å¤„ç†å½“å‰çš„è¯·æ±‚ï¼Œ ä½†åŒæ—¶ä¹Ÿä¸æ¥æ”¶æ–°çš„è¯·æ±‚äº†ï¼Œä»¥ä¸€ç§ç›¸å¯¹ä¼˜é›…çš„æ–¹å¼åœæ­¢å®¹å™¨ï¼Œæ³¨æ„è¿™ä¸ªå‚æ•°åœ¨åˆ›å»º pod æ—¶å¯ä»¥æŒ‡å®šï¼Œé»˜è®¤æ˜¯30ç§’ã€‚å¼ºåˆ¶åˆ é™¤æ—¶éœ€è¦æŠŠâ€“grace-period è®¾ç½®ä¸º0ï¼Œè¡¨ç¤ºä¸ç­‰å¾…é©¬ä¸Šåˆ é™¤ï¼Œå¦åˆ™å¼ºåˆ¶åˆ é™¤å°±ä¼šå¤±æ•ˆã€‚ ","date":"2020-11-20","objectID":"/kubectl-command/:3:12","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"pod æ ‡ç­¾ç®¡ç† pod çš„å¤§å¤šæ•°çš„æƒ…å†µéƒ½ä¼šç”± deployment or statefulset æ¥ç®¡ç†ï¼Œæ‰€ä»¥æ ‡ç­¾ä¹Ÿä¼šé€šè¿‡å®ƒä»¬ç®¡ç†ï¼Œå®é™…æƒ…å†µä¸‹å¾ˆå°‘ä¼šé€šè¿‡ kubectl å¯¹ pod label åšå¢åˆ æ”¹ï¼Œå¦‚æœ‰éœ€è¦å¯å‚è€ƒ ä¸‹é¢ node çš„ç”¨æ³•ï¼Œåªéœ€è¦æŠŠèµ„æºå¯¹è±¡æ¢æˆ pod å³å¯ã€‚ ","date":"2020-11-20","objectID":"/kubectl-command/:3:13","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æ–‡ä»¶ copy ä» pod ä¸­ copy æ–‡ä»¶æˆ–è€… copy åˆ° pod ä¸­å»ã€‚ å®¹å™¨ä¸­éœ€è¦æœ‰ tar å‘½ä»¤ï¼Œå¦åˆ™ä¼šå¤±è´¥ # ä»æœ¬åœ° copy åˆ° pod kubectl cp /tmp/foo_dir \u003csome-pod\u003e:/tmp/bar_dir kubectl -n monitoring cp abc.txt prometheus-k8s-0:/tmp/abc.txt # å¦‚æœ pod ä¸­æœ‰å¤šä¸ª container å¯ä»¥ç”¨ -c æŒ‡å®š container kubectl cp /tmp/foo \u003csome-pod\u003e:/tmp/bar -c \u003cspecific-container\u003e kubectl -n monitoring cp abc.txt prometheus-k8s-0:/tmp/abc.txt -c prometheus # ä» pod copy åˆ° æœ¬åœ° kubectl cp \u003csome-pod\u003e:/tmp/foo /tmp/bar kubectl -n monitoring cp prometheus-k8s-0:/tmp/abc.txt /tmp/abd.txt ","date":"2020-11-20","objectID":"/kubectl-command/:3:14","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"node åœ¨ pod ä¸€èŠ‚ å·²ç»äº†è§£äº† kubectl get ,kubectl describe , ç­‰ç›¸å…³çš„ç”¨æ³•ï¼Œnode çš„æ“ä½œå’Œ pod ç±»ä¼¼ï¼Œåªæ˜¯åé¢æ¥çš„èµ„æºå¯¹è±¡ä¸åŒã€‚ ","date":"2020-11-20","objectID":"/kubectl-command/:4:0","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹æœ‰å“ªäº›nodeä»¥åŠå…¶åŸºæœ¬ä¿¡æ¯ kubectl get node -o wide ","date":"2020-11-20","objectID":"/kubectl-command/:4:1","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹ node ä¸Šçš„è¯¦ç»†æƒ…å†µ # æŸ¥çœ‹æ‰€æœ‰ node çš„è¯¦ç»†ä¿¡æ¯ kubectl describe node # ä¹Ÿå¯ä»¥æŸ¥çœ‹æŸä¸ª node çš„ä¿¡æ¯ kubectl describe node node-0001 ... è¿™ä¸ªå‘½ä»¤åœ¨å®šä½ node çš„é—®é¢˜å¾ˆæœ‰ç”¨ï¼Œä¼šè¾“å‡ºå¦‚ä¸‹ä¿¡æ¯: Labels Annotations Non-terminated Pods (æ­£åœ¨è¿è¡Œçš„ pod) Allocated resources (å·²ç»åˆ†é…çš„èµ„æº) â€¦ ","date":"2020-11-20","objectID":"/kubectl-command/:4:2","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æŸ¥çœ‹ node çš„èµ„æºä½¿ç”¨æƒ…å†µ kubectl top node ","date":"2020-11-20","objectID":"/kubectl-command/:4:3","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"node çš„æ ‡ç­¾ç®¡ç† å¢åŠ æ ‡ç­¾ kubectl label node $nodename key1=value1 key2=value2 # å¦‚ kubectl label node node-0001 a1=bbb a2=ccc æ›´æ–°æ ‡ç­¾ # åœ¨ å¢åŠ æ ‡ç­¾çš„åŸºç¡€ åŠ  --overwrite å‚æ•° kubectl label node node-0001 a1=bbb --overwrite # å½“æ ‡ç­¾ä¸å­˜åœ¨ä¹Ÿå¯ä»¥ åŠ  --overwrite å‚æ•° kubectl label node node-0001 a10=bbb --overwrite åˆ é™¤æ ‡ç­¾ kubectl label node $nodename key1- key2- kubectl label node node-0001 a10- a3- ","date":"2020-11-20","objectID":"/kubectl-command/:4:4","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"å°†ä¸€ä¸ª node æ ‡è®°ä¸ºä¸å¯è°ƒåº¦/å¯è°ƒåº¦ åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­æˆ–è€…å½“å…¶ä¸­çš„æŸäº› node å‡ºç°é—®é¢˜æ—¶ï¼Œéœ€è¦å°† node æ ‡è®°ä¸ºä¸å¯è°ƒåº¦ï¼Œç­‰æ¢å¤å›æ¥å†æ ‡è®°å›æ¥ã€‚ # å°†ä¸€ä¸ª node å¯ä»¥ æ ‡è®°ä¸ºä¸å¯è°ƒåº¦(unschedulable) ï¼Œå¦‚æœåªæ˜¯çœ‹çœ‹æ•ˆæœï¼Œè€Œä¸æ˜¯çœŸæ­£æ ‡è®°å¯åŠ  --dry-run å‚æ•° kubectl cordon $nodeName kubectl cordon node-0001 kubectl cordon node-0001 --dry-run # å°†ä¸€ä¸ª node å¯ä»¥ æ ‡è®°ä¸ºå¯è°ƒåº¦(schedulable) ï¼Œå¦‚æœåªæ˜¯çœ‹çœ‹æ•ˆæœï¼Œè€Œä¸æ˜¯çœŸæ­£æ ‡è®°å¯åŠ  --dry-run å‚æ•° kubectl uncordon $nodeName kubectl uncordon node-0001 kubectl uncordon node-0001 --dry-run ","date":"2020-11-20","objectID":"/kubectl-command/:4:5","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æ’ç©º node ä¸Šçš„ pod # æ’ç©ºnode ä¸Šçš„æ‰€æœ‰ pod ï¼Œå³ä½¿æ²¡æœ‰è¢« rc ç®¡ç†ï¼Œä½†æ˜¯ä¸ä¼šæ’ç©º è¢« daemonset ç®¡ç†çš„ podï¼Œ å› ä¸ºæ’ç©ºä¹‹ååˆä¼šé©¬ä¸Šåˆ›å»ºå‡ºæ¥ kubectl drain foo --force ","date":"2020-11-20","objectID":"/kubectl-command/:4:6","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"node ä¸Šçš„æ±¡ç‚¹ï¼ˆtaintï¼‰ç®¡ç† æ±¡ç‚¹éœ€è¦é…åˆ pod çš„äº²å’Œæ€§ä½¿ç”¨ï¼Œå¦åˆ™æ±¡ç‚¹æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ # å¢åŠ /æ›´æ–° taint kubectl taint nodes node-0001 dedicated=special-user:NoSchedule --overwrite # åˆ é™¤ taint kubectl taint nodes foo dedicated:NoSchedule- kubectl taint nodes foo dedicated- æ•´ä½“ç”¨æ³•å’Œ label ç±»ä¼¼ ","date":"2020-11-20","objectID":"/kubectl-command/:4:7","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"node çš„ annotate ç®¡ç† å’Œ label æ˜¯ç±»ä¼¼çš„ï¼Œåªæ˜¯æŠŠ verb æ¢æˆ annotate å³å¯ ","date":"2020-11-20","objectID":"/kubectl-command/:4:8","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"å…¶ä»–åœºæ™¯ ä¸Šé¢é€šè¿‡ pod å’Œ node çš„ä¾‹å­ï¼Œç©¿æ’çš„ä»‹ç»äº†å¤§éƒ¨åˆ†çš„ verbï¼ˆå¦‚ get ã€describeã€top â€¦ ï¼‰ï¼Œè¿™ä¸ªå°èŠ‚å†ä»‹ç»å…¶ä»–çš„ä¸€äº›å¸¸ç”¨åœºæ™¯ ","date":"2020-11-20","objectID":"/kubectl-command/:5:0","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"apply åœ¨å‡†å¤‡å¥½ä¸€ä¸ªèµ„æºå¯¹è±¡çš„ yaml æ–‡ä»¶æ—¶å¯ä»¥ç”¨ kubectl apply -f xxx.ymal ä½¿ä¹‹ç”Ÿæ•ˆï¼Œkubernetes çš„api ä¸­å¹¶æ²¡æœ‰ applyï¼Œapi ä¸­æœ‰çš„æ˜¯ create ã€updateã€patch ç­‰ï¼Œapply æ˜¯kubectl è‡ªå·±å°è£…å®ç°çš„ï¼Œå…ˆæ‰§è¡Œ get ï¼Œå†åˆ¤æ–­æ˜¯ create è¿˜æ˜¯ patchï¼Œæ‰€ä»¥ç”¨kubectl åˆ›å»ºæˆ–è€…æ›´æ–°èµ„æºæ—¶ éƒ½å¯ä»¥ç”¨ apply å‘½ä»¤ã€‚ # åˆ›å»ºèµ„æº kubectl apply -f xxx.ymal kubectl create -f xxx.ymal # æ›´æ–°èµ„æº kubectl apply -f xxx.ymal kubectl update -f xxx.ymal kubectl patch -f xxx.ymal ","date":"2020-11-20","objectID":"/kubectl-command/:5:1","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æ»šåŠ¨æ›´æ–° æƒ³è±¡è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œå¦‚æœä½¿ç”¨ configmap æˆ–è€… secret å½“ä½œ pod çš„ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆå½“ configmap æˆ–è€… secret æ›´æ–°äº†åº”è¯¥å¦‚ä½•æ›´æ–° å¯¹åº”çš„pod å‘¢ï¼Ÿ pod åº”è¯¥éƒ½ä¼šé€šè¿‡ deployment æˆ–è€… statefulset æ¥ç¯å¢ƒï¼Œ æ¢è¨€ä¹‹è¯¥å¦‚ä½•æ›´æ–° deployment æˆ–è€… statefulset å‘¢ï¼Ÿé»˜è®¤æƒ…å†µä¸‹ configmap æˆ–è€… secret çš„æ›´æ–°æ˜¯ä¸ä¼šè§¦å‘ deployment æˆ–è€… statefulset çš„æ›´æ–°ï¼Œä¸€ç§å¯è¡Œçš„æ–¹æ³•ä¸º: æ›´æ–° annotations ä¸­ä¸€ä¸ªæ— å…³çš„å­—æ®µ: kubectl -n $namespace patch deployment $deploymentName -p \\ \"{\\\"spec\\\":{\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"test_date\\\":\\\"`date +'%s'`\\\"}}}}}\" kubectl -n monitor patch deployment prometheus -p \\ \"{\\\"spec\\\":{\\\"template\\\":{\\\"metadata\\\":{\\\"annotations\\\":{\\\"test_date\\\":\\\"`date +'%s'`\\\"}}}}}\" ","date":"2020-11-20","objectID":"/kubectl-command/:5:2","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"æ€»ç»“ è¿™ç¯‡æ–‡ç« ä»‹ç»äº† kubectl çš„åŸºæœ¬ç”¨æ³•ï¼Œå¸¸è§åœºæ™¯ä¸­çš„ä¸€äº›æ“ä½œï¼Œå¦‚æœæœ‰å…¶ä»–åœºæ™¯å¯ä»¥é€šè¿‡ kubectl --help å’Œ kubectl command --help æŸ¥çœ‹å¸®åŠ©æ–‡æ¡£ã€‚ å¦‚æœ‰ä¸æ­£ç¡®ä¹‹å¤„æ¬¢è¿æŒ‡æ­£ã€‚ ","date":"2020-11-20","objectID":"/kubectl-command/:6:0","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"å‚è€ƒ https://kubernetes.io/zh/docs/reference/kubectl/cheatsheet/ https://mp.weixin.qq.com/s/OxYbLmTKXn5jrgStIQ6ohQ ","date":"2020-11-20","objectID":"/kubectl-command/:7:0","tags":["kubernetes","kubectl","cli"],"title":"kubectl å¸¸ç”¨å‘½ä»¤","uri":"/kubectl-command/"},{"categories":null,"content":"markdownä¸­æ’å…¥è¡¨æƒ…çš„æ–¹æ³•","date":"2020-11-19","objectID":"/markdownemoji/","tags":["markdown","emoji"],"title":"markdownä¸­æ’å…¥è¡¨æƒ…çš„æ–¹æ³•","uri":"/markdownemoji/"},{"categories":null,"content":"å¯¼è¯» markdown ä¸­ä¹Ÿæ˜¯å¯ä»¥æ’å…¥è¡¨æƒ…ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„markdown è§£æå™¨éƒ½æ”¯æŒï¼Œæˆ‘æœ¬åœ°ç”¨çš„ Golandã€MacDown ä¸æ”¯æŒï¼Œä½†æ˜¯ hugo æ˜¯æ”¯æŒçš„ï¼Œ å†™ä½œçš„è¿‡ç¨‹å¯ä»¥é€‚å½“åŠ å…¥ä¸€äº›è¡¨æƒ…ï¼Œå¯ä»¥è¡¨è¾¾å½“æ—¶å†™ä½œçš„ä¸€ä¸ªå¿ƒæƒ…ã€‚ ","date":"2020-11-19","objectID":"/markdownemoji/:1:0","tags":["markdown","emoji"],"title":"markdownä¸­æ’å…¥è¡¨æƒ…çš„æ–¹æ³•","uri":"/markdownemoji/"},{"categories":null,"content":"ä½¿ç”¨åœºæ™¯ markdown ä¸­æ”¯æŒ emoji çš„åœ°æ–¹æœ‰ : Campfire GitHub Basecamp Redbooth Trac Flowdock Sprint.ly Kandan Textbox.io Kippt Redmine JabbR Trello Hall Qiita Zendesk Ruby China Grove Idobata NodeBB Forums Slack Streamup OrganisedMinds Hackpad Cryptbin Kato Reportedly Cheerful Ghost IRCCloud Dashcube MyVideoGameList Subrosa Sococo Quip And Bang Bonusly Discourse Ello Twemoji Awesome Got Chosen Flow ReadMe.io esa DBook Groups.io TeamworkChat Damn Bugs Letâ€™s Chat Buildkite ChatGrape Dokuwiki Usersnap Discord Status Hero Morfy Bitbucket Gitter Yellow YouTube Habitica and Mattermost ","date":"2020-11-19","objectID":"/markdownemoji/:2:0","tags":["markdown","emoji"],"title":"markdownä¸­æ’å…¥è¡¨æƒ…çš„æ–¹æ³•","uri":"/markdownemoji/"},{"categories":null,"content":"ç”¨æ³• emoji çš„è¡¨æƒ…å¤§å…¨å‚è€ƒ : https://www.webfx.com/tools/emoji-cheat-sheet/ å¦‚æœæƒ³è¦åœ¨ markdown ä¸­ä½¿ç”¨ï¼Œåªè¦åœ¨ç›¸åº”çš„åœ°æ–¹æ’å…¥ :xxx: å³å¯ï¼Œ å…¶ä¸­ xxx å°±æ˜¯è¡¨æƒ…çš„åå­— ï¼Œä¾‹: ## æ’å…¥è¡¨æƒ…ç¤ºä¾‹ - ç¬‘ï¼š ğŸ˜„ - å‚»ç¬‘ ğŸ˜ - å®³ç¾ ğŸ˜Š ... :/play secret: ","date":"2020-11-19","objectID":"/markdownemoji/:3:0","tags":["markdown","emoji"],"title":"markdownä¸­æ’å…¥è¡¨æƒ…çš„æ–¹æ³•","uri":"/markdownemoji/"},{"categories":null,"content":"å‚è€ƒ https://www.webfx.com/tools/emoji-cheat-sheet/ ","date":"2020-11-19","objectID":"/markdownemoji/:4:0","tags":["markdown","emoji"],"title":"markdownä¸­æ’å…¥è¡¨æƒ…çš„æ–¹æ³•","uri":"/markdownemoji/"},{"categories":null,"content":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆäºŒï¼‰","date":"2020-11-18","objectID":"/concurrent/","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆäºŒï¼‰","uri":"/concurrent/"},{"categories":null,"content":"å¯¼è¯» åœ¨ä¸Šä¸€ç¯‡â€œpythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹(ä¸€)ä¸­ä»‹ç»äº†è¿›ç¨‹ã€çº¿ç¨‹çš„æ¦‚å¿µã€åŸºæœ¬ç”¨æ³•å’Œåœ¨ python ä¸­ä½¿ç”¨é‡åˆ°çš„ä¸€äº›å‘ï¼Œ è¿™åœ¨ä¸€ç¯‡ä¸­ä¼šä»‹ç»ä¸€äº›é«˜çº§çš„ç”¨æ³•ï¼Œå½“ç„¶æ›´å¤šçš„æ˜¯é‡åˆ°çš„å‘ï¼Œæ¢è¨€ä¹‹è¿™æ˜¯ä¸€ç‰‡é¿å‘æŒ‡å—ã€‚ ","date":"2020-11-18","objectID":"/concurrent/:1:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆäºŒï¼‰","uri":"/concurrent/"},{"categories":null,"content":"concurrent.futures æˆ‘ä»¬éƒ½çŸ¥é“åœ¨ python ä¸­ï¼Œå¤šçº¿ç¨‹çš„æ ‡å‡†åº“æ˜¯ä½¿ç”¨ threading , å¦‚ ï¼š # -*- coding: UTF-8 -*- import threading import time def runner(index, param) : print(\"çº¿ç¨‹{} å¼€å§‹è¿è¡Œ: ------------\".format(index)) print(\"çº¿ç¨‹{} : {}\".format(index,param)) time.sleep(3) print(\"çº¿ç¨‹{} è¿è¡Œç»“æŸ: ------------\".format(index)) for index,value in enumerate([\"python\", \"java\", \"golang\", \"php\"]) : thread = threading.Thread(target=runner,args=(index, value, )) thread.start() å¤šè¿›ç¨‹çš„åº“æ˜¯ multiprocessing ,å¦‚ï¼š # -*- coding: UTF-8 -*- from multiprocessing import Process import time def runner(index, param) : print(\"çº¿ç¨‹{} å¼€å§‹è¿è¡Œ: ------------\".format(index)) print(\"çº¿ç¨‹{} : {}\".format(index,param)) time.sleep(3) print(\"çº¿ç¨‹{} è¿è¡Œç»“æŸ: ------------\".format(index)) for index,value in enumerate([\"python\", \"java\", \"golang\", \"php\"]) : process = Process(target=runner,args=(index, value, )) process.start() ä»¥ä¸Šä¸¤ä¸ªåº“å·²ç» python2 å·²ç»æ”¯æŒï¼Œå¯ä»¥å¾ˆå¥½çš„å®ç°æˆ‘ä»¬å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹çš„éœ€æ±‚ã€‚ python3.2 æä¾›äº† concurrent.futures åº“ï¼Œå¹¶ä¸”å·²ç»å›æº¯åˆ°python2ï¼Œè¿™ä¸ªåº“åœ¨ threading ä¸ multiprocessing çš„åŸºç¡€ä¸Šæä¾›äº†ä¸€å±‚å°è£…ï¼Œä½¿å¾—å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹åœ¨ä½¿ç”¨è¡Œä¸ºä¸Šä¿æŒäº†ä¸€è‡´ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œä¸”çœ‹ä¸‹é¢åˆ†æï¼Œè¯·å…ˆçœ‹ä¸¤æ®µä»£ç ï¼š å¤šçº¿ç¨‹ # -*- coding: UTF-8 -*- from concurrent.futures._base import TimeoutError from concurrent.futures import ThreadPoolExecutor import time def runner(index, param) : print(\"çº¿ç¨‹{} å¼€å§‹è¿è¡Œ: ------------\".format(index)) print(\"çº¿ç¨‹{} : {}\".format(index,param)) time.sleep(3) print(\"çº¿ç¨‹{} è¿è¡Œç»“æŸ: ------------\".format(index)) max_workers = 4 print(\"æ‰§è¡Œå‡çº§ä»»åŠ¡çš„å¹¶å‘æ•°ä¸ºä¸ºï¼š {}\".format(max_workers)) runners = [\"python\", \"java\", \"golang\", \"php\", \"rust\", \"shell\", \"c\"] with ThreadPoolExecutor(max_workers=max_workers) as executor: for index, value in enumerate(runners): result = executor.submit(runner, index, value) try: result.result(timeout=3 * 60 ) except TimeoutError as err: print(\"ä»»åŠ¡è¶…æ—¶,\", err) å¤šè¿›ç¨‹ # -*- coding: UTF-8 -*- from concurrent.futures._base import TimeoutError from concurrent.futures import ProcessPoolExecutor import time def runner(index, param) : print(\"çº¿ç¨‹{} å¼€å§‹è¿è¡Œ: ------------\".format(index)) print(\"çº¿ç¨‹{} : {}\".format(index,param)) time.sleep(3) print(\"çº¿ç¨‹{} è¿è¡Œç»“æŸ: ------------\".format(index)) max_workers = 4 print(\"æ‰§è¡Œå‡çº§ä»»åŠ¡çš„å¹¶å‘æ•°ä¸ºä¸ºï¼š {}\".format(max_workers)) runners = [\"python\", \"java\", \"golang\", \"php\", \"rust\", \"shell\", \"c\"] with ProcessPoolExecutor(max_workers=max_workers) as executor: for index, value in enumerate(runners): result = executor.submit(runner, index, value) try: result.result(timeout=3 * 60 ) except TimeoutError as err: print(\"ä»»åŠ¡è¶…æ—¶,\", err) å¯ä»¥çœ‹åˆ°å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹å†™æ³•è¶…çº§ç±»ä¼¼ï¼Œä¸€ä¸ªä½¿ç”¨çš„æ˜¯ ProcessPoolExecutor ï¼Œä¸€ä¸ªä½¿ç”¨çš„æ˜¯ ThreadPoolExecutorï¼Œå…¶ä»–ä»£ç åŸºæœ¬ä¸€ç›´ï¼ŒæŸ¥çœ‹æºç å¯ä»¥å‘ç° concurrent.futures å®šä¹‰äº†ä¸€ä¸ª Executor æŠ½è±¡åŸºç±»ï¼Œæä¾›äº† submit ã€map ã€shutdown ç­‰æ–¹æ³• class Executor(object): \"\"\"This is an abstract base class for concrete asynchronous executors.\"\"\" def submit(self, fn, *args, **kwargs): \"\"\"Submits a callable to be executed with the given arguments. Schedules the callable to be executed as fn(*args, **kwargs) and returns a Future instance representing the execution of the callable. Returns: A Future representing the given call. \"\"\" raise NotImplementedError() def map(self, fn, *iterables, **kwargs): \"\"\"Returns a iterator equivalent to map(fn, iter). Args: fn: A callable that will take as many arguments as there are passed iterables. timeout: The maximum number of seconds to wait. If None, then there is no limit on the wait time. Returns: An iterator equivalent to: map(func, *iterables) but the calls may be evaluated out-of-order. Raises: TimeoutError: If the entire result iterator could not be generated before the given timeout. Exception: If fn(*args) raises for any values. \"\"\" timeout = kwargs.get('timeout') if timeout is not None: end_time = timeout + time.time() fs = [self.submit(fn, *args) for args in itertools.izip(*iterables)] # Yield must be hidden in closure so that the futures are submitted # before the first iterator value is required. def result_iterator(): try: for future in fs: if timeout is None: yield future.result() else: yield future.result(end_time - time.time()) finally: for future in fs: future.cancel() return result_iterator() def shutdown(self, wait=True): \"\"","date":"2020-11-18","objectID":"/concurrent/:2:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆäºŒï¼‰","uri":"/concurrent/"},{"categories":null,"content":"concurrent ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„å‘ æ‰§è¡Œç¯å¢ƒä¸º python-2.7.15 å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªè„šæœ¬ multipy.py # -*- coding: UTF-8 -*- from concurrent.futures._base import TimeoutError from concurrent.futures import ProcessPoolExecutor import time def runner(index, param) : print(\"çº¿ç¨‹{} å¼€å§‹è¿è¡Œ: ------------\".format(index)) print(\"çº¿ç¨‹{} : {}\".format(index,param)) time.sleep(3) print(\"çº¿ç¨‹{} è¿è¡Œç»“æŸ: ------------\".format(index)) def main(max_workers=1) : print(\"æ‰§è¡Œå‡çº§ä»»åŠ¡çš„å¹¶å‘æ•°ä¸ºä¸ºï¼š {}\".format(max_workers)) runners = [\"python\", \"java\", \"golang\", \"php\", \"rust\", \"shell\", \"c\"] with ProcessPoolExecutor(max_workers=max_workers) as executor: for index, value in enumerate(runners): result = executor.submit(runner, index, value) try: result.result(timeout=3 * 60) except TimeoutError as err: print(\"ä»»åŠ¡è¶…æ—¶,\", err) if __name__ == \"__main__\" : main(3) é€šè¿‡åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ python multipy.py ï¼Œå¤§å®¶å¯ä»¥åœ¨å¿ƒé‡Œæƒ³è±¡ä¸€ä¸‹ä¼šè¾“å‡ºä»€ä¹ˆã€‚ ç¬¬äºŒä¸ªåœºæ™¯æ˜¯ï¼šåŒæ ·çš„è„šæœ¬ï¼Œ é€šè¿‡ setuptools å®‰è£…åæ‰§è¡Œï¼Œéƒ¨åˆ†ä»£ç ï¼ˆsetup.pyï¼‰å¦‚ä¸‹: #!/usr/bin/env python from setuptools import setup, find_packages setup( name=\"pyctl\", entry_points=''' [console_scripts] pyctl=pyctl.commands.shell:cli ''', classifiers=[ ... ], install_requires=[ ... 'click==7.0' ], ) å®‰è£…å®Œæˆä¹‹åå¯ä»¥åœ¨å‘½ä»¤è¡Œé€šè¿‡ pyctl xxx ... æ‰§è¡Œï¼Œå’Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä¸ç†Ÿæ‚‰ setuptools å¯ä»¥å…ˆäº†è§£ä¸€ä¸‹ï¼Œæ–‡æ¡£å‚è€ƒhttps://pypi.org/project/setuptools/ è¨€å½’æ­£ä¼ ï¼Œé€šè¿‡ setuptools æ‰“åŒ…ä¹‹åå†æ‰§è¡Œè¿™ä¸ªè„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾æ‰“åŒ…ä¹‹åçš„æ‰§è¡Œæ–¹å¼ä¸º pyctl multipy ï¼Œæ‰§è¡Œåä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿå¤§å®¶ä¹Ÿå¯ä»¥åœ¨å¿ƒé‡Œå…ˆæƒ³è±¡ä¸€ä¸‹ã€‚ å®é™…çš„ç»“æœå°±æ˜¯ç›´æ¥é€šè¿‡ python multipy.py çš„æ–¹å¼å¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œç¡®å®æŒ‰ç…§å¤šè¿›ç¨‹çš„æ–¹å¼å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯åˆ°ç¬¬äºŒä¸ªåœºæ™¯æ—¶å´æ— æ³•è¿è¡Œï¼Œé€šè¿‡ ps -ef æŸ¥çœ‹è¿›ç¨‹ï¼Œç¡®å®åˆ›å»ºäº†å¤šä¸ªè¿›ç¨‹ï¼Œä½†è¿™äº›è¿›ç¨‹éƒ½è¢«é˜»å¡ï¼Œæ²¡æœ‰æ‰§è¡Œ runner å‡½æ•°é‡Œé¢çš„å†…å®¹ï¼Œç¨‹åºä¼šè¢«å¡æ­»ã€‚å½“æ—¶ç™¾æ€ä¸è§£å…¶ä¸­çš„åŸå› ï¼Œå°è¯•è¿‡å¾ˆå¤šæ–¹æ³•ï¼ŒåŒ…æ‹¬ä½¿ç”¨åŸç”Ÿçš„ multiprocessing è‡ªå·±å®ç°è¿›ç¨‹ç®¡ç†ä¹Ÿæ˜¯åŒæ ·çš„æ•ˆæœï¼Œæœ€åæ˜¯åŒæ ·çš„ä»£ç ï¼Œæ¢åˆ°python3.8ï¼Œä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥å¾—åˆ°æ­£ç¡®ç»“æœã€‚python2.7 ä¸ºå•¥ä¼šå¡æ­»ï¼Œå¤šä¸ªè¿›ç¨‹åˆ›å»ºå‡ºæ¥æ²¡æœ‰æ‰§è¡Œ runner ä»»åŠ¡è‡³ä»Šè¿˜æ²¡æœ‰æ‰¾åˆ°åŸå› ï¼Œåç»­æœ‰è¿›å±•å†æ›´æ–°ï¼Œ æ¬¢è¿çŸ¥é“åŸå› çš„å°ä¼™ä¼´ç•™è¨€å‘ŠçŸ¥ï¼ï¼ï¼ ","date":"2020-11-18","objectID":"/concurrent/:3:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆäºŒï¼‰","uri":"/concurrent/"},{"categories":null,"content":"æ€»ç»“ åœ¨python2.7çš„ç¯å¢ƒä¸‹é¢ï¼Œå¦‚æœé€šè¿‡ setuptools æ‰“åŒ…å®‰è£…ï¼Œå®‰è£…åå¤šè¿›ç¨‹ä½¿ç”¨ä¼šæœ‰é—®é¢˜ï¼Œç°è±¡æ˜¯ä¼šåˆ›å»ºå¤šä¸ªå­è¿›ç¨‹å‡ºæ¥ï¼Œä½†æ˜¯ä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½ä¼šè¢«é˜»å¡è€Œæ— æ³•çœŸæ­£æ‰§è¡Œrunnerä»»åŠ¡ï¼Œä¸€ä¸ªè¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ³•æ˜¯åˆ‡æ¢åˆ°python3ï¼ˆpython3.8äº²æµ‹æ²¡æœ‰é—®é¢˜ï¼Œå…¶ä»–çš„æ²¡æµ‹è¿‡ï¼‰ã€‚ ","date":"2020-11-18","objectID":"/concurrent/:4:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆäºŒï¼‰","uri":"/concurrent/"},{"categories":null,"content":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆäºŒï¼‰","date":"2020-11-18","objectID":"/python/concurrent/","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆäºŒï¼‰","uri":"/python/concurrent/"},{"categories":null,"content":"å¯¼è¯» åœ¨ä¸Šä¸€ç¯‡â€œpythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹(ä¸€)ä¸­ä»‹ç»äº†è¿›ç¨‹ã€çº¿ç¨‹çš„æ¦‚å¿µã€åŸºæœ¬ç”¨æ³•å’Œåœ¨ python ä¸­ä½¿ç”¨é‡åˆ°çš„ä¸€äº›å‘ï¼Œ è¿™åœ¨ä¸€ç¯‡ä¸­ä¼šä»‹ç»ä¸€äº›é«˜çº§çš„ç”¨æ³•ï¼Œå½“ç„¶æ›´å¤šçš„æ˜¯é‡åˆ°çš„å‘ï¼Œæ¢è¨€ä¹‹è¿™æ˜¯ä¸€ç‰‡é¿å‘æŒ‡å—ã€‚ ","date":"2020-11-18","objectID":"/python/concurrent/:1:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆäºŒï¼‰","uri":"/python/concurrent/"},{"categories":null,"content":"concurrent.futures æˆ‘ä»¬éƒ½çŸ¥é“åœ¨ python ä¸­ï¼Œå¤šçº¿ç¨‹çš„æ ‡å‡†åº“æ˜¯ä½¿ç”¨ threading , å¦‚ ï¼š # -*- coding: UTF-8 -*- import threading import time def runner(index, param) : print(\"çº¿ç¨‹{} å¼€å§‹è¿è¡Œ: ------------\".format(index)) print(\"çº¿ç¨‹{} : {}\".format(index,param)) time.sleep(3) print(\"çº¿ç¨‹{} è¿è¡Œç»“æŸ: ------------\".format(index)) for index,value in enumerate([\"python\", \"java\", \"golang\", \"php\"]) : thread = threading.Thread(target=runner,args=(index, value, )) thread.start() å¤šè¿›ç¨‹çš„åº“æ˜¯ multiprocessing ,å¦‚ï¼š # -*- coding: UTF-8 -*- from multiprocessing import Process import time def runner(index, param) : print(\"çº¿ç¨‹{} å¼€å§‹è¿è¡Œ: ------------\".format(index)) print(\"çº¿ç¨‹{} : {}\".format(index,param)) time.sleep(3) print(\"çº¿ç¨‹{} è¿è¡Œç»“æŸ: ------------\".format(index)) for index,value in enumerate([\"python\", \"java\", \"golang\", \"php\"]) : process = Process(target=runner,args=(index, value, )) process.start() ä»¥ä¸Šä¸¤ä¸ªåº“å·²ç» python2 å·²ç»æ”¯æŒï¼Œå¯ä»¥å¾ˆå¥½çš„å®ç°æˆ‘ä»¬å¤šè¿›ç¨‹ä¸å¤šçº¿ç¨‹çš„éœ€æ±‚ã€‚ python3.2 æä¾›äº† concurrent.futures åº“ï¼Œå¹¶ä¸”å·²ç»å›æº¯åˆ°python2ï¼Œè¿™ä¸ªåº“åœ¨ threading ä¸ multiprocessing çš„åŸºç¡€ä¸Šæä¾›äº†ä¸€å±‚å°è£…ï¼Œä½¿å¾—å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹åœ¨ä½¿ç”¨è¡Œä¸ºä¸Šä¿æŒäº†ä¸€è‡´ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Œä¸”çœ‹ä¸‹é¢åˆ†æï¼Œè¯·å…ˆçœ‹ä¸¤æ®µä»£ç ï¼š å¤šçº¿ç¨‹ # -*- coding: UTF-8 -*- from concurrent.futures._base import TimeoutError from concurrent.futures import ThreadPoolExecutor import time def runner(index, param) : print(\"çº¿ç¨‹{} å¼€å§‹è¿è¡Œ: ------------\".format(index)) print(\"çº¿ç¨‹{} : {}\".format(index,param)) time.sleep(3) print(\"çº¿ç¨‹{} è¿è¡Œç»“æŸ: ------------\".format(index)) max_workers = 4 print(\"æ‰§è¡Œå‡çº§ä»»åŠ¡çš„å¹¶å‘æ•°ä¸ºä¸ºï¼š {}\".format(max_workers)) runners = [\"python\", \"java\", \"golang\", \"php\", \"rust\", \"shell\", \"c\"] with ThreadPoolExecutor(max_workers=max_workers) as executor: for index, value in enumerate(runners): result = executor.submit(runner, index, value) try: result.result(timeout=3 * 60 ) except TimeoutError as err: print(\"ä»»åŠ¡è¶…æ—¶,\", err) å¤šè¿›ç¨‹ # -*- coding: UTF-8 -*- from concurrent.futures._base import TimeoutError from concurrent.futures import ProcessPoolExecutor import time def runner(index, param) : print(\"çº¿ç¨‹{} å¼€å§‹è¿è¡Œ: ------------\".format(index)) print(\"çº¿ç¨‹{} : {}\".format(index,param)) time.sleep(3) print(\"çº¿ç¨‹{} è¿è¡Œç»“æŸ: ------------\".format(index)) max_workers = 4 print(\"æ‰§è¡Œå‡çº§ä»»åŠ¡çš„å¹¶å‘æ•°ä¸ºä¸ºï¼š {}\".format(max_workers)) runners = [\"python\", \"java\", \"golang\", \"php\", \"rust\", \"shell\", \"c\"] with ProcessPoolExecutor(max_workers=max_workers) as executor: for index, value in enumerate(runners): result = executor.submit(runner, index, value) try: result.result(timeout=3 * 60 ) except TimeoutError as err: print(\"ä»»åŠ¡è¶…æ—¶,\", err) å¯ä»¥çœ‹åˆ°å¤šè¿›ç¨‹å’Œå¤šçº¿ç¨‹å†™æ³•è¶…çº§ç±»ä¼¼ï¼Œä¸€ä¸ªä½¿ç”¨çš„æ˜¯ ProcessPoolExecutor ï¼Œä¸€ä¸ªä½¿ç”¨çš„æ˜¯ ThreadPoolExecutorï¼Œå…¶ä»–ä»£ç åŸºæœ¬ä¸€ç›´ï¼ŒæŸ¥çœ‹æºç å¯ä»¥å‘ç° concurrent.futures å®šä¹‰äº†ä¸€ä¸ª Executor æŠ½è±¡åŸºç±»ï¼Œæä¾›äº† submit ã€map ã€shutdown ç­‰æ–¹æ³• class Executor(object): \"\"\"This is an abstract base class for concrete asynchronous executors.\"\"\" def submit(self, fn, *args, **kwargs): \"\"\"Submits a callable to be executed with the given arguments. Schedules the callable to be executed as fn(*args, **kwargs) and returns a Future instance representing the execution of the callable. Returns: A Future representing the given call. \"\"\" raise NotImplementedError() def map(self, fn, *iterables, **kwargs): \"\"\"Returns a iterator equivalent to map(fn, iter). Args: fn: A callable that will take as many arguments as there are passed iterables. timeout: The maximum number of seconds to wait. If None, then there is no limit on the wait time. Returns: An iterator equivalent to: map(func, *iterables) but the calls may be evaluated out-of-order. Raises: TimeoutError: If the entire result iterator could not be generated before the given timeout. Exception: If fn(*args) raises for any values. \"\"\" timeout = kwargs.get('timeout') if timeout is not None: end_time = timeout + time.time() fs = [self.submit(fn, *args) for args in itertools.izip(*iterables)] # Yield must be hidden in closure so that the futures are submitted # before the first iterator value is required. def result_iterator(): try: for future in fs: if timeout is None: yield future.result() else: yield future.result(end_time - time.time()) finally: for future in fs: future.cancel() return result_iterator() def shutdown(self, wait=True): \"\"","date":"2020-11-18","objectID":"/python/concurrent/:2:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆäºŒï¼‰","uri":"/python/concurrent/"},{"categories":null,"content":"concurrent ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°çš„å‘ æ‰§è¡Œç¯å¢ƒä¸º python-2.7.15 å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªè„šæœ¬ multipy.py # -*- coding: UTF-8 -*- from concurrent.futures._base import TimeoutError from concurrent.futures import ProcessPoolExecutor import time def runner(index, param) : print(\"çº¿ç¨‹{} å¼€å§‹è¿è¡Œ: ------------\".format(index)) print(\"çº¿ç¨‹{} : {}\".format(index,param)) time.sleep(3) print(\"çº¿ç¨‹{} è¿è¡Œç»“æŸ: ------------\".format(index)) def main(max_workers=1) : print(\"æ‰§è¡Œå‡çº§ä»»åŠ¡çš„å¹¶å‘æ•°ä¸ºä¸ºï¼š {}\".format(max_workers)) runners = [\"python\", \"java\", \"golang\", \"php\", \"rust\", \"shell\", \"c\"] with ProcessPoolExecutor(max_workers=max_workers) as executor: for index, value in enumerate(runners): result = executor.submit(runner, index, value) try: result.result(timeout=3 * 60) except TimeoutError as err: print(\"ä»»åŠ¡è¶…æ—¶,\", err) if __name__ == \"__main__\" : main(3) é€šè¿‡åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ python multipy.py ï¼Œå¤§å®¶å¯ä»¥åœ¨å¿ƒé‡Œæƒ³è±¡ä¸€ä¸‹ä¼šè¾“å‡ºä»€ä¹ˆã€‚ ç¬¬äºŒä¸ªåœºæ™¯æ˜¯ï¼šåŒæ ·çš„è„šæœ¬ï¼Œ é€šè¿‡ setuptools å®‰è£…åæ‰§è¡Œï¼Œéƒ¨åˆ†ä»£ç ï¼ˆsetup.pyï¼‰å¦‚ä¸‹: #!/usr/bin/env python from setuptools import setup, find_packages setup( name=\"pyctl\", entry_points=''' [console_scripts] pyctl=pyctl.commands.shell:cli ''', classifiers=[ ... ], install_requires=[ ... 'click==7.0' ], ) å®‰è£…å®Œæˆä¹‹åå¯ä»¥åœ¨å‘½ä»¤è¡Œé€šè¿‡ pyctl xxx ... æ‰§è¡Œï¼Œå’Œæ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœä¸ç†Ÿæ‚‰ setuptools å¯ä»¥å…ˆäº†è§£ä¸€ä¸‹ï¼Œæ–‡æ¡£å‚è€ƒhttps://pypi.org/project/setuptools/ è¨€å½’æ­£ä¼ ï¼Œé€šè¿‡ setuptools æ‰“åŒ…ä¹‹åå†æ‰§è¡Œè¿™ä¸ªè„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾æ‰“åŒ…ä¹‹åçš„æ‰§è¡Œæ–¹å¼ä¸º pyctl multipy ï¼Œæ‰§è¡Œåä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿå¤§å®¶ä¹Ÿå¯ä»¥åœ¨å¿ƒé‡Œå…ˆæƒ³è±¡ä¸€ä¸‹ã€‚ å®é™…çš„ç»“æœå°±æ˜¯ç›´æ¥é€šè¿‡ python multipy.py çš„æ–¹å¼å¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œç¡®å®æŒ‰ç…§å¤šè¿›ç¨‹çš„æ–¹å¼å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯åˆ°ç¬¬äºŒä¸ªåœºæ™¯æ—¶å´æ— æ³•è¿è¡Œï¼Œé€šè¿‡ ps -ef æŸ¥çœ‹è¿›ç¨‹ï¼Œç¡®å®åˆ›å»ºäº†å¤šä¸ªè¿›ç¨‹ï¼Œä½†è¿™äº›è¿›ç¨‹éƒ½è¢«é˜»å¡ï¼Œæ²¡æœ‰æ‰§è¡Œ runner å‡½æ•°é‡Œé¢çš„å†…å®¹ï¼Œç¨‹åºä¼šè¢«å¡æ­»ã€‚å½“æ—¶ç™¾æ€ä¸è§£å…¶ä¸­çš„åŸå› ï¼Œå°è¯•è¿‡å¾ˆå¤šæ–¹æ³•ï¼ŒåŒ…æ‹¬ä½¿ç”¨åŸç”Ÿçš„ multiprocessing è‡ªå·±å®ç°è¿›ç¨‹ç®¡ç†ä¹Ÿæ˜¯åŒæ ·çš„æ•ˆæœï¼Œæœ€åæ˜¯åŒæ ·çš„ä»£ç ï¼Œæ¢åˆ°python3.8ï¼Œä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥å¾—åˆ°æ­£ç¡®ç»“æœã€‚python2.7 ä¸ºå•¥ä¼šå¡æ­»ï¼Œå¤šä¸ªè¿›ç¨‹åˆ›å»ºå‡ºæ¥æ²¡æœ‰æ‰§è¡Œ runner ä»»åŠ¡è‡³ä»Šè¿˜æ²¡æœ‰æ‰¾åˆ°åŸå› ï¼Œåç»­æœ‰è¿›å±•å†æ›´æ–°ï¼Œ æ¬¢è¿çŸ¥é“åŸå› çš„å°ä¼™ä¼´ç•™è¨€å‘ŠçŸ¥ï¼ï¼ï¼ ","date":"2020-11-18","objectID":"/python/concurrent/:3:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆäºŒï¼‰","uri":"/python/concurrent/"},{"categories":null,"content":"æ€»ç»“ åœ¨python2.7çš„ç¯å¢ƒä¸‹é¢ï¼Œå¦‚æœé€šè¿‡ setuptools æ‰“åŒ…å®‰è£…ï¼Œå®‰è£…åå¤šè¿›ç¨‹ä½¿ç”¨ä¼šæœ‰é—®é¢˜ï¼Œç°è±¡æ˜¯ä¼šåˆ›å»ºå¤šä¸ªå­è¿›ç¨‹å‡ºæ¥ï¼Œä½†æ˜¯ä¸»è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½ä¼šè¢«é˜»å¡è€Œæ— æ³•çœŸæ­£æ‰§è¡Œrunnerä»»åŠ¡ï¼Œä¸€ä¸ªè¡Œä¹‹æœ‰æ•ˆçš„æ–¹æ³•æ˜¯åˆ‡æ¢åˆ°python3ï¼ˆpython3.8äº²æµ‹æ²¡æœ‰é—®é¢˜ï¼Œå…¶ä»–çš„æ²¡æµ‹è¿‡ï¼‰ã€‚ ","date":"2020-11-18","objectID":"/python/concurrent/:4:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆäºŒï¼‰","uri":"/python/concurrent/"},{"categories":null,"content":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","date":"2020-11-16","objectID":"/multithread/","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","uri":"/multithread/"},{"categories":null,"content":"å¯¼è¯» åœ¨ç¼–ç çš„è¿‡ç¨‹ï¼Œå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹ã€å¹¶å‘ã€å¹¶è¡Œè¿™äº›æ¦‚å¿µè‚¯å®šä¸æ­¢ä¸€æ¬¡çš„å‡ºç°åœ¨æˆ‘ä»¬é¢å‰ã€‚æ¦‚å¿µç†è§£æ˜¯ä¸€å›äº‹ï¼Œä½†æ˜¯èƒ½çœŸæ­£ç”¨å¥½åˆæ˜¯å¦ä¸€å›äº‹ã€‚ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶å‘ç¼–ç¨‹éš¾æ˜“ç¨‹åº¦ç›¸å·®è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œæ­£å¥½è¿™å‡ å¤©æ¢³ç†äº†ä»–ä»¬ä¹‹é—´çš„å…³ç³»ä¸åŒºåˆ«ï¼Œåˆ†äº«ç»™å¤§å®¶ã€‚ï¼ˆåŸºäºè‡ªå·±çš„ç†è§£è°ˆè°ˆï¼Œå¦‚æœä¸å¯¹æ¬¢è¿æŒ‡å‡ºï¼‰ çµé­‚æ‹·é—®ï¼šä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿ ","date":"2020-11-16","objectID":"/multithread/:1:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","uri":"/multithread/"},{"categories":null,"content":"è¿›ç¨‹ è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚ ","date":"2020-11-16","objectID":"/multithread/:2:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","uri":"/multithread/"},{"categories":null,"content":"çº¿ç¨‹ çº¿ç¨‹æ˜¯ cpu è°ƒåº¦çš„æœ€å°è°ƒåº¦ã€‚çº¿ç¨‹åˆåˆ†ä¸ºå†…æ ¸çº¿ç¨‹ï¼Œç”¨æˆ·çº¿ç¨‹ã€‚ å†…æ ¸çº¿ç¨‹åªè¿è¡Œåœ¨å†…æ ¸æ€ï¼Œä¸å—ç”¨æˆ·æ€çš„æ‹–ç´¯ã€‚ ç”¨æˆ·çº¿ç¨‹æ˜¯å®Œå…¨å»ºç«‹åœ¨ç”¨æˆ·ç©ºé—´çš„çº¿ç¨‹åº“ï¼Œç”¨æˆ·çº¿ç¨‹çš„åˆ›å»ºã€è°ƒåº¦ã€åŒæ­¥å’Œé”€æ¯åœ¨ç”¨æˆ·ç©ºé—´å®Œæˆï¼Œä¸éœ€è¦å†…æ ¸çš„å¸®åŠ©ã€‚ç”¨æˆ·çº¿ç¨‹åˆç§°ä¸ºåç¨‹ã€‚ ä¸€ä¸ªçº¿ç¨‹åªèƒ½å±äºä¸€ä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šçº¿ç¨‹å¤„ç†å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€ä¸ªæ—¶åˆ»æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚ è¿™äº›æ˜¯æ¯”è¾ƒå®˜æ–¹çš„å®šä¹‰ï¼Œç®€å•ç†è§£å°±æ˜¯è¿è¡Œä¸€æ®µç¨‹åºï¼Œéœ€è¦ä¸€å®šçš„èµ„æºï¼Œå¦‚cpuï¼Œç³»ç»Ÿå†…æ ¸ä¼šåˆ†é…ç»™è¿›ç¨‹ï¼Œè‡³äºæ€ä¹ˆåˆ†é…è¿™äº›èµ„æºå¯ç”±çº¿ç¨‹å»æŠ¢ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹å ç”¨èµ„æº(cpu)æ—¶é—´å¤ªé•¿ï¼Œå†…æ ¸ä¸ºäº†å¹³è¡¡ï¼Œä¼šå¼ºè¡Œä¸­æ–­ï¼Œåˆ‡æ¢ç»™å…¶ä»–çš„çº¿ç¨‹æ‰§è¡Œï¼Œä½†æ˜¯æ¯æ¬¡åˆ‡æ¢éƒ½æ˜¯æœ‰ä»£ä»·çš„ï¼Œéœ€è¦æŠŠæ‰§è¡Œç°åœºä¿ç•™ä»¥ç¡®ä¿åç»­æ¢å¤çš„æ—¶å€™å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œè¿™å°±æœ‰äº†å†…æ ¸å’Œç”¨æˆ·æ€çš„åˆ‡æ¢ï¼ˆè¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯å—å†…æ ¸æ§åˆ¶çš„ï¼‰ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœåªåœ¨ç”¨æˆ·æ€åˆ‡æ¢ï¼Œå²‚ä¸æ˜¯å¾ˆå¥½ï¼Ÿè¿˜çœŸæ˜¯è¿™æ ·ï¼Œgo è¯­è¨€å°±æ˜¯è¿™æ ·å®ç°ã€‚ ","date":"2020-11-16","objectID":"/multithread/:3:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","uri":"/multithread/"},{"categories":null,"content":"python å¤šçº¿ç¨‹æ—¶é‡åˆ°çš„å‘ python ä¸­å¦‚æœè¦ç”¨å¤šçº¿ç¨‹æˆ–è€…å¤šè¿›ç¨‹æ—¶éœ€è¦è‡ªå·±åˆ›å»ºçº¿ç¨‹æˆ–è€…è¿›ç¨‹ï¼Œè¿™å’Œgoè¯­è¨€ä¸ä¸€æ ·ï¼Œgoè¯­è¨€åªéœ€è¦é€šè¿‡ go å…³é”®å­—åˆ›å»ºå‡ºåç¨‹ï¼Œç„¶åç”±runtime è¿›è¡Œè°ƒåº¦ï¼ˆä¸éœ€è¦è‡ªå·±å¤„ç†è¿›ç¨‹ä¸çº¿ç¨‹ï¼‰ã€‚ä»Šå¤©å…ˆçœ‹çœ‹python ä¸­å¦‚ä½•ä½¿ç”¨å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ã€‚python ç¯å¢ƒä¸º 2.7.15 ã€‚ å…ˆçœ‹ä¸€æ®µç®€å•çš„ä»£ç  import threading import time â€‹ lock = threading.Lock() â€‹ def runner(i, p1, p2, p3=\"\", p4=\"\", **kwargs): \"\"\" :return: \"\"\" count = 0 print(\"çº¿ç¨‹{} param1:====\".format(i), p1) print(\"çº¿ç¨‹{} param2:====\".format(i), p2) print(\"çº¿ç¨‹{} param3:====\".format(i), p3) print(\"çº¿ç¨‹{} param3:====\".format(i), p4) while True: with lock: count += 1 print(\"çº¿ç¨‹{} ç¬¬ {} ç§’ å: ......\".format(i, count)) time.sleep(1) if count == 5: break def main_thread(): \"\"\" ä¸»çº¿ç¨‹çš„è¿è¡Œä»£ç  :return: \"\"\" print(\"ä¸»çº¿ç¨‹å¼€å§‹æ‰§è¡Œ\") time.sleep(1) print(\"ä¸»çº¿ç¨‹æ‰§è¡Œç»“æŸ\") â€‹ def main(): \"\"\" :return: \"\"\" for i in range(5): thread = threading.Thread(target=runner, args=(i, \"a1\", \"a2\"), kwargs={\"p3\": \"p2\", \"p4\": \"p4\"}) thread.setName(\"çº¿ç¨‹{}\".format(i)) thread.start() â€‹ main_thread() â€‹ if __name__ == \"__main__\": main() â€‹ è¿™ä¸ªåº”è¯¥èƒ½æƒ³çš„å‡ºæ¥ä¸åŒçš„çº¿ç¨‹çš„è¾“å‡ºæ˜¯äº¤å‰æ‰“å°å‡ºæ¥çš„ï¼Œè¯´æ˜è¿™æ˜¯å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„ã€‚ ç°åœ¨å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œæœ‰10å°æœºå™¨ï¼Œæ¯ä¸ªæœºå™¨ä¸Šæœ‰10ä¸ªå®¹å™¨éœ€è¦é‡å¯ï¼Œå¦‚æœè¦å¹¶å‘çš„æ‰§è¡Œåº”è¯¥æ€ä¹ˆåšå‘¢? çœ‹çœ‹ä¸‹é¢çš„ä»£ç æœ‰æ²¡æœ‰é—®é¢˜? import os â€‹ import threading â€‹ def runnner(hostip) : appIds = [ \"app-{}\".format(i) for i in range(10)] cmd = \"docker restart {}\".format(\" \".join(appIds)) print(cmd) os.system(\"ssh {hostip} {cmd}\".format(hostip=hostip,cmd=cmd)) â€‹ hosts = [\"10.0.0.1\", \"10.0.0.2\", \"10.0.0.3\" , \"10.0.0.4\", \"10.0.0.5\",\"10.0.0.6\", \"10.0.0.7\", \"10.0.0.8\" , \"10.0.0.9\", \"10.0.0.10\"] â€‹ for hostip in hosts : thread = threading.Thread(target=runnner, args=(hostip,)) thread.start() çœ‹èµ·æ¥åº”è¯¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œç„¶è€ŒçœŸæ­£æ‰§è¡Œçš„è¿˜æ˜¯ä¸²è¡Œï¼Œæ²¡æœ‰åˆ°è¾¾å¹¶å‘æ‰§è¡Œçš„ç›®çš„ã€‚é—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ï¼Ÿ åœ¨python ä¸­çº¿ç¨‹æ‰§è¡Œéœ€è¦å…ˆè·å–GILé”ï¼ˆå…¨å±€è§£é‡Šå™¨é”ï¼‰ï¼Œçœ‹èµ·æ¥æ˜¯åˆ›å»ºäº†å¤šä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯åŒä¸€ä¸ªæ—¶é—´ç‚¹æ¯ä¸ªè¿›ç¨‹åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–è¿™ä¸ªé”å¹¶ä¸”æ‰§è¡Œï¼Œæ˜¯ä¸€ç§ä¼ªå¤šçº¿ç¨‹ï¼Œå¦‚æœåœ¨å¯†é›†è®¡ç®—çš„åœºæ™¯ï¼Œå°±ä¼šé¢‘ç¹çš„å‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œè¿™ä¸ªæ˜¯å¾ˆè€—æ—¶é—´çš„ï¼Œè¿˜æ²¡æœ‰å•çº¿ç¨‹æ•ˆæœå¥½ã€‚é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œä»€ä¹ˆä¼šå‘ç”Ÿçº¿ç¨‹åˆ‡æ¢å‘¢? å¦‚æœé‡åˆ°ioç­‰å¾…æˆ–è€…sleep æ—¶è‚¯å®šä¼šå‘ç”Ÿåˆ‡æ¢ï¼Œè¿˜æœ‰å°±æ˜¯æ¯100æ¡æŒ‡ä»¤åˆ‡æ¢ä¸€æ¬¡çº¿ç¨‹ã€‚å¯ä»¥é€šè¿‡å¦‚ä¸‹æŒ‡ä»¤è®¾ç½®: sys.setcheckinterval ä¸Šé¢è¿™é‡Œä¾‹å­å°±æ²¡æœ‰è§¦å‘çº¿ç¨‹çš„åˆ‡æ¢ï¼Œå½“å‰é¢çš„çº¿ç¨‹æ‰§è¡Œå®Œé€€å‡ºä¹‹åé‡Šæ”¾GILé”ï¼Œåç»­çš„çº¿ç¨‹æ‰èƒ½æ‰§è¡Œï¼Œæ‰€ä»¥æ‰æœ‰çœ‹èµ·æ¥æ˜¯å¤šçº¿ç¨‹çš„å†™æ³•ï¼Œä½†æ˜¯ç¡®å®å•çº¿ç¨‹çš„æ•ˆæœã€‚ æ”¹è¿›çš„æ–¹æ³•å½“ç„¶ä½¿ç”¨å¤šè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„GILé”ï¼Œå¯ä»¥çœŸæ­£çš„å®ç°å¹¶å‘ã€‚è¿›ç¨‹å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œåˆ›å»ºè¿›ç¨‹å¼€é”€æ¯”çº¿ç¨‹è¦å¤§å¾ˆå¤šï¼Œå¦‚æœè¿›ç¨‹ä¹‹é—´æœ‰æ•°æ®äº¤æ¢ä¹Ÿæ¯”çº¿ç¨‹å¤æ‚ï¼Œå¹¶ä¸”çœŸæ­£æ‰§è¡Œè¿˜æ˜¯è¦è½åˆ°cpuä¸Šå»æ‰§è¡Œï¼Œè¿›ç¨‹å¤šäº†ä¹Ÿä¼šé€ æˆæ’é˜Ÿï¼Œç†è®ºä¸Šå’Œåˆ›å»ºå’Œcpuç›¸åŒä¸ªæ•°çš„è¿›ç¨‹æ€§èƒ½æœ€å¥½ã€‚ä¸‹é¢çœ‹çœ‹å¤šè¿›ç¨‹çš„å†™æ³•ã€‚ import os from multiprocessing import Process â€‹ def runnner(hostip) : appIds = [ \"app-{}\".format(i) for i in range(10)] cmd = \"docker restart {}\".format(\" \".join(appIds)) print(cmd) os.system(\"ssh {hostip} {cmd}\".format(hostip=hostip,cmd=cmd)) â€‹ â€‹ hosts = [\"10.0.0.{}\".format(i) for i in range(10)] â€‹ â€‹ for hostip in hosts : process = Process(target=runnner, args=(hostip,)) process.start() å½“ç„¶å¯ä»¥ç”¨è¿›ç¨‹æ± æ§åˆ¶è¿›ç¨‹çš„ä¸ªæ•°ï¼Œå¦‚: import os â€‹ from multiprocessing import Pool â€‹ def runnner(hostip) : appIds = [ \"app-{}\".format(i) for i in range(10)] cmd = \"docker restart {}\".format(\" \".join(appIds)) print(cmd) os.system(\"ssh {hostip} {cmd}\".format(hostip=hostip,cmd=cmd)) â€‹ â€‹ hosts = [\"10.0.0.{}\".format(i) for i in range(10)] â€‹ p = Pool(4) â€‹ for hostip in hosts : p.apply_async(runnner, args=(hostip,)) # å¼‚æ­¥æ‰§è¡Œ p.close() p.join() ","date":"2020-11-16","objectID":"/multithread/:4:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","uri":"/multithread/"},{"categories":null,"content":"å‚è€ƒ https://docs.python.org/2/library/sys.html#sys.setcheckinterval ","date":"2020-11-16","objectID":"/multithread/:5:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","uri":"/multithread/"},{"categories":null,"content":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","date":"2020-11-16","objectID":"/python/multithread/","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","uri":"/python/multithread/"},{"categories":null,"content":"å¯¼è¯» åœ¨ç¼–ç çš„è¿‡ç¨‹ï¼Œå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹ã€å¹¶å‘ã€å¹¶è¡Œè¿™äº›æ¦‚å¿µè‚¯å®šä¸æ­¢ä¸€æ¬¡çš„å‡ºç°åœ¨æˆ‘ä»¬é¢å‰ã€‚æ¦‚å¿µç†è§£æ˜¯ä¸€å›äº‹ï¼Œä½†æ˜¯èƒ½çœŸæ­£ç”¨å¥½åˆæ˜¯å¦ä¸€å›äº‹ã€‚ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶å‘ç¼–ç¨‹éš¾æ˜“ç¨‹åº¦ç›¸å·®è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œæ­£å¥½è¿™å‡ å¤©æ¢³ç†äº†ä»–ä»¬ä¹‹é—´çš„å…³ç³»ä¸åŒºåˆ«ï¼Œåˆ†äº«ç»™å¤§å®¶ã€‚ï¼ˆåŸºäºè‡ªå·±çš„ç†è§£è°ˆè°ˆï¼Œå¦‚æœä¸å¯¹æ¬¢è¿æŒ‡å‡ºï¼‰ çµé­‚æ‹·é—®ï¼šä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿ ","date":"2020-11-16","objectID":"/python/multithread/:1:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","uri":"/python/multithread/"},{"categories":null,"content":"è¿›ç¨‹ è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ã€‚ ","date":"2020-11-16","objectID":"/python/multithread/:2:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","uri":"/python/multithread/"},{"categories":null,"content":"çº¿ç¨‹ çº¿ç¨‹æ˜¯ cpu è°ƒåº¦çš„æœ€å°è°ƒåº¦ã€‚çº¿ç¨‹åˆåˆ†ä¸ºå†…æ ¸çº¿ç¨‹ï¼Œç”¨æˆ·çº¿ç¨‹ã€‚ å†…æ ¸çº¿ç¨‹åªè¿è¡Œåœ¨å†…æ ¸æ€ï¼Œä¸å—ç”¨æˆ·æ€çš„æ‹–ç´¯ã€‚ ç”¨æˆ·çº¿ç¨‹æ˜¯å®Œå…¨å»ºç«‹åœ¨ç”¨æˆ·ç©ºé—´çš„çº¿ç¨‹åº“ï¼Œç”¨æˆ·çº¿ç¨‹çš„åˆ›å»ºã€è°ƒåº¦ã€åŒæ­¥å’Œé”€æ¯åœ¨ç”¨æˆ·ç©ºé—´å®Œæˆï¼Œä¸éœ€è¦å†…æ ¸çš„å¸®åŠ©ã€‚ç”¨æˆ·çº¿ç¨‹åˆç§°ä¸ºåç¨‹ã€‚ ä¸€ä¸ªçº¿ç¨‹åªèƒ½å±äºä¸€ä¸ªè¿›ç¨‹ï¼Œä½†æ˜¯ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œå¤šçº¿ç¨‹å¤„ç†å°±æ˜¯ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€ä¸ªæ—¶åˆ»æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚ è¿™äº›æ˜¯æ¯”è¾ƒå®˜æ–¹çš„å®šä¹‰ï¼Œç®€å•ç†è§£å°±æ˜¯è¿è¡Œä¸€æ®µç¨‹åºï¼Œéœ€è¦ä¸€å®šçš„èµ„æºï¼Œå¦‚cpuï¼Œç³»ç»Ÿå†…æ ¸ä¼šåˆ†é…ç»™è¿›ç¨‹ï¼Œè‡³äºæ€ä¹ˆåˆ†é…è¿™äº›èµ„æºå¯ç”±çº¿ç¨‹å»æŠ¢ï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹å ç”¨èµ„æº(cpu)æ—¶é—´å¤ªé•¿ï¼Œå†…æ ¸ä¸ºäº†å¹³è¡¡ï¼Œä¼šå¼ºè¡Œä¸­æ–­ï¼Œåˆ‡æ¢ç»™å…¶ä»–çš„çº¿ç¨‹æ‰§è¡Œï¼Œä½†æ˜¯æ¯æ¬¡åˆ‡æ¢éƒ½æ˜¯æœ‰ä»£ä»·çš„ï¼Œéœ€è¦æŠŠæ‰§è¡Œç°åœºä¿ç•™ä»¥ç¡®ä¿åç»­æ¢å¤çš„æ—¶å€™å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œè¿™å°±æœ‰äº†å†…æ ¸å’Œç”¨æˆ·æ€çš„åˆ‡æ¢ï¼ˆè¿›ç¨‹å’Œçº¿ç¨‹éƒ½æ˜¯å—å†…æ ¸æ§åˆ¶çš„ï¼‰ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœåªåœ¨ç”¨æˆ·æ€åˆ‡æ¢ï¼Œå²‚ä¸æ˜¯å¾ˆå¥½ï¼Ÿè¿˜çœŸæ˜¯è¿™æ ·ï¼Œgo è¯­è¨€å°±æ˜¯è¿™æ ·å®ç°ã€‚ ","date":"2020-11-16","objectID":"/python/multithread/:3:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","uri":"/python/multithread/"},{"categories":null,"content":"python å¤šçº¿ç¨‹æ—¶é‡åˆ°çš„å‘ python ä¸­å¦‚æœè¦ç”¨å¤šçº¿ç¨‹æˆ–è€…å¤šè¿›ç¨‹æ—¶éœ€è¦è‡ªå·±åˆ›å»ºçº¿ç¨‹æˆ–è€…è¿›ç¨‹ï¼Œè¿™å’Œgoè¯­è¨€ä¸ä¸€æ ·ï¼Œgoè¯­è¨€åªéœ€è¦é€šè¿‡ go å…³é”®å­—åˆ›å»ºå‡ºåç¨‹ï¼Œç„¶åç”±runtime è¿›è¡Œè°ƒåº¦ï¼ˆä¸éœ€è¦è‡ªå·±å¤„ç†è¿›ç¨‹ä¸çº¿ç¨‹ï¼‰ã€‚ä»Šå¤©å…ˆçœ‹çœ‹python ä¸­å¦‚ä½•ä½¿ç”¨å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ã€‚python ç¯å¢ƒä¸º 2.7.15 ã€‚ å…ˆçœ‹ä¸€æ®µç®€å•çš„ä»£ç  import threading import time â€‹ lock = threading.Lock() â€‹ def runner(i, p1, p2, p3=\"\", p4=\"\", **kwargs): \"\"\" :return: \"\"\" count = 0 print(\"çº¿ç¨‹{} param1:====\".format(i), p1) print(\"çº¿ç¨‹{} param2:====\".format(i), p2) print(\"çº¿ç¨‹{} param3:====\".format(i), p3) print(\"çº¿ç¨‹{} param3:====\".format(i), p4) while True: with lock: count += 1 print(\"çº¿ç¨‹{} ç¬¬ {} ç§’ å: ......\".format(i, count)) time.sleep(1) if count == 5: break def main_thread(): \"\"\" ä¸»çº¿ç¨‹çš„è¿è¡Œä»£ç  :return: \"\"\" print(\"ä¸»çº¿ç¨‹å¼€å§‹æ‰§è¡Œ\") time.sleep(1) print(\"ä¸»çº¿ç¨‹æ‰§è¡Œç»“æŸ\") â€‹ def main(): \"\"\" :return: \"\"\" for i in range(5): thread = threading.Thread(target=runner, args=(i, \"a1\", \"a2\"), kwargs={\"p3\": \"p2\", \"p4\": \"p4\"}) thread.setName(\"çº¿ç¨‹{}\".format(i)) thread.start() â€‹ main_thread() â€‹ if __name__ == \"__main__\": main() â€‹ è¿™ä¸ªåº”è¯¥èƒ½æƒ³çš„å‡ºæ¥ä¸åŒçš„çº¿ç¨‹çš„è¾“å‡ºæ˜¯äº¤å‰æ‰“å°å‡ºæ¥çš„ï¼Œè¯´æ˜è¿™æ˜¯å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„ã€‚ ç°åœ¨å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œæœ‰10å°æœºå™¨ï¼Œæ¯ä¸ªæœºå™¨ä¸Šæœ‰10ä¸ªå®¹å™¨éœ€è¦é‡å¯ï¼Œå¦‚æœè¦å¹¶å‘çš„æ‰§è¡Œåº”è¯¥æ€ä¹ˆåšå‘¢? çœ‹çœ‹ä¸‹é¢çš„ä»£ç æœ‰æ²¡æœ‰é—®é¢˜? import os â€‹ import threading â€‹ def runnner(hostip) : appIds = [ \"app-{}\".format(i) for i in range(10)] cmd = \"docker restart {}\".format(\" \".join(appIds)) print(cmd) os.system(\"ssh {hostip} {cmd}\".format(hostip=hostip,cmd=cmd)) â€‹ hosts = [\"10.0.0.1\", \"10.0.0.2\", \"10.0.0.3\" , \"10.0.0.4\", \"10.0.0.5\",\"10.0.0.6\", \"10.0.0.7\", \"10.0.0.8\" , \"10.0.0.9\", \"10.0.0.10\"] â€‹ for hostip in hosts : thread = threading.Thread(target=runnner, args=(hostip,)) thread.start() çœ‹èµ·æ¥åº”è¯¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œç„¶è€ŒçœŸæ­£æ‰§è¡Œçš„è¿˜æ˜¯ä¸²è¡Œï¼Œæ²¡æœ‰åˆ°è¾¾å¹¶å‘æ‰§è¡Œçš„ç›®çš„ã€‚é—®é¢˜å‡ºåœ¨å“ªé‡Œå‘¢ï¼Ÿ åœ¨python ä¸­çº¿ç¨‹æ‰§è¡Œéœ€è¦å…ˆè·å–GILé”ï¼ˆå…¨å±€è§£é‡Šå™¨é”ï¼‰ï¼Œçœ‹èµ·æ¥æ˜¯åˆ›å»ºäº†å¤šä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯åŒä¸€ä¸ªæ—¶é—´ç‚¹æ¯ä¸ªè¿›ç¨‹åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–è¿™ä¸ªé”å¹¶ä¸”æ‰§è¡Œï¼Œæ˜¯ä¸€ç§ä¼ªå¤šçº¿ç¨‹ï¼Œå¦‚æœåœ¨å¯†é›†è®¡ç®—çš„åœºæ™¯ï¼Œå°±ä¼šé¢‘ç¹çš„å‘ç”Ÿçº¿ç¨‹åˆ‡æ¢ï¼Œè¿™ä¸ªæ˜¯å¾ˆè€—æ—¶é—´çš„ï¼Œè¿˜æ²¡æœ‰å•çº¿ç¨‹æ•ˆæœå¥½ã€‚é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œä»€ä¹ˆä¼šå‘ç”Ÿçº¿ç¨‹åˆ‡æ¢å‘¢? å¦‚æœé‡åˆ°ioç­‰å¾…æˆ–è€…sleep æ—¶è‚¯å®šä¼šå‘ç”Ÿåˆ‡æ¢ï¼Œè¿˜æœ‰å°±æ˜¯æ¯100æ¡æŒ‡ä»¤åˆ‡æ¢ä¸€æ¬¡çº¿ç¨‹ã€‚å¯ä»¥é€šè¿‡å¦‚ä¸‹æŒ‡ä»¤è®¾ç½®: sys.setcheckinterval ä¸Šé¢è¿™é‡Œä¾‹å­å°±æ²¡æœ‰è§¦å‘çº¿ç¨‹çš„åˆ‡æ¢ï¼Œå½“å‰é¢çš„çº¿ç¨‹æ‰§è¡Œå®Œé€€å‡ºä¹‹åé‡Šæ”¾GILé”ï¼Œåç»­çš„çº¿ç¨‹æ‰èƒ½æ‰§è¡Œï¼Œæ‰€ä»¥æ‰æœ‰çœ‹èµ·æ¥æ˜¯å¤šçº¿ç¨‹çš„å†™æ³•ï¼Œä½†æ˜¯ç¡®å®å•çº¿ç¨‹çš„æ•ˆæœã€‚ æ”¹è¿›çš„æ–¹æ³•å½“ç„¶ä½¿ç”¨å¤šè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„GILé”ï¼Œå¯ä»¥çœŸæ­£çš„å®ç°å¹¶å‘ã€‚è¿›ç¨‹å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œåˆ›å»ºè¿›ç¨‹å¼€é”€æ¯”çº¿ç¨‹è¦å¤§å¾ˆå¤šï¼Œå¦‚æœè¿›ç¨‹ä¹‹é—´æœ‰æ•°æ®äº¤æ¢ä¹Ÿæ¯”çº¿ç¨‹å¤æ‚ï¼Œå¹¶ä¸”çœŸæ­£æ‰§è¡Œè¿˜æ˜¯è¦è½åˆ°cpuä¸Šå»æ‰§è¡Œï¼Œè¿›ç¨‹å¤šäº†ä¹Ÿä¼šé€ æˆæ’é˜Ÿï¼Œç†è®ºä¸Šå’Œåˆ›å»ºå’Œcpuç›¸åŒä¸ªæ•°çš„è¿›ç¨‹æ€§èƒ½æœ€å¥½ã€‚ä¸‹é¢çœ‹çœ‹å¤šè¿›ç¨‹çš„å†™æ³•ã€‚ import os from multiprocessing import Process â€‹ def runnner(hostip) : appIds = [ \"app-{}\".format(i) for i in range(10)] cmd = \"docker restart {}\".format(\" \".join(appIds)) print(cmd) os.system(\"ssh {hostip} {cmd}\".format(hostip=hostip,cmd=cmd)) â€‹ â€‹ hosts = [\"10.0.0.{}\".format(i) for i in range(10)] â€‹ â€‹ for hostip in hosts : process = Process(target=runnner, args=(hostip,)) process.start() å½“ç„¶å¯ä»¥ç”¨è¿›ç¨‹æ± æ§åˆ¶è¿›ç¨‹çš„ä¸ªæ•°ï¼Œå¦‚: import os â€‹ from multiprocessing import Pool â€‹ def runnner(hostip) : appIds = [ \"app-{}\".format(i) for i in range(10)] cmd = \"docker restart {}\".format(\" \".join(appIds)) print(cmd) os.system(\"ssh {hostip} {cmd}\".format(hostip=hostip,cmd=cmd)) â€‹ â€‹ hosts = [\"10.0.0.{}\".format(i) for i in range(10)] â€‹ p = Pool(4) â€‹ for hostip in hosts : p.apply_async(runnner, args=(hostip,)) # å¼‚æ­¥æ‰§è¡Œ p.close() p.join() ","date":"2020-11-16","objectID":"/python/multithread/:4:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","uri":"/python/multithread/"},{"categories":null,"content":"å‚è€ƒ https://docs.python.org/2/library/sys.html#sys.setcheckinterval https://mp.weixin.qq.com/s/nrT8iIe73POFTBpCdfXupA ","date":"2020-11-16","objectID":"/python/multithread/:5:0","tags":["python","å¤šçº¿ç¨‹","å¤šè¿›ç¨‹"],"title":"pythonä¸­çš„å¤šçº¿ç¨‹ä¸å¤šè¿›ç¨‹ï¼ˆä¸€ï¼‰","uri":"/python/multithread/"},{"categories":null,"content":"æŠ•ç¨¿åˆ° servicemesh ç¤¾åŒºçš„æ–‡ç« ","date":"2020-11-10","objectID":"/elk/","tags":["kubernetes","istio"],"title":"istioä¸­çš„ELKå®è·µ","uri":"/elk/"},{"categories":null,"content":"ELK è¿™ç¯‡æ–‡æ¡£æ˜¯ç”±æˆ‘æŠ•ç¨¿çš„äº‘åŸç”Ÿç¤¾åŒºçš„æ–‡ç« ï¼ŒèŠ‚é€‰è‡ª istio-handbookï¼Œå¦‚æœæœ‰å…´è¶£å¯ä»¥å‚è€ƒè¿™æœ¬ä¹¦ã€‚ ELK æŒ‡çš„æ˜¯ç”± Elasticsearch + Logstash + Kibana ç»„æˆçš„æ—¥å¿—é‡‡é›†ã€å­˜å‚¨ã€å±•ç¤ºä¸ºä¸€ä½“çš„æ—¥å¿—è§£å†³æ–¹æ¡ˆï¼Œç®€ç§° â€œELK Stackâ€ã€‚ELK Stack è¿˜åŒ…å« Beatsï¼ˆå¦‚Filebeatã€Metricbeatã€Heartbeatç­‰ï¼‰ã€Kafkaç­‰æˆå‘˜ï¼Œæ˜¯ç›®å‰ä¸»æµçš„ä¸€ç§æ—¥å¿—è§£å†³æ–¹æ¡ˆã€‚ Elasticsearch æ˜¯ä¸ªå¼€æºåˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œæä¾›æœé›†ã€åˆ†æã€å­˜å‚¨æ•°æ®ä¸‰å¤§åŠŸèƒ½ã€‚ Logstash æ˜¯å…è´¹ä¸”å¼€æ”¾çš„æœåŠ¡å™¨ç«¯æ•°æ®å¤„ç†ç®¡é“ï¼Œèƒ½å¤Ÿä»å¤šä¸ªæ¥æºé‡‡é›†æ•°æ®ï¼Œè½¬æ¢æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€åˆ°æ‚¨æœ€å–œæ¬¢çš„â€œå­˜å‚¨åº“â€ä¸­ã€‚Logstash æ¯”è¾ƒè€—èµ„æºï¼Œåœ¨å®è·µä¸­æˆ‘ä»¬ä¸€èˆ¬ç”¨ä½œå®æ—¶è§£æå’Œè½¬æ¢æ•°æ®ã€‚Logstash é‡‡ç”¨å¯æ’æ‹”æ¡†æ¶ï¼Œæ‹¥æœ‰ 200 å¤šä¸ªæ’ä»¶ã€‚æ‚¨å¯ä»¥å°†ä¸åŒçš„è¾“å…¥é€‰æ‹©ã€è¿‡æ»¤å™¨å’Œè¾“å‡ºé€‰æ‹©æ··åˆæ­é…ã€ç²¾å¿ƒå®‰æ’ï¼Œè®©å®ƒä»¬åœ¨ç®¡é“ä¸­å’Œè°åœ°è¿è¡Œã€‚ Kibana æ˜¯ä¸€ä¸ªå¼€æºå’Œå…è´¹çš„å·¥å…·ï¼ŒKibanaå¯ä»¥ä¸º Logstash å’Œ ElasticSearch æä¾›çš„æ—¥å¿—åˆ†æå‹å¥½çš„ Web ç•Œé¢ï¼Œå¯ä»¥å¸®åŠ©æ±‡æ€»ã€åˆ†æå’Œæœç´¢é‡è¦æ•°æ®æ—¥å¿—ã€‚ Kafka æ˜¯ç”± Apache è½¯ä»¶åŸºé‡‘ä¼šå¼€å‘çš„ä¸€ä¸ªå¼€æºæµå¤„ç†å¹³å°ï¼Œç”± Scala å’Œ Java ç¼–å†™ã€‚ç”¨æ¥åšç¼“å†²ï¼Œå½“æ—¥å¿—é‡æ¯”è¾ƒå¤§çš„æ—¶å€™å¯ä»¥ç¼“è§£åç«¯ Elasticsearch çš„å‹åŠ›ã€‚ Beats æ˜¯æ•°æ®é‡‡é›†çš„å¾—åŠ›å·¥å…·ã€‚Beatså®¶æ—æˆå‘˜åŒ…æ‹¬å¦‚ä¸‹ï¼š Filebeatï¼šç”¨äºæ—¥å¿—æ–‡ä»¶é‡‡é›†ï¼Œå†…ç½®äº†å¤šç§æ¨¡å—ï¼ˆApacheã€Cisco ASAã€Microsoft Azureã€NGINXã€MySQL ç­‰ç­‰ï¼‰ã€‚ Metricbeatï¼š ç”¨äºæŒ‡æ ‡é‡‡é›†ã€‚ Packetbeatï¼šç”¨äºç½‘ç»œæ•°æ®é‡‡é›†ã€‚ Winlogbeatï¼šç”¨äºWindows äº‹ä»¶é‡‡é›†ã€‚ Auditbeatï¼šç”¨äºå®¡è®¡æ—¥å¿—é‡‡é›†ã€‚ Heartbeatï¼šç”¨äºè¿è¡Œæ—¶é—´é‡‡é›†ã€‚ å…¶ä¸­ Filebeat è¢«ç»å¸¸ç”¨æ¥æ”¶é›† Node æˆ–è€… Pod ä¸­çš„æ—¥å¿—ã€‚ Beats ç”¨äºæ”¶é›†å®¢æˆ·ç«¯çš„æ—¥å¿—ï¼Œå‘é€ç»™ç¼“å­˜é˜Ÿåˆ—å¦‚Kafkaï¼Œç›®çš„æ˜¯ä¸ºäº†è§£è€¦æ•°æ®æ”¶é›†ä¸è§£æå…¥åº“çš„è¿‡ç¨‹ï¼ŒåŒæ—¶æé«˜äº†å¯æ‰©å±•æ€§ï¼Œä½¿æ—¥å¿—ç³»ç»Ÿæœ‰å³°å€¼å¤„ç†èƒ½åŠ›ï¼Œä¸ä¼šå› ä¸ºçªå‘çš„è®¿é—®å‹åŠ›é€ æˆæ—¥å¿—ç³»ç»Ÿå¥”æºƒã€‚ç¼“å­˜é˜Ÿåˆ—å¯é€‰çš„è¿˜æœ‰ Redisï¼Œç”±äº Redis æ˜¯å†…å­˜å‹ï¼Œå¾ˆå®¹æ˜“å†™æ»¡ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®ç”¨ kafkaã€‚Logstash ä» ç¼“å­˜é˜Ÿåˆ—ä¸­æ¶ˆè´¹æ—¥å¿—è§£æå¤„ç†ä¹‹åå†™åˆ° Elasticsearchï¼Œé€šè¿‡ Kibana å±•ç¤ºç»™æœ€ç»ˆç”¨æˆ·ã€‚ ","date":"2020-11-10","objectID":"/elk/:0:0","tags":["kubernetes","istio"],"title":"istioä¸­çš„ELKå®è·µ","uri":"/elk/"},{"categories":null,"content":"é‡‡é›†æ–¹æ¡ˆ Filebeat æœ‰ä¸¤ç§éƒ¨ç½²æ¨¡å¼ï¼Œä¸€æ˜¯é€šè¿‡ DaemonSet æ–¹å¼éƒ¨ç½²ï¼ŒäºŒæ˜¯é€šè¿‡ Sidecar æ–¹å¼éƒ¨ç½²ï¼ŒFilebeat é‡‡é›†åå‘é€åˆ° Kafka ï¼Œå†ç”± Logstash ä» Kafka ä¸­æ¶ˆè´¹å†™åˆ° Elasticsearchã€‚ ","date":"2020-11-10","objectID":"/elk/:1:0","tags":["kubernetes","istio"],"title":"istioä¸­çš„ELKå®è·µ","uri":"/elk/"},{"categories":null,"content":"DaemonSet æ–¹å¼éƒ¨ç½² å¼€å¯ Envoy çš„è®¿é—®æ—¥å¿—è¾“å‡ºåˆ° stdout ï¼Œä»¥ DaemonSet çš„æ–¹å¼åœ¨æ¯ä¸€å°é›†ç¾¤èŠ‚ç‚¹éƒ¨ç½² Filebeat ï¼Œå¹¶å°†æ—¥å¿—ç›®å½•æŒ‚è½½è‡³ Filebeat Podï¼Œå®ç°å¯¹ Envoy è®¿é—®æ—¥å¿—çš„é‡‡é›†ã€‚ ","date":"2020-11-10","objectID":"/elk/:1:1","tags":["kubernetes","istio"],"title":"istioä¸­çš„ELKå®è·µ","uri":"/elk/"},{"categories":null,"content":"Sidecar æ–¹å¼éƒ¨ç½² Filebeat å’Œ Envoy éƒ¨ç½²åœ¨åŒä¸€ä¸ª Pod å†…ï¼Œå…±äº«æ—¥å¿—æ•°æ®å·ï¼Œ Envoy å†™ï¼ŒFilebeat è¯»ï¼Œå®ç°å¯¹ Envoy è®¿é—®æ—¥å¿—çš„é‡‡é›†ã€‚ ","date":"2020-11-10","objectID":"/elk/:1:2","tags":["kubernetes","istio"],"title":"istioä¸­çš„ELKå®è·µ","uri":"/elk/"},{"categories":null,"content":"éƒ¨ç½² ELK æœ‰äº†ä»¥ä¸Šçš„åŸºç¡€ï¼Œæˆ‘ä»¬å¼€å§‹éƒ¨ç½² ELK Stack ","date":"2020-11-10","objectID":"/elk/:2:0","tags":["kubernetes","istio"],"title":"istioä¸­çš„ELKå®è·µ","uri":"/elk/"},{"categories":null,"content":"éƒ¨ç½² Kafka é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ namespace ç”¨äºéƒ¨ç½² ELK Stackï¼š # Logging Namespace. All below are a part of this namespace. apiVersion: v1 kind: Namespace metadata: name: logging æ¥ä¸‹æ¥ï¼Œéƒ¨ç½² Kafka æœåŠ¡ã€‚ Kafka é€šè¿‡ Zookeeper ç®¡ç†é›†ç¾¤é…ç½®ï¼Œæ‰€ä»¥åœ¨éƒ¨ç½² Kafka éœ€è¦å…ˆéƒ¨ç½² Zookeeperã€‚ Zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ï¼Œå¼€æ”¾æºç çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºåè°ƒæœåŠ¡ã€‚ Kafka ä¸ Zookeeper éƒ½æ˜¯æœ‰çŠ¶æ€æœåŠ¡ï¼Œéƒ¨ç½²æ—¶éœ€è¦é€‰æ‹© StatefulSet ã€‚ éƒ¨ç½² Zookeeper Service apiVersion:v1kind:Servicemetadata:name:zookeeper-clusternamespace:loggingspec:selector:app:zookeeper-clusterports:- name:httpport:2181targetPort:2181type:ClusterIP Zookeeper åœ¨é›†ç¾¤å†…ä½¿ç”¨ï¼Œä¾› Kafka ä½¿ç”¨ï¼Œåˆ›å»ºç±»å‹ä¸º ClusterIP çš„ Service ã€‚ Zookeeper çš„é»˜è®¤ç«¯å£æ˜¯2181ã€‚ éƒ¨ç½² Zookeeper ConfigMap apiVersion:v1kind:ConfigMapmetadata:name:zookeeper-confignamespace:loggingdata:ZOO_CONF_DIR:/confZOO_PORT:\"2181\" Zookeeper é…ç½®æ–‡ä»¶ä¸­çš„ key éƒ½å¯ä»¥ ä»¥ ZOO_ åŠ å¤§å†™çš„æ–¹å¼è®¾ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œä½¿ä¹‹ç”Ÿæ•ˆã€‚ è¿™é‡Œä»…åˆ—ä¸¾éƒ¨åˆ†é…ç½®ã€‚ éƒ¨ç½² Zookeeper StatefulSet apiVersion:apps/v1kind:StatefulSetmetadata:name:zookeepernamespace:loggingspec:serviceName:zookeeper-clusterreplicas:1updateStrategy:type:RollingUpdateselector:matchLabels:app:zookeeper-clustertemplate:metadata:labels:app:zookeeper-clusterannotations:sidecar.istio.io/inject:\"false\"spec:containers:- name:zookeeperresources:requests:cpu:10mmemory:100Milimits:memory:200Miimage:zookeeperimagePullPolicy:IfNotPresentenvFrom:- configMapRef:name:zookeeper-configreadinessProbe:tcpSocket:port:2181initialDelaySeconds:5periodSeconds:10livenessProbe:tcpSocket:port:2181initialDelaySeconds:15periodSeconds:20ports:- containerPort:2181name:zk-client sidecar.istio.io/inject=false æ ‡è¯†æ­¤æœåŠ¡æ— éœ€ sidecar æ³¨å…¥ã€‚ éƒ¨ç½² Kafka Service apiVersion:v1kind:Servicemetadata:name:bootstrap-kafkanamespace:loggingspec:clusterIP:Noneports:- port:9092selector:app:kafka---apiVersion:v1kind:Servicemetadata:name:kafka-clusternamespace:loggingspec:ports:- name:httptargetPort:9092port:9092selector:app:kafkatype:ClusterIP éƒ¨ç½²ä¸¤ä¸ª Service ã€‚ bootstrap-kafka ä¸ºåç»­éƒ¨ç½² Kafka Statefulset ä½¿ç”¨ã€‚ kafka-cluster ä¸º Kafka çš„è®¿é—®å…¥å£ï¼Œåœ¨ç”Ÿäº§ä¸­ä½¿ç”¨å¯ä»¥ç”¨å…¶ä»–çš„ Service ç±»å‹ã€‚ kafka çš„é»˜è®¤ç«¯å£æ˜¯9092 éƒ¨ç½² Kafka ConfigMap apiVersion:v1kind:ConfigMapmetadata:name:kafka-confignamespace:loggingdata:KAFKA_ADVERTISED_LISTENERS:\"PLAINTEXT://kafka-cluster:9092\"KAFKA_LISTENERS:\"PLAINTEXT://0.0.0.0:9092\"KAFKA_ZOOKEEPER_CONNECT:\"zookeeper-cluster:2181\"KAFKA_LOG_RETENTION_HOURS:\"48\"KAFKA_NUM_PARTITIONS:\"30\" Kafka é…ç½®æ–‡ä»¶ï¼ˆserver.propertiesï¼‰ä¸­çš„ key éƒ½å¯ä»¥ ä»¥ KAFKA_ åŠ å¤§å†™çš„æ–¹å¼è®¾ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼Œä½¿ä¹‹ç”Ÿæ•ˆã€‚ KAFKA_ADVERTISED_LISTENERS ä¸º Kafka ç›‘å¬çš„æœåŠ¡åœ°å€ã€‚ KAFKA_ZOOKEEPER_CONNECT ä¸ºå‰é¢éƒ¨ç½²çš„ Zookeeper çš„æœåŠ¡åœ°å€ã€‚ KAFKA_LOG_RETENTION_HOURS ä¸º Kafka æ•°æ®ä¿ç•™çš„æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´å°†ä¼šè¢«æ¸…ç†ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚ KAFKA_NUM_PARTITIONS ä¸ºåˆ›å»º Kafka topic æ—¶çš„é»˜è®¤åˆ†ç‰‡æ•°ï¼Œè®¾ç½®å¤§ä¸€äº›å¯ä»¥å¢åŠ  Kafka çš„ååé‡ã€‚ è¿™é‡Œä»…åˆ—ä¸¾éƒ¨åˆ†é…ç½®ã€‚ éƒ¨ç½² Kafka StatefulSet apiVersion:apps/v1kind:StatefulSetmetadata:name:kafkanamespace:loggingspec:selector:matchLabels:app:kafkaserviceName:bootstrap-kafkareplicas:1template:metadata:labels:app:kafkaannotations:sidecar.istio.io/inject:\"false\"spec:containers:- name:kafka-brokerimage:russellgao/kafka:2.12-2.0.1ports:- name:insidecontainerPort:9092resources:requests:cpu:0.1memory:1024Milimits:memory:3069MireadinessProbe:tcpSocket:port:9092timeoutSeconds:1initialDelaySeconds:5periodSeconds:10livenessProbe:tcpSocket:port:9092timeoutSeconds:1initialDelaySeconds:15periodSeconds:20envFrom:- configMapRef:name:kafka-config kafka å¯¹ç£ç›˜çš„ IO è¦æ±‚è¾ƒé«˜ï¼Œå¯ä»¥é€‰æ‹©å›ºæ€ç¡¬ç›˜æˆ–è€…ç»è¿‡IOä¼˜åŒ–çš„ç£ç›˜ï¼Œå¦åˆ™å¯èƒ½ä¼šæˆä¸ºæ—¥å¿—ç³»ç»Ÿçš„ç“¶é¢ˆã€‚ è¯·æ³¨æ„ï¼Œæœ¬æ¬¡å®è·µæ²¡æœ‰æŠŠæ•°æ®å·æ˜ å°„å‡ºæ¥ï¼Œåœ¨ç”Ÿäº§å®è·µä¸­ä½¿ç”¨ volumeClaimTemplates æ¥ä¸º Pod æä¾›æŒä¹…åŒ–å­˜å‚¨ã€‚resources å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ã€‚ ","date":"2020-11-10","objectID":"/elk/:2:1","tags":["kubernetes","istio"],"title":"istioä¸­çš„ELKå®è·µ","uri":"/elk/"},{"categories":null,"content":"éƒ¨ç½² Logstash Logstash æ˜¯ä¸€ä¸ªæ— çŠ¶æ€æœåŠ¡ï¼Œé€šè¿‡ Deployment è¿›è¡Œéƒ¨ç½²ã€‚ éƒ¨ç½² Logstash ConfigMap apiVersion:v1kind:ConfigMapmetadata:name:logstash-confnamespace:loggingdata:logstash.conf:| input {http{host=\u003e\"0.0.0.0\"# default: 0.0.0.0port =\u003e 8080 # default:8080user=\u003e\"logstash\"password=\u003e\"aoDJ0JVgkfNPjarn\"response_headers=\u003e{\"Content-Type\"=\u003e\"text/plain\"\"Access-Control-Allow-Origin\"=\u003e\"*\"\"Access-Control-Allow-Methods\"=\u003e\"GET, POST, DELETE, PUT\"\"Access-Control-Allow-Headers\"=\u003e\"authorization, content-type\"\"Access-Control-Allow-Credentials\"=\u003etrue}}kafka{topics=\u003e\"istio\"bootstrap_servers=\u003e\"kafka-cluster:9092\"auto_offset_reset=\u003e\"earliest\"group_id=\u003e\"istio_kafka_gr\"consumer_threads=\u003e3codec=\u003e\"json\"}}filter{grok{match=\u003e{\"message\"=\u003e\"(?m)\\[%{TIMESTAMP_ISO8601:timestamp}\\] \"%{NOTSPACE:method}%{NOTSPACE:path}%{NOTSPACE:protocol}\" %{NUMBER:response_code:int} %{NOTSPACE:response_flags} \"%{NOTSPACE:istio_policy_status}\" \"%{NOTSPACE:upstream_transport_failure_reason}\" %{NUMBER:bytes_received:int} %{NUMBER:bytes_sent:int} %{NUMBER:duration:int} %{NUMBER:upstream_service_time:int} \"%{NOTSPACE:x_forwarded_for}\" \"%{NOTSPACE:user_agent}\" \"%{NOTSPACE:request_id}\" \"%{NOTSPACE:authority}\" \"%{NOTSPACE:upstream_host}\" %{NOTSPACE:upstream_cluster} %{NOTSPACE:upstream_local_address} %{NOTSPACE:downstream_local_address} %{NOTSPACE:downstream_remote_address} %{NOTSPACE:requested_server_name} %{NOTSPACE:route_name}\"}remove_field=\u003e[\"message\"]}date{match=\u003e[\"timestamp\",\"yyyy-MM-ddTHH:mm:ss.SSSZ\"]timezone=\u003e\"Asia/Shanghai\"}ruby{code=\u003e\"event.set('[@metadata][index_day]',(event.get('@timestamp').time.localtime + 8*60*60 ).strftime('%Y.%m.%d'))\"}}output{if\"_grokparsefailure\"notin[tags]{elasticsearch{user=\u003e\"elastic\"password=\u003e\"elastic\"hosts=\u003e[\"elasticsearch.com:9200\"]index=\u003e\"istio-%{[@metadata][index_day]}\"}}} Logstash é…ç½®ç”±3éƒ¨åˆ†ç»„æˆï¼š input Logstash input æ”¯æŒéå¸¸å¤šçš„æ•°æ®æºï¼Œå¦‚ Fileã€Elasticsearchã€Beatsã€Redisã€Kafkaã€Httpç­‰ã€‚ Http input ç”¨äºLogstash çš„å¥åº·æ£€æŸ¥ï¼Œä¹Ÿå¯é€šè¿‡ http æ¥å£å°†æ—¥å¿—ç›´æ¥å‘é€åˆ° Logstashï¼Œä¸»è¦ç”¨äºç§»åŠ¨ç«¯çš„åœºæ™¯ã€‚ Kafka input ç”¨äºæ”¶é›†æ—¥å¿—ï¼Œä¸€ä¸ªinputåªèƒ½ä»ä¸€ä¸ª Topic ä¸­è¯»å–æ•°æ®ï¼Œéœ€è¦å’Œåç»­çš„ Filebeat output å¯¹åº”ã€‚ filter Logstash filter æ”¯æŒéå¸¸å¤šçš„æ’ä»¶ï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œè§£æã€åŠ å·¥ã€è½¬æ¢ï¼Œå¦‚ grokã€dateã€rubyã€jsonã€dropç­‰ã€‚ grok ç”¨äºå¯¹æ—¥å¿—è¿›è¡Œè§£æã€‚ date ç”¨äºæŠŠ timestamp è½¬åŒ–æˆ elasticsearch ä¸­çš„ @timestamp å­—æ®µï¼Œå¯ä»¥æŒ‡å®šæ—¶åŒºã€‚ ruby æ’ä»¶æ”¯æŒæ‰§è¡Œ ruby ä»£ç ï¼Œå¯ä»¥è¿›è¡Œå¤æ‚é€»è¾‘çš„å¤„ç†ï¼Œæ­¤å¤„çš„ç”¨æ³•æ˜¯ @timestamp å­—æ®µçš„æ—¶é—´åŠ 8å°æ—¶ï¼Œè§£å†³è‡ªåŠ¨ç”Ÿæˆçš„ç´¢å¼•æ—¶å·®é—®é¢˜ã€‚ output Logstash output æ”¯æŒéå¸¸å¤šçš„æ•°æ®æºï¼Œå¦‚ elasticsearchã€cvsã€jdbc ç­‰ã€‚ æ­¤å¤„æ˜¯æŠŠ grok è§£ææˆåŠŸçš„æ—¥å¿—å†™åˆ° elasticsearch ã€‚ éƒ¨ç½² Logstash Deployment apiVersion:apps/v1beta2kind:Deploymentmetadata:name:logstashnamespace:loggingspec:replicas:2selector:matchLabels:app:logstashtemplate:metadata:labels:app:logstashannotations:sidecar.istio.io/inject:\"false\"spec:volumes:- name:configconfigMap:name:logstash-confhostname:logstashcontainers:- name:logstashimage:logstash:7.2.0args:[\"-f\",\"/usr/share/logstash/pipeline/logstash.conf\",]imagePullPolicy:IfNotPresentvolumeMounts:- name:configmountPath:\"/usr/share/logstash/pipeline/logstash.conf\"readOnly:truesubPath:logstash.confresources:requests:cpu:0.5memory:1024Milimits:cpu:1.5memory:3072MireadinessProbe:tcpSocket:port:8080initialDelaySeconds:5periodSeconds:10livenessProbe:tcpSocket:port:8080initialDelaySeconds:15periodSeconds:20 Logstash ä¸éœ€è¦å¯¹å¤–å‘å¸ƒæœåŠ¡ï¼Œå³ä¸éœ€è¦åˆ›å»º Serviceï¼Œä» Kafka ä¸­æ¶ˆè´¹æ—¥å¿—ï¼Œå¤„ç†å®Œæˆä¹‹åå†™åˆ° Elasticsearch ã€‚ Logstash åªéœ€è¦æŠŠé…ç½®æ–‡ä»¶æŒ‚è½½è¿›å»ï¼Œæ— éœ€æŒ‚è½½å…¶ä»–ç›®å½•ï¼Œæ’æŸ¥é”™è¯¯æ—¶å¯é€šè¿‡ Logstash Console Log è¿›è¡ŒæŸ¥çœ‹ã€‚ éƒ¨ç½² Logstash HorizontalPodAutoscaler apiVersion:autoscaling/v2beta1kind:HorizontalPodAutoscalermetadata:name:logstashnamespace:loggingspec:scaleTargetRef:apiVersion:apps/v1beta2kind:Deploymentname:logstashminReplicas:2maxReplicas:10metrics:- type:Resourceresource:name:cputargetAverageUtilization:80 Logstash æ¯”è¾ƒæ¶ˆè´¹ CPU ï¼Œå¯ä»¥éƒ¨ç½² HPAï¼Œå¯ä»¥æ ¹æ®æ—¥å¿—é‡åŠ¨æ€çš„æ‰©æ‰€å®¹ã€‚ Logstash çš„å‹åŠ›å¯¹ CPU æ¯”è¾ƒæ•æ„Ÿï¼Œå¯ä»¥åªæ ¹æ® CPU è¿™ä¸€ä¸ªæŒ‡æ ‡è¿›è¡Œ HPAã€‚ Logstash çš„é…ç½®æ–‡ä»¶æ”¯æŒif/elseæ¡ä»¶åˆ¤æ–­ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸€ä¸ª Logstash é›†ç¾¤å¯ä»¥æ”¯æŒæ¯”è¾ƒå¤šçš„æ—¥å¿—æ ¼å¼ã€‚å¦å¤– Logstash çš„ grok è¯­æ³•ç›¸å¯¹å¤æ‚ï¼Œå¯ä»¥ä½¿ç”¨ Kibana Dev Tools å·¥å…·è¿›è¡Œè°ƒè¯•ï¼Œå¦‚ä¸‹å›¾ï¼š ","date":"2020-11-10","objectID":"/elk/:2:2","tags":["kubernetes","istio"],"title":"istioä¸­çš„ELKå®è·µ","uri":"/elk/"},{"categories":null,"content":"éƒ¨ç½² Filebeat è¿™é‡Œä»…ç»™å‡º Filebeat DaemonSet çš„éƒ¨ç½²è¿‡ç¨‹ã€‚ éƒ¨ç½² Filebeat ConfigMap apiVersion:v1kind:ConfigMapmetadata:name:filebeat-confnamespace:loggingdata:filebeat.yml:| filebeat:inputs:- paths:- /var/log- /var/lib/docker/containersignore_older:1hforce_close_files:true#å¼ºåˆ¶filebeatåœ¨æ–‡ä»¶åæ”¹å˜æ—¶ï¼Œå…³é—­æ–‡ä»¶ï¼Œä¼šæœ‰ä¸¢å¤±æ—¥å¿—çš„é£é™©close_older:1mfields_under_root:trueoutput:kafka:enabled:truehosts:[\"kafka-cluster:9092\"]topic:\"istio\"version:\"2.0.0\"partition.round_robin:reachable_only:falseworker:2max_retries:3bulk_max_size:2048timeout:30sbroker_timeout:10schannel_buffer_size:256keep_alive:60compression:gzipmax_message_bytes:1000000required_acks:1 input.paths ä»£è¡¨ Filebeat ç›‘å¬çš„æ—¥å¿—è·¯å¾„ã€‚ input.ignore_older ä»£è¡¨æ—¥å¿—æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´è¶…è¿‡è¿™ä¸ªä¹‹é—´ï¼Œå°†ä¼šå¿½ç•¥ï¼Œè¿™ä¸ªåœ¨ Filebeat é‡å¯æ—¶å¾ˆæœ‰æ•ˆæœï¼Œè§£å†³é‡å¤è¯»å–æ—¥å¿—çš„é—®é¢˜ã€‚ out.kafka.hosts å’Œä¹‹å‰éƒ¨ç½²çš„ Kafka Service å¯¹åº”ã€‚ out.kafka.topic å’Œä¹‹å‰éƒ¨ç½²çš„ Logstash ConfigMap ä¸­çš„ input å¯¹åº”ã€‚ éƒ¨ç½² Filebeat DaemonSet apiVersion:apps/v1kind:DaemonSetmetadata:name:filebeatnamespace:logginglabels:app:filebeatspec:selector:matchLabels:app:filebeattemplate:metadata:labels:app:filebeatannotations:sidecar.istio.io/inject:\"false\"spec:containers:- name:filebeatimage:elastic/filebeat:7.2.0imagePullPolicy:IfNotPresentvolumeMounts:- name:configmountPath:\"/usr/share/filebeat/filebeat.yml\"readOnly:truesubPath:filebeat.yml- name:varlogmountPath:/var/log- name:varlibdockercontainersmountPath:/var/lib/docker/containersresources:requests:cpu:0.1memory:200Milimits:cpu:0.3memory:600Mivolumes:- name:varloghostPath:path:/var/log- name:varlibdockercontainershostPath:path:/var/lib/docker/containers- name:configconfigMap:name:filebeat-conf è¿™é‡Œå£°æ˜äº†ä¸¤ä¸ª hostPath ç±»å‹çš„æ•°æ®å·ï¼Œè·¯å¾„ä¸ºæ—¥å¿—å­˜å‚¨çš„è·¯å¾„ã€‚ å°†å®¿ä¸»æœºçš„ /var/log å’Œ /var/lib/docker/containers æŒ‚è½½åˆ°äº† Filebeat Pod å†…ä¾¿äº Filebeat æ”¶é›†æ—¥å¿—ã€‚ Filebeat ä¸éœ€è¦éƒ¨ç½² Service ã€‚ Filebeat å¯¹èµ„æºæ¶ˆè€—æ¯”è¾ƒå°‘ï¼Œå¯å¿½ç•¥å¯¹ Node çš„èµ„æºæ¶ˆè€—ã€‚ ","date":"2020-11-10","objectID":"/elk/:2:3","tags":["kubernetes","istio"],"title":"istioä¸­çš„ELKå®è·µ","uri":"/elk/"},{"categories":null,"content":"å°ç»“ æœ¬èŠ‚ä¸ºå¤§å®¶ä»‹ç»äº† ELK çš„åŸç†å’Œå®‰è£…éƒ¨ç½²ï¼Œä»¥åŠå¦‚ä½•æ”¶é›†æ—¥å¿—ã€‚ ","date":"2020-11-10","objectID":"/elk/:3:0","tags":["kubernetes","istio"],"title":"istioä¸­çš„ELKå®è·µ","uri":"/elk/"},{"categories":null,"content":"å‚è€ƒ Beats Logstash Zookeeper ","date":"2020-11-10","objectID":"/elk/:4:0","tags":["kubernetes","istio"],"title":"istioä¸­çš„ELKå®è·µ","uri":"/elk/"},{"categories":null,"content":"Hugo, the world's fastest framework for building websites","date":"2020-11-08","objectID":"/about/","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":null,"content":"ç®€ä»‹ é«˜ç»´å®—ï¼ˆrussellgaoï¼‰ï¼Œç°å°±èŒäºä¸Šæµ·æµ·é¼ä¿¡æ¯å·¥ç¨‹è‚¡ä»½æœ‰é™å…¬å¸ï¼Œæ‹…ä»»è¿ç»´å¼€å‘ç»ç†ã€‚ ","date":"2020-11-08","objectID":"/about/:1:0","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":null,"content":"å…³æ³¨é¢†åŸŸ ä¸“æ³¨äºdevopsï¼Œaiopsï¼Œgolongï¼Œpythonï¼Œkubernetesï¼Œservicemeshï¼Œäº‘åŸç”Ÿï¼Œç®—æ³•ç­‰é¢†åŸŸï¼Œçƒ­è¡·äºå‚ä¸å¼€æºè½¯ä»¶å’Œå¼€æºç¤¾åŒºã€‚ ","date":"2020-11-08","objectID":"/about/:2:0","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":null,"content":"ä¸ªäººå…¬ä¼—å· ","date":"2020-11-08","objectID":"/about/:3:0","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":null,"content":"æŠ•ç¨¿ å¦‚æœæœ‰å¥½çš„æ–‡ç« éœ€è¦åˆ†äº«ä¹Ÿå¯ä»¥æŠ•ç¨¿ç»™ä½œè€…å“Ÿï¼ ","date":"2020-11-08","objectID":"/about/:4:0","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":null,"content":"æŠ•ç¨¿æŒ‡å— æ–‡ç« é¡»ä¸ºåŸåˆ›çš„æŠ€æœ¯æ–‡ç«  é¡»åŒ…å«ä½œè€…çš„å§“åï¼Œå…¬å¸å¤´è¡”å’Œç®€è¦ä»‹ç» é¡»é€šè¿‡åœ¨ github æäº¤ PR çš„æ–¹å¼æä¾› ","date":"2020-11-08","objectID":"/about/:4:1","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":null,"content":"åŸåˆ›ç”³æ˜ æœ¬åšå®¢ä¸Šçš„æ‰€æœ‰æ–‡æ¡£å‡ä¸ºåŸåˆ›ï¼Œåœ¨å†™å…¥è¿‡ç¨‹ä¸­ä¸å…å‚è€ƒå…¶ä»–äººä¼˜ç§€çš„æ–‡ç« ï¼Œä¸€èˆ¬éƒ½ä¼šåœ¨æ–‡æœ«ç”³æ˜å‚è€ƒçš„æ–‡ç« ï¼Œå¦‚æœ‰ä¾µçŠ¯åˆ°æ‚¨çš„æƒç›Šè¯·è”ç³»ä½œè€…ç¬¬ä¸€æ—¶é—´ä¿®æ”¹ã€‚ ","date":"2020-11-08","objectID":"/about/:5:0","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":null,"content":"è½¬è½½è¯´æ˜ å¦‚éœ€è½¬è½½ï¼Œè¯·åŠ æ³¨åŸæ–‡å‡ºå¤„ã€‚ ","date":"2020-11-08","objectID":"/about/:6:0","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":null,"content":"éšç¬”è®°å½• https://github.com/russellgao/blog https://github.com/russellgao/blogs https://github.com/russellgao/algorithm ","date":"2020-11-08","objectID":"/about/:7:0","tags":null,"title":"å…³äºæˆ‘","uri":"/about/"},{"categories":null,"content":"Hugo, the world's fastest framework for building websites","date":"2020-11-08","objectID":"/golang/defer/","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/golang/defer/"},{"categories":null,"content":"èƒŒæ™¯ åœ¨å­¦ä¹ å’Œä½¿ç”¨ Go çš„è¿‡ç¨‹ä¸­å‘ç°ï¼ŒGo åœ¨è¯­è¨€å±‚é¢çš„è®¾è®¡æœ‰å¾ˆå¤šæœ‰è¶£çš„åœ°æ–¹ï¼Œæ‰€ä»¥å‡†å¤‡ç”¨ä¸€ä¸ªç³»åˆ—æ¥ç»†æ•°è¿™äº›æœ‰è¶£çš„åœ°æ–¹ã€‚å†™è¿™ä¸ªç³»åˆ—ä¸€æ˜¯ä¸ºäº†åŠ æ·±è‡ªå·±çš„ç†è§£ï¼ŒäºŒæ˜¯æ„¿æ„åˆ†äº«ï¼Œåˆ†äº« Go ä¸­æœ‰è¶£çš„è®¾è®¡ç»†èŠ‚ã€‚æ¯ç¯‡éƒ½ä¼šé€šè¿‡ä¸€ä¸ªä¾‹å­è®²è¿°ä¸€ä¸ªç»†èŠ‚ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥å…³æ³¨ä¸€ä¸‹å“Ÿï¼ ","date":"2020-11-08","objectID":"/golang/defer/:1:0","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/golang/defer/"},{"categories":null,"content":"Go ä»‹ç» Goï¼ˆåˆç§° Golangï¼‰æ˜¯ Google çš„ Robert Griesemerï¼ŒRob Pike åŠ Ken Thompson å¼€å‘çš„ä¸€ç§é™æ€å¼ºç±»å‹ã€ç¼–è¯‘å‹è¯­è¨€ã€‚Go è¯­è¨€è¯­æ³•ä¸ C ç›¸è¿‘ï¼Œä½†åŠŸèƒ½ä¸Šæœ‰ï¼šå†…å­˜å®‰å…¨ï¼ŒGCï¼ˆåƒåœ¾å›æ”¶ï¼‰ï¼Œç»“æ„å½¢æ€åŠ CSP-style å¹¶å‘è®¡ç®—ã€‚ Go æ˜¯ç”±è¿™3ä½å¤§ä½¬ä»2007å¹´9æœˆå¼€å§‹è®¾è®¡Goï¼Œ2009å¹´æ­£å¼æ¨å‡ºï¼Œåˆ°ç›®å‰ä¸ºæ­¢å·²ç»å‘äº†15ä¸ªå¤§ç‰ˆæœ¬ï¼Œæœ€æ–°ç‰ˆä¸º1.15.4ã€‚Go ç°åœ¨å¹¿æ³›åº”ç”¨äºäº‘åŸç”Ÿã€ä¸­é—´ä»¶ã€è¿˜æœ‰å„ä¸ªä¸šåŠ¡å¹³å°ï¼Œå¦‚ dockerã€kubernetesã€etcdç­‰éƒ½æ˜¯Goè¯­è¨€ç¼–å†™ã€‚æ‰€ä»¥è¿˜æ˜¯å¾ˆæœ‰å¿…è¦äº†è§£ä¸€ä¸‹å“Ÿï¼ ä¸‹é¢ç®€å•è¯´è¯´Goçš„ä¼˜ç¼ºç‚¹ï¼Œä¿—è¯è¯´ï¼šä¸€ä¸‡ä¸ªäººçœ¼ä¸­æœ‰ä¸€ä¸‡ä¸ªå“ˆå§†é›·ç‰¹ï¼Œæ‰€ä»¥ä¼˜ç¼ºç‚¹éƒ½æ˜¯ç›¸å¯¹è€Œè¨€ï¼Œå°±è°ˆè°ˆè‡ªå·±ä½¿ç”¨è¿‡ç¨‹ä¸­çš„æ„Ÿå—ï¼Œå…·ä½“çš„ä¼˜ç¼ºç‚¹ä¼šåœ¨åé¢çš„ç³»åˆ—æ–‡ç« ä¸­ä¸€ä¸€æåˆ°ï¼Œè¿™é‡Œæ˜¯æŠ›ç –å¼•ç‰ã€‚ ","date":"2020-11-08","objectID":"/golang/defer/:2:0","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/golang/defer/"},{"categories":null,"content":"Go ä¼˜ç‚¹ è¯­è¨€å±‚é¢æ”¯æŒå¹¶å‘ï¼šä¸€ä¸ª go å…³é”®å­—å³å¯å®ç°å¹¶å‘ï¼Œå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¾èµ–äºåº“å®ç°å¹¶å‘ï¼Œè¿™æ˜¯æœ‰æœ¬è´¨çš„åŒºåˆ« é«˜æ€§èƒ½ ç¼–è¯‘å®Œä¹‹åç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯å…å»ç¯å¢ƒä¾èµ– defer æœºåˆ¶ å†…ç½®runtime å†…åµŒCæ”¯æŒï¼ŒGoé‡Œé¢ä¹Ÿå¯ä»¥ç›´æ¥åŒ…å«Cä»£ç ï¼Œåˆ©ç”¨ç°æœ‰çš„ä¸°å¯Œçš„Cåº“ è·¨å¹³å°ç¼–è¯‘ ã€‚ã€‚ã€‚ ","date":"2020-11-08","objectID":"/golang/defer/:3:0","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/golang/defer/"},{"categories":null,"content":"Go ç¼ºç‚¹ åŒ…ç®¡ç† ã€‚ã€‚ã€‚ ","date":"2020-11-08","objectID":"/golang/defer/:4:0","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/golang/defer/"},{"categories":null,"content":"defer è¯´èµ· Go è¯­è¨€çš„æœ€å¼ºå¤§çš„åœ°æ–¹ï¼Œä¸å¾—ä¸è¯´ Go çš„å¹¶å‘æœºåˆ¶å’Œè°ƒåº¦åŸç†ï¼Œä½†æ˜¯ä»Šå¤©ä¸è®²è¿™äº›é«˜æ·±çš„ç†è®ºï¼Œå…ˆä»ç®€å•çš„å¼€å§‹ã€‚å…ˆæ€è€ƒè¿™ä¹ˆå‡ ä¸ªé—®é¢˜ï¼ˆå¯ä»¥ç”¨è‡ªå·±ç†Ÿæ‚‰çš„è¯­è¨€æ€è€ƒå¦‚ä½•è§£å†³ï¼‰: å¯¹äºæ–‡ä»¶çš„æ‰“å¼€å…³é—­ï¼Œç½‘ç»œè¿æ¥çš„å»ºç«‹æ–­å¼€åœºæ™¯ï¼Œå½“æ‰“å¼€æ—¶å€™åº”è¯¥ä½•æ—¶å…³é—­? å½“è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¸Œæœ›åœ¨å‡½æ•°è¿”å›æ—¶ä¿®æ”¹å®ƒçš„å€¼ï¼Œè¯¥å¦‚ä½•è§£å†³? å…ˆçœ‹çœ‹defer çš„å®˜æ–¹å®šä¹‰ ï¼š A â€œdeferâ€ statement invokes a function whose execution is deferred to the moment the surrounding function returns, either because the surrounding function executed a return statement, reached the end of its function body, or because the corresponding goroutine is panicking. æ„æ€æ˜¯è¯´ï¼Œå½“åŒ…è£¹defer çš„å‡½æ•°è¿”å›æ—¶æˆ–è€…åŒ…è£¹deferçš„å‡½æ•°æ‰§è¡Œåˆ°æœ«å°¾æ—¶æˆ–è€…æ‰€åœ¨çš„goroutineå‘ç”Ÿpanicæ—¶æ‰ä¼šæ‰§è¡Œã€‚ æ¢å¥è¯è¯´å°±æ˜¯å½“å‡½æ•°æ‰§è¡Œå®Œä¹‹åæˆ–è€…å‘ç”Ÿå¼‚å¸¸æ—¶å†æ‰§è¡Œdeferè¯­å¥ï¼Œå°±æ˜¯è¯´åœ¨è¢«è°ƒå‡½æ•°è¿”å›ä¹‹åï¼Œèµ‹å€¼ç»™è°ƒç”¨å‡½æ•°ä¹‹å‰ï¼Œè¿˜æœ‰æœºä¼šæ‰§è¡Œå…¶ä»–æŒ‡ä»¤ï¼Œæ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ã€‚å…ˆçœ‹ä¸€æ®µpython ä»£ç  : def f(x,y) : z = x / y z += 1 return z â€‹ if __name__ == \"__main__\" : result = f(4 /2) å½“è°ƒç”¨å‡½æ•°fï¼Œfè¿”å›ç»™zå¹¶ä¸”èµ‹å€¼ç»™resultï¼Œåœ¨è¿™æ—¶é—´ï¼Œæ˜¯æ²¡æœ‰ä»»ä½•æœºä¼šæ‰§è¡Œå…¶ä»–çš„å‡½æ•°ä»£ç çš„ã€‚å†çœ‹ä¸€æ®µgoä»£ç : package main func main() { result := f(4, 2) fmt.Println(result) } â€‹ func f(x, y int) (r int) { r = x / y r += 1 defer func() { r += 2 }() return } å½“è°ƒç”¨å‡½æ•°fï¼Œfè¿”å›ä¹‹åï¼Œåœ¨èµ‹å€¼ä¹‹å‰æ‰§è¡Œäº†r +=2 ã€‚ç°åœ¨å›æƒ³ä¸€ä¸‹ä¹‹å‰çš„ä¸¤ä¸ªé—®é¢˜ï¼Œå¦‚æœæœ‰defer æœºåˆ¶ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥å¾ˆå¥½çš„è§£å†³ã€‚å¦‚å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨defer è¯­å¥ä¸­å¤„ç†æ–‡ä»¶çš„å…³é—­ï¼Œè¿æ¥çš„é‡Šæ”¾ç­‰ï¼Œè€Œä¸ç”¨è€ƒè™‘ä¸€äº›å¼‚å¸¸æƒ…å†µã€‚ é‚£deferçš„å®ç°åŸç†æ˜¯æ€æ ·çš„å‘¢? defer å…¶å®æ˜¯è°ƒç”¨runtime.deferproc è¿›è¡Œå®ç°ï¼Œåœ¨defer å‡ºç°çš„åœ°æ–¹ï¼Œæ’å…¥äº†call runtime.deferprocï¼Œç„¶ååœ¨å‡½æ•°è¿”å›ä¹‹å‰çš„åœ°æ–¹ï¼Œæ’å…¥æŒ‡ä»¤call runtime.deferreturnã€‚ æ™®é€šå‡½æ•°è¿”å›æ—¶ï¼Œæ±‡ç¼–ä»£ç ç±»ä¼¼äº: add xx SP return å¦‚æœåŒ…å«äº†defer è¯­å¥ï¼Œæ±‡ç¼–ä»£ç ç±»ä¼¼äº: call runtime.deferreturnï¼Œ add xx SP return goroutineçš„æ§åˆ¶ç»“æ„ä¸­ï¼Œæœ‰ä¸€å¼ è¡¨è®°å½•deferï¼Œè°ƒç”¨runtime.deferprocæ—¶ä¼šå°†éœ€è¦deferçš„è¡¨è¾¾å¼è®°å½•åœ¨è¡¨ä¸­ï¼Œè€Œåœ¨è°ƒç”¨runtime.deferreturnçš„æ—¶å€™ï¼Œåˆ™ä¼šä¾æ¬¡ä»deferè¡¨ä¸­å‡ºæ ˆå¹¶æ‰§è¡Œã€‚ defer åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¹Ÿå­˜åœ¨ä¸€äº›å‘ï¼Œçœ‹å‡ ä¸ªä¾‹å­: ä¾‹1: func f() (result int) { defer func() { result++ }() return 10 } ä¾‹2: func f() (result int) { t := 10 defer func() { t = t + 1 }() return t } ä¾‹3: func f() (result int) { defer func(result int) { result = result + 1 }(result) return 10 } å¤§å®¶å¯ä»¥å…ˆå¿ƒé‡Œé»˜é»˜ç®—ä¸€ä¸‹ä»–ä»¬çš„ç»“æœ ç¬¬ä¸€ä¸ªæ˜¯11ï¼Œç¬¬äºŒä¸ªæ˜¯10ï¼Œç¬¬ä¸‰ä¸ªæ˜¯10ã€‚ deferè¡¨è¾¾å¼å¯èƒ½ä¼šåœ¨è®¾ç½®å‡½æ•°è¿”å›å€¼ä¹‹åï¼Œåœ¨è¿”å›åˆ°è°ƒç”¨å‡½æ•°ä¹‹å‰ï¼Œä¿®æ”¹è¿”å›å€¼ï¼Œä½¿æœ€ç»ˆçš„å‡½æ•°è¿”å›å€¼ä¸ä½ æƒ³è±¡çš„ä¸ä¸€è‡´ã€‚å…¶å®ä½¿ç”¨deferæ—¶ï¼Œç”¨ä¸€ä¸ªç®€å•çš„è½¬æ¢è§„åˆ™æ”¹å†™ä¸€ä¸‹ï¼Œå°±ä¸ä¼šè¿·ç³Šäº†ã€‚æ”¹å†™è§„åˆ™æ˜¯å°†returnè¯­å¥æ‹†æˆä¸¤å¥å†™ï¼Œreturn xxxä¼šè¢«æ”¹å†™æˆ: è¿”å›å€¼ = xxx è°ƒç”¨deferå‡½æ•° ç©ºçš„return ä¾‹1 ä¼šè¢«æ”¹å†™æˆ: func f() (result int) { result = 10 // returnè¯­å¥ä¸æ˜¯ä¸€æ¡åŸå­è°ƒç”¨ï¼Œreturn xxxå…¶å®æ˜¯èµ‹å€¼ï¼‹retæŒ‡ä»¤ defer func() { result++ }() return // ç©ºçš„returnæŒ‡ä»¤ } æ‰€ä»¥è¿”å›å€¼æ˜¯11 ä¾‹2 ä¼šè¢«æ”¹å†™æˆ: func f() (result int) { t := 10 result = t // èµ‹å€¼æŒ‡ä»¤ defer func() { t = t + 1 //deferè¢«æ’å…¥åˆ°èµ‹å€¼ä¸è¿”å›ä¹‹é—´æ‰§è¡Œï¼Œè¿™ä¸ªä¾‹å­ä¸­è¿”å›å€¼ resultæ²¡è¢«ä¿®æ”¹è¿‡ }() return // ç©ºçš„returnæŒ‡ä»¤ } æ‰€ä»¥è¿”å›å€¼æ˜¯10 ä¾‹3 å°±ç•™ç»™å¤§å®¶è‡ªå·±æ”¹å†™ä¸€ä¸‹å•¦ï¼Œæœ‰å…´è¶£å¯ä»¥ç§æˆ‘æ²Ÿé€šå“Ÿï¼ ","date":"2020-11-08","objectID":"/golang/defer/:5:0","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/golang/defer/"},{"categories":null,"content":"æ€»ç»“ è¿™ç¯‡ä¸»è¦åšäº†å¯¹Goè¯­è¨€çš„ä»‹ç»å’Œä¼˜ç¼ºç‚¹ï¼Œåˆ†æäº†defer çš„ç”¨æ³•ä»¥åŠå®ç°åŸç†ï¼Œæœ€åç”¨ä¾‹å­å±•ç¤ºäº†ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå­˜åœ¨çš„å‘ã€‚ä¸‹ç¯‡é¢„å‘Š: Go çš„è°ƒåº¦æ¨¡å‹ï¼Œæ¬¢è¿å…³æ³¨!!! å¦‚æœæœ‰ç†è§£ä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡å‡ºã€‚ ","date":"2020-11-08","objectID":"/golang/defer/:6:0","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/golang/defer/"},{"categories":null,"content":"Hugo, the world's fastest framework for building websites","date":"2020-11-08","objectID":"/defer/","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/defer/"},{"categories":null,"content":"èƒŒæ™¯ åœ¨å­¦ä¹ å’Œä½¿ç”¨ Go çš„è¿‡ç¨‹ä¸­å‘ç°ï¼ŒGo åœ¨è¯­è¨€å±‚é¢çš„è®¾è®¡æœ‰å¾ˆå¤šæœ‰è¶£çš„åœ°æ–¹ï¼Œæ‰€ä»¥å‡†å¤‡ç”¨ä¸€ä¸ªç³»åˆ—æ¥ç»†æ•°è¿™äº›æœ‰è¶£çš„åœ°æ–¹ã€‚å†™è¿™ä¸ªç³»åˆ—ä¸€æ˜¯ä¸ºäº†åŠ æ·±è‡ªå·±çš„ç†è§£ï¼ŒäºŒæ˜¯æ„¿æ„åˆ†äº«ï¼Œåˆ†äº« Go ä¸­æœ‰è¶£çš„è®¾è®¡ç»†èŠ‚ã€‚æ¯ç¯‡éƒ½ä¼šé€šè¿‡ä¸€ä¸ªä¾‹å­è®²è¿°ä¸€ä¸ªç»†èŠ‚ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥å…³æ³¨ä¸€ä¸‹å“Ÿï¼ ","date":"2020-11-08","objectID":"/defer/:1:0","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/defer/"},{"categories":null,"content":"Go ä»‹ç» Goï¼ˆåˆç§° Golangï¼‰æ˜¯ Google çš„ Robert Griesemerï¼ŒRob Pike åŠ Ken Thompson å¼€å‘çš„ä¸€ç§é™æ€å¼ºç±»å‹ã€ç¼–è¯‘å‹è¯­è¨€ã€‚Go è¯­è¨€è¯­æ³•ä¸ C ç›¸è¿‘ï¼Œä½†åŠŸèƒ½ä¸Šæœ‰ï¼šå†…å­˜å®‰å…¨ï¼ŒGCï¼ˆåƒåœ¾å›æ”¶ï¼‰ï¼Œç»“æ„å½¢æ€åŠ CSP-style å¹¶å‘è®¡ç®—ã€‚ Go æ˜¯ç”±è¿™3ä½å¤§ä½¬ä»2007å¹´9æœˆå¼€å§‹è®¾è®¡Goï¼Œ2009å¹´æ­£å¼æ¨å‡ºï¼Œåˆ°ç›®å‰ä¸ºæ­¢å·²ç»å‘äº†15ä¸ªå¤§ç‰ˆæœ¬ï¼Œæœ€æ–°ç‰ˆä¸º1.15.4ã€‚Go ç°åœ¨å¹¿æ³›åº”ç”¨äºäº‘åŸç”Ÿã€ä¸­é—´ä»¶ã€è¿˜æœ‰å„ä¸ªä¸šåŠ¡å¹³å°ï¼Œå¦‚ dockerã€kubernetesã€etcdç­‰éƒ½æ˜¯Goè¯­è¨€ç¼–å†™ã€‚æ‰€ä»¥è¿˜æ˜¯å¾ˆæœ‰å¿…è¦äº†è§£ä¸€ä¸‹å“Ÿï¼ ä¸‹é¢ç®€å•è¯´è¯´Goçš„ä¼˜ç¼ºç‚¹ï¼Œä¿—è¯è¯´ï¼šä¸€ä¸‡ä¸ªäººçœ¼ä¸­æœ‰ä¸€ä¸‡ä¸ªå“ˆå§†é›·ç‰¹ï¼Œæ‰€ä»¥ä¼˜ç¼ºç‚¹éƒ½æ˜¯ç›¸å¯¹è€Œè¨€ï¼Œå°±è°ˆè°ˆè‡ªå·±ä½¿ç”¨è¿‡ç¨‹ä¸­çš„æ„Ÿå—ï¼Œå…·ä½“çš„ä¼˜ç¼ºç‚¹ä¼šåœ¨åé¢çš„ç³»åˆ—æ–‡ç« ä¸­ä¸€ä¸€æåˆ°ï¼Œè¿™é‡Œæ˜¯æŠ›ç –å¼•ç‰ã€‚ ","date":"2020-11-08","objectID":"/defer/:2:0","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/defer/"},{"categories":null,"content":"Go ä¼˜ç‚¹ è¯­è¨€å±‚é¢æ”¯æŒå¹¶å‘ï¼šä¸€ä¸ª go å…³é”®å­—å³å¯å®ç°å¹¶å‘ï¼Œå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¾èµ–äºåº“å®ç°å¹¶å‘ï¼Œè¿™æ˜¯æœ‰æœ¬è´¨çš„åŒºåˆ« é«˜æ€§èƒ½ ç¼–è¯‘å®Œä¹‹åç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯å…å»ç¯å¢ƒä¾èµ– defer æœºåˆ¶ å†…ç½®runtime å†…åµŒCæ”¯æŒï¼ŒGoé‡Œé¢ä¹Ÿå¯ä»¥ç›´æ¥åŒ…å«Cä»£ç ï¼Œåˆ©ç”¨ç°æœ‰çš„ä¸°å¯Œçš„Cåº“ è·¨å¹³å°ç¼–è¯‘ ã€‚ã€‚ã€‚ ","date":"2020-11-08","objectID":"/defer/:3:0","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/defer/"},{"categories":null,"content":"Go ç¼ºç‚¹ åŒ…ç®¡ç† ã€‚ã€‚ã€‚ ","date":"2020-11-08","objectID":"/defer/:4:0","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/defer/"},{"categories":null,"content":"defer è¯´èµ· Go è¯­è¨€çš„æœ€å¼ºå¤§çš„åœ°æ–¹ï¼Œä¸å¾—ä¸è¯´ Go çš„å¹¶å‘æœºåˆ¶å’Œè°ƒåº¦åŸç†ï¼Œä½†æ˜¯ä»Šå¤©ä¸è®²è¿™äº›é«˜æ·±çš„ç†è®ºï¼Œå…ˆä»ç®€å•çš„å¼€å§‹ã€‚å…ˆæ€è€ƒè¿™ä¹ˆå‡ ä¸ªé—®é¢˜ï¼ˆå¯ä»¥ç”¨è‡ªå·±ç†Ÿæ‚‰çš„è¯­è¨€æ€è€ƒå¦‚ä½•è§£å†³ï¼‰: å¯¹äºæ–‡ä»¶çš„æ‰“å¼€å…³é—­ï¼Œç½‘ç»œè¿æ¥çš„å»ºç«‹æ–­å¼€åœºæ™¯ï¼Œå½“æ‰“å¼€æ—¶å€™åº”è¯¥ä½•æ—¶å…³é—­? å½“è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¸Œæœ›åœ¨å‡½æ•°è¿”å›æ—¶ä¿®æ”¹å®ƒçš„å€¼ï¼Œè¯¥å¦‚ä½•è§£å†³? å…ˆçœ‹çœ‹defer çš„å®˜æ–¹å®šä¹‰ ï¼š A â€œdeferâ€ statement invokes a function whose execution is deferred to the moment the surrounding function returns, either because the surrounding function executed a return statement, reached the end of its function body, or because the corresponding goroutine is panicking. æ„æ€æ˜¯è¯´ï¼Œå½“åŒ…è£¹defer çš„å‡½æ•°è¿”å›æ—¶æˆ–è€…åŒ…è£¹deferçš„å‡½æ•°æ‰§è¡Œåˆ°æœ«å°¾æ—¶æˆ–è€…æ‰€åœ¨çš„goroutineå‘ç”Ÿpanicæ—¶æ‰ä¼šæ‰§è¡Œã€‚ æ¢å¥è¯è¯´å°±æ˜¯å½“å‡½æ•°æ‰§è¡Œå®Œä¹‹åæˆ–è€…å‘ç”Ÿå¼‚å¸¸æ—¶å†æ‰§è¡Œdeferè¯­å¥ï¼Œå°±æ˜¯è¯´åœ¨è¢«è°ƒå‡½æ•°è¿”å›ä¹‹åï¼Œèµ‹å€¼ç»™è°ƒç”¨å‡½æ•°ä¹‹å‰ï¼Œè¿˜æœ‰æœºä¼šæ‰§è¡Œå…¶ä»–æŒ‡ä»¤ï¼Œæ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ã€‚å…ˆçœ‹ä¸€æ®µpython ä»£ç  : def f(x,y) : z = x / y z += 1 return z â€‹ if __name__ == \"__main__\" : result = f(4 /2) å½“è°ƒç”¨å‡½æ•°fï¼Œfè¿”å›ç»™zå¹¶ä¸”èµ‹å€¼ç»™resultï¼Œåœ¨è¿™æ—¶é—´ï¼Œæ˜¯æ²¡æœ‰ä»»ä½•æœºä¼šæ‰§è¡Œå…¶ä»–çš„å‡½æ•°ä»£ç çš„ã€‚å†çœ‹ä¸€æ®µgoä»£ç : package main func main() { result := f(4, 2) fmt.Println(result) } â€‹ func f(x, y int) (r int) { r = x / y r += 1 defer func() { r += 2 }() return } å½“è°ƒç”¨å‡½æ•°fï¼Œfè¿”å›ä¹‹åï¼Œåœ¨èµ‹å€¼ä¹‹å‰æ‰§è¡Œäº†r +=2 ã€‚ç°åœ¨å›æƒ³ä¸€ä¸‹ä¹‹å‰çš„ä¸¤ä¸ªé—®é¢˜ï¼Œå¦‚æœæœ‰defer æœºåˆ¶ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥å¾ˆå¥½çš„è§£å†³ã€‚å¦‚å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨defer è¯­å¥ä¸­å¤„ç†æ–‡ä»¶çš„å…³é—­ï¼Œè¿æ¥çš„é‡Šæ”¾ç­‰ï¼Œè€Œä¸ç”¨è€ƒè™‘ä¸€äº›å¼‚å¸¸æƒ…å†µã€‚ é‚£deferçš„å®ç°åŸç†æ˜¯æ€æ ·çš„å‘¢? defer å…¶å®æ˜¯è°ƒç”¨runtime.deferproc è¿›è¡Œå®ç°ï¼Œåœ¨defer å‡ºç°çš„åœ°æ–¹ï¼Œæ’å…¥äº†call runtime.deferprocï¼Œç„¶ååœ¨å‡½æ•°è¿”å›ä¹‹å‰çš„åœ°æ–¹ï¼Œæ’å…¥æŒ‡ä»¤call runtime.deferreturnã€‚ æ™®é€šå‡½æ•°è¿”å›æ—¶ï¼Œæ±‡ç¼–ä»£ç ç±»ä¼¼äº: add xx SP return å¦‚æœåŒ…å«äº†defer è¯­å¥ï¼Œæ±‡ç¼–ä»£ç ç±»ä¼¼äº: call runtime.deferreturnï¼Œ add xx SP return goroutineçš„æ§åˆ¶ç»“æ„ä¸­ï¼Œæœ‰ä¸€å¼ è¡¨è®°å½•deferï¼Œè°ƒç”¨runtime.deferprocæ—¶ä¼šå°†éœ€è¦deferçš„è¡¨è¾¾å¼è®°å½•åœ¨è¡¨ä¸­ï¼Œè€Œåœ¨è°ƒç”¨runtime.deferreturnçš„æ—¶å€™ï¼Œåˆ™ä¼šä¾æ¬¡ä»deferè¡¨ä¸­å‡ºæ ˆå¹¶æ‰§è¡Œã€‚ defer åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¹Ÿå­˜åœ¨ä¸€äº›å‘ï¼Œçœ‹å‡ ä¸ªä¾‹å­: ä¾‹1: func f() (result int) { defer func() { result++ }() return 10 } ä¾‹2: func f() (result int) { t := 10 defer func() { t = t + 1 }() return t } ä¾‹3: func f() (result int) { defer func(result int) { result = result + 1 }(result) return 10 } å¤§å®¶å¯ä»¥å…ˆå¿ƒé‡Œé»˜é»˜ç®—ä¸€ä¸‹ä»–ä»¬çš„ç»“æœ ç¬¬ä¸€ä¸ªæ˜¯11ï¼Œç¬¬äºŒä¸ªæ˜¯10ï¼Œç¬¬ä¸‰ä¸ªæ˜¯10ã€‚ deferè¡¨è¾¾å¼å¯èƒ½ä¼šåœ¨è®¾ç½®å‡½æ•°è¿”å›å€¼ä¹‹åï¼Œåœ¨è¿”å›åˆ°è°ƒç”¨å‡½æ•°ä¹‹å‰ï¼Œä¿®æ”¹è¿”å›å€¼ï¼Œä½¿æœ€ç»ˆçš„å‡½æ•°è¿”å›å€¼ä¸ä½ æƒ³è±¡çš„ä¸ä¸€è‡´ã€‚å…¶å®ä½¿ç”¨deferæ—¶ï¼Œç”¨ä¸€ä¸ªç®€å•çš„è½¬æ¢è§„åˆ™æ”¹å†™ä¸€ä¸‹ï¼Œå°±ä¸ä¼šè¿·ç³Šäº†ã€‚æ”¹å†™è§„åˆ™æ˜¯å°†returnè¯­å¥æ‹†æˆä¸¤å¥å†™ï¼Œreturn xxxä¼šè¢«æ”¹å†™æˆ: è¿”å›å€¼ = xxx è°ƒç”¨deferå‡½æ•° ç©ºçš„return ä¾‹1 ä¼šè¢«æ”¹å†™æˆ: func f() (result int) { result = 10 // returnè¯­å¥ä¸æ˜¯ä¸€æ¡åŸå­è°ƒç”¨ï¼Œreturn xxxå…¶å®æ˜¯èµ‹å€¼ï¼‹retæŒ‡ä»¤ defer func() { result++ }() return // ç©ºçš„returnæŒ‡ä»¤ } æ‰€ä»¥è¿”å›å€¼æ˜¯11 ä¾‹2 ä¼šè¢«æ”¹å†™æˆ: func f() (result int) { t := 10 result = t // èµ‹å€¼æŒ‡ä»¤ defer func() { t = t + 1 //deferè¢«æ’å…¥åˆ°èµ‹å€¼ä¸è¿”å›ä¹‹é—´æ‰§è¡Œï¼Œè¿™ä¸ªä¾‹å­ä¸­è¿”å›å€¼ resultæ²¡è¢«ä¿®æ”¹è¿‡ }() return // ç©ºçš„returnæŒ‡ä»¤ } æ‰€ä»¥è¿”å›å€¼æ˜¯10 ä¾‹3 å°±ç•™ç»™å¤§å®¶è‡ªå·±æ”¹å†™ä¸€ä¸‹å•¦ï¼Œæœ‰å…´è¶£å¯ä»¥ç§æˆ‘æ²Ÿé€šå“Ÿï¼ ","date":"2020-11-08","objectID":"/defer/:5:0","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/defer/"},{"categories":null,"content":"æ€»ç»“ è¿™ç¯‡ä¸»è¦åšäº†å¯¹Goè¯­è¨€çš„ä»‹ç»å’Œä¼˜ç¼ºç‚¹ï¼Œåˆ†æäº†defer çš„ç”¨æ³•ä»¥åŠå®ç°åŸç†ï¼Œæœ€åç”¨ä¾‹å­å±•ç¤ºäº†ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½ä¼šå­˜åœ¨çš„å‘ã€‚ä¸‹ç¯‡é¢„å‘Š: Go çš„è°ƒåº¦æ¨¡å‹ï¼Œæ¬¢è¿å…³æ³¨!!! å¦‚æœæœ‰ç†è§£ä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œæ¬¢è¿æŒ‡å‡ºã€‚ ","date":"2020-11-08","objectID":"/defer/:6:0","tags":["golang","defer"],"title":"ç»†è°ˆ Golang ä¸­é‚£äº›è®¾è®¡ä¼˜ç¾çš„ç»†èŠ‚-defer","uri":"/defer/"},{"categories":null,"content":"è‡ªå·±å¼€æºçš„é¡¹ç›®","date":"2020-11-08","objectID":"/opensrouce/toolkit/","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"toolkit ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:0:0","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"ä½œç”¨ ç”¨äºæä¾›å·¥ä½œæ•ˆç‡çš„å·¥å…·ç®±ï¼Œé‡Œé¢æœ‰å„ç§å·¥å…·ï¼Œå°±æ¯”å¦‚çœŸå®å·¥å…·ç®±ä¸­é‡Œé¢æœ‰æ‰³æ‰‹ï¼Œå„ç§å¤§å°çš„èµ·å­ï¼Œé’³å­ç­‰ æŸäº›åœºæ™¯ä¸‹ç¡®å®å¯ä»¥è¾¾åˆ°äº‹åŠåŠŸå€çš„æ•ˆæœ ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:1:0","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"å®‰è£… ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:2:0","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"æºç å®‰è£… æœ‰ go è¯­è¨€ç¯å¢ƒçš„å¯ä»¥ç›´æ¥ç”¨æºç è¿›è¡Œç¼–è¯‘è¿è¡Œ git clone https://github.com/russellgao/toolkit.git cd toolkit make ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:2:1","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"äºŒè¿›åˆ¶ å¯ä»¥ç›´æ¥åœ¨release é¡µé¢è¿›è¡Œä¸‹è½½å¯¹åº”çš„æ“ä½œç³»ç»Ÿçš„äºŒè¿›åˆ¶æ–‡ä»¶ https://github.com/russellgao/toolkit/releases/ ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:2:2","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"ç”¨æ³• ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:3:0","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"æœ¬æœºè¿è¡Œ å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¿›è¡Œ gwz:toolkit gaoweizong$ tkctl --help tkctl is a toolkit entrypoint,run `tkctl --help` get more information. Usage: tkctl [flags] tkctl [command] Available Commands: help Help about any command replace æ–‡æœ¬æ›¿æ¢ï¼Œæ”¯æŒæ­£åˆ™æ›¿æ¢å’Œéæ­£åˆ™æ›¿æ¢ï¼Œç±»ä¼¼ä¸linuxä¸‹çš„sedï¼Œä½†æ¯”sedæ›´å¥½ç”¨ï¼Œè€Œä¸”å¯ä»¥è·¨å¹³å°ä½¿ç”¨ secret ç”Ÿæˆéšæœºå¯†ç ï¼Œæ”¯æŒ1ï½100ä½é•¿åº¦ï¼Œå¯ä»¥æŒ‡å®šæ˜¯å¦åŒ…å«ç‰¹æ®Šå­—ç¬¦ version tkctl version Flags: -h, --help help for tkctl -v, --version show the version and exit Use \"tkctl [command] --help\" for more information about a command. tkctl ä¸­çš„å­å‘½ä»¤ä¼šä¸æ–­æ›´æ–°ï¼ŒæŸä¸ªå…·ä½“çš„åŠŸèƒ½è¯·æŸ¥çœ‹Available Commands:ä¸‹çš„å¸®åŠ©æ–‡æ¡£ï¼Œå¦‚æ–‡æœ¬æ›¿æ¢ tkctl replace --help æ–‡æœ¬æ›¿æ¢ï¼Œæ”¯æŒæ­£åˆ™æ›¿æ¢å’Œéæ­£åˆ™æ›¿æ¢ï¼Œç±»ä¼¼ä¸linuxä¸‹çš„sedï¼Œä½†æ¯”sedæ›´å¥½ç”¨ï¼Œè€Œä¸”å¯ä»¥è·¨å¹³å°ä½¿ç”¨ Usage: tkctl replace [flags] Flags: -d, --dirs string éœ€è¦æ›¿æ¢çš„ç›®å½•, é»˜è®¤ä¸ºå½“å‰è·¯å¾„ (default \".\") -h, --help help for replace -m, --mode string æ›¿æ¢çš„æ¨¡å¼ï¼Œæ”¯æŒæ­£åˆ™ï¼ˆregexpï¼‰å’Œéæ­£åˆ™ï¼ˆtextï¼‰ä¸¤ç§æ¨¡å¼ï¼Œé»˜è®¤éæ­£åˆ™ï¼Œ (default \"text\") -p, --pattern string éœ€è¦æ›¿æ¢çš„pattern [required] -r, --repl string ç›®æ ‡å­—ç¬¦ä¸² [required] ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:3:1","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"docker å¦‚æœæœ¬åœ°æœ‰dockerç¯å¢ƒï¼Œä¹Ÿå¯ä»¥ä¸ç”¨ä¸‹è½½äºŒè¿›åˆ¶çš„åˆ¶å“ï¼Œå¯ä»¥é€šè¿‡docker ç¯å¢ƒç›´æ¥è¿è¡Œ docker run -it --rm russellgao/toolkit:latest tkctl --help # å¦‚æœæœ‰éœ€è¦å¯ä»¥æŠŠç›®å½•æŒ‚è½½è¿›å» docker run -it -v /data:/data --rm russellgao/toolkit:latest tkctl --help ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:3:2","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"é€‚ç”¨èŒƒå›´ å¯ä»¥è·¨å¹³å°ä½¿ç”¨ mac windows linux ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:4:0","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"å¼€å‘ç¯å¢ƒ go 1.14.2 ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:5:0","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"æ”¯æŒçš„åŠŸèƒ½ ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:6:0","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"1.0.0 æ–‡æœ¬æ­£åˆ™æ›¿æ¢ ç”Ÿæˆéšæœºå¯†ç  ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:6:1","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"æœªæ¥å±•æœ› æœŸæœ›å¯ä»¥æˆä¸ºä¸€ä¸ªå®Œæ•´çš„å·¥å…·ç®±ï¼Œå¯ä»¥è§£å†³æ—¥å¸¸å·¥ä½œä¸­çš„ç¹æ‚äº‹æƒ…ã€‚ ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:7:0","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"é¡¹ç›®åœ°å€ https://github.com/russellgao/toolkit ","date":"2020-11-08","objectID":"/opensrouce/toolkit/:8:0","tags":["golang","toolkit"],"title":"è‡ªå·±å¼€æºçš„é¡¹ç›® - toolkit","uri":"/opensrouce/toolkit/"},{"categories":null,"content":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","date":"2020-07-09","objectID":"/oracle/","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/oracle/"},{"categories":null,"content":"å®‰è£…åº“ pip3 install sqlalchemy pip3 install cx_Oracle ","date":"2020-07-09","objectID":"/oracle/:1:0","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/oracle/"},{"categories":null,"content":"å®‰è£…å®¢æˆ·ç«¯ oracle å®¢æˆ·ç«¯ä¸‹è½½é¡µé¢: https://www.oracle.com/database/technologies/instant-client/downloads.html ","date":"2020-07-09","objectID":"/oracle/:2:0","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/oracle/"},{"categories":null,"content":"mac https://www.oracle.com/database/technologies/instant-client/macos-intel-x86-downloads.html åœ¨ä¸Šé¢çš„é¡µé¢ä¸‹è½½ä¹‹åæ‰§è¡Œ: # è§£å‹ cd ~ unzip instantclient-basic-macos.x64-19.3.0.0.0dbru.zip # åˆ›å»ºlink mkdir ~/lib ln -s ~/instantclient_19_3/libclntsh.dylib ~/lib/ ","date":"2020-07-09","objectID":"/oracle/:2:1","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/oracle/"},{"categories":null,"content":"linux https://www.oracle.com/database/technologies/instant-client/linux-x86-64-downloads.html ","date":"2020-07-09","objectID":"/oracle/:2:2","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/oracle/"},{"categories":null,"content":"windows https://www.oracle.com/database/technologies/instant-client/winx64-64-downloads.html ","date":"2020-07-09","objectID":"/oracle/:2:3","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/oracle/"},{"categories":null,"content":"ä½¿ç”¨ åœ¨ä¸Šé¢è£…å¥½åº“å’Œoracle client å°±å¯ä»¥ç”¨python æ“ä½œ oracle äº† ç®€å•ç”¨æ³•å‚è§ : from sqlalchemy import * # è¿æ¥oracle engine = create_engine('oracle://username:passwoed@xxxxx', encoding=\"utf8\",echo=True) connection = engine.connect() # table, ä¼šæ ¹æ®è¡¨åè‡ªåŠ¨ç”ŸæˆTable å¯¹è±¡ meta = MetaData() t = Table(\"abcd\",meta,autoload=True,autoload_with=engine) # è·å–åˆ— columns = t.c print(columns) # æŸ¥è¯¢ # s = select([t]) # s = select([t]).where(t.c.name == \"xxxx\") s = select([t]).where(t.c.code == \"xxxx\") result = connection.execute(s) for row in result : print(row[t.c.gid],row[t.c.code],row[t.c.name],row[t.c.note]) result.close() print(\"end\") ","date":"2020-07-09","objectID":"/oracle/:3:0","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/oracle/"},{"categories":null,"content":"æŠ¥é”™ å¦‚æœæŠ¥å¦‚ä¸‹é”™è¯¯: sqlalchemy.exc.DatabaseError: (cx_Oracle.DatabaseError) DPI-1047: Cannot locate a 64-bit Oracle Client library: \"dlopen(libclntsh.dylib, 1): image not found\". See https://cx-oracle.readthedocs.io/en/latest/user_guide/installation.html for help (Background on this error at: http://sqlalche.me/e/13/4xp6) è¯´æ˜oracleçš„ client æ²¡æœ‰æ­£ç¡®å®‰è£… å¦‚æœæŠ¥é”™å¦‚ä¸‹: sqlalchemy.exc.DatabaseError: (cx_Oracle.DatabaseError) ORA-01017: invalid username/password; logon denied (Background on this error at: http://sqlalche.me/e/13/4xp6) è¯´æ˜oracle çš„ç”¨æˆ·å¯†ç ä¸æ­£ç¡® ","date":"2020-07-09","objectID":"/oracle/:4:0","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/oracle/"},{"categories":null,"content":"å‚è€ƒ https://docs.sqlalchemy.org/en/13/dialects/oracle.html https://www.cnblogs.com/iupoint/p/10932069.html ","date":"2020-07-09","objectID":"/oracle/:5:0","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/oracle/"},{"categories":null,"content":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","date":"2020-07-09","objectID":"/python/oracle/","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/python/oracle/"},{"categories":null,"content":"å®‰è£…åº“ pip3 install sqlalchemy pip3 install cx_Oracle ","date":"2020-07-09","objectID":"/python/oracle/:1:0","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/python/oracle/"},{"categories":null,"content":"å®‰è£…å®¢æˆ·ç«¯ oracle å®¢æˆ·ç«¯ä¸‹è½½é¡µé¢: https://www.oracle.com/database/technologies/instant-client/downloads.html ","date":"2020-07-09","objectID":"/python/oracle/:2:0","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/python/oracle/"},{"categories":null,"content":"mac https://www.oracle.com/database/technologies/instant-client/macos-intel-x86-downloads.html åœ¨ä¸Šé¢çš„é¡µé¢ä¸‹è½½ä¹‹åæ‰§è¡Œ: # è§£å‹ cd ~ unzip instantclient-basic-macos.x64-19.3.0.0.0dbru.zip # åˆ›å»ºlink mkdir ~/lib ln -s ~/instantclient_19_3/libclntsh.dylib ~/lib/ ","date":"2020-07-09","objectID":"/python/oracle/:2:1","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/python/oracle/"},{"categories":null,"content":"linux https://www.oracle.com/database/technologies/instant-client/linux-x86-64-downloads.html ","date":"2020-07-09","objectID":"/python/oracle/:2:2","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/python/oracle/"},{"categories":null,"content":"windows https://www.oracle.com/database/technologies/instant-client/winx64-64-downloads.html ","date":"2020-07-09","objectID":"/python/oracle/:2:3","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/python/oracle/"},{"categories":null,"content":"ä½¿ç”¨ åœ¨ä¸Šé¢è£…å¥½åº“å’Œoracle client å°±å¯ä»¥ç”¨python æ“ä½œ oracle äº† ç®€å•ç”¨æ³•å‚è§ : from sqlalchemy import * # è¿æ¥oracle engine = create_engine('oracle://username:passwoed@xxxxx', encoding=\"utf8\",echo=True) connection = engine.connect() # table, ä¼šæ ¹æ®è¡¨åè‡ªåŠ¨ç”ŸæˆTable å¯¹è±¡ meta = MetaData() t = Table(\"abcd\",meta,autoload=True,autoload_with=engine) # è·å–åˆ— columns = t.c print(columns) # æŸ¥è¯¢ # s = select([t]) # s = select([t]).where(t.c.name == \"xxxx\") s = select([t]).where(t.c.code == \"xxxx\") result = connection.execute(s) for row in result : print(row[t.c.gid],row[t.c.code],row[t.c.name],row[t.c.note]) result.close() print(\"end\") ","date":"2020-07-09","objectID":"/python/oracle/:3:0","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/python/oracle/"},{"categories":null,"content":"æŠ¥é”™ å¦‚æœæŠ¥å¦‚ä¸‹é”™è¯¯: sqlalchemy.exc.DatabaseError: (cx_Oracle.DatabaseError) DPI-1047: Cannot locate a 64-bit Oracle Client library: \"dlopen(libclntsh.dylib, 1): image not found\". See https://cx-oracle.readthedocs.io/en/latest/user_guide/installation.html for help (Background on this error at: http://sqlalche.me/e/13/4xp6) è¯´æ˜oracleçš„ client æ²¡æœ‰æ­£ç¡®å®‰è£… å¦‚æœæŠ¥é”™å¦‚ä¸‹: sqlalchemy.exc.DatabaseError: (cx_Oracle.DatabaseError) ORA-01017: invalid username/password; logon denied (Background on this error at: http://sqlalche.me/e/13/4xp6) è¯´æ˜oracle çš„ç”¨æˆ·å¯†ç ä¸æ­£ç¡® ","date":"2020-07-09","objectID":"/python/oracle/:4:0","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/python/oracle/"},{"categories":null,"content":"å‚è€ƒ https://docs.sqlalchemy.org/en/13/dialects/oracle.html https://www.cnblogs.com/iupoint/p/10932069.html ","date":"2020-07-09","objectID":"/python/oracle/:5:0","tags":["python","oracle","æ•°æ®åº“"],"title":"å¦‚ä½•åˆ©ç”¨ python æ“çºµ oracle","uri":"/python/oracle/"},{"categories":null,"content":"pod é…ç½®æ–‡ä»¶è¯´æ˜","date":"2020-06-18","objectID":"/kubernetes/pod%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/","tags":["kubernetes","pod"],"title":"pod é…ç½®æ–‡ä»¶è¯´æ˜","uri":"/kubernetes/pod%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/"},{"categories":null,"content":"Podçš„å®šä¹‰æ–‡ä»¶ apiVersion:v1kind:Podmetadata:name:stringnamaspace:stringlabels:- name:stringannotations:- name:stringspec:containers:- name:string# ä½¿ç”¨çš„é•œåƒimage:stringimagePullPolicy:[Always|Never|IfNotPresent]command:[string]args:[string]# å·¥ä½œç›®å½•workingDir:stringvolumeMounts:- name:stringmountPath:stringreadOnly:booleanports:- name:stringcontainerPort:inthostPort:intprotocol:stringenv:- name:stringvalue:stringresources:limits:cpu:stringmemory:stringrequests:cpu:stringmemory:stringlivenessProbe:exec:command:[string]httpGet:path:stringport:inthost:stringscheme:stringhttpHeaders:- name:stringvalue:stringtcpSocket:port:int# å¤šä¹…ä¹‹åå»æ£€æŸ¥initialDelaySeconds:number# å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´timeoutSeconds:number# å¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡periodSeconds:number# æˆåŠŸçš„é˜€å€¼ï¼Œæ£€æŸ¥å‡ æ¬¡æˆåŠŸæ‰ç®—æˆåŠŸsuccessThreshold:0# å¤±è´¥çš„é˜€å€¼ï¼Œæ£€æŸ¥å‡ æ¬¡å¤±è´¥æ‰ç®—å¤±è´¥failureThreshold:0securityContext:# è¯¦ç»†å‚è§ pod_SecurityContext ç« èŠ‚# securityContext å¯ä»¥é…ç½®pod æˆ–è€…container çº§åˆ«runAsUser:1000# è¿è¡Œçš„ç”¨æˆ·runAsGroup:3000# è¿è¡Œçš„ç”¨æˆ·ç»„fsGroup:2000privileged:bool# æ˜¯å¦ä»¥privileged æƒé™è¿è¡Œï¼Œå³è¿™æ˜¯è¿™ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‰¹æƒallowPrivilegeEscalation:bool# æ§åˆ¶ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦èƒ½æ¯”å…¶çˆ¶è¿›ç¨‹è·å–æ›´å¤šçš„æƒé™ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨ä»¥privilegedæƒé™è¿è¡Œæˆ–å…·æœ‰CAP_SYS_ADMINæƒé™ï¼Œåˆ™AllowPrivilegeEscalationçš„å€¼å°†æ€»æ˜¯truecapabilities:add:[\"NET_ADMIN\",\"SYS_TIME\",\"...\"]# ç»™æŸä¸ªç‰¹å®šçš„è¿›ç¨‹privilegedæƒé™ï¼Œè€Œä¸ç”¨ç»™rootç”¨æˆ·æ‰€æœ‰çš„privilegedæƒé™terminationMessagePath:/dev/termination-log# å®¹å™¨ç»ˆæ­¢çš„æ—¥å¿—æ–‡ä»¶terminationMessagePolicy:[File|FallbackToLogsOnError]# é»˜è®¤ä¸ºFile, å®¹å™¨ç»ˆæ­¢æ¶ˆæ¯è¾“å‡ºåˆ°æ–‡ä»¶restartPolicy:[Always|Never|OnFailure]# é‡å¯ç­–ç•¥ï¼Œé»˜è®¤ä¸º AlwaysnodeSelector:object# é€šè¿‡label é€‰å–nodednsPolicy:ClusterFirst# pod çš„ dns ç­–ç•¥ ,å¯ä»¥é…ç½®å¦‚ä¸‹å€¼# Default : å’Œå®¿ä¸»æœºçš„DNSå®Œå…¨ä¸€è‡´# ClusterFirst: æŠŠé›†ç¾¤çš„DNSå†™å…¥åˆ°Podçš„DNSé…ç½®ï¼Œä½†æ˜¯å¦‚æœè®¾ç½®äº†HostNetwork=trueï¼Œå°±ä¼šå¼ºåˆ¶è®¾ç½®ä¸ºDefault# ClusterFirstWithHostNet: æŠŠé›†ç¾¤çš„DNSå†™å…¥åˆ°Podçš„DNSé…ç½®ï¼Œä¸ç®¡æ˜¯å¦è®¾ç½®HostNetwork# None: å¿½ç•¥æ‰€æœ‰çš„DNSé…ç½®ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè®¾ç½®äº†Noneä¹‹åä¼šè‡ªå·±æ‰‹åŠ¨å†è®¾ç½®dnsConfigenableServiceLinks:true# Kubernetesæ”¯æŒä¸¤ç§æŸ¥æ‰¾æœåŠ¡çš„ä¸»è¦æ¨¡å¼: ç¯å¢ƒå˜é‡å’ŒDNS, å¦‚æœä¸éœ€è¦æœåŠ¡ç¯å¢ƒå˜é‡, å°† `enableServiceLinks` æ ‡å¿—è®¾ç½®ä¸º `false` æ¥ç¦ç”¨æ­¤æ¨¡å¼terminationGracePeriodSeconds:10# å‘å‡ºåˆ é™¤podæŒ‡ä»¤åå¤šä¹…ä¹‹åçœŸæ­£çš„åˆ é™¤podserviceAccountName:jenkins# pod ç»‘å®šçš„serviceAccountpriorityClassName:# ç»™pod è®¾ç½®ä¼˜å…ˆçº§ï¼Œå‚è€ƒ : https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/schedulerName:default-scheduler# å¦‚æœä¸é…ç½®åˆ™ä½¿ç”¨kubernetes é»˜è®¤çš„default-schedulerï¼Œå¦‚æœè¿™ä¸ªä¸æ»¡è¶³è¦æ±‚åˆ™å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªscheduler# https://kubernetes.io/zh/docs/tasks/administer-cluster/configure-multiple-schedulers/affinity:# äº²å’Œæ€§è®¾ç½®tolerations:- effect:NoExecutekey:node.kubernetes.io/not-readyoperator:ExiststolerationSeconds:300- effect:NoExecutekey:node.kubernetes.io/unreachableoperator:ExiststolerationSeconds:300# å®¹å¿è®¾ç½®imagePullSecrets:- name:string# é•œåƒæ‹‰å–ç­–ç•¥hostNetwork:false# æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœä¸ºtrueï¼Œpodç›´æ¥ç”¨ä¸»æœºç½‘ç»œï¼Œåœ¨podä¸­å¯ä»¥çœ‹åˆ°ä¸»æœºçš„ç½‘ç»œæ¥å£volumes:- name:stringemptyDir:{}hostPath:path:stringsecret:secretName:stringitems:- key:stringpath:stringconfigMap:name:stringitems:- key:stringpath:string# ç›®å½•æŒ‚è½½ ","date":"2020-06-18","objectID":"/kubernetes/pod%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/:1:0","tags":["kubernetes","pod"],"title":"pod é…ç½®æ–‡ä»¶è¯´æ˜","uri":"/kubernetes/pod%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/"},{"categories":null,"content":"pod å…·ä½“çš„æ ·ä¾‹ apiVersion:v1kind:Podmetadata:labels:app:elastic-clustername:enode-0spec:containers:- env:- name:ES_JAVA_OPTSvalueFrom:configMapKeyRef:key:ES_JAVA_OPTSname:es-configimage:elasticsearch:6.7.2imagePullPolicy:IfNotPresentlivenessProbe:failureThreshold:3httpGet:path:/_cluster/health?local=trueport:9200scheme:HTTPperiodSeconds:600successThreshold:1timeoutSeconds:1name:elasticsearchports:- containerPort:9200name:es-httpprotocol:TCP- containerPort:9300name:es-transportprotocol:TCPreadinessProbe:failureThreshold:3httpGet:path:/_cluster/health?local=trueport:9200scheme:HTTPinitialDelaySeconds:30periodSeconds:20successThreshold:1timeoutSeconds:1resources:limits:cpu:\"2\"memory:10Girequests:cpu:\"1\"memory:8GisecurityContext:capabilities:add:- IPC_LOCK- SYS_RESOURCEprivileged:truerunAsUser:1000terminationMessagePath:/dev/termination-logterminationMessagePolicy:FilevolumeMounts:- mountPath:/usr/share/elasticsearch/dataname:es-data- mountPath:/usr/share/elasticsearch/logsname:es-logs- mountPath:/usr/share/elasticsearch/config/elasticsearch.ymlname:elasticsearch-configsubPath:elasticsearch.yml- mountPath:/var/run/secrets/kubernetes.io/serviceaccountname:default-token-k4r6freadOnly:truednsPolicy:ClusterFirstenableServiceLinks:truehostname:enode-0initContainers:- command:- sysctl- -w- vm.max_map_count=262144image:busyboximagePullPolicy:IfNotPresentname:init-sysctlresources:{}securityContext:privileged:trueterminationMessagePath:/dev/termination-logterminationMessagePolicy:FilevolumeMounts:- mountPath:/var/run/secrets/kubernetes.io/serviceaccountname:default-token-k4r6freadOnly:truepriority:0restartPolicy:AlwaysschedulerName:default-schedulersecurityContext:fsGroup:1000serviceAccount:defaultserviceAccountName:defaultsubdomain:elasticsearch-clusterterminationGracePeriodSeconds:30tolerations:- effect:NoExecutekey:node.kubernetes.io/not-readyoperator:ExiststolerationSeconds:300- effect:NoExecutekey:node.kubernetes.io/unreachableoperator:ExiststolerationSeconds:300volumes:- name:es-datapersistentVolumeClaim:claimName:es-data-enode-0- name:es-logspersistentVolumeClaim:claimName:es-logs-enode-0- configMap:defaultMode:420items:- key:elasticsearch.ymlpath:elasticsearch.ymlname:es-configname:elasticsearch-config- name:default-token-k4r6fsecret:defaultMode:420secretName:default-token-k4r6f ","date":"2020-06-18","objectID":"/kubernetes/pod%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/:2:0","tags":["kubernetes","pod"],"title":"pod é…ç½®æ–‡ä»¶è¯´æ˜","uri":"/kubernetes/pod%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/"},{"categories":null,"content":"pod é…ç½®æ–‡ä»¶è¯´æ˜","date":"2020-06-18","objectID":"/pod%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/","tags":["kubernetes","pod"],"title":"pod é…ç½®æ–‡ä»¶è¯´æ˜","uri":"/pod%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/"},{"categories":null,"content":"Podçš„å®šä¹‰æ–‡ä»¶ apiVersion:v1kind:Podmetadata:name:stringnamaspace:stringlabels:- name:stringannotations:- name:stringspec:containers:- name:string# ä½¿ç”¨çš„é•œåƒimage:stringimagePullPolicy:[Always|Never|IfNotPresent]command:[string]args:[string]# å·¥ä½œç›®å½•workingDir:stringvolumeMounts:- name:stringmountPath:stringreadOnly:booleanports:- name:stringcontainerPort:inthostPort:intprotocol:stringenv:- name:stringvalue:stringresources:limits:cpu:stringmemory:stringrequests:cpu:stringmemory:stringlivenessProbe:exec:command:[string]httpGet:path:stringport:inthost:stringscheme:stringhttpHeaders:- name:stringvalue:stringtcpSocket:port:int# å¤šä¹…ä¹‹åå»æ£€æŸ¥initialDelaySeconds:number# å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´timeoutSeconds:number# å¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡periodSeconds:number# æˆåŠŸçš„é˜€å€¼ï¼Œæ£€æŸ¥å‡ æ¬¡æˆåŠŸæ‰ç®—æˆåŠŸsuccessThreshold:0# å¤±è´¥çš„é˜€å€¼ï¼Œæ£€æŸ¥å‡ æ¬¡å¤±è´¥æ‰ç®—å¤±è´¥failureThreshold:0securityContext:# è¯¦ç»†å‚è§ pod_SecurityContext ç« èŠ‚# securityContext å¯ä»¥é…ç½®pod æˆ–è€…container çº§åˆ«runAsUser:1000# è¿è¡Œçš„ç”¨æˆ·runAsGroup:3000# è¿è¡Œçš„ç”¨æˆ·ç»„fsGroup:2000privileged:bool# æ˜¯å¦ä»¥privileged æƒé™è¿è¡Œï¼Œå³è¿™æ˜¯è¿™ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‰¹æƒallowPrivilegeEscalation:bool# æ§åˆ¶ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦èƒ½æ¯”å…¶çˆ¶è¿›ç¨‹è·å–æ›´å¤šçš„æƒé™ï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨ä»¥privilegedæƒé™è¿è¡Œæˆ–å…·æœ‰CAP_SYS_ADMINæƒé™ï¼Œåˆ™AllowPrivilegeEscalationçš„å€¼å°†æ€»æ˜¯truecapabilities:add:[\"NET_ADMIN\",\"SYS_TIME\",\"...\"]# ç»™æŸä¸ªç‰¹å®šçš„è¿›ç¨‹privilegedæƒé™ï¼Œè€Œä¸ç”¨ç»™rootç”¨æˆ·æ‰€æœ‰çš„privilegedæƒé™terminationMessagePath:/dev/termination-log# å®¹å™¨ç»ˆæ­¢çš„æ—¥å¿—æ–‡ä»¶terminationMessagePolicy:[File|FallbackToLogsOnError]# é»˜è®¤ä¸ºFile, å®¹å™¨ç»ˆæ­¢æ¶ˆæ¯è¾“å‡ºåˆ°æ–‡ä»¶restartPolicy:[Always|Never|OnFailure]# é‡å¯ç­–ç•¥ï¼Œé»˜è®¤ä¸º AlwaysnodeSelector:object# é€šè¿‡label é€‰å–nodednsPolicy:ClusterFirst# pod çš„ dns ç­–ç•¥ ,å¯ä»¥é…ç½®å¦‚ä¸‹å€¼# Default : å’Œå®¿ä¸»æœºçš„DNSå®Œå…¨ä¸€è‡´# ClusterFirst: æŠŠé›†ç¾¤çš„DNSå†™å…¥åˆ°Podçš„DNSé…ç½®ï¼Œä½†æ˜¯å¦‚æœè®¾ç½®äº†HostNetwork=trueï¼Œå°±ä¼šå¼ºåˆ¶è®¾ç½®ä¸ºDefault# ClusterFirstWithHostNet: æŠŠé›†ç¾¤çš„DNSå†™å…¥åˆ°Podçš„DNSé…ç½®ï¼Œä¸ç®¡æ˜¯å¦è®¾ç½®HostNetwork# None: å¿½ç•¥æ‰€æœ‰çš„DNSé…ç½®ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè®¾ç½®äº†Noneä¹‹åä¼šè‡ªå·±æ‰‹åŠ¨å†è®¾ç½®dnsConfigenableServiceLinks:true# Kubernetesæ”¯æŒä¸¤ç§æŸ¥æ‰¾æœåŠ¡çš„ä¸»è¦æ¨¡å¼: ç¯å¢ƒå˜é‡å’ŒDNS, å¦‚æœä¸éœ€è¦æœåŠ¡ç¯å¢ƒå˜é‡, å°† `enableServiceLinks` æ ‡å¿—è®¾ç½®ä¸º `false` æ¥ç¦ç”¨æ­¤æ¨¡å¼terminationGracePeriodSeconds:10# å‘å‡ºåˆ é™¤podæŒ‡ä»¤åå¤šä¹…ä¹‹åçœŸæ­£çš„åˆ é™¤podserviceAccountName:jenkins# pod ç»‘å®šçš„serviceAccountpriorityClassName:# ç»™pod è®¾ç½®ä¼˜å…ˆçº§ï¼Œå‚è€ƒ : https://kubernetes.io/docs/concepts/configuration/pod-priority-preemption/schedulerName:default-scheduler# å¦‚æœä¸é…ç½®åˆ™ä½¿ç”¨kubernetes é»˜è®¤çš„default-schedulerï¼Œå¦‚æœè¿™ä¸ªä¸æ»¡è¶³è¦æ±‚åˆ™å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªscheduler# https://kubernetes.io/zh/docs/tasks/administer-cluster/configure-multiple-schedulers/affinity:# äº²å’Œæ€§è®¾ç½®tolerations:- effect:NoExecutekey:node.kubernetes.io/not-readyoperator:ExiststolerationSeconds:300- effect:NoExecutekey:node.kubernetes.io/unreachableoperator:ExiststolerationSeconds:300# å®¹å¿è®¾ç½®imagePullSecrets:- name:string# é•œåƒæ‹‰å–ç­–ç•¥hostNetwork:false# æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœä¸ºtrueï¼Œpodç›´æ¥ç”¨ä¸»æœºç½‘ç»œï¼Œåœ¨podä¸­å¯ä»¥çœ‹åˆ°ä¸»æœºçš„ç½‘ç»œæ¥å£volumes:- name:stringemptyDir:{}hostPath:path:stringsecret:secretName:stringitems:- key:stringpath:stringconfigMap:name:stringitems:- key:stringpath:string# ç›®å½•æŒ‚è½½ ","date":"2020-06-18","objectID":"/pod%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/:1:0","tags":["kubernetes","pod"],"title":"pod é…ç½®æ–‡ä»¶è¯´æ˜","uri":"/pod%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/"},{"categories":null,"content":"pod å…·ä½“çš„æ ·ä¾‹ apiVersion:v1kind:Podmetadata:labels:app:elastic-clustername:enode-0spec:containers:- env:- name:ES_JAVA_OPTSvalueFrom:configMapKeyRef:key:ES_JAVA_OPTSname:es-configimage:elasticsearch:6.7.2imagePullPolicy:IfNotPresentlivenessProbe:failureThreshold:3httpGet:path:/_cluster/health?local=trueport:9200scheme:HTTPperiodSeconds:600successThreshold:1timeoutSeconds:1name:elasticsearchports:- containerPort:9200name:es-httpprotocol:TCP- containerPort:9300name:es-transportprotocol:TCPreadinessProbe:failureThreshold:3httpGet:path:/_cluster/health?local=trueport:9200scheme:HTTPinitialDelaySeconds:30periodSeconds:20successThreshold:1timeoutSeconds:1resources:limits:cpu:\"2\"memory:10Girequests:cpu:\"1\"memory:8GisecurityContext:capabilities:add:- IPC_LOCK- SYS_RESOURCEprivileged:truerunAsUser:1000terminationMessagePath:/dev/termination-logterminationMessagePolicy:FilevolumeMounts:- mountPath:/usr/share/elasticsearch/dataname:es-data- mountPath:/usr/share/elasticsearch/logsname:es-logs- mountPath:/usr/share/elasticsearch/config/elasticsearch.ymlname:elasticsearch-configsubPath:elasticsearch.yml- mountPath:/var/run/secrets/kubernetes.io/serviceaccountname:default-token-k4r6freadOnly:truednsPolicy:ClusterFirstenableServiceLinks:truehostname:enode-0initContainers:- command:- sysctl- -w- vm.max_map_count=262144image:busyboximagePullPolicy:IfNotPresentname:init-sysctlresources:{}securityContext:privileged:trueterminationMessagePath:/dev/termination-logterminationMessagePolicy:FilevolumeMounts:- mountPath:/var/run/secrets/kubernetes.io/serviceaccountname:default-token-k4r6freadOnly:truepriority:0restartPolicy:AlwaysschedulerName:default-schedulersecurityContext:fsGroup:1000serviceAccount:defaultserviceAccountName:defaultsubdomain:elasticsearch-clusterterminationGracePeriodSeconds:30tolerations:- effect:NoExecutekey:node.kubernetes.io/not-readyoperator:ExiststolerationSeconds:300- effect:NoExecutekey:node.kubernetes.io/unreachableoperator:ExiststolerationSeconds:300volumes:- name:es-datapersistentVolumeClaim:claimName:es-data-enode-0- name:es-logspersistentVolumeClaim:claimName:es-logs-enode-0- configMap:defaultMode:420items:- key:elasticsearch.ymlpath:elasticsearch.ymlname:es-configname:elasticsearch-config- name:default-token-k4r6fsecret:defaultMode:420secretName:default-token-k4r6f ","date":"2020-06-18","objectID":"/pod%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/:2:0","tags":["kubernetes","pod"],"title":"pod é…ç½®æ–‡ä»¶è¯´æ˜","uri":"/pod%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E/"},{"categories":null,"content":"ä½è¿ç®—åˆé›†","date":"2020-05-30","objectID":"/argorithm/bit/","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"ä½è¿ç®— è®¡ç®—æœºä¸­çš„æ•°åœ¨å†…å­˜ä¸­éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶å½¢å¼è¿›è¡Œå­˜å‚¨çš„ï¼Œç”¨ä½è¿ç®—å°±æ˜¯ç›´æ¥å¯¹æ•´æ•°åœ¨å†…å­˜ä¸­çš„äºŒè¿›åˆ¶ä½è¿›è¡Œæ“ä½œï¼Œå› æ­¤å…¶æ‰§è¡Œæ•ˆç‡éå¸¸é«˜ï¼Œåœ¨ç¨‹åºä¸­å°½é‡ä½¿ç”¨ä½è¿ç®—è¿›è¡Œæ“ä½œï¼Œè¿™ä¼šå¤§å¤§æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚ ","date":"2020-05-30","objectID":"/argorithm/bit/:0:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"ä½æ“ä½œç¬¦ ","date":"2020-05-30","objectID":"/argorithm/bit/:1:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"\u0026 ä¸è¿ç®— \u0026 ä¸è¿ç®— ä¸¤ä¸ªä½éƒ½æ˜¯ 1 æ—¶ï¼Œç»“æœæ‰ä¸º 1ï¼Œå¦åˆ™ä¸º 0ï¼Œå¦‚ 1 0 0 1 1 \u0026 1 1 0 0 1 ------------------------------ 1 0 0 0 1 ","date":"2020-05-30","objectID":"/argorithm/bit/:1:1","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"| æˆ–è¿ç®— ä¸¤ä¸ªä½éƒ½æ˜¯ 0 æ—¶ï¼Œç»“æœæ‰ä¸º 0ï¼Œå¦åˆ™ä¸º 1ï¼Œå¦‚ 1 0 0 1 1 | 1 1 0 0 1 ------------------------------ 1 1 0 1 1 ","date":"2020-05-30","objectID":"/argorithm/bit/:1:2","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"^ å¼‚æˆ–è¿ç®— ä¸¤ä¸ªä½ç›¸åŒåˆ™ä¸º 0ï¼Œä¸åŒåˆ™ä¸º 1ï¼Œå¦‚ 1 0 0 1 1 ^ 1 1 0 0 1 ----------------------------- 0 1 0 1 0 ","date":"2020-05-30","objectID":"/argorithm/bit/:1:3","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"~ å–åè¿ç®— 0 åˆ™å˜ä¸º 1ï¼Œ1 åˆ™å˜ä¸º 0ï¼Œå¦‚ ~ 1 0 0 1 1 ----------------------------- 0 1 1 0 0 ","date":"2020-05-30","objectID":"/argorithm/bit/:1:4","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"Â« å·¦ç§»è¿ç®— å‘å·¦è¿›è¡Œç§»ä½æ“ä½œï¼Œé«˜ä½ä¸¢å¼ƒï¼Œä½ä½è¡¥ 0,å¦‚ int a = 8; a \u003c\u003c 3; ç§»ä½å‰ï¼š0000 0000 0000 0000 0000 0000 0000 1000 ç§»ä½åï¼š0000 0000 0000 0000 0000 0000 0100 0000 å·¦ç§»nä¸ºçš„å€¼å³ä¸ºå½“å‰å€¼*2^n, å¦‚: a = 8 b = a\u003c\u003c3 # 64 c = a * (2 ** 3) # 64 ","date":"2020-05-30","objectID":"/argorithm/bit/:1:5","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"Â»å³ç§»è¿ç®— å‘å³è¿›è¡Œç§»ä½æ“ä½œï¼Œå¯¹æ— ç¬¦å·æ•°ï¼Œé«˜ä½è¡¥ 0ï¼Œå¯¹äºæœ‰ç¬¦å·æ•°ï¼Œé«˜ä½è¡¥ç¬¦å·ä½ï¼Œå¦‚ unsigned int a = 8; a \u003e\u003e 3; ç§»ä½å‰ï¼š0000 0000 0000 0000 0000 0000 0000 1000 ç§»ä½åï¼š0000 0000 0000 0000 0000 0000 0000 0001 â€‹ int a = -8; a \u003e\u003e 3; ç§»ä½å‰ï¼š1111 1111 1111 1111 1111 1111 1111 1000 ç§»ä½å‰ï¼š1111 1111 1111 1111 1111 1111 1111 1111 ","date":"2020-05-30","objectID":"/argorithm/bit/:1:6","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"æœ‰ç¬¦å·æ•°å’Œæ— ç¬¦å·æ•° ","date":"2020-05-30","objectID":"/argorithm/bit/:2:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"æœ‰ç¬¦å·æ•° æœ‰ç¬¦å·æ•°çš„å®šä¹‰æ˜¯ï¼šå­—èŠ‚çš„æœ€é«˜ä½ä½œä¸ºç¬¦å·ä½ï¼Œå…¶ä½™çš„æ˜¯æ•°å€¼ä½ã€‚ä¾‹å¦‚ä¸€ä¸ªå­—èŠ‚ä¸­å­˜å‚¨çš„äºŒè¿›åˆ¶æ•°ä¸º1100 1000ï¼Œæœ€é«˜ä½1ä½œä¸ºç¬¦å·ä½ï¼Œå…¶ä½™çš„7ä¸º 100 1000 ä½œä¸ºæ•°å€¼ä¸ºã€‚ é‚£ä¹ˆï¼Œç¬¦å·ä½å æ®1ä½ï¼Œå°±æœ‰0å’Œ1è¿™æ ·çš„ä¸¤ç§æ•°å€¼ï¼Œå°±æœ‰ï¼š å¦‚æœç¬¦å·ä½ä¸º0ï¼Œé‚£ä¹ˆå­—èŠ‚ä¸­å­˜å‚¨çš„æ•°å€¼æ˜¯æ­£æ•° å¦‚æœç¬¦å·ä½ä¸º1ï¼Œé‚£ä¹ˆå­—èŠ‚ä¸­å­˜å‚¨çš„æ•°å€¼æ˜¯è´Ÿæ•° å¯¹äº1100 1000è¿™æ ·çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œç¬¦å·ä½æ˜¯1ï¼Œå°±è¡¨ç¤ºè´Ÿæ•°ã€‚ åœ¨æœ‰ç¬¦å·æ•°ä¸­ï¼Œè¡¨ç¤ºè´Ÿæ•°çš„ç®—æ³•æ˜¯ï¼š æŠŠæ•°å€¼ä½ä¸­å­˜å‚¨çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯ä¸ªä½éƒ½å–åï¼Œå°±æ˜¯åŸæ¥ä¸º0çš„å€¼å˜ä¸º1ï¼ŒåŸæ¥ä¸º1çš„å€¼å˜ä¸º0ï¼› ç»™å¯¹å–ååçš„äºŒè¿›åˆ¶æ•°æ®åŠ 1ï¼Œå¾—åˆ°çš„æ•°å€¼å°±å¾—åˆ°è´Ÿæ•°å€¼ï¼› ","date":"2020-05-30","objectID":"/argorithm/bit/:2:1","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"æ— ç¬¦å·æ•° æ— ç¬¦å·æ•°çš„å®šä¹‰æ˜¯ï¼šæ²¡æœ‰ç¬¦å·ä½ï¼Œæ‰€æœ‰çš„ä½æ•°éƒ½æ˜¯æ•°å€¼ä½ã€‚æ‰€ä»¥è¡¨ç¤ºçš„éƒ½æ˜¯æ­£æ•°ã€‚ ","date":"2020-05-30","objectID":"/argorithm/bit/:2:2","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"ä¾‹å­ ä¾‹ä¸€ 1100 1000è¿™ä¸ªæ•°å€¼ï¼Œå¦‚æœä½œä¸ºæœ‰ç¬¦å·æ•°çœ‹å¾…ï¼Œé‚£ä¹ˆç¬¦å·ä½æ˜¯1ï¼Œæ•°å€¼ä½æ˜¯100 1000ã€‚æ‰€ä»¥ï¼Œç¬¦å·ä½æ˜¯1ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªæ•°æ®æ˜¯è´Ÿæ•°ã€‚ç„¶åï¼Œè¡¨ç¤ºæˆåè¿›åˆ¶æ—¶ï¼Œå¯¹æ•°å€¼ä½çš„æ“ä½œæ˜¯ï¼š æ•°å€¼ä½å–åï¼Œå¾—åˆ°011 0111ï¼› å¯¹å–ååçš„æ•°å€¼ 011 0111åŠ 1å¾—åˆ°011 1000ï¼Œæ•°å€¼ä½çš„å€¼ä¸º56ï¼› é‚£ä¹ˆï¼Œ1100 1000è¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®è¡¨ç¤ºä¸ºâ€œæœ‰ç¬¦å·æ•°â€æ—¶ï¼Œå°±æ˜¯-56è¿™ä¸ªæ•°å€¼ã€‚ å¦‚æœä½œä¸ºæ— ç¬¦å·æ•°çœ‹å¾…ï¼Œé‚£ä¹ˆï¼Œå°±æ²¡æœ‰ç¬¦å·ä½ï¼Œæ‰€æœ‰çš„ä½æ•°éƒ½æ˜¯æ•°å€¼ä½ï¼Œæ‰€ä»¥11001000éƒ½ä½œä¸ºæ•°å€¼ä½ï¼Œè¡¨ç¤ºçš„åè¿›åˆ¶æ•°å€¼æ˜¯200 ä¾‹äºŒ ä¾‹å¦‚ï¼Œ0111 0011è¿™ä¸ªæ•°å€¼ï¼Œå¦‚æœå½“åšâ€œæœ‰ç¬¦å·æ•°â€çœ‹å¾…ï¼Œé‚£ä¹ˆï¼Œå…¶ç¬¦å·ä½æ˜¯0ï¼Œæ‰€ä»¥ï¼Œè¡¨ç¤ºæ•´æ•°ï¼Œæ•°å€¼ä½æ˜¯115ï¼Œæ‰€ä»¥ï¼Œè¡¨ç¤ºæ­£115è¿™ä¸ªæ•°å€¼ã€‚å¦‚æœå½“åšæ— ç¬¦å·æ•°çœ‹å¾…ï¼Œæ‰€æœ‰ä½éƒ½æ˜¯æ•°å€¼ä½ï¼Œè®¡ç®—å¾—åˆ°115è¿™ä¸ªæ•°å€¼ï¼Œæ‰€ä»¥ï¼Œè¡¨ç¤ºæ­£115ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ€»ç»“ ","date":"2020-05-30","objectID":"/argorithm/bit/:2:3","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"æ€»ç»“ æ— ç¬¦å·æ•°ï¼Œæ€»æ˜¯è¡¨ç¤ºæ­£æ•°ã€‚æ‰€æœ‰ä½æ•°éƒ½è¡¨ç¤ºæ•°å€¼ä½ã€‚ æœ‰ç¬¦å·æ•°ï¼Œå¯ä»¥è¡¨ç¤ºæ­£æ•°å’Œè´Ÿæ•°ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œå…¶ä½™ä½éƒ½æ˜¯æ•°å€¼ä½ã€‚å¦‚æœç¬¦å·ä½æ˜¯0ï¼Œåˆ™è¡¨ç¤ºæ­£æ•°ï¼›å¦‚æœç¬¦å·ä½æ˜¯1ï¼Œåˆ™è¡¨ç¤ºè´Ÿæ•°ã€‚å¯¹äºè´Ÿæ•°çš„è¡¨ç¤ºæ–¹æ³•æ˜¯ï¼šæ•°å€¼ä½å…¨éƒ¨å–åï¼Œå†åŠ 1ï¼Œå¾—åˆ°çš„æ•°å€¼å°±æ˜¯è´Ÿæ•°å€¼ã€‚ ","date":"2020-05-30","objectID":"/argorithm/bit/:2:4","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"åŸç ã€åç ã€è¡¥ç  ","date":"2020-05-30","objectID":"/argorithm/bit/:3:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"åŸç  åŸç çš„è¡¨ç¤ºèŒƒå›´-127~-0, +0~+127, å…±256ä¸ªæ•°å­— æ­£0çš„åŸç æ˜¯0000 0000, è´Ÿ0çš„åŸç æ˜¯1000 0000, æœ‰æ­£0è´Ÿ0ä¹‹åˆ†, ä¸ç¬¦åˆäººçš„ä¹ æƒ¯, å¾…è§£å†³. åŸç æœ‰å‡ ä¸ªç¼ºç‚¹ï¼Œé›¶åˆ†ä¸¤ç§ +0 å’Œ -0 ã€‚è¿˜æœ‰ï¼Œåœ¨è¿›è¡Œä¸åŒç¬¦å·çš„åŠ æ³•è¿ç®—æˆ–è€…åŒç¬¦å·çš„å‡æ³•è¿ç®—çš„æ—¶å€™ï¼Œä¸èƒ½ç›´æ¥åˆ¤æ–­å‡ºç»“æœçš„æ­£è´Ÿã€‚ä½ éœ€è¦å°†ä¸¤ä¸ªå€¼çš„ç»å¯¹å€¼è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åè¿›è¡ŒåŠ å‡æ“ä½œ ï¼Œæœ€åç¬¦å·ä½ç”±ç»å¯¹å€¼å¤§çš„å†³å®šã€‚äºæ˜¯åç å°±äº§ç”Ÿäº†ã€‚ ","date":"2020-05-30","objectID":"/argorithm/bit/:3:1","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"åç  é™¤ç¬¦å·ä½, åŸç å…¶ä½™ä½å–åè€Œå¾— +0ï¼š0000 0000ï¼Œ-0ï¼š1111 1111 ä»ç„¶æœ‰æ­£0è´Ÿ0ä¹‹åˆ†ã€‚ æ­£æ•°çš„åç å°±æ˜¯åŸç ï¼Œè´Ÿæ•°çš„åç ç­‰äºåŸç é™¤ç¬¦å·ä½ä»¥å¤–æ‰€æœ‰çš„ä½å–å ä¸¾ä¾‹è¯´æ˜ï¼š intç±»å‹çš„ 3 çš„åç æ˜¯ 00000000 00000000 00000000 00000011 å’ŒåŸç ä¸€æ ·æ²¡ä»€ä¹ˆå¯è¯´çš„ intç±»å‹çš„ -3 çš„åç æ˜¯ 11111111 11111111 11111111 11111100 é™¤å¼€ç¬¦å·ä½ æ‰€æœ‰ä½ å–å è§£å†³äº†åŠ å‡è¿ç®—çš„é—®é¢˜ï¼Œä½†è¿˜æ˜¯æœ‰æ­£è´Ÿé›¶ä¹‹åˆ†ï¼Œç„¶åå°±åˆ°è¡¥ç äº† ","date":"2020-05-30","objectID":"/argorithm/bit/:3:2","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"è¡¥ç  åœ¨åç çš„åŸºç¡€ä¸ŠåŠ 1è€Œå¾— å¯¹åŸç çš„ä¸¤ç§0åŒæ—¶æœ«ä½åŠ 1 +0ï¼š0000 0000ï¼Œ-0ï¼š0000 0000(å› ä¸ºæº¢å‡ºå¯¼è‡´8ä½å…¨0) æ¶ˆé™¤äº†æ­£0è´Ÿ0ä¹‹åˆ«, å¦‚æ­¤ä¸€æ¥, ä¾¿èŠ‚çœå‡ºä¸€ä¸ªæ•°å€¼è¡¨ç¤ºæ–¹å¼1000 0000, ä¸èƒ½æµªè´¹, ç”¨æ¥è¡¨ç¤º-128, -128ç‰¹æ®Šä¹‹å¤„åœ¨äºæ²¡æœ‰ç›¸åº”çš„åç åŸç ã€‚ä¹Ÿå¯ä»¥è¿™æ ·è€ƒè™‘: -1ï¼š 1111 1111 -2ï¼š 1111 1110ï¼ˆåœ¨-1çš„åŸºç¡€ä¸Šå‡1ï¼Œç›´æ¥å°†è¡¥ç å‡1å³å¯ï¼‰ -3ï¼š 1111 1101ï¼ˆåœ¨-2è¡¥ç åŸºç¡€ä¸Šå‡1ï¼Œä»¥ä¸‹ç±»ä¼¼ï¼‰ -4ï¼š 1111 1100 â€¦â€¦ -127ï¼š1000 0001 -128ï¼š1000 0000 å¦‚æ­¤ä»¥æ¥ï¼š8ä½è¡¥ç è¡¨ç¤ºèŒƒå›´æ˜¯-128~+127å› ä¸º0åªæœ‰ä¸€ç§å½¢å¼æ‰€ä»¥ï¼Œä»ç„¶æ˜¯256ä¸ªæ•° è‹¥8ä½ä»£è¡¨æ— ç¬¦å·æ•°, åˆ™è¡¨ç¤ºèŒƒå›´æ˜¯ : 0~255, è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé«˜çº§è¯­è¨€è®²åˆ°æ•°æ®ç±»å‹ï¼Œ æ­£æ•°çš„è¡¥ç ä¸åŸç ç›¸åŒï¼Œè´Ÿæ•°çš„è¡¥ç ä¸º å…¶åŸç é™¤ç¬¦å·ä½å¤–æ‰€æœ‰ä½å–åï¼ˆå¾—åˆ°åç äº†ï¼‰ï¼Œç„¶åæœ€ä½ä½åŠ 1 ","date":"2020-05-30","objectID":"/argorithm/bit/:3:3","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"åŸç ï¼Œåç ï¼Œè¡¥ç æ€»ç»“ æ­£æ•°çš„åç å’Œè¡¥ç éƒ½ä¸åŸç ç›¸åŒã€‚ è´Ÿæ•°çš„åç ä¸ºå¯¹è¯¥æ•°çš„åŸç é™¤ç¬¦å·ä½å¤–å„ä½å–åã€‚ è´Ÿæ•°çš„è¡¥ç ä¸ºå¯¹è¯¥æ•°çš„åŸç é™¤ç¬¦å·ä½å¤–å„ä½å–åï¼Œç„¶ååœ¨æœ€åä¸€ä½åŠ 1ã€€ ä¼˜ç¼ºç‚¹: åŸç æœ€å¥½ç†è§£äº†ï¼Œä½†æ˜¯åŠ å‡æ³•ä¸å¤Ÿæ–¹ä¾¿ï¼Œè¿˜æœ‰ä¸¤ä¸ªé›¶ã€‚ã€‚ åç ç¨å¾®å›°éš¾ä¸€äº›ï¼Œè§£å†³äº†åŠ å‡æ³•çš„é—®é¢˜ï¼Œä½†è¿˜æ˜¯æœ‰æœ‰ä¸ªé›¶ è¡¥ç ç†è§£å›°éš¾ï¼Œå…¶ä»–å°±æ²¡ä»€ä¹ˆç¼ºç‚¹äº† ","date":"2020-05-30","objectID":"/argorithm/bit/:3:4","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"å­˜å‚¨ è®¡ç®—æœºä¸­çš„æ•´æ•°æ˜¯ç”¨è¡¥ç å­˜å‚¨çš„ï¼Œæœ€é«˜ä½ä¸ºç¬¦å·ä½ å¦‚æœæœ€é«˜ä½ä¸º0åˆ™ä¸ºæ­£æ•°ï¼Œæ±‚å€¼çš„æ—¶å€™ï¼Œç›´æ¥è½¬ä¸º10è¿›åˆ¶å³å¯ã€‚ æœ€é«˜ä½å¦‚æœä¸º1ä»£è¡¨ä¸ºè´Ÿæ•°ï¼Œæ±‚å€¼çš„æ—¶å€™ï¼Œéœ€è¦å…ˆæŠŠäºŒè¿›åˆ¶çš„å€¼æŒ‰ä½å–åï¼Œç„¶ååŠ 1å¾—åˆ°è´Ÿæ•°ç»å¯¹å€¼(ç›¸åæ•°)çš„äºŒè¿›åˆ¶ç ï¼Œç„¶åè½¬ä¸º10è¿›åˆ¶ï¼ŒåŠ ä¸Šè´Ÿå·å³å¯ã€‚ ","date":"2020-05-30","objectID":"/argorithm/bit/:3:5","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"åŸç ï¼Œåç ï¼Œè¡¥ç çš„åº”ç”¨ ","date":"2020-05-30","objectID":"/argorithm/bit/:3:6","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"è´Ÿæ•°çš„åè¿›åˆ¶å’ŒäºŒè¿›åˆ¶è½¬æ¢ ","date":"2020-05-30","objectID":"/argorithm/bit/:4:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"åè¿›åˆ¶è½¬äºŒè¿›åˆ¶ æ–¹æ³•ä¸º: å…ˆè½¬æ¢ä¸ºäºŒè¿›åˆ¶ å¯¹äºŒè¿›åˆ¶æ•°æ±‚å å†å°†è¯¥äºŒè¿›åˆ¶æ•°åŠ ä¸€ æ€»è€Œè¨€ä¹‹: åè¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ±‚è¡¥ç å³ä¸ºç»“æœ ä¾‹å­ -32 è½¬æ¢ä¸ºäºŒè¿›åˆ¶ ç¬¬ä¸€æ­¥ï¼š32ï¼ˆ10ï¼‰=00100000ï¼ˆ2ï¼‰ ç¬¬äºŒæ­¥ï¼šæ±‚åï¼š11011111 ç¬¬ä¸‰æ­¥ï¼šåŠ 1:11100000 æ‰€ä»¥-32ï¼ˆ10ï¼‰=11100000ï¼ˆ2ï¼‰ ","date":"2020-05-30","objectID":"/argorithm/bit/:4:1","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"äºŒè¿›åˆ¶è½¬åè¿›åˆ¶ æ–¹æ³•ä¸º: æ•°å€¼ä¸ºå–å å¯¹è¯¥äºŒè¿›åˆ¶åŠ ä¸€ è½¬æ¢ä¸º10è¿›åˆ¶ ä¾‹å­ 11001000 è½¬æ¢ä¸ºåè¿›åˆ¶ ç¬¬ä¸€æ­¥ï¼ˆæ•°å€¼ä½å–åï¼‰ï¼š 10110111 ç¬¬äºŒæ­¥ï¼ˆåŠ ä¸€ï¼‰ï¼š10111000 ç¬¬ä¸‰æ­¥ï¼ˆåè¿›åˆ¶ï¼‰ï¼š-56 æ‰€ä»¥11001000ï¼ˆ2ï¼‰=-56ï¼ˆ10ï¼‰ ","date":"2020-05-30","objectID":"/argorithm/bit/:4:2","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"åè¿›åˆ¶æ•°æ±‚åçš„è§„å¾‹ ä¸‹é¢éƒ½æ˜¯ä»¥10è¿›åˆ¶è¡¨ç¤º: ","date":"2020-05-30","objectID":"/argorithm/bit/:5:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"è´Ÿæ•°æ±‚å è´Ÿæ•°æ±‚åç­‰äºå…¶ç»å¯¹å€¼ -1 å¦‚: num = -5 num1 = ~num # 4 ","date":"2020-05-30","objectID":"/argorithm/bit/:5:1","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"æ­£æ•°æ±‚å æ­£æ•°æ±‚åç­‰äºå…¶å€¼ +1 çš„è´Ÿæ•° å¦‚: num = 4 num1 = ~num # -5 ","date":"2020-05-30","objectID":"/argorithm/bit/:5:2","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"äºŒè¿›åˆ¶çš„åº”ç”¨åœºæ™¯ ","date":"2020-05-30","objectID":"/argorithm/bit/:6:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"ä½æ“ä½œå®ç°ä¹˜é™¤æ³• æ•° a å‘å³ç§»ä¸€ä½ï¼Œç›¸å½“äºå°† a é™¤ä»¥ 2ï¼›æ•° a å‘å·¦ç§»ä¸€ä½ï¼Œç›¸å½“äºå°† a ä¹˜ä»¥ 2 a = 2 a \u003e\u003e 1 # ---\u003e 1 a \u003c\u003c 1 # ---\u003e 4 ","date":"2020-05-30","objectID":"/argorithm/bit/:6:1","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"ä½æ“ä½œäº¤æ¢ä¸¤æ•° ä½æ“ä½œäº¤æ¢ä¸¤æ•°å¯ä»¥ä¸éœ€è¦ç¬¬ä¸‰ä¸ªä¸´æ—¶å˜é‡ï¼Œè™½ç„¶æ™®é€šæ“ä½œä¹Ÿå¯ä»¥åšåˆ°ï¼Œä½†æ˜¯æ²¡æœ‰å…¶æ•ˆç‡é«˜ # æ™®é€šæ“ä½œ def swap(a: int, b: int) -\u003e(int,int): a = a + b b = a - b a = a - b return a,b # ä½ä¸æ“ä½œ def swap(a: int, b: int) -\u003e (int, int): \"\"\" äº¤æ¢ä¸¤ä¸ªæ•° :param a: :param b: :return: \"\"\" a ^= b # a = (a^b) b ^= a # b = b ^ a = b ^ a ^ b a ^= b # a = a ^ b = a ^ a ^ b return a, b ","date":"2020-05-30","objectID":"/argorithm/bit/:6:2","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"ä½æ“ä½œåˆ¤æ–­å¥‡å¶æ•° åªè¦æ ¹æ®æ•°çš„æœ€åä¸€ä½æ˜¯ 0 è¿˜æ˜¯ 1 æ¥å†³å®šå³å¯ï¼Œä¸º 0 å°±æ˜¯å¶æ•°ï¼Œä¸º 1 å°±æ˜¯å¥‡æ•° if(0 == (a \u0026 1)) { //å¶æ•° } ","date":"2020-05-30","objectID":"/argorithm/bit/:6:3","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"ä½æ“ä½œäº¤æ¢ç¬¦å· äº¤æ¢ç¬¦å·å°†æ­£æ•°å˜æˆè´Ÿæ•°ï¼Œè´Ÿæ•°å˜æˆæ­£æ•° func reversal(a int) int { return ^a + 1 } def reversal(a: int) -\u003e int: \"\"\" æ±‚ç›¸åæ•° :param a: :return: \"\"\" return ~a + 1 æ­£æ•°å–ååŠ 1ï¼Œæ­£å¥½å˜æˆå…¶å¯¹åº”çš„è´Ÿæ•°(è¡¥ç è¡¨ç¤º)ï¼›è´Ÿæ•°å–ååŠ ä¸€ï¼Œåˆ™å˜ä¸ºå…¶åŸç ï¼Œå³æ­£æ•° ","date":"2020-05-30","objectID":"/argorithm/bit/:6:4","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"ä½æ“ä½œæ±‚ç»å¯¹å€¼ æ­£æ•°çš„ç»å¯¹å€¼æ˜¯å…¶æœ¬èº«ï¼Œè´Ÿæ•°çš„ç»å¯¹å€¼æ­£å¥½å¯ä»¥å¯¹å…¶è¿›è¡Œå–ååŠ ä¸€æ±‚å¾—ï¼Œå³æˆ‘ä»¬é¦–å…ˆåˆ¤æ–­å…¶ç¬¦å·ä½ï¼ˆæ•´æ•°å³ç§» 31 ä½å¾—åˆ° 0ï¼Œè´Ÿæ•°å³ç§» 31 ä½å¾—åˆ° -1,å³ 0xffffffffï¼‰ï¼Œç„¶åæ ¹æ®ç¬¦å·è¿›è¡Œç›¸åº”çš„æ“ä½œ def abs(a: int) -\u003e int: i = a \u003e\u003e 31 result = a if i == 0 else ~a + 1 return result ä¸Šé¢çš„æ“ä½œå¯ä»¥è¿›è¡Œä¼˜åŒ–ï¼Œå¯ä»¥å°† i == 0 çš„æ¡ä»¶åˆ¤æ–­è¯­å¥å»æ‰ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ç¬¦å·ä½ i åªæœ‰ä¸¤ç§æƒ…å†µï¼Œå³ i = 0 ä¸ºæ­£ï¼Œi = -1 ä¸ºè´Ÿã€‚å¯¹äºä»»ä½•æ•°ä¸ 0 å¼‚æˆ–éƒ½ä¼šä¿æŒä¸å˜ï¼Œä¸ -1 å³ 0xffffffff è¿›è¡Œå¼‚æˆ–å°±ç›¸å½“äºå¯¹æ­¤æ•°è¿›è¡Œå–å,å› æ­¤å¯ä»¥å°†ä¸Šé¢ä¸‰ç›®å…ƒç®—ç¬¦è½¬æ¢ä¸º((a^i)-i)ï¼Œå³æ•´æ•°æ—¶ a ä¸ 0 å¼‚æˆ–å¾—åˆ°æœ¬èº«ï¼Œå†å‡å» 0ï¼Œè´Ÿæ•°æ—¶ä¸ 0xffffffff å¼‚æˆ–å°† a è¿›è¡Œå–åï¼Œç„¶ååœ¨åŠ ä¸Š 1ï¼Œå³å‡å» i(i =-1) def abs(a: int) -\u003e int: \"\"\" æ±‚ç»å¯¹å€¼ :param a: :return: \"\"\" i = a \u003e\u003e 31 result = (a ^ i) - i return result or func abs(a int) int { i := a \u003e\u003e 31 return (a ^ i) - i } ","date":"2020-05-30","objectID":"/argorithm/bit/:6:5","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"ä½æ“ä½œè¿›è¡Œé«˜ä½ä½äº¤æ¢ ç»™å®šä¸€ä¸ª 16 ä½çš„æ— ç¬¦å·æ•´æ•°ï¼Œå°†å…¶é«˜ 8 ä½ä¸ä½ 8 ä½è¿›è¡Œäº¤æ¢ï¼Œæ±‚å‡ºäº¤æ¢åçš„å€¼ï¼Œå¦‚ ä»ä¸Šé¢ç§»ä½æ“ä½œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåªè¦å°†æ— ç¬¦å·æ•° aÂ»8 å³å¯å¾—åˆ°å…¶é«˜ 8 ä½ç§»åˆ°ä½ 8 ä½ï¼Œé«˜ä½è¡¥ 0ï¼›å°† a Â« 8 å³å¯å°† ä½ 8 ä½ç§»åˆ°é«˜ 8 ä½ï¼Œä½ 8 ä½è¡¥ 0ï¼Œç„¶åå°† a Â» 8 å’Œ aÂ«8 è¿›è¡Œæˆ–æ“ä½œæ—¢å¯æ±‚å¾—äº¤æ¢åçš„ç»“æœ ã€‚ unsigned short a = 34520; a = (a \u003e\u003e 8) | (a \u003c\u003c 8); ","date":"2020-05-30","objectID":"/argorithm/bit/:6:6","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"ä½æ“ä½œç»Ÿè®¡äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•° ç»Ÿè®¡äºŒè¿›åˆ¶1çš„ä¸ªæ•°å¯ä»¥åˆ†åˆ«è·å–æ¯ä¸ªäºŒè¿›åˆ¶ä½æ•°ï¼Œç„¶åå†ç»Ÿè®¡å…¶1çš„ä¸ªæ•°ï¼Œæ­¤æ–¹æ³•æ•ˆç‡æ¯”è¾ƒä½ã€‚ è¿™é‡Œä»‹ç»å¦å¤–ä¸€ç§é«˜æ•ˆçš„æ–¹æ³•ï¼ŒåŒæ ·ä»¥ 34520 ä¸ºä¾‹ï¼Œ æˆ‘ä»¬è®¡ç®—å…¶ a \u0026= (a-1)çš„ç»“æœï¼š ç¬¬ä¸€æ¬¡ï¼šè®¡ç®—å‰ï¼š1000 0110 1101 1000 è®¡ç®—åï¼š1000 0110 1101 0000 ç¬¬äºŒæ¬¡ï¼šè®¡ç®—å‰ï¼š1000 0110 1101 0000 è®¡ç®—åï¼š1000 0110 1100 0000 ç¬¬ä¸‰æ¬¡ï¼šè®¡ç®—å‰ï¼š1000 0110 1100 0000 è®¡ç®—åï¼š1000 0110 1000 0000 æˆ‘ä»¬å‘ç°ï¼Œæ¯è®¡ç®—ä¸€æ¬¡äºŒè¿›åˆ¶ä¸­å°±å°‘äº†ä¸€ä¸ª 1ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢æ–¹æ³•å»ç»Ÿè®¡ï¼šcount = 0 def count_1(a: int) -\u003e int: \"\"\" è®¡ç®—æ•°å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„1çš„æ•°é‡ :param a: :return: \"\"\" count = 0 while (a): a = a \u0026 a - 1 count += 1 return count ","date":"2020-05-30","objectID":"/argorithm/bit/:6:7","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"æ±‚å’Œ ä¸¤æ•°æ±‚å’Œ func add(a int, b int) int { for b != 0 { sum := a ^ b carry := (a \u0026 b) \u003c\u003c 1 a = sum b = carry } return a } ","date":"2020-05-30","objectID":"/argorithm/bit/:6:8","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"æ¯”ç‰¹ä½è®¡æ•° ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•° numã€‚å¯¹äº 0 â‰¤ i â‰¤ num èŒƒå›´ä¸­çš„æ¯ä¸ªæ•°å­— i ï¼Œè®¡ç®—å…¶äºŒè¿›åˆ¶æ•°ä¸­çš„ 1 çš„æ•°ç›®å¹¶å°†å®ƒä»¬ä½œä¸ºæ•°ç»„è¿”å›ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: 2 è¾“å‡º: [0,1,1] ç¤ºä¾‹ 2: è¾“å…¥: 5 è¾“å‡º: [0,1,1,2,1,2] def countBits(num: int) -\u003e [int]: result = [0] * (num + 1) for i in range(1, num + 1): result[i] = result[i \u0026 i - 1] + 1 return result func countBits(num int) []int { result := make([]int, num+1) for i := 1; i \u003c num+1 ; i ++ { result[i] = result[i \u0026 (i-1)] + 1 } return result } ","date":"2020-05-30","objectID":"/argorithm/bit/:6:9","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"å¸¸ç”¨çš„ç‰¹æ®Šçš„æ•° 0xaaaaaaaa = 10101010101010101010101010101010 (å¶æ•°ä½ä¸º1ï¼Œå¥‡æ•°ä½ä¸º0ï¼‰ 0x55555555 = 1010101010101010101010101010101 (å¶æ•°ä½ä¸º0ï¼Œå¥‡æ•°ä½ä¸º1ï¼‰ 0x33333333 = 110011001100110011001100110011 (1å’Œ0æ¯éš”ä¸¤ä½äº¤æ›¿å‡ºç°) 0xcccccccc = 11001100110011001100110011001100Â (0å’Œ1æ¯éš”ä¸¤ä½äº¤æ›¿å‡ºç°) 0x0f0f0f0f = 00001111000011110000111100001111Â (1å’Œ0æ¯éš”å››ä½äº¤æ›¿å‡ºç°) 0xf0f0f0f0 = 11110000111100001111000011110000Â (0å’Œ1æ¯éš”å››ä½äº¤æ›¿å‡ºç°) 0xffffffff = 11111111111111111111111111111111 ","date":"2020-05-30","objectID":"/argorithm/bit/:7:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/argorithm/bit/"},{"categories":null,"content":"ä½è¿ç®—åˆé›†","date":"2020-05-30","objectID":"/bit/","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"ä½è¿ç®— è®¡ç®—æœºä¸­çš„æ•°åœ¨å†…å­˜ä¸­éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶å½¢å¼è¿›è¡Œå­˜å‚¨çš„ï¼Œç”¨ä½è¿ç®—å°±æ˜¯ç›´æ¥å¯¹æ•´æ•°åœ¨å†…å­˜ä¸­çš„äºŒè¿›åˆ¶ä½è¿›è¡Œæ“ä½œï¼Œå› æ­¤å…¶æ‰§è¡Œæ•ˆç‡éå¸¸é«˜ï¼Œåœ¨ç¨‹åºä¸­å°½é‡ä½¿ç”¨ä½è¿ç®—è¿›è¡Œæ“ä½œï¼Œè¿™ä¼šå¤§å¤§æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚ ","date":"2020-05-30","objectID":"/bit/:0:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"ä½æ“ä½œç¬¦ ","date":"2020-05-30","objectID":"/bit/:1:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"\u0026 ä¸è¿ç®— \u0026 ä¸è¿ç®— ä¸¤ä¸ªä½éƒ½æ˜¯ 1 æ—¶ï¼Œç»“æœæ‰ä¸º 1ï¼Œå¦åˆ™ä¸º 0ï¼Œå¦‚ 1 0 0 1 1 \u0026 1 1 0 0 1 ------------------------------ 1 0 0 0 1 ","date":"2020-05-30","objectID":"/bit/:1:1","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"| æˆ–è¿ç®— ä¸¤ä¸ªä½éƒ½æ˜¯ 0 æ—¶ï¼Œç»“æœæ‰ä¸º 0ï¼Œå¦åˆ™ä¸º 1ï¼Œå¦‚ 1 0 0 1 1 | 1 1 0 0 1 ------------------------------ 1 1 0 1 1 ","date":"2020-05-30","objectID":"/bit/:1:2","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"^ å¼‚æˆ–è¿ç®— ä¸¤ä¸ªä½ç›¸åŒåˆ™ä¸º 0ï¼Œä¸åŒåˆ™ä¸º 1ï¼Œå¦‚ 1 0 0 1 1 ^ 1 1 0 0 1 ----------------------------- 0 1 0 1 0 ","date":"2020-05-30","objectID":"/bit/:1:3","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"~ å–åè¿ç®— 0 åˆ™å˜ä¸º 1ï¼Œ1 åˆ™å˜ä¸º 0ï¼Œå¦‚ ~ 1 0 0 1 1 ----------------------------- 0 1 1 0 0 ","date":"2020-05-30","objectID":"/bit/:1:4","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"Â« å·¦ç§»è¿ç®— å‘å·¦è¿›è¡Œç§»ä½æ“ä½œï¼Œé«˜ä½ä¸¢å¼ƒï¼Œä½ä½è¡¥ 0,å¦‚ int a = 8; a \u003c\u003c 3; ç§»ä½å‰ï¼š0000 0000 0000 0000 0000 0000 0000 1000 ç§»ä½åï¼š0000 0000 0000 0000 0000 0000 0100 0000 å·¦ç§»nä¸ºçš„å€¼å³ä¸ºå½“å‰å€¼*2^n, å¦‚: a = 8 b = a\u003c\u003c3 # 64 c = a * (2 ** 3) # 64 ","date":"2020-05-30","objectID":"/bit/:1:5","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"Â»å³ç§»è¿ç®— å‘å³è¿›è¡Œç§»ä½æ“ä½œï¼Œå¯¹æ— ç¬¦å·æ•°ï¼Œé«˜ä½è¡¥ 0ï¼Œå¯¹äºæœ‰ç¬¦å·æ•°ï¼Œé«˜ä½è¡¥ç¬¦å·ä½ï¼Œå¦‚ unsigned int a = 8; a \u003e\u003e 3; ç§»ä½å‰ï¼š0000 0000 0000 0000 0000 0000 0000 1000 ç§»ä½åï¼š0000 0000 0000 0000 0000 0000 0000 0001 â€‹ int a = -8; a \u003e\u003e 3; ç§»ä½å‰ï¼š1111 1111 1111 1111 1111 1111 1111 1000 ç§»ä½å‰ï¼š1111 1111 1111 1111 1111 1111 1111 1111 ","date":"2020-05-30","objectID":"/bit/:1:6","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"æœ‰ç¬¦å·æ•°å’Œæ— ç¬¦å·æ•° ","date":"2020-05-30","objectID":"/bit/:2:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"æœ‰ç¬¦å·æ•° æœ‰ç¬¦å·æ•°çš„å®šä¹‰æ˜¯ï¼šå­—èŠ‚çš„æœ€é«˜ä½ä½œä¸ºç¬¦å·ä½ï¼Œå…¶ä½™çš„æ˜¯æ•°å€¼ä½ã€‚ä¾‹å¦‚ä¸€ä¸ªå­—èŠ‚ä¸­å­˜å‚¨çš„äºŒè¿›åˆ¶æ•°ä¸º1100 1000ï¼Œæœ€é«˜ä½1ä½œä¸ºç¬¦å·ä½ï¼Œå…¶ä½™çš„7ä¸º 100 1000 ä½œä¸ºæ•°å€¼ä¸ºã€‚ é‚£ä¹ˆï¼Œç¬¦å·ä½å æ®1ä½ï¼Œå°±æœ‰0å’Œ1è¿™æ ·çš„ä¸¤ç§æ•°å€¼ï¼Œå°±æœ‰ï¼š å¦‚æœç¬¦å·ä½ä¸º0ï¼Œé‚£ä¹ˆå­—èŠ‚ä¸­å­˜å‚¨çš„æ•°å€¼æ˜¯æ­£æ•° å¦‚æœç¬¦å·ä½ä¸º1ï¼Œé‚£ä¹ˆå­—èŠ‚ä¸­å­˜å‚¨çš„æ•°å€¼æ˜¯è´Ÿæ•° å¯¹äº1100 1000è¿™æ ·çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œç¬¦å·ä½æ˜¯1ï¼Œå°±è¡¨ç¤ºè´Ÿæ•°ã€‚ åœ¨æœ‰ç¬¦å·æ•°ä¸­ï¼Œè¡¨ç¤ºè´Ÿæ•°çš„ç®—æ³•æ˜¯ï¼š æŠŠæ•°å€¼ä½ä¸­å­˜å‚¨çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œæ¯ä¸ªä½éƒ½å–åï¼Œå°±æ˜¯åŸæ¥ä¸º0çš„å€¼å˜ä¸º1ï¼ŒåŸæ¥ä¸º1çš„å€¼å˜ä¸º0ï¼› ç»™å¯¹å–ååçš„äºŒè¿›åˆ¶æ•°æ®åŠ 1ï¼Œå¾—åˆ°çš„æ•°å€¼å°±å¾—åˆ°è´Ÿæ•°å€¼ï¼› ","date":"2020-05-30","objectID":"/bit/:2:1","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"æ— ç¬¦å·æ•° æ— ç¬¦å·æ•°çš„å®šä¹‰æ˜¯ï¼šæ²¡æœ‰ç¬¦å·ä½ï¼Œæ‰€æœ‰çš„ä½æ•°éƒ½æ˜¯æ•°å€¼ä½ã€‚æ‰€ä»¥è¡¨ç¤ºçš„éƒ½æ˜¯æ­£æ•°ã€‚ ","date":"2020-05-30","objectID":"/bit/:2:2","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"ä¾‹å­ ä¾‹ä¸€ 1100 1000è¿™ä¸ªæ•°å€¼ï¼Œå¦‚æœä½œä¸ºæœ‰ç¬¦å·æ•°çœ‹å¾…ï¼Œé‚£ä¹ˆç¬¦å·ä½æ˜¯1ï¼Œæ•°å€¼ä½æ˜¯100 1000ã€‚æ‰€ä»¥ï¼Œç¬¦å·ä½æ˜¯1ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªæ•°æ®æ˜¯è´Ÿæ•°ã€‚ç„¶åï¼Œè¡¨ç¤ºæˆåè¿›åˆ¶æ—¶ï¼Œå¯¹æ•°å€¼ä½çš„æ“ä½œæ˜¯ï¼š æ•°å€¼ä½å–åï¼Œå¾—åˆ°011 0111ï¼› å¯¹å–ååçš„æ•°å€¼ 011 0111åŠ 1å¾—åˆ°011 1000ï¼Œæ•°å€¼ä½çš„å€¼ä¸º56ï¼› é‚£ä¹ˆï¼Œ1100 1000è¿™ä¸ªäºŒè¿›åˆ¶æ•°æ®è¡¨ç¤ºä¸ºâ€œæœ‰ç¬¦å·æ•°â€æ—¶ï¼Œå°±æ˜¯-56è¿™ä¸ªæ•°å€¼ã€‚ å¦‚æœä½œä¸ºæ— ç¬¦å·æ•°çœ‹å¾…ï¼Œé‚£ä¹ˆï¼Œå°±æ²¡æœ‰ç¬¦å·ä½ï¼Œæ‰€æœ‰çš„ä½æ•°éƒ½æ˜¯æ•°å€¼ä½ï¼Œæ‰€ä»¥11001000éƒ½ä½œä¸ºæ•°å€¼ä½ï¼Œè¡¨ç¤ºçš„åè¿›åˆ¶æ•°å€¼æ˜¯200 ä¾‹äºŒ ä¾‹å¦‚ï¼Œ0111 0011è¿™ä¸ªæ•°å€¼ï¼Œå¦‚æœå½“åšâ€œæœ‰ç¬¦å·æ•°â€çœ‹å¾…ï¼Œé‚£ä¹ˆï¼Œå…¶ç¬¦å·ä½æ˜¯0ï¼Œæ‰€ä»¥ï¼Œè¡¨ç¤ºæ•´æ•°ï¼Œæ•°å€¼ä½æ˜¯115ï¼Œæ‰€ä»¥ï¼Œè¡¨ç¤ºæ­£115è¿™ä¸ªæ•°å€¼ã€‚å¦‚æœå½“åšæ— ç¬¦å·æ•°çœ‹å¾…ï¼Œæ‰€æœ‰ä½éƒ½æ˜¯æ•°å€¼ä½ï¼Œè®¡ç®—å¾—åˆ°115è¿™ä¸ªæ•°å€¼ï¼Œæ‰€ä»¥ï¼Œè¡¨ç¤ºæ­£115ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ€»ç»“ ","date":"2020-05-30","objectID":"/bit/:2:3","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"æ€»ç»“ æ— ç¬¦å·æ•°ï¼Œæ€»æ˜¯è¡¨ç¤ºæ­£æ•°ã€‚æ‰€æœ‰ä½æ•°éƒ½è¡¨ç¤ºæ•°å€¼ä½ã€‚ æœ‰ç¬¦å·æ•°ï¼Œå¯ä»¥è¡¨ç¤ºæ­£æ•°å’Œè´Ÿæ•°ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œå…¶ä½™ä½éƒ½æ˜¯æ•°å€¼ä½ã€‚å¦‚æœç¬¦å·ä½æ˜¯0ï¼Œåˆ™è¡¨ç¤ºæ­£æ•°ï¼›å¦‚æœç¬¦å·ä½æ˜¯1ï¼Œåˆ™è¡¨ç¤ºè´Ÿæ•°ã€‚å¯¹äºè´Ÿæ•°çš„è¡¨ç¤ºæ–¹æ³•æ˜¯ï¼šæ•°å€¼ä½å…¨éƒ¨å–åï¼Œå†åŠ 1ï¼Œå¾—åˆ°çš„æ•°å€¼å°±æ˜¯è´Ÿæ•°å€¼ã€‚ ","date":"2020-05-30","objectID":"/bit/:2:4","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"åŸç ã€åç ã€è¡¥ç  ","date":"2020-05-30","objectID":"/bit/:3:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"åŸç  åŸç çš„è¡¨ç¤ºèŒƒå›´-127~-0, +0~+127, å…±256ä¸ªæ•°å­— æ­£0çš„åŸç æ˜¯0000 0000, è´Ÿ0çš„åŸç æ˜¯1000 0000, æœ‰æ­£0è´Ÿ0ä¹‹åˆ†, ä¸ç¬¦åˆäººçš„ä¹ æƒ¯, å¾…è§£å†³. åŸç æœ‰å‡ ä¸ªç¼ºç‚¹ï¼Œé›¶åˆ†ä¸¤ç§ +0 å’Œ -0 ã€‚è¿˜æœ‰ï¼Œåœ¨è¿›è¡Œä¸åŒç¬¦å·çš„åŠ æ³•è¿ç®—æˆ–è€…åŒç¬¦å·çš„å‡æ³•è¿ç®—çš„æ—¶å€™ï¼Œä¸èƒ½ç›´æ¥åˆ¤æ–­å‡ºç»“æœçš„æ­£è´Ÿã€‚ä½ éœ€è¦å°†ä¸¤ä¸ªå€¼çš„ç»å¯¹å€¼è¿›è¡Œæ¯”è¾ƒï¼Œç„¶åè¿›è¡ŒåŠ å‡æ“ä½œ ï¼Œæœ€åç¬¦å·ä½ç”±ç»å¯¹å€¼å¤§çš„å†³å®šã€‚äºæ˜¯åç å°±äº§ç”Ÿäº†ã€‚ ","date":"2020-05-30","objectID":"/bit/:3:1","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"åç  é™¤ç¬¦å·ä½, åŸç å…¶ä½™ä½å–åè€Œå¾— +0ï¼š0000 0000ï¼Œ-0ï¼š1111 1111 ä»ç„¶æœ‰æ­£0è´Ÿ0ä¹‹åˆ†ã€‚ æ­£æ•°çš„åç å°±æ˜¯åŸç ï¼Œè´Ÿæ•°çš„åç ç­‰äºåŸç é™¤ç¬¦å·ä½ä»¥å¤–æ‰€æœ‰çš„ä½å–å ä¸¾ä¾‹è¯´æ˜ï¼š intç±»å‹çš„ 3 çš„åç æ˜¯ 00000000 00000000 00000000 00000011 å’ŒåŸç ä¸€æ ·æ²¡ä»€ä¹ˆå¯è¯´çš„ intç±»å‹çš„ -3 çš„åç æ˜¯ 11111111 11111111 11111111 11111100 é™¤å¼€ç¬¦å·ä½ æ‰€æœ‰ä½ å–å è§£å†³äº†åŠ å‡è¿ç®—çš„é—®é¢˜ï¼Œä½†è¿˜æ˜¯æœ‰æ­£è´Ÿé›¶ä¹‹åˆ†ï¼Œç„¶åå°±åˆ°è¡¥ç äº† ","date":"2020-05-30","objectID":"/bit/:3:2","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"è¡¥ç  åœ¨åç çš„åŸºç¡€ä¸ŠåŠ 1è€Œå¾— å¯¹åŸç çš„ä¸¤ç§0åŒæ—¶æœ«ä½åŠ 1 +0ï¼š0000 0000ï¼Œ-0ï¼š0000 0000(å› ä¸ºæº¢å‡ºå¯¼è‡´8ä½å…¨0) æ¶ˆé™¤äº†æ­£0è´Ÿ0ä¹‹åˆ«, å¦‚æ­¤ä¸€æ¥, ä¾¿èŠ‚çœå‡ºä¸€ä¸ªæ•°å€¼è¡¨ç¤ºæ–¹å¼1000 0000, ä¸èƒ½æµªè´¹, ç”¨æ¥è¡¨ç¤º-128, -128ç‰¹æ®Šä¹‹å¤„åœ¨äºæ²¡æœ‰ç›¸åº”çš„åç åŸç ã€‚ä¹Ÿå¯ä»¥è¿™æ ·è€ƒè™‘: -1ï¼š 1111 1111 -2ï¼š 1111 1110ï¼ˆåœ¨-1çš„åŸºç¡€ä¸Šå‡1ï¼Œç›´æ¥å°†è¡¥ç å‡1å³å¯ï¼‰ -3ï¼š 1111 1101ï¼ˆåœ¨-2è¡¥ç åŸºç¡€ä¸Šå‡1ï¼Œä»¥ä¸‹ç±»ä¼¼ï¼‰ -4ï¼š 1111 1100 â€¦â€¦ -127ï¼š1000 0001 -128ï¼š1000 0000 å¦‚æ­¤ä»¥æ¥ï¼š8ä½è¡¥ç è¡¨ç¤ºèŒƒå›´æ˜¯-128~+127å› ä¸º0åªæœ‰ä¸€ç§å½¢å¼æ‰€ä»¥ï¼Œä»ç„¶æ˜¯256ä¸ªæ•° è‹¥8ä½ä»£è¡¨æ— ç¬¦å·æ•°, åˆ™è¡¨ç¤ºèŒƒå›´æ˜¯ : 0~255, è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé«˜çº§è¯­è¨€è®²åˆ°æ•°æ®ç±»å‹ï¼Œ æ­£æ•°çš„è¡¥ç ä¸åŸç ç›¸åŒï¼Œè´Ÿæ•°çš„è¡¥ç ä¸º å…¶åŸç é™¤ç¬¦å·ä½å¤–æ‰€æœ‰ä½å–åï¼ˆå¾—åˆ°åç äº†ï¼‰ï¼Œç„¶åæœ€ä½ä½åŠ 1 ","date":"2020-05-30","objectID":"/bit/:3:3","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"åŸç ï¼Œåç ï¼Œè¡¥ç æ€»ç»“ æ­£æ•°çš„åç å’Œè¡¥ç éƒ½ä¸åŸç ç›¸åŒã€‚ è´Ÿæ•°çš„åç ä¸ºå¯¹è¯¥æ•°çš„åŸç é™¤ç¬¦å·ä½å¤–å„ä½å–åã€‚ è´Ÿæ•°çš„è¡¥ç ä¸ºå¯¹è¯¥æ•°çš„åŸç é™¤ç¬¦å·ä½å¤–å„ä½å–åï¼Œç„¶ååœ¨æœ€åä¸€ä½åŠ 1ã€€ ä¼˜ç¼ºç‚¹: åŸç æœ€å¥½ç†è§£äº†ï¼Œä½†æ˜¯åŠ å‡æ³•ä¸å¤Ÿæ–¹ä¾¿ï¼Œè¿˜æœ‰ä¸¤ä¸ªé›¶ã€‚ã€‚ åç ç¨å¾®å›°éš¾ä¸€äº›ï¼Œè§£å†³äº†åŠ å‡æ³•çš„é—®é¢˜ï¼Œä½†è¿˜æ˜¯æœ‰æœ‰ä¸ªé›¶ è¡¥ç ç†è§£å›°éš¾ï¼Œå…¶ä»–å°±æ²¡ä»€ä¹ˆç¼ºç‚¹äº† ","date":"2020-05-30","objectID":"/bit/:3:4","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"å­˜å‚¨ è®¡ç®—æœºä¸­çš„æ•´æ•°æ˜¯ç”¨è¡¥ç å­˜å‚¨çš„ï¼Œæœ€é«˜ä½ä¸ºç¬¦å·ä½ å¦‚æœæœ€é«˜ä½ä¸º0åˆ™ä¸ºæ­£æ•°ï¼Œæ±‚å€¼çš„æ—¶å€™ï¼Œç›´æ¥è½¬ä¸º10è¿›åˆ¶å³å¯ã€‚ æœ€é«˜ä½å¦‚æœä¸º1ä»£è¡¨ä¸ºè´Ÿæ•°ï¼Œæ±‚å€¼çš„æ—¶å€™ï¼Œéœ€è¦å…ˆæŠŠäºŒè¿›åˆ¶çš„å€¼æŒ‰ä½å–åï¼Œç„¶ååŠ 1å¾—åˆ°è´Ÿæ•°ç»å¯¹å€¼(ç›¸åæ•°)çš„äºŒè¿›åˆ¶ç ï¼Œç„¶åè½¬ä¸º10è¿›åˆ¶ï¼ŒåŠ ä¸Šè´Ÿå·å³å¯ã€‚ ","date":"2020-05-30","objectID":"/bit/:3:5","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"åŸç ï¼Œåç ï¼Œè¡¥ç çš„åº”ç”¨ ","date":"2020-05-30","objectID":"/bit/:3:6","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"è´Ÿæ•°çš„åè¿›åˆ¶å’ŒäºŒè¿›åˆ¶è½¬æ¢ ","date":"2020-05-30","objectID":"/bit/:4:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"åè¿›åˆ¶è½¬äºŒè¿›åˆ¶ æ–¹æ³•ä¸º: å…ˆè½¬æ¢ä¸ºäºŒè¿›åˆ¶ å¯¹äºŒè¿›åˆ¶æ•°æ±‚å å†å°†è¯¥äºŒè¿›åˆ¶æ•°åŠ ä¸€ æ€»è€Œè¨€ä¹‹: åè¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°æ±‚è¡¥ç å³ä¸ºç»“æœ ä¾‹å­ -32 è½¬æ¢ä¸ºäºŒè¿›åˆ¶ ç¬¬ä¸€æ­¥ï¼š32ï¼ˆ10ï¼‰=00100000ï¼ˆ2ï¼‰ ç¬¬äºŒæ­¥ï¼šæ±‚åï¼š11011111 ç¬¬ä¸‰æ­¥ï¼šåŠ 1:11100000 æ‰€ä»¥-32ï¼ˆ10ï¼‰=11100000ï¼ˆ2ï¼‰ ","date":"2020-05-30","objectID":"/bit/:4:1","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"äºŒè¿›åˆ¶è½¬åè¿›åˆ¶ æ–¹æ³•ä¸º: æ•°å€¼ä¸ºå–å å¯¹è¯¥äºŒè¿›åˆ¶åŠ ä¸€ è½¬æ¢ä¸º10è¿›åˆ¶ ä¾‹å­ 11001000 è½¬æ¢ä¸ºåè¿›åˆ¶ ç¬¬ä¸€æ­¥ï¼ˆæ•°å€¼ä½å–åï¼‰ï¼š 10110111 ç¬¬äºŒæ­¥ï¼ˆåŠ ä¸€ï¼‰ï¼š10111000 ç¬¬ä¸‰æ­¥ï¼ˆåè¿›åˆ¶ï¼‰ï¼š-56 æ‰€ä»¥11001000ï¼ˆ2ï¼‰=-56ï¼ˆ10ï¼‰ ","date":"2020-05-30","objectID":"/bit/:4:2","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"åè¿›åˆ¶æ•°æ±‚åçš„è§„å¾‹ ä¸‹é¢éƒ½æ˜¯ä»¥10è¿›åˆ¶è¡¨ç¤º: ","date":"2020-05-30","objectID":"/bit/:5:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"è´Ÿæ•°æ±‚å è´Ÿæ•°æ±‚åç­‰äºå…¶ç»å¯¹å€¼ -1 å¦‚: num = -5 num1 = ~num # 4 ","date":"2020-05-30","objectID":"/bit/:5:1","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"æ­£æ•°æ±‚å æ­£æ•°æ±‚åç­‰äºå…¶å€¼ +1 çš„è´Ÿæ•° å¦‚: num = 4 num1 = ~num # -5 ","date":"2020-05-30","objectID":"/bit/:5:2","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"äºŒè¿›åˆ¶çš„åº”ç”¨åœºæ™¯ ","date":"2020-05-30","objectID":"/bit/:6:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"ä½æ“ä½œå®ç°ä¹˜é™¤æ³• æ•° a å‘å³ç§»ä¸€ä½ï¼Œç›¸å½“äºå°† a é™¤ä»¥ 2ï¼›æ•° a å‘å·¦ç§»ä¸€ä½ï¼Œç›¸å½“äºå°† a ä¹˜ä»¥ 2 a = 2 a \u003e\u003e 1 # ---\u003e 1 a \u003c\u003c 1 # ---\u003e 4 ","date":"2020-05-30","objectID":"/bit/:6:1","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"ä½æ“ä½œäº¤æ¢ä¸¤æ•° ä½æ“ä½œäº¤æ¢ä¸¤æ•°å¯ä»¥ä¸éœ€è¦ç¬¬ä¸‰ä¸ªä¸´æ—¶å˜é‡ï¼Œè™½ç„¶æ™®é€šæ“ä½œä¹Ÿå¯ä»¥åšåˆ°ï¼Œä½†æ˜¯æ²¡æœ‰å…¶æ•ˆç‡é«˜ # æ™®é€šæ“ä½œ def swap(a: int, b: int) -\u003e(int,int): a = a + b b = a - b a = a - b return a,b # ä½ä¸æ“ä½œ def swap(a: int, b: int) -\u003e (int, int): \"\"\" äº¤æ¢ä¸¤ä¸ªæ•° :param a: :param b: :return: \"\"\" a ^= b # a = (a^b) b ^= a # b = b ^ a = b ^ a ^ b a ^= b # a = a ^ b = a ^ a ^ b return a, b ","date":"2020-05-30","objectID":"/bit/:6:2","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"ä½æ“ä½œåˆ¤æ–­å¥‡å¶æ•° åªè¦æ ¹æ®æ•°çš„æœ€åä¸€ä½æ˜¯ 0 è¿˜æ˜¯ 1 æ¥å†³å®šå³å¯ï¼Œä¸º 0 å°±æ˜¯å¶æ•°ï¼Œä¸º 1 å°±æ˜¯å¥‡æ•° if(0 == (a \u0026 1)) { //å¶æ•° } ","date":"2020-05-30","objectID":"/bit/:6:3","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"ä½æ“ä½œäº¤æ¢ç¬¦å· äº¤æ¢ç¬¦å·å°†æ­£æ•°å˜æˆè´Ÿæ•°ï¼Œè´Ÿæ•°å˜æˆæ­£æ•° func reversal(a int) int { return ^a + 1 } def reversal(a: int) -\u003e int: \"\"\" æ±‚ç›¸åæ•° :param a: :return: \"\"\" return ~a + 1 æ­£æ•°å–ååŠ 1ï¼Œæ­£å¥½å˜æˆå…¶å¯¹åº”çš„è´Ÿæ•°(è¡¥ç è¡¨ç¤º)ï¼›è´Ÿæ•°å–ååŠ ä¸€ï¼Œåˆ™å˜ä¸ºå…¶åŸç ï¼Œå³æ­£æ•° ","date":"2020-05-30","objectID":"/bit/:6:4","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"ä½æ“ä½œæ±‚ç»å¯¹å€¼ æ­£æ•°çš„ç»å¯¹å€¼æ˜¯å…¶æœ¬èº«ï¼Œè´Ÿæ•°çš„ç»å¯¹å€¼æ­£å¥½å¯ä»¥å¯¹å…¶è¿›è¡Œå–ååŠ ä¸€æ±‚å¾—ï¼Œå³æˆ‘ä»¬é¦–å…ˆåˆ¤æ–­å…¶ç¬¦å·ä½ï¼ˆæ•´æ•°å³ç§» 31 ä½å¾—åˆ° 0ï¼Œè´Ÿæ•°å³ç§» 31 ä½å¾—åˆ° -1,å³ 0xffffffffï¼‰ï¼Œç„¶åæ ¹æ®ç¬¦å·è¿›è¡Œç›¸åº”çš„æ“ä½œ def abs(a: int) -\u003e int: i = a \u003e\u003e 31 result = a if i == 0 else ~a + 1 return result ä¸Šé¢çš„æ“ä½œå¯ä»¥è¿›è¡Œä¼˜åŒ–ï¼Œå¯ä»¥å°† i == 0 çš„æ¡ä»¶åˆ¤æ–­è¯­å¥å»æ‰ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ç¬¦å·ä½ i åªæœ‰ä¸¤ç§æƒ…å†µï¼Œå³ i = 0 ä¸ºæ­£ï¼Œi = -1 ä¸ºè´Ÿã€‚å¯¹äºä»»ä½•æ•°ä¸ 0 å¼‚æˆ–éƒ½ä¼šä¿æŒä¸å˜ï¼Œä¸ -1 å³ 0xffffffff è¿›è¡Œå¼‚æˆ–å°±ç›¸å½“äºå¯¹æ­¤æ•°è¿›è¡Œå–å,å› æ­¤å¯ä»¥å°†ä¸Šé¢ä¸‰ç›®å…ƒç®—ç¬¦è½¬æ¢ä¸º((a^i)-i)ï¼Œå³æ•´æ•°æ—¶ a ä¸ 0 å¼‚æˆ–å¾—åˆ°æœ¬èº«ï¼Œå†å‡å» 0ï¼Œè´Ÿæ•°æ—¶ä¸ 0xffffffff å¼‚æˆ–å°† a è¿›è¡Œå–åï¼Œç„¶ååœ¨åŠ ä¸Š 1ï¼Œå³å‡å» i(i =-1) def abs(a: int) -\u003e int: \"\"\" æ±‚ç»å¯¹å€¼ :param a: :return: \"\"\" i = a \u003e\u003e 31 result = (a ^ i) - i return result or func abs(a int) int { i := a \u003e\u003e 31 return (a ^ i) - i } ","date":"2020-05-30","objectID":"/bit/:6:5","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"ä½æ“ä½œè¿›è¡Œé«˜ä½ä½äº¤æ¢ ç»™å®šä¸€ä¸ª 16 ä½çš„æ— ç¬¦å·æ•´æ•°ï¼Œå°†å…¶é«˜ 8 ä½ä¸ä½ 8 ä½è¿›è¡Œäº¤æ¢ï¼Œæ±‚å‡ºäº¤æ¢åçš„å€¼ï¼Œå¦‚ ä»ä¸Šé¢ç§»ä½æ“ä½œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œåªè¦å°†æ— ç¬¦å·æ•° aÂ»8 å³å¯å¾—åˆ°å…¶é«˜ 8 ä½ç§»åˆ°ä½ 8 ä½ï¼Œé«˜ä½è¡¥ 0ï¼›å°† a Â« 8 å³å¯å°† ä½ 8 ä½ç§»åˆ°é«˜ 8 ä½ï¼Œä½ 8 ä½è¡¥ 0ï¼Œç„¶åå°† a Â» 8 å’Œ aÂ«8 è¿›è¡Œæˆ–æ“ä½œæ—¢å¯æ±‚å¾—äº¤æ¢åçš„ç»“æœ ã€‚ unsigned short a = 34520; a = (a \u003e\u003e 8) | (a \u003c\u003c 8); ","date":"2020-05-30","objectID":"/bit/:6:6","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"ä½æ“ä½œç»Ÿè®¡äºŒè¿›åˆ¶ä¸­ 1 çš„ä¸ªæ•° ç»Ÿè®¡äºŒè¿›åˆ¶1çš„ä¸ªæ•°å¯ä»¥åˆ†åˆ«è·å–æ¯ä¸ªäºŒè¿›åˆ¶ä½æ•°ï¼Œç„¶åå†ç»Ÿè®¡å…¶1çš„ä¸ªæ•°ï¼Œæ­¤æ–¹æ³•æ•ˆç‡æ¯”è¾ƒä½ã€‚ è¿™é‡Œä»‹ç»å¦å¤–ä¸€ç§é«˜æ•ˆçš„æ–¹æ³•ï¼ŒåŒæ ·ä»¥ 34520 ä¸ºä¾‹ï¼Œ æˆ‘ä»¬è®¡ç®—å…¶ a \u0026= (a-1)çš„ç»“æœï¼š ç¬¬ä¸€æ¬¡ï¼šè®¡ç®—å‰ï¼š1000 0110 1101 1000 è®¡ç®—åï¼š1000 0110 1101 0000 ç¬¬äºŒæ¬¡ï¼šè®¡ç®—å‰ï¼š1000 0110 1101 0000 è®¡ç®—åï¼š1000 0110 1100 0000 ç¬¬ä¸‰æ¬¡ï¼šè®¡ç®—å‰ï¼š1000 0110 1100 0000 è®¡ç®—åï¼š1000 0110 1000 0000 æˆ‘ä»¬å‘ç°ï¼Œæ¯è®¡ç®—ä¸€æ¬¡äºŒè¿›åˆ¶ä¸­å°±å°‘äº†ä¸€ä¸ª 1ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢æ–¹æ³•å»ç»Ÿè®¡ï¼šcount = 0 def count_1(a: int) -\u003e int: \"\"\" è®¡ç®—æ•°å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„1çš„æ•°é‡ :param a: :return: \"\"\" count = 0 while (a): a = a \u0026 a - 1 count += 1 return count ","date":"2020-05-30","objectID":"/bit/:6:7","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"æ±‚å’Œ ä¸¤æ•°æ±‚å’Œ func add(a int, b int) int { for b != 0 { sum := a ^ b carry := (a \u0026 b) \u003c\u003c 1 a = sum b = carry } return a } ","date":"2020-05-30","objectID":"/bit/:6:8","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"æ¯”ç‰¹ä½è®¡æ•° ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•° numã€‚å¯¹äº 0 â‰¤ i â‰¤ num èŒƒå›´ä¸­çš„æ¯ä¸ªæ•°å­— i ï¼Œè®¡ç®—å…¶äºŒè¿›åˆ¶æ•°ä¸­çš„ 1 çš„æ•°ç›®å¹¶å°†å®ƒä»¬ä½œä¸ºæ•°ç»„è¿”å›ã€‚ ç¤ºä¾‹ 1: è¾“å…¥: 2 è¾“å‡º: [0,1,1] ç¤ºä¾‹ 2: è¾“å…¥: 5 è¾“å‡º: [0,1,1,2,1,2] def countBits(num: int) -\u003e [int]: result = [0] * (num + 1) for i in range(1, num + 1): result[i] = result[i \u0026 i - 1] + 1 return result func countBits(num int) []int { result := make([]int, num+1) for i := 1; i \u003c num+1 ; i ++ { result[i] = result[i \u0026 (i-1)] + 1 } return result } ","date":"2020-05-30","objectID":"/bit/:6:9","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"å¸¸ç”¨çš„ç‰¹æ®Šçš„æ•° 0xaaaaaaaa = 10101010101010101010101010101010 (å¶æ•°ä½ä¸º1ï¼Œå¥‡æ•°ä½ä¸º0ï¼‰ 0x55555555 = 1010101010101010101010101010101 (å¶æ•°ä½ä¸º0ï¼Œå¥‡æ•°ä½ä¸º1ï¼‰ 0x33333333 = 110011001100110011001100110011 (1å’Œ0æ¯éš”ä¸¤ä½äº¤æ›¿å‡ºç°) 0xcccccccc = 11001100110011001100110011001100Â (0å’Œ1æ¯éš”ä¸¤ä½äº¤æ›¿å‡ºç°) 0x0f0f0f0f = 00001111000011110000111100001111Â (1å’Œ0æ¯éš”å››ä½äº¤æ›¿å‡ºç°) 0xf0f0f0f0 = 11110000111100001111000011110000Â (0å’Œ1æ¯éš”å››ä½äº¤æ›¿å‡ºç°) 0xffffffff = 11111111111111111111111111111111 ","date":"2020-05-30","objectID":"/bit/:7:0","tags":["ç®—æ³•","ä½è¿ç®—","bit"],"title":"ä½è¿ç®—","uri":"/bit/"},{"categories":null,"content":"äºŒå‰æœç´¢æ ‘","date":"2020-05-05","objectID":"/argorithm/binarysearchtree/","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/argorithm/binarysearchtree/"},{"categories":null,"content":"å®šä¹‰åŠç‰¹ç‚¹ äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆè‹±è¯­ï¼šBinary Search Treeï¼‰ï¼Œä¹Ÿç§°ä¸º äºŒå‰æœç´¢æ ‘ã€æœ‰åºäºŒå‰æ ‘ï¼ˆOrdered Binary Treeï¼‰æˆ–æ’åºäºŒå‰æ ‘ï¼ˆSorted Binary Treeï¼‰ï¼Œæ˜¯æŒ‡ä¸€æ£µç©ºæ ‘æˆ–è€…å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æ ‘ï¼š è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼› è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼› ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼› æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘ç›¸æ¯”äºå…¶ä»–æ•°æ®ç»“æ„çš„ä¼˜åŠ¿åœ¨äºæŸ¥æ‰¾ã€æ’å…¥çš„æ—¶é—´å¤æ‚åº¦è¾ƒä½ã€‚ä¸º O(logn)ã€‚äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯åŸºç¡€æ€§æ•°æ®ç»“æ„ï¼Œç”¨äºæ„å»ºæ›´ä¸ºæŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œå¦‚é›†åˆã€å¤šé‡é›†ã€å…³è”æ•°ç»„ç­‰ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾è¿‡ç¨‹å’Œæ¬¡ä¼˜äºŒå‰æ ‘ç±»ä¼¼ï¼Œé€šå¸¸é‡‡å–äºŒå‰é“¾è¡¨ä½œä¸ºäºŒå‰æŸ¥æ‰¾æ ‘çš„å­˜å‚¨ç»“æ„ã€‚ä¸­åºéå†äºŒå‰æŸ¥æ‰¾æ ‘å¯å¾—åˆ°ä¸€ä¸ªå…³é”®å­—çš„æœ‰åºåºåˆ—ï¼Œä¸€ä¸ªæ— åºåºåˆ—å¯ä»¥é€šè¿‡æ„é€ ä¸€æ£µäºŒå‰æŸ¥æ‰¾æ ‘å˜æˆä¸€ä¸ªæœ‰åºåºåˆ—ï¼Œæ„é€ æ ‘çš„è¿‡ç¨‹å³ä¸ºå¯¹æ— åºåºåˆ—è¿›è¡ŒæŸ¥æ‰¾çš„è¿‡ç¨‹ã€‚æ¯æ¬¡æ’å…¥çš„æ–°çš„ç»“ç‚¹éƒ½æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ä¸Šæ–°çš„å¶å­ç»“ç‚¹ï¼Œåœ¨è¿›è¡Œæ’å…¥æ“ä½œæ—¶ï¼Œä¸å¿…ç§»åŠ¨å…¶å®ƒç»“ç‚¹ï¼Œåªéœ€æ”¹åŠ¨æŸä¸ªç»“ç‚¹çš„æŒ‡é’ˆï¼Œç”±ç©ºå˜ä¸ºéç©ºå³å¯ã€‚æœç´¢ã€æ’å…¥ã€åˆ é™¤çš„å¤æ‚åº¦ç­‰äºæ ‘é«˜ï¼ŒæœŸæœ› O(\\log n)O(logn)ï¼Œæœ€å O(n)O(n)ï¼ˆæ•°åˆ—æœ‰åºï¼Œæ ‘é€€åŒ–æˆçº¿æ€§è¡¨ï¼‰ã€‚ è™½ç„¶äºŒå‰æŸ¥æ‰¾æ ‘çš„æœ€åæ•ˆç‡æ˜¯ O(n)O(n)ï¼Œä½†å®ƒæ”¯æŒåŠ¨æ€æŸ¥è¯¢ï¼Œä¸”æœ‰å¾ˆå¤šæ”¹è¿›ç‰ˆçš„äºŒå‰æŸ¥æ‰¾æ ‘å¯ä»¥ä½¿æ ‘é«˜ä¸º O(\\log n)O(logn)ï¼Œä»è€Œå°†æœ€åæ•ˆç‡é™è‡³ O(\\log n)O(logn)ï¼Œå¦‚ AVL æ ‘ã€çº¢é»‘æ ‘ç­‰ã€‚ ","date":"2020-05-05","objectID":"/argorithm/binarysearchtree/:1:0","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/argorithm/binarysearchtree/"},{"categories":null,"content":"å¸¸ç”¨æ“ä½œ ","date":"2020-05-05","objectID":"/argorithm/binarysearchtree/:2:0","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/argorithm/binarysearchtree/"},{"categories":null,"content":"æ ‘èŠ‚ç‚¹å®šä¹‰: class TreeNode: def __init__(self, val): self.val = val self.left = None self.right = None or type TreeNode struct { Val int Left *TreeNode Right *TreeNode } ","date":"2020-05-05","objectID":"/argorithm/binarysearchtree/:2:1","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/argorithm/binarysearchtree/"},{"categories":null,"content":"æŸ¥æ‰¾ åœ¨äºŒå‰æœç´¢æ ‘bä¸­æŸ¥æ‰¾xçš„è¿‡ç¨‹ä¸ºï¼š è‹¥bæ˜¯ç©ºæ ‘ï¼Œåˆ™æœç´¢å¤±è´¥ï¼Œå¦åˆ™ï¼š è‹¥xç­‰äºbçš„æ ¹èŠ‚ç‚¹çš„æ•°æ®åŸŸä¹‹å€¼ï¼Œåˆ™æŸ¥æ‰¾æˆåŠŸï¼›å¦åˆ™ï¼š è‹¥xå°äºbçš„æ ¹èŠ‚ç‚¹çš„æ•°æ®åŸŸä¹‹å€¼ï¼Œåˆ™é€’å½’æœç´¢å·¦å­æ ‘ï¼›å¦åˆ™: é€’å½’æŸ¥æ‰¾å³å­æ ‘ ","date":"2020-05-05","objectID":"/argorithm/binarysearchtree/:2:2","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/argorithm/binarysearchtree/"},{"categories":null,"content":"æ’å…¥ å‘ä¸€ä¸ªäºŒå‰æœç´¢æ ‘bä¸­æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹sçš„ç®—æ³•ï¼Œè¿‡ç¨‹ä¸ºï¼š è‹¥bæ˜¯ç©ºæ ‘ï¼Œåˆ™å°†sæ‰€æŒ‡ç»“ç‚¹ä½œä¸ºæ ¹èŠ‚ç‚¹æ’å…¥ï¼Œå¦åˆ™ï¼š è‹¥s.valç­‰äºbçš„æ ¹èŠ‚ç‚¹çš„æ•°æ®åŸŸä¹‹å€¼ï¼Œåˆ™è¿”å›ï¼Œå¦åˆ™ï¼š è‹¥s.valå°äºbçš„æ ¹èŠ‚ç‚¹çš„æ•°æ®åŸŸä¹‹å€¼ï¼Œåˆ™æŠŠsæ‰€æŒ‡èŠ‚ç‚¹æ’å…¥åˆ°å·¦å­æ ‘ä¸­ï¼Œå¦åˆ™ï¼š æŠŠsæ‰€æŒ‡èŠ‚ç‚¹æ’å…¥åˆ°å³å­æ ‘ä¸­ï¼ˆæ–°æ’å…¥èŠ‚ç‚¹æ€»æ˜¯å¶å­èŠ‚ç‚¹ï¼‰ ","date":"2020-05-05","objectID":"/argorithm/binarysearchtree/:2:3","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/argorithm/binarysearchtree/"},{"categories":null,"content":"åˆ é™¤ äºŒå‰æœç´¢æ ‘çš„åˆ é™¤æ“ä½œåˆ†ä¸‰ç§æƒ…å†µè®¨è®º: å¦‚æœå¾…åˆ é™¤çš„èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥ç«‹å³è¢«åˆ é™¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¾‹ï¼šåˆ é™¤æ•°æ®ä¸º16çš„èŠ‚ç‚¹ï¼Œæ˜¯å¶å­èŠ‚ç‚¹ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ å¦‚æœæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œè¦å°†ä¸‹ä¸€ä¸ªå­èŠ‚ç‚¹ä¸Šç§»åˆ°å½“å‰èŠ‚ç‚¹ï¼Œå³æ›¿æ¢ä¹‹ ä¾‹ï¼šåˆ é™¤æ•°æ®ä¸º25çš„èŠ‚ç‚¹ï¼Œå®ƒä¸‹é¢æœ‰å”¯ä¸€ä¸€ä¸ªå­èŠ‚ç‚¹35, ä¸Šç§»åˆ°æ›¿æ¢ä¹‹ å¦‚æœæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™å°†å…¶å³å­æ ‘çš„æœ€å°æ•°æ®ä»£æ›¿æ­¤èŠ‚ç‚¹çš„æ•°æ®ï¼Œå¹¶å°†å…¶å³å­æ ‘çš„æœ€å°æ•°æ®åˆ é™¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ä¾‹ï¼šåˆ é™¤èŠ‚ç‚¹æ•°æ®ä¸º5çš„èŠ‚ç‚¹ï¼Œæ‰¾åˆ°è¢«åˆ é™¤èŠ‚ç‚¹å³å­æ ‘çš„æœ€å°èŠ‚ç‚¹ã€‚éœ€è¦ä¸€ä¸ªä¸´æ—¶å˜é‡successorï¼Œå°†11èŠ‚ç‚¹ä¸‹é¢çš„å­èŠ‚ç‚¹è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰¾åˆ°å³å­æ ‘æœ€å°èŠ‚ç‚¹7ï¼Œå¹¶æŠŠå³å­æ ‘æœ€å°èŠ‚ç‚¹7æ›¿æ¢è¢«åˆ é™¤èŠ‚ç‚¹ï¼Œç»´æŒäºŒå‰æ ‘ç»“æ„ã€‚å¦‚ä¸‹å›¾ ","date":"2020-05-05","objectID":"/argorithm/binarysearchtree/:2:4","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/argorithm/binarysearchtree/"},{"categories":null,"content":"éå† å¯ä»¥é‡‡ç”¨å‰åºï¼Œä¸­åºï¼Œååºæ¥éå†è¯¥äºŒå‰æœç´¢æ ‘ï¼Œæˆ–è€…ä½¿ç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢çš„æ–¹å¼ã€‚è¿™é‡Œç”¨ä¸­åºéå†æ¥å®ç°ï¼Œå¯ä»¥ä¿è¯æŒ‰ä»å°åˆ°å¤§çš„é¡ºåºæ‰“å°ã€‚ ","date":"2020-05-05","objectID":"/argorithm/binarysearchtree/:2:5","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/argorithm/binarysearchtree/"},{"categories":null,"content":"æ„é€ ä¸€é¢—äºŒå‰æŸ¥æ‰¾æ ‘ ç”¨ä¸€ç»„æ•°å€¼å»ºé€ ä¸€æ£µäºŒå‰æŸ¥æ‰¾æ ‘çš„åŒæ—¶ï¼Œä¹ŸæŠŠè¿™ç»„æ•°å€¼è¿›è¡Œäº†æ’åºã€‚å…¶æœ€å·®æ—¶é—´å¤æ‚åº¦ä¸º O(n2)ã€‚ä¾‹å¦‚ï¼Œè‹¥è¯¥ç»„æ•°å€¼ç»æ˜¯æœ‰åºçš„ï¼ˆä»å°åˆ°å¤§ï¼‰ï¼Œåˆ™å»ºé€ å‡ºæ¥çš„äºŒå‰æŸ¥æ‰¾æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œéƒ½æ²¡æœ‰å·¦å­æ ‘ ","date":"2020-05-05","objectID":"/argorithm/binarysearchtree/:2:6","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/argorithm/binarysearchtree/"},{"categories":null,"content":"å¸¸ç”¨æ“ä½œçš„å®ç° pythonç‰ˆ # èŠ‚ç‚¹å®šä¹‰ class TreeNode: def __init__(self, x): self.val = x self.left = None self.right = None # æŸ¥æ‰¾ def search(root: TreeNode, val: int) -\u003e (bool, TreeNode): if root == None: return False, None elif val \u003e root.val: return search(root.right, val) elif val \u003c root.val: return search(root.left, val) else: return True, root # æ’å…¥ def insert(root: TreeNode, node: TreeNode) -\u003e TreeNode: \"\"\"insert inplace\"\"\" if root == None: root = node return root elif node.val \u003e root.val: root.right = insert(root.right, node) else: root.left = insert(root.left, node) return root # åˆ é™¤ def deleteNode(root: TreeNode, key: int) -\u003e TreeNode: \"\"\" :type root: TreeNode :type key: int :rtype: TreeNode \"\"\" if root == None: return None if key \u003c root.val: root.left = deleteNode(root.left, key) elif key \u003e root.val: root.right = deleteNode(root.right, key) else: if root.left == None: return root.right elif root.right == None: return root.left else: min_node = findMinNode(root.right) root.val = min_node.val root.right = deleteNode(root.right, root.val) return root def findMinNode(node: TreeNode) -\u003e TreeNode: while node.left: node = node.left return node # ä¸­åºéå† def traverse_binary_tree(root: TreeNode): if root is None: return traverse_binary_tree(root.left) print(root.val) traverse_binary_tree(root.right) # æ„å»ºäºŒå‰æ ‘ def build_binary_tree(values: [int]): tree = None for v in values: tree = insert(tree, TreeNode(v)) return tree if __name__ == \"__main__\": values = [17, 5, 35, 2, 11, 29, 38, 9, 16, 7] # æ„é€ äºŒå‰æ ‘ node = build_binary_tree(values) # æŸ¥æ‰¾ node_7 = search(node, 35) # éå† traverse_binary_tree(node) # åˆ é™¤ a = deleteNode(node, 5) print() golangç‰ˆ: package main import \"fmt\" type TreeNode struct { Val int Left *TreeNode Right *TreeNode } func main() { values := []int{17, 5, 35, 2, 11, 29, 38, 9, 16, 7} // æµ‹è¯•æ„é€ äºŒå‰æ ‘ node := buildBinarySearchTree(values) // éå† traverseBinarySearchTree(node) // æœç´¢ ok, child := search(node, 11) // åˆ é™¤ new_node := deleteTreenode(node, 35) fmt.Println(new_node) fmt.Println(ok, child) } // æŸ¥æ‰¾ func search(root *TreeNode, val int) (bool, *TreeNode) { if root == nil { return false, nil } if root.Val == val { return true, root } else if root.Val \u003c val { return search(root.Right, val) } else { return search(root.Left, val) } } // æ’å…¥ func insert(root, node *TreeNode) *TreeNode { if root == nil { root = node return root } if root.Val \u003e node.Val { root.Left = insert(root.Left, node) } else { root.Right = insert(root.Right, node) } return root } // åˆ é™¤ func deleteTreenode(root *TreeNode, val int) *TreeNode { if root == nil { return nil } if root.Val \u003e val { root.Left = deleteTreenode(root.Left, val) } else if root.Val \u003c val { root.Right = deleteTreenode(root.Right, val) } else { if root.Left == nil { return root.Right } else if root.Right == nil { return root.Left } else { min_node := findMinNode(root.Right) root.Val = min_node.Val root.Right = deleteTreenode(root.Right, min_node.Val) } } return root } func findMinNode(root *TreeNode) *TreeNode { for root.Left != nil { root = root.Left } return root } // ä¸­åºéå† func traverseBinarySearchTree(root *TreeNode) { if root == nil { return } traverseBinarySearchTree(root.Left) fmt.Println(root.Val) traverseBinarySearchTree(root.Right) } // æ„å»ºäºŒå‰æœç´¢æ ‘ func buildBinarySearchTree(values []int) *TreeNode { var node *TreeNode = nil for _, value := range values { node = insert(node, \u0026TreeNode{Val: value}) } return node } ","date":"2020-05-05","objectID":"/argorithm/binarysearchtree/:3:0","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/argorithm/binarysearchtree/"},{"categories":null,"content":"æ€§èƒ½åˆ†æ æŸ¥æ‰¾ï¼šæœ€ä½³æƒ…å†µOlog(n), æœ€åæƒ…å†µO(n) æ’å…¥ï¼šæœ€ä½³æƒ…å†µOlog(n), æœ€åæƒ…å†µO(n) åˆ é™¤ï¼šæœ€ä½³æƒ…å†µOlog(n), æœ€åæƒ…å†µO(n) ","date":"2020-05-05","objectID":"/argorithm/binarysearchtree/:4:0","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/argorithm/binarysearchtree/"},{"categories":null,"content":"äºŒå‰æœç´¢æ ‘","date":"2020-05-05","objectID":"/binarysearchtree/","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/binarysearchtree/"},{"categories":null,"content":"å®šä¹‰åŠç‰¹ç‚¹ äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆè‹±è¯­ï¼šBinary Search Treeï¼‰ï¼Œä¹Ÿç§°ä¸º äºŒå‰æœç´¢æ ‘ã€æœ‰åºäºŒå‰æ ‘ï¼ˆOrdered Binary Treeï¼‰æˆ–æ’åºäºŒå‰æ ‘ï¼ˆSorted Binary Treeï¼‰ï¼Œæ˜¯æŒ‡ä¸€æ£µç©ºæ ‘æˆ–è€…å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æ ‘ï¼š è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼› è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼› ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼› æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘ç›¸æ¯”äºå…¶ä»–æ•°æ®ç»“æ„çš„ä¼˜åŠ¿åœ¨äºæŸ¥æ‰¾ã€æ’å…¥çš„æ—¶é—´å¤æ‚åº¦è¾ƒä½ã€‚ä¸º O(logn)ã€‚äºŒå‰æŸ¥æ‰¾æ ‘æ˜¯åŸºç¡€æ€§æ•°æ®ç»“æ„ï¼Œç”¨äºæ„å»ºæ›´ä¸ºæŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œå¦‚é›†åˆã€å¤šé‡é›†ã€å…³è”æ•°ç»„ç­‰ã€‚ äºŒå‰æŸ¥æ‰¾æ ‘çš„æŸ¥æ‰¾è¿‡ç¨‹å’Œæ¬¡ä¼˜äºŒå‰æ ‘ç±»ä¼¼ï¼Œé€šå¸¸é‡‡å–äºŒå‰é“¾è¡¨ä½œä¸ºäºŒå‰æŸ¥æ‰¾æ ‘çš„å­˜å‚¨ç»“æ„ã€‚ä¸­åºéå†äºŒå‰æŸ¥æ‰¾æ ‘å¯å¾—åˆ°ä¸€ä¸ªå…³é”®å­—çš„æœ‰åºåºåˆ—ï¼Œä¸€ä¸ªæ— åºåºåˆ—å¯ä»¥é€šè¿‡æ„é€ ä¸€æ£µäºŒå‰æŸ¥æ‰¾æ ‘å˜æˆä¸€ä¸ªæœ‰åºåºåˆ—ï¼Œæ„é€ æ ‘çš„è¿‡ç¨‹å³ä¸ºå¯¹æ— åºåºåˆ—è¿›è¡ŒæŸ¥æ‰¾çš„è¿‡ç¨‹ã€‚æ¯æ¬¡æ’å…¥çš„æ–°çš„ç»“ç‚¹éƒ½æ˜¯äºŒå‰æŸ¥æ‰¾æ ‘ä¸Šæ–°çš„å¶å­ç»“ç‚¹ï¼Œåœ¨è¿›è¡Œæ’å…¥æ“ä½œæ—¶ï¼Œä¸å¿…ç§»åŠ¨å…¶å®ƒç»“ç‚¹ï¼Œåªéœ€æ”¹åŠ¨æŸä¸ªç»“ç‚¹çš„æŒ‡é’ˆï¼Œç”±ç©ºå˜ä¸ºéç©ºå³å¯ã€‚æœç´¢ã€æ’å…¥ã€åˆ é™¤çš„å¤æ‚åº¦ç­‰äºæ ‘é«˜ï¼ŒæœŸæœ› O(\\log n)O(logn)ï¼Œæœ€å O(n)O(n)ï¼ˆæ•°åˆ—æœ‰åºï¼Œæ ‘é€€åŒ–æˆçº¿æ€§è¡¨ï¼‰ã€‚ è™½ç„¶äºŒå‰æŸ¥æ‰¾æ ‘çš„æœ€åæ•ˆç‡æ˜¯ O(n)O(n)ï¼Œä½†å®ƒæ”¯æŒåŠ¨æ€æŸ¥è¯¢ï¼Œä¸”æœ‰å¾ˆå¤šæ”¹è¿›ç‰ˆçš„äºŒå‰æŸ¥æ‰¾æ ‘å¯ä»¥ä½¿æ ‘é«˜ä¸º O(\\log n)O(logn)ï¼Œä»è€Œå°†æœ€åæ•ˆç‡é™è‡³ O(\\log n)O(logn)ï¼Œå¦‚ AVL æ ‘ã€çº¢é»‘æ ‘ç­‰ã€‚ ","date":"2020-05-05","objectID":"/binarysearchtree/:1:0","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/binarysearchtree/"},{"categories":null,"content":"å¸¸ç”¨æ“ä½œ ","date":"2020-05-05","objectID":"/binarysearchtree/:2:0","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/binarysearchtree/"},{"categories":null,"content":"æ ‘èŠ‚ç‚¹å®šä¹‰: class TreeNode: def __init__(self, val): self.val = val self.left = None self.right = None or type TreeNode struct { Val int Left *TreeNode Right *TreeNode } ","date":"2020-05-05","objectID":"/binarysearchtree/:2:1","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/binarysearchtree/"},{"categories":null,"content":"æŸ¥æ‰¾ åœ¨äºŒå‰æœç´¢æ ‘bä¸­æŸ¥æ‰¾xçš„è¿‡ç¨‹ä¸ºï¼š è‹¥bæ˜¯ç©ºæ ‘ï¼Œåˆ™æœç´¢å¤±è´¥ï¼Œå¦åˆ™ï¼š è‹¥xç­‰äºbçš„æ ¹èŠ‚ç‚¹çš„æ•°æ®åŸŸä¹‹å€¼ï¼Œåˆ™æŸ¥æ‰¾æˆåŠŸï¼›å¦åˆ™ï¼š è‹¥xå°äºbçš„æ ¹èŠ‚ç‚¹çš„æ•°æ®åŸŸä¹‹å€¼ï¼Œåˆ™é€’å½’æœç´¢å·¦å­æ ‘ï¼›å¦åˆ™: é€’å½’æŸ¥æ‰¾å³å­æ ‘ ","date":"2020-05-05","objectID":"/binarysearchtree/:2:2","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/binarysearchtree/"},{"categories":null,"content":"æ’å…¥ å‘ä¸€ä¸ªäºŒå‰æœç´¢æ ‘bä¸­æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹sçš„ç®—æ³•ï¼Œè¿‡ç¨‹ä¸ºï¼š è‹¥bæ˜¯ç©ºæ ‘ï¼Œåˆ™å°†sæ‰€æŒ‡ç»“ç‚¹ä½œä¸ºæ ¹èŠ‚ç‚¹æ’å…¥ï¼Œå¦åˆ™ï¼š è‹¥s.valç­‰äºbçš„æ ¹èŠ‚ç‚¹çš„æ•°æ®åŸŸä¹‹å€¼ï¼Œåˆ™è¿”å›ï¼Œå¦åˆ™ï¼š è‹¥s.valå°äºbçš„æ ¹èŠ‚ç‚¹çš„æ•°æ®åŸŸä¹‹å€¼ï¼Œåˆ™æŠŠsæ‰€æŒ‡èŠ‚ç‚¹æ’å…¥åˆ°å·¦å­æ ‘ä¸­ï¼Œå¦åˆ™ï¼š æŠŠsæ‰€æŒ‡èŠ‚ç‚¹æ’å…¥åˆ°å³å­æ ‘ä¸­ï¼ˆæ–°æ’å…¥èŠ‚ç‚¹æ€»æ˜¯å¶å­èŠ‚ç‚¹ï¼‰ ","date":"2020-05-05","objectID":"/binarysearchtree/:2:3","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/binarysearchtree/"},{"categories":null,"content":"åˆ é™¤ äºŒå‰æœç´¢æ ‘çš„åˆ é™¤æ“ä½œåˆ†ä¸‰ç§æƒ…å†µè®¨è®º: å¦‚æœå¾…åˆ é™¤çš„èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥ç«‹å³è¢«åˆ é™¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¾‹ï¼šåˆ é™¤æ•°æ®ä¸º16çš„èŠ‚ç‚¹ï¼Œæ˜¯å¶å­èŠ‚ç‚¹ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ å¦‚æœæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œè¦å°†ä¸‹ä¸€ä¸ªå­èŠ‚ç‚¹ä¸Šç§»åˆ°å½“å‰èŠ‚ç‚¹ï¼Œå³æ›¿æ¢ä¹‹ ä¾‹ï¼šåˆ é™¤æ•°æ®ä¸º25çš„èŠ‚ç‚¹ï¼Œå®ƒä¸‹é¢æœ‰å”¯ä¸€ä¸€ä¸ªå­èŠ‚ç‚¹35, ä¸Šç§»åˆ°æ›¿æ¢ä¹‹ å¦‚æœæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™å°†å…¶å³å­æ ‘çš„æœ€å°æ•°æ®ä»£æ›¿æ­¤èŠ‚ç‚¹çš„æ•°æ®ï¼Œå¹¶å°†å…¶å³å­æ ‘çš„æœ€å°æ•°æ®åˆ é™¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º ä¾‹ï¼šåˆ é™¤èŠ‚ç‚¹æ•°æ®ä¸º5çš„èŠ‚ç‚¹ï¼Œæ‰¾åˆ°è¢«åˆ é™¤èŠ‚ç‚¹å³å­æ ‘çš„æœ€å°èŠ‚ç‚¹ã€‚éœ€è¦ä¸€ä¸ªä¸´æ—¶å˜é‡successorï¼Œå°†11èŠ‚ç‚¹ä¸‹é¢çš„å­èŠ‚ç‚¹è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰¾åˆ°å³å­æ ‘æœ€å°èŠ‚ç‚¹7ï¼Œå¹¶æŠŠå³å­æ ‘æœ€å°èŠ‚ç‚¹7æ›¿æ¢è¢«åˆ é™¤èŠ‚ç‚¹ï¼Œç»´æŒäºŒå‰æ ‘ç»“æ„ã€‚å¦‚ä¸‹å›¾ ","date":"2020-05-05","objectID":"/binarysearchtree/:2:4","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/binarysearchtree/"},{"categories":null,"content":"éå† å¯ä»¥é‡‡ç”¨å‰åºï¼Œä¸­åºï¼Œååºæ¥éå†è¯¥äºŒå‰æœç´¢æ ‘ï¼Œæˆ–è€…ä½¿ç”¨å¹¿åº¦ä¼˜å…ˆæœç´¢çš„æ–¹å¼ã€‚è¿™é‡Œç”¨ä¸­åºéå†æ¥å®ç°ï¼Œå¯ä»¥ä¿è¯æŒ‰ä»å°åˆ°å¤§çš„é¡ºåºæ‰“å°ã€‚ ","date":"2020-05-05","objectID":"/binarysearchtree/:2:5","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/binarysearchtree/"},{"categories":null,"content":"æ„é€ ä¸€é¢—äºŒå‰æŸ¥æ‰¾æ ‘ ç”¨ä¸€ç»„æ•°å€¼å»ºé€ ä¸€æ£µäºŒå‰æŸ¥æ‰¾æ ‘çš„åŒæ—¶ï¼Œä¹ŸæŠŠè¿™ç»„æ•°å€¼è¿›è¡Œäº†æ’åºã€‚å…¶æœ€å·®æ—¶é—´å¤æ‚åº¦ä¸º O(n2)ã€‚ä¾‹å¦‚ï¼Œè‹¥è¯¥ç»„æ•°å€¼ç»æ˜¯æœ‰åºçš„ï¼ˆä»å°åˆ°å¤§ï¼‰ï¼Œåˆ™å»ºé€ å‡ºæ¥çš„äºŒå‰æŸ¥æ‰¾æ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œéƒ½æ²¡æœ‰å·¦å­æ ‘ ","date":"2020-05-05","objectID":"/binarysearchtree/:2:6","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/binarysearchtree/"},{"categories":null,"content":"å¸¸ç”¨æ“ä½œçš„å®ç° pythonç‰ˆ # èŠ‚ç‚¹å®šä¹‰ class TreeNode: def __init__(self, x): self.val = x self.left = None self.right = None # æŸ¥æ‰¾ def search(root: TreeNode, val: int) -\u003e (bool, TreeNode): if root == None: return False, None elif val \u003e root.val: return search(root.right, val) elif val \u003c root.val: return search(root.left, val) else: return True, root # æ’å…¥ def insert(root: TreeNode, node: TreeNode) -\u003e TreeNode: \"\"\"insert inplace\"\"\" if root == None: root = node return root elif node.val \u003e root.val: root.right = insert(root.right, node) else: root.left = insert(root.left, node) return root # åˆ é™¤ def deleteNode(root: TreeNode, key: int) -\u003e TreeNode: \"\"\" :type root: TreeNode :type key: int :rtype: TreeNode \"\"\" if root == None: return None if key \u003c root.val: root.left = deleteNode(root.left, key) elif key \u003e root.val: root.right = deleteNode(root.right, key) else: if root.left == None: return root.right elif root.right == None: return root.left else: min_node = findMinNode(root.right) root.val = min_node.val root.right = deleteNode(root.right, root.val) return root def findMinNode(node: TreeNode) -\u003e TreeNode: while node.left: node = node.left return node # ä¸­åºéå† def traverse_binary_tree(root: TreeNode): if root is None: return traverse_binary_tree(root.left) print(root.val) traverse_binary_tree(root.right) # æ„å»ºäºŒå‰æ ‘ def build_binary_tree(values: [int]): tree = None for v in values: tree = insert(tree, TreeNode(v)) return tree if __name__ == \"__main__\": values = [17, 5, 35, 2, 11, 29, 38, 9, 16, 7] # æ„é€ äºŒå‰æ ‘ node = build_binary_tree(values) # æŸ¥æ‰¾ node_7 = search(node, 35) # éå† traverse_binary_tree(node) # åˆ é™¤ a = deleteNode(node, 5) print() golangç‰ˆ: package main import \"fmt\" type TreeNode struct { Val int Left *TreeNode Right *TreeNode } func main() { values := []int{17, 5, 35, 2, 11, 29, 38, 9, 16, 7} // æµ‹è¯•æ„é€ äºŒå‰æ ‘ node := buildBinarySearchTree(values) // éå† traverseBinarySearchTree(node) // æœç´¢ ok, child := search(node, 11) // åˆ é™¤ new_node := deleteTreenode(node, 35) fmt.Println(new_node) fmt.Println(ok, child) } // æŸ¥æ‰¾ func search(root *TreeNode, val int) (bool, *TreeNode) { if root == nil { return false, nil } if root.Val == val { return true, root } else if root.Val \u003c val { return search(root.Right, val) } else { return search(root.Left, val) } } // æ’å…¥ func insert(root, node *TreeNode) *TreeNode { if root == nil { root = node return root } if root.Val \u003e node.Val { root.Left = insert(root.Left, node) } else { root.Right = insert(root.Right, node) } return root } // åˆ é™¤ func deleteTreenode(root *TreeNode, val int) *TreeNode { if root == nil { return nil } if root.Val \u003e val { root.Left = deleteTreenode(root.Left, val) } else if root.Val \u003c val { root.Right = deleteTreenode(root.Right, val) } else { if root.Left == nil { return root.Right } else if root.Right == nil { return root.Left } else { min_node := findMinNode(root.Right) root.Val = min_node.Val root.Right = deleteTreenode(root.Right, min_node.Val) } } return root } func findMinNode(root *TreeNode) *TreeNode { for root.Left != nil { root = root.Left } return root } // ä¸­åºéå† func traverseBinarySearchTree(root *TreeNode) { if root == nil { return } traverseBinarySearchTree(root.Left) fmt.Println(root.Val) traverseBinarySearchTree(root.Right) } // æ„å»ºäºŒå‰æœç´¢æ ‘ func buildBinarySearchTree(values []int) *TreeNode { var node *TreeNode = nil for _, value := range values { node = insert(node, \u0026TreeNode{Val: value}) } return node } ","date":"2020-05-05","objectID":"/binarysearchtree/:3:0","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/binarysearchtree/"},{"categories":null,"content":"æ€§èƒ½åˆ†æ æŸ¥æ‰¾ï¼šæœ€ä½³æƒ…å†µOlog(n), æœ€åæƒ…å†µO(n) æ’å…¥ï¼šæœ€ä½³æƒ…å†µOlog(n), æœ€åæƒ…å†µO(n) åˆ é™¤ï¼šæœ€ä½³æƒ…å†µOlog(n), æœ€åæƒ…å†µO(n) ","date":"2020-05-05","objectID":"/binarysearchtree/:4:0","tags":["ç®—æ³•","binarySearchTree","äºŒå‰æœç´¢æ ‘"],"title":"äºŒå‰æœç´¢æ ‘","uri":"/binarysearchtree/"},{"categories":null,"content":"How to run jenkins on kubernetes","date":"2020-02-08","objectID":"/opensrouce/k8s_jenkins/","tags":["kubernetes","jenkins"],"title":"How to run jenkins on kubernetes","uri":"/opensrouce/k8s_jenkins/"},{"categories":null,"content":"ä½œç”¨ å¦‚ä½•åœ¨Kubernetesç¯å¢ƒä¸­è¿è¡Œjenkins ","date":"2020-02-08","objectID":"/opensrouce/k8s_jenkins/:1:0","tags":["kubernetes","jenkins"],"title":"How to run jenkins on kubernetes","uri":"/opensrouce/k8s_jenkins/"},{"categories":null,"content":"é¡¹ç›®åœ°å€ https://github.com/russellgao/k8s_jenkins ","date":"2020-02-08","objectID":"/opensrouce/k8s_jenkins/:2:0","tags":["kubernetes","jenkins"],"title":"How to run jenkins on kubernetes","uri":"/opensrouce/k8s_jenkins/"},{"categories":null,"content":"å‚è€ƒ https://mp.weixin.qq.com/s/7YFlmcUH5iOB2XOBIZ2_rA ","date":"2020-02-08","objectID":"/opensrouce/k8s_jenkins/:3:0","tags":["kubernetes","jenkins"],"title":"How to run jenkins on kubernetes","uri":"/opensrouce/k8s_jenkins/"},{"categories":null,"content":"åœ¨k8s ä¸­è¿è¡ŒEKL","date":"2020-01-04","objectID":"/opensrouce/k8s_elk/","tags":["kubernetes","ELK"],"title":"ELK stack on kubernetes","uri":"/opensrouce/k8s_elk/"},{"categories":null,"content":"ä½œç”¨ å¦‚ä½•åœ¨Kubernetesç¯å¢ƒä¸­è¿è¡ŒELK Stack ","date":"2020-01-04","objectID":"/opensrouce/k8s_elk/:1:0","tags":["kubernetes","ELK"],"title":"ELK stack on kubernetes","uri":"/opensrouce/k8s_elk/"},{"categories":null,"content":"é¡¹ç›®åœ°å€ https://github.com/russellgao/k8s_elk ","date":"2020-01-04","objectID":"/opensrouce/k8s_elk/:2:0","tags":["kubernetes","ELK"],"title":"ELK stack on kubernetes","uri":"/opensrouce/k8s_elk/"},{"categories":null,"content":"ç”¨æ³• manifests Can run in production environment experimental In the experimental stage ä½¿ç”¨ä¹‹å‰éœ€è¦ä¿®æ”¹å„ä¸ªyamlæ–‡ä»¶çš„Storageï¼ŒServiceç›¸å…³çš„å‚æ•°ï¼Œæ ¹æ®å®é™…æƒ…å†µé€‰æ‹©åˆé€‚çš„ä»‹è´¨ï¼Œä¿®æ”¹å®Œä¹‹åæ‰§è¡Œkubectl -f manifests å³å¯ã€‚ è¯¦ç»†ä¿¡æ¯å‚è€ƒ github ","date":"2020-01-04","objectID":"/opensrouce/k8s_elk/:3:0","tags":["kubernetes","ELK"],"title":"ELK stack on kubernetes","uri":"/opensrouce/k8s_elk/"},{"categories":null,"content":"æ”¯æŒçš„ç»„ä»¶ es logstash kibana kafka zookeeper ","date":"2020-01-04","objectID":"/opensrouce/k8s_elk/:4:0","tags":["kubernetes","ELK"],"title":"ELK stack on kubernetes","uri":"/opensrouce/k8s_elk/"},{"categories":null,"content":"More https://mp.weixin.qq.com/s/93_Jf8P69Q0nkw1Ip7MsFQ ","date":"2020-01-04","objectID":"/opensrouce/k8s_elk/:5:0","tags":["kubernetes","ELK"],"title":"ELK stack on kubernetes","uri":"/opensrouce/k8s_elk/"}]